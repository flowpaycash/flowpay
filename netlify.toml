# FLOWPay - Netlify Configuration
# Configuração simplificada para desenvolvimento local

[build]
  publish = "public"
  command = "echo 'Build não necessário - arquivos estáticos'"

[functions]
  directory = "netlify/functions"

# Variáveis de ambiente para produção
[context.production.environment]
  # WOOVI_API_KEY deve ser configurada via Netlify UI
  # WOOVI_WEBHOOK_SECRET deve ser configurada via Netlify UI
  # SERVER_WALLET_PRIVATE_KEY deve ser configurada via Netlify UI (chave privada da wallet do servidor)
  # BRL_TO_USD_RATE deve ser configurada via Netlify UI (taxa de conversão BRL/USD, padrão: 5.0)
  WOOVI_API_URL = "https://api.woovi.com"
  NODE_ENV = "production"
  URL = "https://flowpaypix.netlify.app"
  ADMIN_PASSWORD = "flowpay2024"

# Variáveis de ambiente para preview (staging)
[context.deploy-preview.environment]
  # WOOVI_API_KEY deve ser configurada via Netlify UI
  # WOOVI_WEBHOOK_SECRET deve ser configurada via Netlify UI
  # SERVER_WALLET_PRIVATE_KEY deve ser configurada via Netlify UI (chave privada da wallet do servidor)
  # BRL_TO_USD_RATE deve ser configurada via Netlify UI (taxa de conversão BRL/USD, padrão: 5.0)
  WOOVI_API_URL = "https://api.woovi.com"
  NODE_ENV = "staging"
  ADMIN_PASSWORD = "flowpay2024"

# Headers de segurança HTTPS obrigatórios
[[headers]]
  for = "/*"
  [headers.values]
    # Content Security Policy
    Content-Security-Policy = "default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'; img-src 'self' data: https:; font-src 'self'; connect-src 'self' https://rpc.ankr.com https://*.web3auth.io https://*.walletconnect.com https://*.torus.sh; frame-src 'self' https://*.web3auth.io; base-uri 'self'; object-src 'none';"
    
    # CORS e Cross-Origin
    Cross-Origin-Opener-Policy = "same-origin"
    Cross-Origin-Resource-Policy = "same-origin"
    Cross-Origin-Embedder-Policy = "require-corp"
    
    # HTTPS obrigatório
    Strict-Transport-Security = "max-age=31536000; includeSubDomains; preload"
    
    # Proteção contra clickjacking
    X-Frame-Options = "DENY"
    
    # Proteção contra MIME type sniffing
    X-Content-Type-Options = "nosniff"
    
    # Proteção contra XSS
    X-XSS-Protection = "1; mode=block"
    
    # Referrer Policy
    Referrer-Policy = "strict-origin-when-cross-origin"
    
    # Permissions Policy
    Permissions-Policy = "geolocation=(), microphone=(), camera=(), payment=(), usb=(), magnetometer=(), gyroscope=(), accelerometer=()"

# Redirects para SPA (excluindo funções Netlify)
[[redirects]]
  from = "/*"
  to = "/index.html"
  status = 200
  exclude = ["/.netlify/functions/*", "/login", "/auth/*", "/client", "/login-test"]

# Rotas específicas de autenticação
[[redirects]]
  from = "/login"
  to = "/login.html"
  status = 200

[[redirects]]
  from = "/auth/*"
  to = "/auth/verify.html"
  status = 200

[[redirects]]
  from = "/client"
  to = "/client.html"
  status = 200

[[redirects]]
  from = "/login-test"
  to = "/login-test.html"
  status = 200