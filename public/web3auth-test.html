<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Web3Auth Test - FLOWPay</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .status {
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }
        .status.success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .status.error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .status.info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            margin: 10px 5px;
            font-size: 16px;
        }
        button:hover { background: #0056b3; }
        button:disabled { background: #6c757d; cursor: not-allowed; }
        .log {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            padding: 15px;
            margin: 15px 0;
            font-family: monospace;
            font-size: 14px;
            max-height: 300px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Web3Auth Test - FLOWPay</h1>
        <p>Teste de integra√ß√£o do Web3Auth com import map e CSP otimizada.</p>
        
        <div id="status" class="status info">
            üîÑ Inicializando...
        </div>
        
        <div>
            <button id="init-btn" onclick="testInit()">üöÄ Inicializar Web3Auth</button>
            <button id="connect-btn" onclick="testConnect()" disabled>üîó Conectar Carteira</button>
            <button id="disconnect-btn" onclick="testDisconnect()" disabled>üîå Desconectar</button>
        </div>
        
        <div class="log" id="log">
            Log de eventos aparecer√° aqui...
        </div>
    </div>

    <!-- Import Map para Web3Auth -->
    <!-- Web3Auth - Bundle local -->

    <!-- CSP Config -->
    <script src="csp-config.js"></script>

    <script type="module">
        // Teste de importa√ß√£o
        try {
            console.log('üß™ Testando importa√ß√£o do Web3Auth...');
            
            const { Web3Auth } = await import('@web3auth/modal');
            console.log('‚úÖ Web3Auth importado com sucesso:', Web3Auth);
            
            // Teste de importa√ß√£o do Web3
            const Web3 = (await import('web3')).default;
            console.log('‚úÖ Web3 importado com sucesso:', Web3);
            
            // Configura√ß√£o de teste
            const testConfig = {
                clientId: '9afb8749df8f4370aded1dce851d13f4',
                web3AuthNetwork: 'testnet',
                chainConfig: {
                    chainNamespace: "eip155",
                    chainId: "0x5", // Goerli testnet
                    rpcTarget: "https://rpc.ankr.com/eth_goerli",
                    displayName: "Ethereum Goerli",
                    blockExplorer: "https://goerli.etherscan.io",
                    ticker: "ETH",
                    tickerName: "Ethereum"
                }
            };
            
            // Criar inst√¢ncia
            const web3auth = new Web3Auth(testConfig);
            console.log('‚úÖ Inst√¢ncia Web3Auth criada:', web3auth);
            
            // Inicializar
            await web3auth.initModal();
            console.log('‚úÖ Web3Auth inicializado com sucesso!');
            
            // Exportar para uso global
            window.web3auth = web3auth;
            window.testConfig = testConfig;
            
            // Atualizar status
            document.getElementById('status').className = 'status success';
            document.getElementById('status').textContent = '‚úÖ Web3Auth inicializado com sucesso!';
            document.getElementById('init-btn').disabled = true;
            document.getElementById('connect-btn').disabled = false;
            
            addLog('‚úÖ Web3Auth inicializado com sucesso!');
            
        } catch (error) {
            console.error('‚ùå Erro na inicializa√ß√£o:', error);
            
            document.getElementById('status').className = 'status error';
            document.getElementById('status').textContent = `‚ùå Erro: ${error.message}`;
            
            addLog(`‚ùå Erro na inicializa√ß√£o: ${error.message}`);
        }
        
        // Fun√ß√£o para adicionar logs
        function addLog(message) {
            const log = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            log.innerHTML += `[${timestamp}] ${message}\n`;
            log.scrollTop = log.scrollHeight;
        }
        
        // Exportar fun√ß√£o de log
        window.addLog = addLog;
    </script>

    <script>
        // Fun√ß√µes de teste
        async function testInit() {
            addLog('üöÄ Testando inicializa√ß√£o...');
            // A inicializa√ß√£o j√° foi feita no m√≥dulo
        }
        
        async function testConnect() {
            try {
                addLog('üîó Tentando conectar carteira...');
                
                if (!window.web3auth) {
                    throw new Error('Web3Auth n√£o inicializado');
                }
                
                const provider = await window.web3auth.connect();
                addLog('‚úÖ Carteira conectada!');
                
                // Obter informa√ß√µes do usu√°rio
                const user = await window.web3auth.getUserInfo();
                addLog(`üë§ Usu√°rio: ${JSON.stringify(user, null, 2)}`);
                
                document.getElementById('connect-btn').disabled = true;
                document.getElementById('disconnect-btn').disabled = false;
                
            } catch (error) {
                addLog(`‚ùå Erro na conex√£o: ${error.message}`);
            }
        }
        
        async function testDisconnect() {
            try {
                addLog('üîå Desconectando carteira...');
                
                if (window.web3auth) {
                    await window.web3auth.logout();
                    addLog('‚úÖ Carteira desconectada!');
                    
                    document.getElementById('connect-btn').disabled = false;
                    document.getElementById('disconnect-btn').disabled = true;
                }
                
            } catch (error) {
                addLog(`‚ùå Erro na desconex√£o: ${error.message}`);
            }
        }
    </script>
</body>
</html>
