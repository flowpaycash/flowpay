<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FLOWPay - Teste</title>
    <link rel="stylesheet" href="css/checkout-minimal.css">
    <style>
        body {
            background: #000;
            color: #fff;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
        }
        .test-container {
            max-width: 600px;
            margin: 0 auto;
        }
        .test-button {
            background: #ff007a;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            margin: 10px;
            font-size: 16px;
        }
        .test-button:hover {
            background: #e6006a;
        }
        .status {
            background: #333;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }
        .error {
            background: #ff4444;
            color: white;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .success {
            background: #44ff44;
            color: black;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>üß™ FLOWPay - Teste de Funcionalidade</h1>
        
        <div class="status">
            <h3>Status do Sistema</h3>
            <div id="status-content">Carregando...</div>
        </div>
        
        <div>
            <button class="test-button" onclick="testBasicFunctionality()">Testar Funcionalidade B√°sica</button>
            <button class="test-button" onclick="testMachine()">Testar M√°quina de Estados</button>
            <button class="test-button" onclick="testCopy()">Testar Carregamento de Copy</button>
            <button class="test-button" onclick="clearStatus()">Limpar Status</button>
        </div>
        
        <div class="status">
            <h3>Console de Log</h3>
            <div id="console-log" style="font-family: monospace; font-size: 12px; max-height: 300px; overflow-y: auto;"></div>
        </div>
    </div>

    <script>
        // Fun√ß√£o para logar no console visual
        function log(message, type = 'info') {
            const consoleDiv = document.getElementById('console-log');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.style.color = type === 'error' ? '#ff4444' : type === 'success' ? '#44ff44' : '#ffffff';
            logEntry.textContent = `[${timestamp}] ${message}`;
            consoleDiv.appendChild(logEntry);
            consoleDiv.scrollTop = consoleDiv.scrollHeight;
            
            // Tamb√©m logar no console do navegador
            console.log(`[${timestamp}] ${message}`);
        }

        // Fun√ß√£o para atualizar status
        function updateStatus(message, type = 'info') {
            const statusDiv = document.getElementById('status-content');
            statusDiv.innerHTML = message;
            statusDiv.className = type;
        }

        // Teste b√°sico de funcionalidade
        function testBasicFunctionality() {
            log('üß™ Testando funcionalidade b√°sica...');
            
            try {
                // Testar se o DOM est√° funcionando
                const testElement = document.createElement('div');
                testElement.textContent = 'Teste DOM';
                document.body.appendChild(testElement);
                document.body.removeChild(testElement);
                
                // Testar se o CSS est√° carregado
                const computedStyle = window.getComputedStyle(document.body);
                const backgroundColor = computedStyle.backgroundColor;
                
                log(`‚úÖ DOM funcionando, CSS carregado (background: ${backgroundColor})`, 'success');
                updateStatus('‚úÖ Funcionalidade b√°sica OK', 'success');
                
            } catch (error) {
                log(`‚ùå Erro na funcionalidade b√°sica: ${error.message}`, 'error');
                updateStatus(`‚ùå Erro: ${error.message}`, 'error');
            }
        }

        // Teste da m√°quina de estados
        async function testMachine() {
            log('üöÄ Testando m√°quina de estados...');
            
            try {
                // Tentar importar a m√°quina
                const { startCheckout } = await import('/assets/js/navigation-flow.machine.js');
                log('‚úÖ M√°quina importada com sucesso', 'success');
                
                // Testar cria√ß√£o da m√°quina
                const machine = startCheckout({
                    copy: { test: true },
                    services: {
                        createPix: () => Promise.resolve('test'),
                        submitCrypto: () => Promise.resolve('test'),
                        connect: () => Promise.resolve('test'),
                        disconnect: () => Promise.resolve('test')
                    }
                });
                
                log('‚úÖ M√°quina criada com sucesso', 'success');
                updateStatus('‚úÖ M√°quina de estados funcionando', 'success');
                
            } catch (error) {
                log(`‚ùå Erro na m√°quina de estados: ${error.message}`, 'error');
                updateStatus(`‚ùå Erro na m√°quina: ${error.message}`, 'error');
            }
        }

        // Teste de carregamento de copy
        async function testCopy() {
            log('üìù Testando carregamento de copy...');
            
            try {
                const response = await fetch('/ui.copy.pt.json');
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const copy = await response.json();
                log(`‚úÖ Copy carregado: ${JSON.stringify(copy).substring(0, 100)}...`, 'success');
                updateStatus('‚úÖ Copy carregado com sucesso', 'success');
                
            } catch (error) {
                log(`‚ùå Erro ao carregar copy: ${error.message}`, 'error');
                updateStatus(`‚ùå Erro no copy: ${error.message}`, 'error');
            }
        }

        // Limpar status
        function clearStatus() {
            document.getElementById('status-content').innerHTML = 'Status limpo';
            document.getElementById('console-log').innerHTML = '';
            log('üßπ Status e console limpos');
        }

        // Inicializa√ß√£o
        document.addEventListener('DOMContentLoaded', () => {
            log('üöÄ P√°gina carregada, iniciando testes...');
            updateStatus('üîÑ Pronto para testes', 'info');
            
            // Teste autom√°tico b√°sico
            setTimeout(() => {
                testBasicFunctionality();
            }, 1000);
        });

        // Capturar erros globais
        window.addEventListener('error', (event) => {
            log(`‚ùå Erro global: ${event.error?.message || event.message}`, 'error');
        });

        window.addEventListener('unhandledrejection', (event) => {
            log(`‚ùå Promise rejeitada: ${event.reason}`, 'error');
        });
    </script>
</body>
</html>
