import{a as ac,b as nf,c as cc,d as sf,e as uc,f as of,g as af}from"./chunk-44GR3ESJ.js";import{a as Ad,c as tf,d as rf}from"./chunk-HH6JVPNS.js";import{c as Gd}from"./chunk-PO2OHKQD.js";import{B as Qd,C as Zd,D as ef,e as _n,r as Wd,s as Yd,u as Ui,w as ct,x as Qt,y as Jd,z as Xd}from"./chunk-W46MJTAP.js";import{a as Ie}from"./chunk-CRC5266G.js";import{a as ki,c as Tr}from"./chunk-HUHSLM6Z.js";import{A as Dd,B as Td,D as Cd,E as Od,F as Hd,G as Xt,H as It,g as rc,o as Te,p as si,q as xn,r as dt,s as ic,t as ks,u as nc,z as ke}from"./chunk-MKYDMTOZ.js";import{d as Rv,m as Ri}from"./chunk-GWB75M73.js";import{a as De,b as Z}from"./chunk-W44JATXS.js";import{b as Nd}from"./chunk-UYB2FLAM.js";import{a as Vd}from"./chunk-BQB6TGSC.js";import{a as qs,b as zs,c as Pd,d as js,e as Ni,f as Fd,h as dr,i as Bi,j as zd,k as Kd,l as Sn}from"./chunk-IUNNABVL.js";import{c as kd,d as Ld,e as Md,f as $d,g as Ws,i as Gs}from"./chunk-GEDAPGUD.js";import{a as sc,b as Vs,c as $s,d as oc,e as Ks,f as Pi,g as Fi,h as Hs,i as Bd,j as Ud,k as St,m as qd,n as jd}from"./chunk-PVBWCU6O.js";import{a as Le,b as q,c as Ls,d as $,e as K,f as Ne}from"./chunk-U5CWZESK.js";import{a as Jt,b as Ms,c as oi,d as Rd,e as _t}from"./chunk-GMMKJC3W.js";import{c as Id,d as me,e as Ge,f as xt,g as Se,h as En}from"./chunk-BG6P72OF.js";var An={};Ge(An,{__assign:()=>pc,__asyncDelegator:()=>wb,__asyncGenerator:()=>yb,__asyncValues:()=>vb,__await:()=>In,__awaiter:()=>hb,__classPrivateFieldGet:()=>_b,__classPrivateFieldSet:()=>Sb,__createBinding:()=>fb,__decorate:()=>cb,__exportStar:()=>pb,__extends:()=>ob,__generator:()=>db,__importDefault:()=>xb,__importStar:()=>Eb,__makeTemplateObject:()=>bb,__metadata:()=>lb,__param:()=>ub,__read:()=>Ef,__rest:()=>ab,__spread:()=>gb,__spreadArrays:()=>mb,__values:()=>gc});function ob(r,e){fc(r,e);function t(){this.constructor=r}r.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function ab(r,e){var t={};for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&e.indexOf(i)<0&&(t[i]=r[i]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,i=Object.getOwnPropertySymbols(r);n<i.length;n++)e.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(r,i[n])&&(t[i[n]]=r[i[n]]);return t}function cb(r,e,t,i){var n=arguments.length,s=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(r,e,t,i);else for(var a=r.length-1;a>=0;a--)(o=r[a])&&(s=(n<3?o(s):n>3?o(e,t,s):o(e,t))||s);return n>3&&s&&Object.defineProperty(e,t,s),s}function ub(r,e){return function(t,i){e(t,i,r)}}function lb(r,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,e)}function hb(r,e,t,i){function n(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(l){try{u(i.next(l))}catch(h){o(h)}}function c(l){try{u(i.throw(l))}catch(h){o(h)}}function u(l){l.done?s(l.value):n(l.value).then(a,c)}u((i=i.apply(r,e||[])).next())})}function db(r,e){var t={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},i,n,s,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(u){return function(l){return c([u,l])}}function c(u){if(i)throw new TypeError("Generator is already executing.");for(;t;)try{if(i=1,n&&(s=u[0]&2?n.return:u[0]?n.throw||((s=n.return)&&s.call(n),0):n.next)&&!(s=s.call(n,u[1])).done)return s;switch(n=0,s&&(u=[u[0]&2,s.value]),u[0]){case 0:case 1:s=u;break;case 4:return t.label++,{value:u[1],done:!1};case 5:t.label++,n=u[1],u=[0];continue;case 7:u=t.ops.pop(),t.trys.pop();continue;default:if(s=t.trys,!(s=s.length>0&&s[s.length-1])&&(u[0]===6||u[0]===2)){t=0;continue}if(u[0]===3&&(!s||u[1]>s[0]&&u[1]<s[3])){t.label=u[1];break}if(u[0]===6&&t.label<s[1]){t.label=s[1],s=u;break}if(s&&t.label<s[2]){t.label=s[2],t.ops.push(u);break}s[2]&&t.ops.pop(),t.trys.pop();continue}u=e.call(r,t)}catch(l){u=[6,l],n=0}finally{i=s=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}function fb(r,e,t,i){i===void 0&&(i=t),r[i]=e[t]}function pb(r,e){for(var t in r)t!=="default"&&!e.hasOwnProperty(t)&&(e[t]=r[t])}function gc(r){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&r[e],i=0;if(t)return t.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&i>=r.length&&(r=void 0),{value:r&&r[i++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Ef(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var i=t.call(r),n,s=[],o;try{for(;(e===void 0||e-- >0)&&!(n=i.next()).done;)s.push(n.value)}catch(a){o={error:a}}finally{try{n&&!n.done&&(t=i.return)&&t.call(i)}finally{if(o)throw o.error}}return s}function gb(){for(var r=[],e=0;e<arguments.length;e++)r=r.concat(Ef(arguments[e]));return r}function mb(){for(var r=0,e=0,t=arguments.length;e<t;e++)r+=arguments[e].length;for(var i=Array(r),n=0,e=0;e<t;e++)for(var s=arguments[e],o=0,a=s.length;o<a;o++,n++)i[n]=s[o];return i}function In(r){return this instanceof In?(this.v=r,this):new In(r)}function yb(r,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=t.apply(r,e||[]),n,s=[];return n={},o("next"),o("throw"),o("return"),n[Symbol.asyncIterator]=function(){return this},n;function o(d){i[d]&&(n[d]=function(p){return new Promise(function(f,g){s.push([d,p,f,g])>1||a(d,p)})})}function a(d,p){try{c(i[d](p))}catch(f){h(s[0][3],f)}}function c(d){d.value instanceof In?Promise.resolve(d.value.v).then(u,l):h(s[0][2],d)}function u(d){a("next",d)}function l(d){a("throw",d)}function h(d,p){d(p),s.shift(),s.length&&a(s[0][0],s[0][1])}}function wb(r){var e,t;return e={},i("next"),i("throw",function(n){throw n}),i("return"),e[Symbol.iterator]=function(){return this},e;function i(n,s){e[n]=r[n]?function(o){return(t=!t)?{value:In(r[n](o)),done:n==="return"}:s?s(o):o}:s}}function vb(r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=r[Symbol.asyncIterator],t;return e?e.call(r):(r=typeof gc=="function"?gc(r):r[Symbol.iterator](),t={},i("next"),i("throw"),i("return"),t[Symbol.asyncIterator]=function(){return this},t);function i(s){t[s]=r[s]&&function(o){return new Promise(function(a,c){o=r[s](o),n(a,c,o.done,o.value)})}}function n(s,o,a,c){Promise.resolve(c).then(function(u){s({value:u,done:a})},o)}}function bb(r,e){return Object.defineProperty?Object.defineProperty(r,"raw",{value:e}):r.raw=e,r}function Eb(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)Object.hasOwnProperty.call(r,t)&&(e[t]=r[t]);return e.default=r,e}function xb(r){return r&&r.__esModule?r:{default:r}}function _b(r,e){if(!e.has(r))throw new TypeError("attempted to get private field on non-instance");return e.get(r)}function Sb(r,e,t){if(!e.has(r))throw new TypeError("attempted to set private field on non-instance");return e.set(r,t),t}var fc,pc,Dn=Id(()=>{fc=function(r,e){return fc=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var n in i)i.hasOwnProperty(n)&&(t[n]=i[n])},fc(r,e)};pc=function(){return pc=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++){t=arguments[i];for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s])}return e},pc.apply(this,arguments)}});var xf=me(Qs=>{"use strict";Object.defineProperty(Qs,"__esModule",{value:!0});Qs.delay=void 0;function Ib(r){return new Promise(e=>{setTimeout(()=>{e(!0)},r)})}Qs.delay=Ib});var _f=me(Li=>{"use strict";Object.defineProperty(Li,"__esModule",{value:!0});Li.ONE_THOUSAND=Li.ONE_HUNDRED=void 0;Li.ONE_HUNDRED=100;Li.ONE_THOUSAND=1e3});var Sf=me(V=>{"use strict";Object.defineProperty(V,"__esModule",{value:!0});V.ONE_YEAR=V.FOUR_WEEKS=V.THREE_WEEKS=V.TWO_WEEKS=V.ONE_WEEK=V.THIRTY_DAYS=V.SEVEN_DAYS=V.FIVE_DAYS=V.THREE_DAYS=V.ONE_DAY=V.TWENTY_FOUR_HOURS=V.TWELVE_HOURS=V.SIX_HOURS=V.THREE_HOURS=V.ONE_HOUR=V.SIXTY_MINUTES=V.THIRTY_MINUTES=V.TEN_MINUTES=V.FIVE_MINUTES=V.ONE_MINUTE=V.SIXTY_SECONDS=V.THIRTY_SECONDS=V.TEN_SECONDS=V.FIVE_SECONDS=V.ONE_SECOND=void 0;V.ONE_SECOND=1;V.FIVE_SECONDS=5;V.TEN_SECONDS=10;V.THIRTY_SECONDS=30;V.SIXTY_SECONDS=60;V.ONE_MINUTE=V.SIXTY_SECONDS;V.FIVE_MINUTES=V.ONE_MINUTE*5;V.TEN_MINUTES=V.ONE_MINUTE*10;V.THIRTY_MINUTES=V.ONE_MINUTE*30;V.SIXTY_MINUTES=V.ONE_MINUTE*60;V.ONE_HOUR=V.SIXTY_MINUTES;V.THREE_HOURS=V.ONE_HOUR*3;V.SIX_HOURS=V.ONE_HOUR*6;V.TWELVE_HOURS=V.ONE_HOUR*12;V.TWENTY_FOUR_HOURS=V.ONE_HOUR*24;V.ONE_DAY=V.TWENTY_FOUR_HOURS;V.THREE_DAYS=V.ONE_DAY*3;V.FIVE_DAYS=V.ONE_DAY*5;V.SEVEN_DAYS=V.ONE_DAY*7;V.THIRTY_DAYS=V.ONE_DAY*30;V.ONE_WEEK=V.SEVEN_DAYS;V.TWO_WEEKS=V.ONE_WEEK*2;V.THREE_WEEKS=V.ONE_WEEK*3;V.FOUR_WEEKS=V.ONE_WEEK*4;V.ONE_YEAR=V.ONE_DAY*365});var mc=me(Zs=>{"use strict";Object.defineProperty(Zs,"__esModule",{value:!0});var If=(Dn(),En(An));If.__exportStar(_f(),Zs);If.__exportStar(Sf(),Zs)});var Df=me(Mi=>{"use strict";Object.defineProperty(Mi,"__esModule",{value:!0});Mi.fromMiliseconds=Mi.toMiliseconds=void 0;var Af=mc();function Ab(r){return r*Af.ONE_THOUSAND}Mi.toMiliseconds=Ab;function Db(r){return Math.floor(r/Af.ONE_THOUSAND)}Mi.fromMiliseconds=Db});var Cf=me(eo=>{"use strict";Object.defineProperty(eo,"__esModule",{value:!0});var Tf=(Dn(),En(An));Tf.__exportStar(xf(),eo);Tf.__exportStar(Df(),eo)});var Of=me(Tn=>{"use strict";Object.defineProperty(Tn,"__esModule",{value:!0});Tn.Watch=void 0;var to=class{constructor(){this.timestamps=new Map}start(e){if(this.timestamps.has(e))throw new Error(`Watch already started for label: ${e}`);this.timestamps.set(e,{started:Date.now()})}stop(e){let t=this.get(e);if(typeof t.elapsed<"u")throw new Error(`Watch already stopped for label: ${e}`);let i=Date.now()-t.started;this.timestamps.set(e,{started:t.started,elapsed:i})}get(e){let t=this.timestamps.get(e);if(typeof t>"u")throw new Error(`No timestamp found for label: ${e}`);return t}elapsed(e){let t=this.get(e);return t.elapsed||Date.now()-t.started}};Tn.Watch=to;Tn.default=to});var Rf=me(ro=>{"use strict";Object.defineProperty(ro,"__esModule",{value:!0});ro.IWatch=void 0;var yc=class{};ro.IWatch=yc});var Nf=me(wc=>{"use strict";Object.defineProperty(wc,"__esModule",{value:!0});var Tb=(Dn(),En(An));Tb.__exportStar(Rf(),wc)});var zi=me(qi=>{"use strict";Object.defineProperty(qi,"__esModule",{value:!0});var io=(Dn(),En(An));io.__exportStar(Cf(),qi);io.__exportStar(Of(),qi);io.__exportStar(Nf(),qi);io.__exportStar(mc(),qi)});var no=me(fe=>{"use strict";Object.defineProperty(fe,"__esModule",{value:!0});fe.getLocalStorage=fe.getLocalStorageOrThrow=fe.getCrypto=fe.getCryptoOrThrow=fe.getLocation=fe.getLocationOrThrow=fe.getNavigator=fe.getNavigatorOrThrow=fe.getDocument=fe.getDocumentOrThrow=fe.getFromWindowOrThrow=fe.getFromWindow=void 0;function ai(r){let e;return typeof window<"u"&&typeof window[r]<"u"&&(e=window[r]),e}fe.getFromWindow=ai;function ji(r){let e=ai(r);if(!e)throw new Error(`${r} is not defined in Window`);return e}fe.getFromWindowOrThrow=ji;function Cb(){return ji("document")}fe.getDocumentOrThrow=Cb;function Ob(){return ai("document")}fe.getDocument=Ob;function Rb(){return ji("navigator")}fe.getNavigatorOrThrow=Rb;function Nb(){return ai("navigator")}fe.getNavigator=Nb;function Pb(){return ji("location")}fe.getLocationOrThrow=Pb;function Fb(){return ai("location")}fe.getLocation=Fb;function Bb(){return ji("crypto")}fe.getCryptoOrThrow=Bb;function Ub(){return ai("crypto")}fe.getCrypto=Ub;function kb(){return ji("localStorage")}fe.getLocalStorageOrThrow=kb;function Lb(){return ai("localStorage")}fe.getLocalStorage=Lb});var Ff=me(so=>{"use strict";Object.defineProperty(so,"__esModule",{value:!0});so.getWindowMetadata=void 0;var Pf=no();function Mb(){let r,e;try{r=Pf.getDocumentOrThrow(),e=Pf.getLocationOrThrow()}catch{return null}function t(){let h=r.getElementsByTagName("link"),d=[];for(let p=0;p<h.length;p++){let f=h[p],g=f.getAttribute("rel");if(g&&g.toLowerCase().indexOf("icon")>-1){let m=f.getAttribute("href");if(m)if(m.toLowerCase().indexOf("https:")===-1&&m.toLowerCase().indexOf("http:")===-1&&m.indexOf("//")!==0){let w=e.protocol+"//"+e.host;if(m.indexOf("/")===0)w+=m;else{let v=e.pathname.split("/");v.pop();let y=v.join("/");w+=y+"/"+m}d.push(w)}else if(m.indexOf("//")===0){let w=e.protocol+m;d.push(w)}else d.push(m)}}return d}function i(...h){let d=r.getElementsByTagName("meta");for(let p=0;p<d.length;p++){let f=d[p],g=["itemprop","property","name"].map(m=>f.getAttribute(m)).filter(m=>m?h.includes(m):!1);if(g.length&&g){let m=f.getAttribute("content");if(m)return m}}return""}function n(){let h=i("name","og:site_name","og:title","twitter:title");return h||(h=r.title),h}function s(){return i("description","og:description","twitter:description","keywords")}let o=n(),a=s(),c=e.origin,u=t();return{description:a,url:c,icons:u,name:o}}so.getWindowMetadata=Mb});var Su=me((_4,cg)=>{var o_="Input must be an string, Buffer or Uint8Array";function a_(r){let e;if(r instanceof Uint8Array)e=r;else if(typeof r=="string")e=new TextEncoder().encode(r);else throw new Error(o_);return e}function c_(r){return Array.prototype.map.call(r,function(e){return(e<16?"0":"")+e.toString(16)}).join("")}function Do(r){return(4294967296+r).toString(16).substring(1)}function u_(r,e,t){let i=`
`+r+" = ";for(let n=0;n<e.length;n+=2){if(t===32)i+=Do(e[n]).toUpperCase(),i+=" ",i+=Do(e[n+1]).toUpperCase();else if(t===64)i+=Do(e[n+1]).toUpperCase(),i+=Do(e[n]).toUpperCase();else throw new Error("Invalid size "+t);n%6===4?i+=`
`+new Array(r.length+4).join(" "):n<e.length-2&&(i+=" ")}}function l_(r,e,t){let i=new Date().getTime(),n=new Uint8Array(e);for(let o=0;o<e;o++)n[o]=o%256;i=new Date().getTime();for(let o=0;o<t;o++){let a=r(n),c=new Date().getTime(),u=c-i;i=c}}cg.exports={normalizeInput:a_,toHex:c_,debugPrint:u_,testSpeed:l_}});var yg=me((S4,mg)=>{var Co=Su();function To(r,e,t){let i=r[e]+r[t],n=r[e+1]+r[t+1];i>=4294967296&&n++,r[e]=i,r[e+1]=n}function ug(r,e,t,i){let n=r[e]+t;t<0&&(n+=4294967296);let s=r[e+1]+i;n>=4294967296&&s++,r[e]=n,r[e+1]=s}function lg(r,e){return r[e]^r[e+1]<<8^r[e+2]<<16^r[e+3]<<24}function Pr(r,e,t,i,n,s){let o=zn[n],a=zn[n+1],c=zn[s],u=zn[s+1];To(X,r,e),ug(X,r,o,a);let l=X[i]^X[r],h=X[i+1]^X[r+1];X[i]=h,X[i+1]=l,To(X,t,i),l=X[e]^X[t],h=X[e+1]^X[t+1],X[e]=l>>>24^h<<8,X[e+1]=h>>>24^l<<8,To(X,r,e),ug(X,r,c,u),l=X[i]^X[r],h=X[i+1]^X[r+1],X[i]=l>>>16^h<<16,X[i+1]=h>>>16^l<<16,To(X,t,i),l=X[e]^X[t],h=X[e+1]^X[t+1],X[e]=h>>>31^l<<1,X[e+1]=l>>>31^h<<1}var hg=new Uint32Array([4089235720,1779033703,2227873595,3144134277,4271175723,1013904242,1595750129,2773480762,2917565137,1359893119,725511199,2600822924,4215389547,528734635,327033209,1541459225]),h_=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3],Ye=new Uint8Array(h_.map(function(r){return r*2})),X=new Uint32Array(32),zn=new Uint32Array(32);function dg(r,e){let t=0;for(t=0;t<16;t++)X[t]=r.h[t],X[t+16]=hg[t];for(X[24]=X[24]^r.t,X[25]=X[25]^r.t/4294967296,e&&(X[28]=~X[28],X[29]=~X[29]),t=0;t<32;t++)zn[t]=lg(r.b,4*t);for(t=0;t<12;t++)Pr(0,8,16,24,Ye[t*16+0],Ye[t*16+1]),Pr(2,10,18,26,Ye[t*16+2],Ye[t*16+3]),Pr(4,12,20,28,Ye[t*16+4],Ye[t*16+5]),Pr(6,14,22,30,Ye[t*16+6],Ye[t*16+7]),Pr(0,10,20,30,Ye[t*16+8],Ye[t*16+9]),Pr(2,12,22,24,Ye[t*16+10],Ye[t*16+11]),Pr(4,14,16,26,Ye[t*16+12],Ye[t*16+13]),Pr(6,8,18,28,Ye[t*16+14],Ye[t*16+15]);for(t=0;t<16;t++)r.h[t]=r.h[t]^X[t]^X[t+16]}var Fr=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]);function fg(r,e,t,i){if(r===0||r>64)throw new Error("Illegal output length, expected 0 < length <= 64");if(e&&e.length>64)throw new Error("Illegal key, expected Uint8Array with 0 < length <= 64");if(t&&t.length!==16)throw new Error("Illegal salt, expected Uint8Array with length is 16");if(i&&i.length!==16)throw new Error("Illegal personal, expected Uint8Array with length is 16");let n={b:new Uint8Array(128),h:new Uint32Array(16),t:0,c:0,outlen:r};Fr.fill(0),Fr[0]=r,e&&(Fr[1]=e.length),Fr[2]=1,Fr[3]=1,t&&Fr.set(t,32),i&&Fr.set(i,48);for(let s=0;s<16;s++)n.h[s]=hg[s]^lg(Fr,s*4);return e&&(Iu(n,e),n.c=128),n}function Iu(r,e){for(let t=0;t<e.length;t++)r.c===128&&(r.t+=r.c,dg(r,!1),r.c=0),r.b[r.c++]=e[t]}function pg(r){for(r.t+=r.c;r.c<128;)r.b[r.c++]=0;dg(r,!0);let e=new Uint8Array(r.outlen);for(let t=0;t<r.outlen;t++)e[t]=r.h[t>>2]>>8*(t&3);return e}function gg(r,e,t,i,n){t=t||64,r=Co.normalizeInput(r),i&&(i=Co.normalizeInput(i)),n&&(n=Co.normalizeInput(n));let s=fg(t,e,i,n);return Iu(s,r),pg(s)}function d_(r,e,t,i,n){let s=gg(r,e,t,i,n);return Co.toHex(s)}mg.exports={blake2b:gg,blake2bHex:d_,blake2bInit:fg,blake2bUpdate:Iu,blake2bFinal:pg}});var Ig=me((I4,Sg)=>{var wg=Su();function f_(r,e){return r[e]^r[e+1]<<8^r[e+2]<<16^r[e+3]<<24}function Br(r,e,t,i,n,s){ne[r]=ne[r]+ne[e]+n,ne[i]=Oo(ne[i]^ne[r],16),ne[t]=ne[t]+ne[i],ne[e]=Oo(ne[e]^ne[t],12),ne[r]=ne[r]+ne[e]+s,ne[i]=Oo(ne[i]^ne[r],8),ne[t]=ne[t]+ne[i],ne[e]=Oo(ne[e]^ne[t],7)}function Oo(r,e){return r>>>e^r<<32-e}var vg=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Je=new Uint8Array([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0]),ne=new Uint32Array(16),ze=new Uint32Array(16);function bg(r,e){let t=0;for(t=0;t<8;t++)ne[t]=r.h[t],ne[t+8]=vg[t];for(ne[12]^=r.t,ne[13]^=r.t/4294967296,e&&(ne[14]=~ne[14]),t=0;t<16;t++)ze[t]=f_(r.b,4*t);for(t=0;t<10;t++)Br(0,4,8,12,ze[Je[t*16+0]],ze[Je[t*16+1]]),Br(1,5,9,13,ze[Je[t*16+2]],ze[Je[t*16+3]]),Br(2,6,10,14,ze[Je[t*16+4]],ze[Je[t*16+5]]),Br(3,7,11,15,ze[Je[t*16+6]],ze[Je[t*16+7]]),Br(0,5,10,15,ze[Je[t*16+8]],ze[Je[t*16+9]]),Br(1,6,11,12,ze[Je[t*16+10]],ze[Je[t*16+11]]),Br(2,7,8,13,ze[Je[t*16+12]],ze[Je[t*16+13]]),Br(3,4,9,14,ze[Je[t*16+14]],ze[Je[t*16+15]]);for(t=0;t<8;t++)r.h[t]^=ne[t]^ne[t+8]}function Eg(r,e){if(!(r>0&&r<=32))throw new Error("Incorrect output length, should be in [1, 32]");let t=e?e.length:0;if(e&&!(t>0&&t<=32))throw new Error("Incorrect key length, should be in [1, 32]");let i={h:new Uint32Array(vg),b:new Uint8Array(64),c:0,t:0,outlen:r};return i.h[0]^=16842752^t<<8^r,t>0&&(Au(i,e),i.c=64),i}function Au(r,e){for(let t=0;t<e.length;t++)r.c===64&&(r.t+=r.c,bg(r,!1),r.c=0),r.b[r.c++]=e[t]}function xg(r){for(r.t+=r.c;r.c<64;)r.b[r.c++]=0;bg(r,!0);let e=new Uint8Array(r.outlen);for(let t=0;t<r.outlen;t++)e[t]=r.h[t>>2]>>8*(t&3)&255;return e}function _g(r,e,t){t=t||32,r=wg.normalizeInput(r);let i=Eg(t,e);return Au(i,r),xg(i)}function p_(r,e,t){let i=_g(r,e,t);return wg.toHex(i)}Sg.exports={blake2s:_g,blake2sHex:p_,blake2sInit:Eg,blake2sUpdate:Au,blake2sFinal:xg}});var Dg=me((A4,Ag)=>{var jn=yg(),Vn=Ig();Ag.exports={blake2b:jn.blake2b,blake2bHex:jn.blake2bHex,blake2bInit:jn.blake2bInit,blake2bUpdate:jn.blake2bUpdate,blake2bFinal:jn.blake2bFinal,blake2s:Vn.blake2s,blake2sHex:Vn.blake2sHex,blake2sInit:Vn.blake2sInit,blake2sUpdate:Vn.blake2sUpdate,blake2sFinal:Vn.blake2sFinal}});var l0=me((TN,u0)=>{"use strict";function nA(r){try{return JSON.stringify(r)}catch{return'"[Circular]"'}}u0.exports=sA;function sA(r,e,t){var i=t&&t.stringify||nA,n=1;if(typeof r=="object"&&r!==null){var s=e.length+n;if(s===1)return r;var o=new Array(s);o[0]=i(r);for(var a=1;a<s;a++)o[a]=i(e[a]);return o.join(" ")}if(typeof r!="string")return r;var c=e.length;if(c===0)return r;for(var u="",l=1-n,h=-1,d=r&&r.length||0,p=0;p<d;){if(r.charCodeAt(p)===37&&p+1<d){switch(h=h>-1?h:0,r.charCodeAt(p+1)){case 100:case 102:if(l>=c||e[l]==null)break;h<p&&(u+=r.slice(h,p)),u+=Number(e[l]),h=p+2,p++;break;case 105:if(l>=c||e[l]==null)break;h<p&&(u+=r.slice(h,p)),u+=Math.floor(Number(e[l])),h=p+2,p++;break;case 79:case 111:case 106:if(l>=c||e[l]===void 0)break;h<p&&(u+=r.slice(h,p));var f=typeof e[l];if(f==="string"){u+="'"+e[l]+"'",h=p+2,p++;break}if(f==="function"){u+=e[l].name||"<anonymous>",h=p+2,p++;break}u+=i(e[l]),h=p+2,p++;break;case 115:if(l>=c)break;h<p&&(u+=r.slice(h,p)),u+=String(e[l]),h=p+2,p++;break;case 37:h<p&&(u+=r.slice(h,p)),u+="%",h=p+2,p++,l--;break}++l}++p}return h===-1?r:(h<d&&(u+=r.slice(h)),u)}});var Vl=me((CN,p0)=>{"use strict";var h0=l0();p0.exports=nr;var ms=gA().console||{},oA={mapHttpRequest:oa,mapHttpResponse:oa,wrapRequestSerializer:zl,wrapResponseSerializer:zl,wrapErrorSerializer:zl,req:oa,res:oa,err:hA};function aA(r,e){return Array.isArray(r)?r.filter(function(i){return i!=="!stdSerializers.err"}):r===!0?Object.keys(e):!1}function nr(r){r=r||{},r.browser=r.browser||{};let e=r.browser.transmit;if(e&&typeof e.send!="function")throw Error("pino: transmit option must have a send function");let t=r.browser.write||ms;r.browser.write&&(r.browser.asObject=!0);let i=r.serializers||{},n=aA(r.browser.serialize,i),s=r.browser.serialize;Array.isArray(r.browser.serialize)&&r.browser.serialize.indexOf("!stdSerializers.err")>-1&&(s=!1);let o=["error","fatal","warn","info","debug","trace"];typeof t=="function"&&(t.error=t.fatal=t.warn=t.info=t.debug=t.trace=t),r.enabled===!1&&(r.level="silent");let a=r.level||"info",c=Object.create(t);c.log||(c.log=ys),Object.defineProperty(c,"levelVal",{get:l}),Object.defineProperty(c,"level",{get:h,set:d});let u={transmit:e,serialize:n,asObject:r.browser.asObject,levels:o,timestamp:dA(r)};c.levels=nr.levels,c.level=a,c.setMaxListeners=c.getMaxListeners=c.emit=c.addListener=c.on=c.prependListener=c.once=c.prependOnceListener=c.removeListener=c.removeAllListeners=c.listeners=c.listenerCount=c.eventNames=c.write=c.flush=ys,c.serializers=i,c._serialize=n,c._stdErrSerialize=s,c.child=p,e&&(c._logEvent=jl());function l(){return this.level==="silent"?1/0:this.levels.values[this.level]}function h(){return this._level}function d(f){if(f!=="silent"&&!this.levels.values[f])throw Error("unknown level "+f);this._level=f,ln(u,c,"error","log"),ln(u,c,"fatal","error"),ln(u,c,"warn","error"),ln(u,c,"info","log"),ln(u,c,"debug","log"),ln(u,c,"trace","log")}function p(f,g){if(!f)throw new Error("missing bindings for child Pino");g=g||{},n&&f.serializers&&(g.serializers=f.serializers);let m=g.serializers;if(n&&m){var w=Object.assign({},i,m),v=r.browser.serialize===!0?Object.keys(w):n;delete f.serializers,aa([f],v,w,this._stdErrSerialize)}function y(S){this._childLevel=(S._childLevel|0)+1,this.error=hn(S,f,"error"),this.fatal=hn(S,f,"fatal"),this.warn=hn(S,f,"warn"),this.info=hn(S,f,"info"),this.debug=hn(S,f,"debug"),this.trace=hn(S,f,"trace"),w&&(this.serializers=w,this._serialize=v),e&&(this._logEvent=jl([].concat(S._logEvent.bindings,f)))}return y.prototype=this,new y(this)}return c}nr.levels={values:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},labels:{10:"trace",20:"debug",30:"info",40:"warn",50:"error",60:"fatal"}};nr.stdSerializers=oA;nr.stdTimeFunctions=Object.assign({},{nullTime:d0,epochTime:f0,unixTime:fA,isoTime:pA});function ln(r,e,t,i){let n=Object.getPrototypeOf(e);e[t]=e.levelVal>e.levels.values[t]?ys:n[t]?n[t]:ms[t]||ms[i]||ys,cA(r,e,t)}function cA(r,e,t){!r.transmit&&e[t]===ys||(e[t]=(function(i){return function(){let s=r.timestamp(),o=new Array(arguments.length),a=Object.getPrototypeOf&&Object.getPrototypeOf(this)===ms?ms:this;for(var c=0;c<o.length;c++)o[c]=arguments[c];if(r.serialize&&!r.asObject&&aa(o,this._serialize,this.serializers,this._stdErrSerialize),r.asObject?i.call(a,uA(this,t,o,s)):i.apply(a,o),r.transmit){let u=r.transmit.level||e.level,l=nr.levels.values[u],h=nr.levels.values[t];if(h<l)return;lA(this,{ts:s,methodLevel:t,methodValue:h,transmitLevel:u,transmitValue:nr.levels.values[r.transmit.level||e.level],send:r.transmit.send,val:e.levelVal},o)}}})(e[t]))}function uA(r,e,t,i){r._serialize&&aa(t,r._serialize,r.serializers,r._stdErrSerialize);let n=t.slice(),s=n[0],o={};i&&(o.time=i),o.level=nr.levels.values[e];let a=(r._childLevel|0)+1;if(a<1&&(a=1),s!==null&&typeof s=="object"){for(;a--&&typeof n[0]=="object";)Object.assign(o,n.shift());s=n.length?h0(n.shift(),n):void 0}else typeof s=="string"&&(s=h0(n.shift(),n));return s!==void 0&&(o.msg=s),o}function aa(r,e,t,i){for(let n in r)if(i&&r[n]instanceof Error)r[n]=nr.stdSerializers.err(r[n]);else if(typeof r[n]=="object"&&!Array.isArray(r[n]))for(let s in r[n])e&&e.indexOf(s)>-1&&s in t&&(r[n][s]=t[s](r[n][s]))}function hn(r,e,t){return function(){let i=new Array(1+arguments.length);i[0]=e;for(var n=1;n<i.length;n++)i[n]=arguments[n-1];return r[t].apply(this,i)}}function lA(r,e,t){let i=e.send,n=e.ts,s=e.methodLevel,o=e.methodValue,a=e.val,c=r._logEvent.bindings;aa(t,r._serialize||Object.keys(r.serializers),r.serializers,r._stdErrSerialize===void 0?!0:r._stdErrSerialize),r._logEvent.ts=n,r._logEvent.messages=t.filter(function(u){return c.indexOf(u)===-1}),r._logEvent.level.label=s,r._logEvent.level.value=o,i(s,r._logEvent,a),r._logEvent=jl(c)}function jl(r){return{ts:0,messages:[],bindings:r||[],level:{label:"",value:0}}}function hA(r){let e={type:r.constructor.name,msg:r.message,stack:r.stack};for(let t in r)e[t]===void 0&&(e[t]=r[t]);return e}function dA(r){return typeof r.timestamp=="function"?r.timestamp:r.timestamp===!1?d0:f0}function oa(){return{}}function zl(r){return r}function ys(){}function d0(){return!1}function f0(){return Date.now()}function fA(){return Math.round(Date.now()/1e3)}function pA(){return new Date(Date.now()).toISOString()}function gA(){function r(e){return typeof e<"u"&&e}try{return typeof globalThis<"u"||Object.defineProperty(Object.prototype,"globalThis",{get:function(){return delete Object.prototype.globalThis,this.globalThis=this},configurable:!0}),globalThis}catch{return r(self)||r(window)||r(this)||{}}}});var D0={};Ge(D0,{__assign:()=>Xl,__asyncDelegator:()=>GA,__asyncGenerator:()=>WA,__asyncValues:()=>YA,__await:()=>_s,__awaiter:()=>zA,__classPrivateFieldGet:()=>ZA,__classPrivateFieldSet:()=>eD,__createBinding:()=>VA,__decorate:()=>LA,__exportStar:()=>$A,__extends:()=>UA,__generator:()=>jA,__importDefault:()=>QA,__importStar:()=>XA,__makeTemplateObject:()=>JA,__metadata:()=>qA,__param:()=>MA,__read:()=>A0,__rest:()=>kA,__spread:()=>KA,__spreadArrays:()=>HA,__values:()=>Ql});function UA(r,e){Jl(r,e);function t(){this.constructor=r}r.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function kA(r,e){var t={};for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&e.indexOf(i)<0&&(t[i]=r[i]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,i=Object.getOwnPropertySymbols(r);n<i.length;n++)e.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(r,i[n])&&(t[i[n]]=r[i[n]]);return t}function LA(r,e,t,i){var n=arguments.length,s=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,t):i,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(r,e,t,i);else for(var a=r.length-1;a>=0;a--)(o=r[a])&&(s=(n<3?o(s):n>3?o(e,t,s):o(e,t))||s);return n>3&&s&&Object.defineProperty(e,t,s),s}function MA(r,e){return function(t,i){e(t,i,r)}}function qA(r,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,e)}function zA(r,e,t,i){function n(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(l){try{u(i.next(l))}catch(h){o(h)}}function c(l){try{u(i.throw(l))}catch(h){o(h)}}function u(l){l.done?s(l.value):n(l.value).then(a,c)}u((i=i.apply(r,e||[])).next())})}function jA(r,e){var t={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},i,n,s,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(u){return function(l){return c([u,l])}}function c(u){if(i)throw new TypeError("Generator is already executing.");for(;t;)try{if(i=1,n&&(s=u[0]&2?n.return:u[0]?n.throw||((s=n.return)&&s.call(n),0):n.next)&&!(s=s.call(n,u[1])).done)return s;switch(n=0,s&&(u=[u[0]&2,s.value]),u[0]){case 0:case 1:s=u;break;case 4:return t.label++,{value:u[1],done:!1};case 5:t.label++,n=u[1],u=[0];continue;case 7:u=t.ops.pop(),t.trys.pop();continue;default:if(s=t.trys,!(s=s.length>0&&s[s.length-1])&&(u[0]===6||u[0]===2)){t=0;continue}if(u[0]===3&&(!s||u[1]>s[0]&&u[1]<s[3])){t.label=u[1];break}if(u[0]===6&&t.label<s[1]){t.label=s[1],s=u;break}if(s&&t.label<s[2]){t.label=s[2],t.ops.push(u);break}s[2]&&t.ops.pop(),t.trys.pop();continue}u=e.call(r,t)}catch(l){u=[6,l],n=0}finally{i=s=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}function VA(r,e,t,i){i===void 0&&(i=t),r[i]=e[t]}function $A(r,e){for(var t in r)t!=="default"&&!e.hasOwnProperty(t)&&(e[t]=r[t])}function Ql(r){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&r[e],i=0;if(t)return t.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&i>=r.length&&(r=void 0),{value:r&&r[i++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function A0(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var i=t.call(r),n,s=[],o;try{for(;(e===void 0||e-- >0)&&!(n=i.next()).done;)s.push(n.value)}catch(a){o={error:a}}finally{try{n&&!n.done&&(t=i.return)&&t.call(i)}finally{if(o)throw o.error}}return s}function KA(){for(var r=[],e=0;e<arguments.length;e++)r=r.concat(A0(arguments[e]));return r}function HA(){for(var r=0,e=0,t=arguments.length;e<t;e++)r+=arguments[e].length;for(var i=Array(r),n=0,e=0;e<t;e++)for(var s=arguments[e],o=0,a=s.length;o<a;o++,n++)i[n]=s[o];return i}function _s(r){return this instanceof _s?(this.v=r,this):new _s(r)}function WA(r,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=t.apply(r,e||[]),n,s=[];return n={},o("next"),o("throw"),o("return"),n[Symbol.asyncIterator]=function(){return this},n;function o(d){i[d]&&(n[d]=function(p){return new Promise(function(f,g){s.push([d,p,f,g])>1||a(d,p)})})}function a(d,p){try{c(i[d](p))}catch(f){h(s[0][3],f)}}function c(d){d.value instanceof _s?Promise.resolve(d.value.v).then(u,l):h(s[0][2],d)}function u(d){a("next",d)}function l(d){a("throw",d)}function h(d,p){d(p),s.shift(),s.length&&a(s[0][0],s[0][1])}}function GA(r){var e,t;return e={},i("next"),i("throw",function(n){throw n}),i("return"),e[Symbol.iterator]=function(){return this},e;function i(n,s){e[n]=r[n]?function(o){return(t=!t)?{value:_s(r[n](o)),done:n==="return"}:s?s(o):o}:s}}function YA(r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=r[Symbol.asyncIterator],t;return e?e.call(r):(r=typeof Ql=="function"?Ql(r):r[Symbol.iterator](),t={},i("next"),i("throw"),i("return"),t[Symbol.asyncIterator]=function(){return this},t);function i(s){t[s]=r[s]&&function(o){return new Promise(function(a,c){o=r[s](o),n(a,c,o.done,o.value)})}}function n(s,o,a,c){Promise.resolve(c).then(function(u){s({value:u,done:a})},o)}}function JA(r,e){return Object.defineProperty?Object.defineProperty(r,"raw",{value:e}):r.raw=e,r}function XA(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)Object.hasOwnProperty.call(r,t)&&(e[t]=r[t]);return e.default=r,e}function QA(r){return r&&r.__esModule?r:{default:r}}function ZA(r,e){if(!e.has(r))throw new TypeError("attempted to get private field on non-instance");return e.get(r)}function eD(r,e,t){if(!e.has(r))throw new TypeError("attempted to set private field on non-instance");return e.set(r,t),t}var Jl,Xl,T0=Id(()=>{Jl=function(r,e){return Jl=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var n in i)i.hasOwnProperty(n)&&(t[n]=i[n])},Jl(r,e)};Xl=function(){return Xl=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++){t=arguments[i];for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s])}return e},Xl.apply(this,arguments)}});var O0=me(Qr=>{"use strict";Object.defineProperty(Qr,"__esModule",{value:!0});Qr.isBrowserCryptoAvailable=Qr.getSubtleCrypto=Qr.getBrowerCrypto=void 0;function Zl(){return(global==null?void 0:global.crypto)||(global==null?void 0:global.msCrypto)||{}}Qr.getBrowerCrypto=Zl;function C0(){let r=Zl();return r.subtle||r.webkitSubtle}Qr.getSubtleCrypto=C0;function tD(){return!!Zl()&&!!C0()}Qr.isBrowserCryptoAvailable=tD});var P0=me(Zr=>{"use strict";Object.defineProperty(Zr,"__esModule",{value:!0});Zr.isBrowser=Zr.isNode=Zr.isReactNative=void 0;function R0(){return typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"}Zr.isReactNative=R0;function N0(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}Zr.isNode=N0;function rD(){return!R0()&&!N0()}Zr.isBrowser=rD});var eh=me(Oa=>{"use strict";Object.defineProperty(Oa,"__esModule",{value:!0});var F0=(T0(),En(D0));F0.__exportStar(O0(),Oa);F0.__exportStar(P0(),Oa)});var z0=me((oP,q0)=>{"use strict";q0.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}});function Nv(r){return r instanceof Uint8Array||ArrayBuffer.isView(r)&&r.constructor.name==="Uint8Array"}function uf(r,e){return Array.isArray(e)?e.length===0?!0:r?e.every(t=>typeof t=="string"):e.every(t=>Number.isSafeInteger(t)):!1}function Ys(r,e){if(typeof e!="string")throw new Error(`${r}: string expected`);return!0}function dc(r){if(!Number.isSafeInteger(r))throw new Error(`invalid integer: ${r}`)}function hc(r){if(!Array.isArray(r))throw new Error("array expected")}function Js(r,e){if(!uf(!0,e))throw new Error(`${r}: array of strings expected`)}function Pv(r,e){if(!uf(!1,e))throw new Error(`${r}: array of numbers expected`)}function Fv(...r){let e=s=>s,t=(s,o)=>a=>s(o(a)),i=r.map(s=>s.encode).reduceRight(t,e),n=r.map(s=>s.decode).reduce(t,e);return{encode:i,decode:n}}function Bv(r){let e=typeof r=="string"?r.split(""):r,t=e.length;Js("alphabet",e);let i=new Map(e.map((n,s)=>[n,s]));return{encode:n=>(hc(n),n.map(s=>{if(!Number.isSafeInteger(s)||s<0||s>=t)throw new Error(`alphabet.encode: digit index outside alphabet "${s}". Allowed: ${r}`);return e[s]})),decode:n=>(hc(n),n.map(s=>{Ys("alphabet.decode",s);let o=i.get(s);if(o===void 0)throw new Error(`Unknown letter: "${s}". Allowed: ${r}`);return o}))}}function Uv(r=""){return Ys("join",r),{encode:e=>(Js("join.decode",e),e.join(r)),decode:e=>(Ys("join.decode",e),e.split(r))}}function kv(r,e="="){return dc(r),Ys("padding",e),{encode(t){for(Js("padding.encode",t);t.length*r%8;)t.push(e);return t},decode(t){Js("padding.decode",t);let i=t.length;if(i*r%8)throw new Error("padding: invalid, string should have whole number of bytes");for(;i>0&&t[i-1]===e;i--)if((i-1)*r%8===0)throw new Error("padding: invalid, string has too much padding");return t.slice(0,i)}}}var lf=(r,e)=>e===0?r:lf(e,r%e),Xs=(r,e)=>r+(e-lf(r,e)),lc=(()=>{let r=[];for(let e=0;e<40;e++)r.push(2**e);return r})();function cf(r,e,t,i){if(hc(r),e<=0||e>32)throw new Error(`convertRadix2: wrong from=${e}`);if(t<=0||t>32)throw new Error(`convertRadix2: wrong to=${t}`);if(Xs(e,t)>32)throw new Error(`convertRadix2: carry overflow from=${e} to=${t} carryBits=${Xs(e,t)}`);let n=0,s=0,o=lc[e],a=lc[t]-1,c=[];for(let u of r){if(dc(u),u>=o)throw new Error(`convertRadix2: invalid data word=${u} from=${e}`);if(n=n<<e|u,s+e>32)throw new Error(`convertRadix2: carry overflow pos=${s} from=${e}`);for(s+=e;s>=t;s-=t)c.push((n>>s-t&a)>>>0);let l=lc[s];if(l===void 0)throw new Error("invalid carry");n&=l-1}if(n=n<<t-s&a,!i&&s>=e)throw new Error("Excess padding");if(!i&&n>0)throw new Error(`Non-zero padding: ${n}`);return i&&s>0&&c.push(n>>>0),c}function Lv(r,e=!1){if(dc(r),r<=0||r>32)throw new Error("radix2: bits should be in (0..32]");if(Xs(8,r)>32||Xs(r,8)>32)throw new Error("radix2: carry overflow");return{encode:t=>{if(!Nv(t))throw new Error("radix2.encode input should be Uint8Array");return cf(Array.from(t),8,r,!e)},decode:t=>(Pv("radix2.decode",t),Uint8Array.from(cf(t,r,8,e)))}}var hf=Fv(Lv(5),Bv("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),kv(5),Uv(""));var ff=r=>{let{document:e}=r,t=e.querySelector('head > meta[property="og:site_name"]');if(t)return t.content;let i=e.querySelector('head > meta[name="title"]');return i?i.content:e.title&&e.title.length>0?e.title:r.location.hostname};function df(r){return new Promise((e,t)=>{try{let i=document.createElement("img");i.onload=()=>e(!0),i.onerror=()=>e(!1),i.src=r}catch(i){t(i)}})}async function pf(r){let{document:e}=r,t=e.querySelector('head > link[rel="shortcut icon"]');return t&&await df(t.href)||(t=Array.from(e.querySelectorAll('head > link[rel="icon"]')).find(i=>!!i.href)||null,t&&await df(t.href))?t.href:null}function JO(r){let[e,t]=r.split(".");return{header:JSON.parse(rc(e)),payload:JSON.parse(rc(t))}}var Mv=(function(r){return r.ETH_SEND_TRANSACTION="eth_sendTransaction",r.ETH_SIGN_TRANSACTION="eth_signTransaction",r.ETH_SIGN="eth_sign",r.PERSONAL_SIGN="personal_sign",r.ETH_SIGN_TYPED_DATA="eth_signTypedData",r.ETH_SIGN_TYPED_DATA_V3="eth_signTypedData_v3",r.ETH_SIGN_TYPED_DATA_V4="eth_signTypedData_v4",r.ADD_ETHEREUM_CHAIN="wallet_addEthereumChain",r.SWITCH_ETHEREUM_CHAIN="wallet_switchEthereumChain",r})({}),qv=(function(r){return r.SIGN_TRANSACTION="solana_signTransaction",r.SIGN_MESSAGE="solana_signMessage",r})({}),zv=(function(r){return r.ETH_CHAIN_CHANGED="chainChanged",r.ETH_ACCOUNTS_CHANGED="accountsChanged",r})({}),jv=(function(r){return r.SOL_CHAIN_CHANGED="chainChanged",r.SOL_ACCOUNTS_CHANGED="accountsChanged",r})({}),Vv=async()=>({name:ff(window),icon:await pf(window)}),$v=r=>{let e=[];return r.forEach(t=>{let[i]=t.split(":");e.includes(i)||e.push(i)}),e},Kv=r=>{switch(r){case ke.EIP155:return Object.values(Mv);case ke.SOLANA:return Object.values(qv);default:throw new Error(`No default methods for namespace: ${r}`)}},Hv=r=>{switch(r){case ke.EIP155:return Object.values(zv);case ke.SOLANA:return Object.values(jv);default:throw new Error(`No default events for namespace: ${r}`)}},Wv=r=>{let e=$v(r);return Object.fromEntries(e.map(t=>[t,{methods:Kv(t),chains:r.filter(i=>i.startsWith(t)),events:Hv(t)}]))},gf=async(r,e)=>{let t=await Vv(),i={walletConnectInitOptions:{projectId:e,relayUrl:"wss://relay.walletconnect.com",metadata:{name:t.name,description:t.name,url:window.location.origin,icons:[t.icon||""]}}},n=r.map(o=>{if(o.chainNamespace===ke.SOLANA)return`${o.chainNamespace}:${_n[o.chainId]}`;if(o.chainNamespace===ke.EIP155)return`${o.chainNamespace}:${parseInt(o.chainId,16)}`;throw new Error(`Unsupported chain namespace: ${o.chainNamespace}`)}),s={optionalNamespaces:Wv(n)};return{connectorSettings:i,loginSettings:s}};var mf=function(r,e,t){if(t||arguments.length===2)for(var i=0,n=e.length,s;i<n;i++)(s||!(i in e))&&(s||(s=Array.prototype.slice.call(e,0,i)),s[i]=e[i]);return r.concat(s||Array.prototype.slice.call(e))},Gv=(function(){function r(e,t,i){this.name=e,this.version=t,this.os=i,this.type="browser"}return r})();var Yv=(function(){function r(e){this.version=e,this.type="node",this.name="node",this.os=process.platform}return r})();var Jv=(function(){function r(e,t,i,n){this.name=e,this.version=t,this.os=i,this.bot=n,this.type="bot-device"}return r})();var Xv=(function(){function r(){this.type="bot",this.bot=!0,this.name="bot",this.version=null,this.os=null}return r})();var Qv=(function(){function r(){this.type="react-native",this.name="react-native",this.version=null,this.os=null}return r})();var Zv=/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/,eb=/(nuhk|curl|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/,yf=3,tb=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/EdgA?\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["pie",/^Microsoft Pocket Internet Explorer\/(\d+\.\d+)$/],["pie",/^Mozilla\/\d\.\d+\s\(compatible;\s(?:MSP?IE|MSInternet Explorer) (\d+\.\d+);.*Windows CE.*\)$/],["netfront",/^Mozilla\/\d\.\d+.*NetFront\/(\d.\d)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FB[AS]V\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["curl",/^curl\/([0-9\.]+)$/],["searchbot",Zv]],wf=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Windows CE",/Windows CE|WinCE|Microsoft Pocket Internet Explorer/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]];function bf(r){return r?vf(r):typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"?new Qv:typeof navigator<"u"?vf(navigator.userAgent):nb()}function rb(r){return r!==""&&tb.reduce(function(e,t){var i=t[0],n=t[1];if(e)return e;var s=n.exec(r);return!!s&&[i,s]},!1)}function vf(r){var e=rb(r);if(!e)return null;var t=e[0],i=e[1];if(t==="searchbot")return new Xv;var n=i[1]&&i[1].split(".").join("_").split("_").slice(0,3);n?n.length<yf&&(n=mf(mf([],n,!0),sb(yf-n.length),!0)):n=[];var s=n.join("."),o=ib(r),a=eb.exec(r);return a&&a[1]?new Jv(t,s,o,a[1]):new Gv(t,s,o)}function ib(r){for(var e=0,t=wf.length;e<t;e++){var i=wf[e],n=i[0],s=i[1],o=s.exec(r);if(o)return n}return null}function nb(){var r=typeof process<"u"&&process.version;return r?new Yv(process.version.slice(1)):null}function sb(r){for(var e=[],t=0;t<r;t++)e.push("0");return e}var vr=Se(zi()),$t=Se(no()),om=Se(Ff());function Bf(r){let e=of(`0x${r.substring(4)}`).substring(26);return af(`0x${e}`)}async function kf({hash:r,signature:e}){let t=ac(r)?r:uc(r),{secp256k1:i}=await import("./secp256k1-QBO3REJS.js");return`0x${(()=>{if(typeof e=="object"&&"r"in e&&"s"in e){let{r:u,s:l,v:h,yParity:d}=e,p=Number(d??h),f=Uf(p);return new i.Signature(cc(u),cc(l)).addRecoveryBit(f)}let o=ac(e)?e:uc(e);if(nf(o)!==65)throw new Error("invalid signature length");let a=sf(`0x${o.slice(130)}`),c=Uf(a);return i.Signature.fromCompact(o.substring(2,130)).addRecoveryBit(c)})().recoverPublicKey(t.substring(2)).toHex(!1)}`}function Uf(r){if(r===0||r===1)return r;if(r===27)return 0;if(r===28)return 1;throw new Error("Invalid yParityOrV value")}async function vc({hash:r,signature:e}){return Bf(await kf({hash:r,signature:e}))}function qb(r){if(r.length>=255)throw new TypeError("Alphabet too long");let e=new Uint8Array(256);for(let u=0;u<e.length;u++)e[u]=255;for(let u=0;u<r.length;u++){let l=r.charAt(u),h=l.charCodeAt(0);if(e[h]!==255)throw new TypeError(l+" is ambiguous");e[h]=u}let t=r.length,i=r.charAt(0),n=Math.log(t)/Math.log(256),s=Math.log(256)/Math.log(t);function o(u){if(u instanceof Uint8Array||(ArrayBuffer.isView(u)?u=new Uint8Array(u.buffer,u.byteOffset,u.byteLength):Array.isArray(u)&&(u=Uint8Array.from(u))),!(u instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(u.length===0)return"";let l=0,h=0,d=0,p=u.length;for(;d!==p&&u[d]===0;)d++,l++;let f=(p-d)*s+1>>>0,g=new Uint8Array(f);for(;d!==p;){let v=u[d],y=0;for(let S=f-1;(v!==0||y<h)&&S!==-1;S--,y++)v+=256*g[S]>>>0,g[S]=v%t>>>0,v=v/t>>>0;if(v!==0)throw new Error("Non-zero carry");h=y,d++}let m=f-h;for(;m!==f&&g[m]===0;)m++;let w=i.repeat(l);for(;m<f;++m)w+=r.charAt(g[m]);return w}function a(u){if(typeof u!="string")throw new TypeError("Expected String");if(u.length===0)return new Uint8Array;let l=0,h=0,d=0;for(;u[l]===i;)h++,l++;let p=(u.length-l)*n+1>>>0,f=new Uint8Array(p);for(;l<u.length;){let v=u.charCodeAt(l);if(v>255)return;let y=e[v];if(y===255)return;let S=0;for(let E=p-1;(y!==0||S<d)&&E!==-1;E--,S++)y+=t*f[E]>>>0,f[E]=y%256>>>0,y=y/256>>>0;if(y!==0)throw new Error("Non-zero carry");d=S,l++}let g=p-d;for(;g!==p&&f[g]===0;)g++;let m=new Uint8Array(h+(p-g)),w=h;for(;g!==p;)m[w++]=f[g++];return m}function c(u){let l=a(u);if(l)return l;throw new Error("Non-base"+t+" character")}return{encode:o,decodeUnsafe:a,decode:c}}var Lf=qb;var zb="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz",Vi=Lf(zb);function Mf(r){let e=r.length,t=0,i=0;for(;i<e;){let n=r.charCodeAt(i++);if((n&4294967168)===0){t++;continue}else if((n&4294965248)===0)t+=2;else{if(n>=55296&&n<=56319&&i<e){let s=r.charCodeAt(i);(s&64512)===56320&&(++i,n=((n&1023)<<10)+(s&1023)+65536)}(n&4294901760)===0?t+=3:t+=4}}return t}function jb(r,e,t){let i=r.length,n=t,s=0;for(;s<i;){let o=r.charCodeAt(s++);if((o&4294967168)===0){e[n++]=o;continue}else if((o&4294965248)===0)e[n++]=o>>6&31|192;else{if(o>=55296&&o<=56319&&s<i){let a=r.charCodeAt(s);(a&64512)===56320&&(++s,o=((o&1023)<<10)+(a&1023)+65536)}(o&4294901760)===0?(e[n++]=o>>12&15|224,e[n++]=o>>6&63|128):(e[n++]=o>>18&7|240,e[n++]=o>>12&63|128,e[n++]=o>>6&63|128)}e[n++]=o&63|128}}var Vb=new TextEncoder,$b=50;function Kb(r,e,t){Vb.encodeInto(r,e.subarray(t))}function qf(r,e,t){r.length>$b?Kb(r,e,t):jb(r,e,t)}var Hb=4096;function bc(r,e,t){let i=e,n=i+t,s=[],o="";for(;i<n;){let a=r[i++];if((a&128)===0)s.push(a);else if((a&224)===192){let c=r[i++]&63;s.push((a&31)<<6|c)}else if((a&240)===224){let c=r[i++]&63,u=r[i++]&63;s.push((a&31)<<12|c<<6|u)}else if((a&248)===240){let c=r[i++]&63,u=r[i++]&63,l=r[i++]&63,h=(a&7)<<18|c<<12|u<<6|l;h>65535&&(h-=65536,s.push(h>>>10&1023|55296),h=56320|h&1023),s.push(h)}else s.push(a);s.length>=Hb&&(o+=String.fromCharCode(...s),s.length=0)}return s.length>0&&(o+=String.fromCharCode(...s)),o}var Wb=new TextDecoder,Gb=200;function Yb(r,e,t){let i=r.subarray(e,e+t);return Wb.decode(i)}function zf(r,e,t){return t>Gb?Yb(r,e,t):bc(r,e,t)}var ci=class{constructor(e,t){this.type=e,this.data=t}};var ft=class r extends Error{constructor(e){super(e);let t=Object.create(r.prototype);Object.setPrototypeOf(this,t),Object.defineProperty(this,"name",{configurable:!0,enumerable:!1,value:r.name})}};function jf(r,e,t){let i=t/4294967296,n=t;r.setUint32(e,i),r.setUint32(e+4,n)}function oo(r,e,t){let i=Math.floor(t/4294967296),n=t;r.setUint32(e,i),r.setUint32(e+4,n)}function ao(r,e){let t=r.getInt32(e),i=r.getUint32(e+4);return t*4294967296+i}function Vf(r,e){let t=r.getUint32(e),i=r.getUint32(e+4);return t*4294967296+i}var Jb=-1,Xb=4294967296-1,Qb=17179869184-1;function Zb({sec:r,nsec:e}){if(r>=0&&e>=0&&r<=Qb)if(e===0&&r<=Xb){let t=new Uint8Array(4);return new DataView(t.buffer).setUint32(0,r),t}else{let t=r/4294967296,i=r&4294967295,n=new Uint8Array(8),s=new DataView(n.buffer);return s.setUint32(0,e<<2|t&3),s.setUint32(4,i),n}else{let t=new Uint8Array(12),i=new DataView(t.buffer);return i.setUint32(0,e),oo(i,4,r),t}}function e1(r){let e=r.getTime(),t=Math.floor(e/1e3),i=(e-t*1e3)*1e6,n=Math.floor(i/1e9);return{sec:t+n,nsec:i-n*1e9}}function t1(r){if(r instanceof Date){let e=e1(r);return Zb(e)}else return null}function r1(r){let e=new DataView(r.buffer,r.byteOffset,r.byteLength);switch(r.byteLength){case 4:return{sec:e.getUint32(0),nsec:0};case 8:{let t=e.getUint32(0),i=e.getUint32(4),n=(t&3)*4294967296+i,s=t>>>2;return{sec:n,nsec:s}}case 12:{let t=ao(e,4),i=e.getUint32(0);return{sec:t,nsec:i}}default:throw new ft(`Unrecognized data size for timestamp (expected 4, 8, or 12): ${r.length}`)}}function i1(r){let e=r1(r);return new Date(e.sec*1e3+e.nsec/1e6)}var $f={type:Jb,encode:t1,decode:i1};var Cr=class{constructor(){this.builtInEncoders=[],this.builtInDecoders=[],this.encoders=[],this.decoders=[],this.register($f)}register({type:e,encode:t,decode:i}){if(e>=0)this.encoders[e]=t,this.decoders[e]=i;else{let n=-1-e;this.builtInEncoders[n]=t,this.builtInDecoders[n]=i}}tryToEncode(e,t){for(let i=0;i<this.builtInEncoders.length;i++){let n=this.builtInEncoders[i];if(n!=null){let s=n(e,t);if(s!=null){let o=-1-i;return new ci(o,s)}}}for(let i=0;i<this.encoders.length;i++){let n=this.encoders[i];if(n!=null){let s=n(e,t);if(s!=null){let o=i;return new ci(o,s)}}}return e instanceof ci?e:null}decode(e,t,i){let n=t<0?this.builtInDecoders[-1-t]:this.decoders[t];return n?n(e,t,i):new ci(t,e)}};Cr.defaultCodec=new Cr;function n1(r){return r instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&r instanceof SharedArrayBuffer}function Cn(r){return r instanceof Uint8Array?r:ArrayBuffer.isView(r)?new Uint8Array(r.buffer,r.byteOffset,r.byteLength):n1(r)?new Uint8Array(r):Uint8Array.from(r)}var s1=100,o1=2048,co=class r{constructor(e){this.entered=!1,this.extensionCodec=e?.extensionCodec??Cr.defaultCodec,this.context=e?.context,this.useBigInt64=e?.useBigInt64??!1,this.maxDepth=e?.maxDepth??s1,this.initialBufferSize=e?.initialBufferSize??o1,this.sortKeys=e?.sortKeys??!1,this.forceFloat32=e?.forceFloat32??!1,this.ignoreUndefined=e?.ignoreUndefined??!1,this.forceIntegerToFloat=e?.forceIntegerToFloat??!1,this.pos=0,this.view=new DataView(new ArrayBuffer(this.initialBufferSize)),this.bytes=new Uint8Array(this.view.buffer)}clone(){return new r({extensionCodec:this.extensionCodec,context:this.context,useBigInt64:this.useBigInt64,maxDepth:this.maxDepth,initialBufferSize:this.initialBufferSize,sortKeys:this.sortKeys,forceFloat32:this.forceFloat32,ignoreUndefined:this.ignoreUndefined,forceIntegerToFloat:this.forceIntegerToFloat})}reinitializeState(){this.pos=0}encodeSharedRef(e){if(this.entered)return this.clone().encodeSharedRef(e);try{return this.entered=!0,this.reinitializeState(),this.doEncode(e,1),this.bytes.subarray(0,this.pos)}finally{this.entered=!1}}encode(e){if(this.entered)return this.clone().encode(e);try{return this.entered=!0,this.reinitializeState(),this.doEncode(e,1),this.bytes.slice(0,this.pos)}finally{this.entered=!1}}doEncode(e,t){if(t>this.maxDepth)throw new Error(`Too deep objects in depth ${t}`);e==null?this.encodeNil():typeof e=="boolean"?this.encodeBoolean(e):typeof e=="number"?this.forceIntegerToFloat?this.encodeNumberAsFloat(e):this.encodeNumber(e):typeof e=="string"?this.encodeString(e):this.useBigInt64&&typeof e=="bigint"?this.encodeBigInt64(e):this.encodeObject(e,t)}ensureBufferSizeToWrite(e){let t=this.pos+e;this.view.byteLength<t&&this.resizeBuffer(t*2)}resizeBuffer(e){let t=new ArrayBuffer(e),i=new Uint8Array(t),n=new DataView(t);i.set(this.bytes),this.view=n,this.bytes=i}encodeNil(){this.writeU8(192)}encodeBoolean(e){e===!1?this.writeU8(194):this.writeU8(195)}encodeNumber(e){!this.forceIntegerToFloat&&Number.isSafeInteger(e)?e>=0?e<128?this.writeU8(e):e<256?(this.writeU8(204),this.writeU8(e)):e<65536?(this.writeU8(205),this.writeU16(e)):e<4294967296?(this.writeU8(206),this.writeU32(e)):this.useBigInt64?this.encodeNumberAsFloat(e):(this.writeU8(207),this.writeU64(e)):e>=-32?this.writeU8(224|e+32):e>=-128?(this.writeU8(208),this.writeI8(e)):e>=-32768?(this.writeU8(209),this.writeI16(e)):e>=-2147483648?(this.writeU8(210),this.writeI32(e)):this.useBigInt64?this.encodeNumberAsFloat(e):(this.writeU8(211),this.writeI64(e)):this.encodeNumberAsFloat(e)}encodeNumberAsFloat(e){this.forceFloat32?(this.writeU8(202),this.writeF32(e)):(this.writeU8(203),this.writeF64(e))}encodeBigInt64(e){e>=BigInt(0)?(this.writeU8(207),this.writeBigUint64(e)):(this.writeU8(211),this.writeBigInt64(e))}writeStringHeader(e){if(e<32)this.writeU8(160+e);else if(e<256)this.writeU8(217),this.writeU8(e);else if(e<65536)this.writeU8(218),this.writeU16(e);else if(e<4294967296)this.writeU8(219),this.writeU32(e);else throw new Error(`Too long string: ${e} bytes in UTF-8`)}encodeString(e){let i=Mf(e);this.ensureBufferSizeToWrite(5+i),this.writeStringHeader(i),qf(e,this.bytes,this.pos),this.pos+=i}encodeObject(e,t){let i=this.extensionCodec.tryToEncode(e,this.context);if(i!=null)this.encodeExtension(i);else if(Array.isArray(e))this.encodeArray(e,t);else if(ArrayBuffer.isView(e))this.encodeBinary(e);else if(typeof e=="object")this.encodeMap(e,t);else throw new Error(`Unrecognized object: ${Object.prototype.toString.apply(e)}`)}encodeBinary(e){let t=e.byteLength;if(t<256)this.writeU8(196),this.writeU8(t);else if(t<65536)this.writeU8(197),this.writeU16(t);else if(t<4294967296)this.writeU8(198),this.writeU32(t);else throw new Error(`Too large binary: ${t}`);let i=Cn(e);this.writeU8a(i)}encodeArray(e,t){let i=e.length;if(i<16)this.writeU8(144+i);else if(i<65536)this.writeU8(220),this.writeU16(i);else if(i<4294967296)this.writeU8(221),this.writeU32(i);else throw new Error(`Too large array: ${i}`);for(let n of e)this.doEncode(n,t+1)}countWithoutUndefined(e,t){let i=0;for(let n of t)e[n]!==void 0&&i++;return i}encodeMap(e,t){let i=Object.keys(e);this.sortKeys&&i.sort();let n=this.ignoreUndefined?this.countWithoutUndefined(e,i):i.length;if(n<16)this.writeU8(128+n);else if(n<65536)this.writeU8(222),this.writeU16(n);else if(n<4294967296)this.writeU8(223),this.writeU32(n);else throw new Error(`Too large map object: ${n}`);for(let s of i){let o=e[s];this.ignoreUndefined&&o===void 0||(this.encodeString(s),this.doEncode(o,t+1))}}encodeExtension(e){if(typeof e.data=="function"){let i=e.data(this.pos+6),n=i.length;if(n>=4294967296)throw new Error(`Too large extension object: ${n}`);this.writeU8(201),this.writeU32(n),this.writeI8(e.type),this.writeU8a(i);return}let t=e.data.length;if(t===1)this.writeU8(212);else if(t===2)this.writeU8(213);else if(t===4)this.writeU8(214);else if(t===8)this.writeU8(215);else if(t===16)this.writeU8(216);else if(t<256)this.writeU8(199),this.writeU8(t);else if(t<65536)this.writeU8(200),this.writeU16(t);else if(t<4294967296)this.writeU8(201),this.writeU32(t);else throw new Error(`Too large extension object: ${t}`);this.writeI8(e.type),this.writeU8a(e.data)}writeU8(e){this.ensureBufferSizeToWrite(1),this.view.setUint8(this.pos,e),this.pos++}writeU8a(e){let t=e.length;this.ensureBufferSizeToWrite(t),this.bytes.set(e,this.pos),this.pos+=t}writeI8(e){this.ensureBufferSizeToWrite(1),this.view.setInt8(this.pos,e),this.pos++}writeU16(e){this.ensureBufferSizeToWrite(2),this.view.setUint16(this.pos,e),this.pos+=2}writeI16(e){this.ensureBufferSizeToWrite(2),this.view.setInt16(this.pos,e),this.pos+=2}writeU32(e){this.ensureBufferSizeToWrite(4),this.view.setUint32(this.pos,e),this.pos+=4}writeI32(e){this.ensureBufferSizeToWrite(4),this.view.setInt32(this.pos,e),this.pos+=4}writeF32(e){this.ensureBufferSizeToWrite(4),this.view.setFloat32(this.pos,e),this.pos+=4}writeF64(e){this.ensureBufferSizeToWrite(8),this.view.setFloat64(this.pos,e),this.pos+=8}writeU64(e){this.ensureBufferSizeToWrite(8),jf(this.view,this.pos,e),this.pos+=8}writeI64(e){this.ensureBufferSizeToWrite(8),oo(this.view,this.pos,e),this.pos+=8}writeBigUint64(e){this.ensureBufferSizeToWrite(8),this.view.setBigUint64(this.pos,e),this.pos+=8}writeBigInt64(e){this.ensureBufferSizeToWrite(8),this.view.setBigInt64(this.pos,e),this.pos+=8}};function Ec(r,e){return new co(e).encodeSharedRef(r)}function uo(r){return`${r<0?"-":""}0x${Math.abs(r).toString(16).padStart(2,"0")}`}var a1=16,c1=16,lo=class{constructor(e=a1,t=c1){this.hit=0,this.miss=0,this.maxKeyLength=e,this.maxLengthPerKey=t,this.caches=[];for(let i=0;i<this.maxKeyLength;i++)this.caches.push([])}canBeCached(e){return e>0&&e<=this.maxKeyLength}find(e,t,i){let n=this.caches[i-1];e:for(let s of n){let o=s.bytes;for(let a=0;a<i;a++)if(o[a]!==e[t+a])continue e;return s.str}return null}store(e,t){let i=this.caches[e.length-1],n={bytes:e,str:t};i.length>=this.maxLengthPerKey?i[Math.random()*i.length|0]=n:i.push(n)}decode(e,t,i){let n=this.find(e,t,i);if(n!=null)return this.hit++,n;this.miss++;let s=bc(e,t,i),o=Uint8Array.prototype.slice.call(e,t,t+i);return this.store(o,s),s}};var xc="array",Nn="map_key",Hf="map_value",u1=r=>{if(typeof r=="string"||typeof r=="number")return r;throw new ft("The type of key must be string or number but "+typeof r)},_c=class{constructor(){this.stack=[],this.stackHeadPosition=-1}get length(){return this.stackHeadPosition+1}top(){return this.stack[this.stackHeadPosition]}pushArrayState(e){let t=this.getUninitializedStateFromPool();t.type=xc,t.position=0,t.size=e,t.array=new Array(e)}pushMapState(e){let t=this.getUninitializedStateFromPool();t.type=Nn,t.readCount=0,t.size=e,t.map={}}getUninitializedStateFromPool(){if(this.stackHeadPosition++,this.stackHeadPosition===this.stack.length){let e={type:void 0,size:0,array:void 0,position:0,readCount:0,map:void 0,key:null};this.stack.push(e)}return this.stack[this.stackHeadPosition]}release(e){if(this.stack[this.stackHeadPosition]!==e)throw new Error("Invalid stack state. Released state is not on top of the stack.");if(e.type===xc){let i=e;i.size=0,i.array=void 0,i.position=0,i.type=void 0}if(e.type===Nn||e.type===Hf){let i=e;i.size=0,i.map=void 0,i.readCount=0,i.type=void 0}this.stackHeadPosition--}reset(){this.stack.length=0,this.stackHeadPosition=-1}},Rn=-1,Sc=new DataView(new ArrayBuffer(0)),l1=new Uint8Array(Sc.buffer);try{Sc.getInt8(0)}catch(r){if(!(r instanceof RangeError))throw new Error("This module is not supported in the current JavaScript engine because DataView does not throw RangeError on out-of-bounds access")}var Kf=new RangeError("Insufficient data"),h1=new lo,ho=class r{constructor(e){this.totalPos=0,this.pos=0,this.view=Sc,this.bytes=l1,this.headByte=Rn,this.stack=new _c,this.entered=!1,this.extensionCodec=e?.extensionCodec??Cr.defaultCodec,this.context=e?.context,this.useBigInt64=e?.useBigInt64??!1,this.rawStrings=e?.rawStrings??!1,this.maxStrLength=e?.maxStrLength??4294967295,this.maxBinLength=e?.maxBinLength??4294967295,this.maxArrayLength=e?.maxArrayLength??4294967295,this.maxMapLength=e?.maxMapLength??4294967295,this.maxExtLength=e?.maxExtLength??4294967295,this.keyDecoder=e?.keyDecoder!==void 0?e.keyDecoder:h1,this.mapKeyConverter=e?.mapKeyConverter??u1}clone(){return new r({extensionCodec:this.extensionCodec,context:this.context,useBigInt64:this.useBigInt64,rawStrings:this.rawStrings,maxStrLength:this.maxStrLength,maxBinLength:this.maxBinLength,maxArrayLength:this.maxArrayLength,maxMapLength:this.maxMapLength,maxExtLength:this.maxExtLength,keyDecoder:this.keyDecoder})}reinitializeState(){this.totalPos=0,this.headByte=Rn,this.stack.reset()}setBuffer(e){let t=Cn(e);this.bytes=t,this.view=new DataView(t.buffer,t.byteOffset,t.byteLength),this.pos=0}appendBuffer(e){if(this.headByte===Rn&&!this.hasRemaining(1))this.setBuffer(e);else{let t=this.bytes.subarray(this.pos),i=Cn(e),n=new Uint8Array(t.length+i.length);n.set(t),n.set(i,t.length),this.setBuffer(n)}}hasRemaining(e){return this.view.byteLength-this.pos>=e}createExtraByteError(e){let{view:t,pos:i}=this;return new RangeError(`Extra ${t.byteLength-i} of ${t.byteLength} byte(s) found at buffer[${e}]`)}decode(e){if(this.entered)return this.clone().decode(e);try{this.entered=!0,this.reinitializeState(),this.setBuffer(e);let t=this.doDecodeSync();if(this.hasRemaining(1))throw this.createExtraByteError(this.pos);return t}finally{this.entered=!1}}*decodeMulti(e){if(this.entered){yield*this.clone().decodeMulti(e);return}try{for(this.entered=!0,this.reinitializeState(),this.setBuffer(e);this.hasRemaining(1);)yield this.doDecodeSync()}finally{this.entered=!1}}async decodeAsync(e){if(this.entered)return this.clone().decodeAsync(e);try{this.entered=!0;let t=!1,i;for await(let a of e){if(t)throw this.entered=!1,this.createExtraByteError(this.totalPos);this.appendBuffer(a);try{i=this.doDecodeSync(),t=!0}catch(c){if(!(c instanceof RangeError))throw c}this.totalPos+=this.pos}if(t){if(this.hasRemaining(1))throw this.createExtraByteError(this.totalPos);return i}let{headByte:n,pos:s,totalPos:o}=this;throw new RangeError(`Insufficient data in parsing ${uo(n)} at ${o} (${s} in the current buffer)`)}finally{this.entered=!1}}decodeArrayStream(e){return this.decodeMultiAsync(e,!0)}decodeStream(e){return this.decodeMultiAsync(e,!1)}async*decodeMultiAsync(e,t){if(this.entered){yield*this.clone().decodeMultiAsync(e,t);return}try{this.entered=!0;let i=t,n=-1;for await(let s of e){if(t&&n===0)throw this.createExtraByteError(this.totalPos);this.appendBuffer(s),i&&(n=this.readArraySize(),i=!1,this.complete());try{for(;yield this.doDecodeSync(),--n!==0;);}catch(o){if(!(o instanceof RangeError))throw o}this.totalPos+=this.pos}}finally{this.entered=!1}}doDecodeSync(){e:for(;;){let e=this.readHeadByte(),t;if(e>=224)t=e-256;else if(e<192)if(e<128)t=e;else if(e<144){let n=e-128;if(n!==0){this.pushMapState(n),this.complete();continue e}else t={}}else if(e<160){let n=e-144;if(n!==0){this.pushArrayState(n),this.complete();continue e}else t=[]}else{let n=e-160;t=this.decodeString(n,0)}else if(e===192)t=null;else if(e===194)t=!1;else if(e===195)t=!0;else if(e===202)t=this.readF32();else if(e===203)t=this.readF64();else if(e===204)t=this.readU8();else if(e===205)t=this.readU16();else if(e===206)t=this.readU32();else if(e===207)this.useBigInt64?t=this.readU64AsBigInt():t=this.readU64();else if(e===208)t=this.readI8();else if(e===209)t=this.readI16();else if(e===210)t=this.readI32();else if(e===211)this.useBigInt64?t=this.readI64AsBigInt():t=this.readI64();else if(e===217){let n=this.lookU8();t=this.decodeString(n,1)}else if(e===218){let n=this.lookU16();t=this.decodeString(n,2)}else if(e===219){let n=this.lookU32();t=this.decodeString(n,4)}else if(e===220){let n=this.readU16();if(n!==0){this.pushArrayState(n),this.complete();continue e}else t=[]}else if(e===221){let n=this.readU32();if(n!==0){this.pushArrayState(n),this.complete();continue e}else t=[]}else if(e===222){let n=this.readU16();if(n!==0){this.pushMapState(n),this.complete();continue e}else t={}}else if(e===223){let n=this.readU32();if(n!==0){this.pushMapState(n),this.complete();continue e}else t={}}else if(e===196){let n=this.lookU8();t=this.decodeBinary(n,1)}else if(e===197){let n=this.lookU16();t=this.decodeBinary(n,2)}else if(e===198){let n=this.lookU32();t=this.decodeBinary(n,4)}else if(e===212)t=this.decodeExtension(1,0);else if(e===213)t=this.decodeExtension(2,0);else if(e===214)t=this.decodeExtension(4,0);else if(e===215)t=this.decodeExtension(8,0);else if(e===216)t=this.decodeExtension(16,0);else if(e===199){let n=this.lookU8();t=this.decodeExtension(n,1)}else if(e===200){let n=this.lookU16();t=this.decodeExtension(n,2)}else if(e===201){let n=this.lookU32();t=this.decodeExtension(n,4)}else throw new ft(`Unrecognized type byte: ${uo(e)}`);this.complete();let i=this.stack;for(;i.length>0;){let n=i.top();if(n.type===xc)if(n.array[n.position]=t,n.position++,n.position===n.size)t=n.array,i.release(n);else continue e;else if(n.type===Nn){if(t==="__proto__")throw new ft("The key __proto__ is not allowed");n.key=this.mapKeyConverter(t),n.type=Hf;continue e}else if(n.map[n.key]=t,n.readCount++,n.readCount===n.size)t=n.map,i.release(n);else{n.key=null,n.type=Nn;continue e}}return t}}readHeadByte(){return this.headByte===Rn&&(this.headByte=this.readU8()),this.headByte}complete(){this.headByte=Rn}readArraySize(){let e=this.readHeadByte();switch(e){case 220:return this.readU16();case 221:return this.readU32();default:{if(e<160)return e-144;throw new ft(`Unrecognized array type byte: ${uo(e)}`)}}}pushMapState(e){if(e>this.maxMapLength)throw new ft(`Max length exceeded: map length (${e}) > maxMapLengthLength (${this.maxMapLength})`);this.stack.pushMapState(e)}pushArrayState(e){if(e>this.maxArrayLength)throw new ft(`Max length exceeded: array length (${e}) > maxArrayLength (${this.maxArrayLength})`);this.stack.pushArrayState(e)}decodeString(e,t){return!this.rawStrings||this.stateIsMapKey()?this.decodeUtf8String(e,t):this.decodeBinary(e,t)}decodeUtf8String(e,t){if(e>this.maxStrLength)throw new ft(`Max length exceeded: UTF-8 byte length (${e}) > maxStrLength (${this.maxStrLength})`);if(this.bytes.byteLength<this.pos+t+e)throw Kf;let i=this.pos+t,n;return this.stateIsMapKey()&&this.keyDecoder?.canBeCached(e)?n=this.keyDecoder.decode(this.bytes,i,e):n=zf(this.bytes,i,e),this.pos+=t+e,n}stateIsMapKey(){return this.stack.length>0?this.stack.top().type===Nn:!1}decodeBinary(e,t){if(e>this.maxBinLength)throw new ft(`Max length exceeded: bin length (${e}) > maxBinLength (${this.maxBinLength})`);if(!this.hasRemaining(e+t))throw Kf;let i=this.pos+t,n=this.bytes.subarray(i,i+e);return this.pos+=t+e,n}decodeExtension(e,t){if(e>this.maxExtLength)throw new ft(`Max length exceeded: ext length (${e}) > maxExtLength (${this.maxExtLength})`);let i=this.view.getInt8(this.pos+t),n=this.decodeBinary(e,t+1);return this.extensionCodec.decode(n,i,this.context)}lookU8(){return this.view.getUint8(this.pos)}lookU16(){return this.view.getUint16(this.pos)}lookU32(){return this.view.getUint32(this.pos)}readU8(){let e=this.view.getUint8(this.pos);return this.pos++,e}readI8(){let e=this.view.getInt8(this.pos);return this.pos++,e}readU16(){let e=this.view.getUint16(this.pos);return this.pos+=2,e}readI16(){let e=this.view.getInt16(this.pos);return this.pos+=2,e}readU32(){let e=this.view.getUint32(this.pos);return this.pos+=4,e}readI32(){let e=this.view.getInt32(this.pos);return this.pos+=4,e}readU64(){let e=Vf(this.view,this.pos);return this.pos+=8,e}readI64(){let e=ao(this.view,this.pos);return this.pos+=8,e}readU64AsBigInt(){let e=this.view.getBigUint64(this.pos);return this.pos+=8,e}readI64AsBigInt(){let e=this.view.getBigInt64(this.pos);return this.pos+=8,e}readF32(){let e=this.view.getFloat32(this.pos);return this.pos+=4,e}readF64(){let e=this.view.getFloat64(this.pos);return this.pos+=8,e}};function Ic(r,e){return new ho(e).decode(r)}var hp=Se(zi());var d1=r=>JSON.stringify(r,(e,t)=>typeof t=="bigint"?t.toString()+"n":t),f1=r=>{let e=/([\[:])?(\d{17,}|(?:[9](?:[1-9]07199254740991|0[1-9]7199254740991|00[8-9]199254740991|007[2-9]99254740991|007199[3-9]54740991|0071992[6-9]4740991|00719925[5-9]740991|007199254[8-9]40991|0071992547[5-9]0991|00719925474[1-9]991|00719925474099[2-9])))([,\}\]])/g,t=r.replace(e,'$1"$2n"$3');return JSON.parse(t,(i,n)=>typeof n=="string"&&n.match(/^\d+n$/)?BigInt(n.substring(0,n.length-1)):n)};function Zt(r){if(typeof r!="string")throw new Error(`Cannot safe json parse value of type ${typeof r}`);try{return f1(r)}catch{return r}}function Rt(r){return typeof r=="string"?r:d1(r)||""}function p1(r){return r instanceof Uint8Array||ArrayBuffer.isView(r)&&r.constructor.name==="Uint8Array"}function dp(r,...e){if(!p1(r))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(r.length))throw new Error("Uint8Array expected of length "+e+", got length="+r.length)}function Wf(r,e=!0){if(r.destroyed)throw new Error("Hash instance has been destroyed");if(e&&r.finished)throw new Error("Hash#digest() has already been called")}function g1(r,e){dp(r);let t=e.outputLen;if(r.length<t)throw new Error("digestInto() expects output buffer of length at least "+t)}var $i=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;var Ac=r=>new DataView(r.buffer,r.byteOffset,r.byteLength);function m1(r){if(typeof r!="string")throw new Error("utf8ToBytes expected string, got "+typeof r);return new Uint8Array(new TextEncoder().encode(r))}function fp(r){return typeof r=="string"&&(r=m1(r)),dp(r),r}var Fc=class{clone(){return this._cloneInto()}};function y1(r){let e=i=>r().update(fp(i)).digest(),t=r();return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=()=>r(),e}function pp(r=32){if($i&&typeof $i.getRandomValues=="function")return $i.getRandomValues(new Uint8Array(r));if($i&&typeof $i.randomBytes=="function")return $i.randomBytes(r);throw new Error("crypto.getRandomValues must be defined")}function w1(r,e,t,i){if(typeof r.setBigUint64=="function")return r.setBigUint64(e,t,i);let n=BigInt(32),s=BigInt(4294967295),o=Number(t>>n&s),a=Number(t&s),c=i?4:0,u=i?0:4;r.setUint32(e+c,o,i),r.setUint32(e+u,a,i)}var Bc=class extends Fc{constructor(e,t,i,n){super(),this.blockLen=e,this.outputLen=t,this.padOffset=i,this.isLE=n,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=Ac(this.buffer)}update(e){Wf(this);let{view:t,buffer:i,blockLen:n}=this;e=fp(e);let s=e.length;for(let o=0;o<s;){let a=Math.min(n-this.pos,s-o);if(a===n){let c=Ac(e);for(;n<=s-o;o+=n)this.process(c,o);continue}i.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===n&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){Wf(this),g1(e,this),this.finished=!0;let{buffer:t,view:i,blockLen:n,isLE:s}=this,{pos:o}=this;t[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>n-o&&(this.process(i,0),o=0);for(let h=o;h<n;h++)t[h]=0;w1(i,n-8,BigInt(this.length*8),s),this.process(i,0);let a=Ac(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");let u=c/4,l=this.get();if(u>l.length)throw new Error("_sha2: outputLen bigger than state");for(let h=0;h<u;h++)a.setUint32(4*h,l[h],s)}digest(){let{buffer:e,outputLen:t}=this;this.digestInto(e);let i=e.slice(0,t);return this.destroy(),i}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());let{blockLen:t,buffer:i,length:n,finished:s,destroyed:o,pos:a}=this;return e.length=n,e.pos=a,e.finished=s,e.destroyed=o,n%t&&e.buffer.set(i),e}},fo=BigInt(2**32-1),Uc=BigInt(32);function gp(r,e=!1){return e?{h:Number(r&fo),l:Number(r>>Uc&fo)}:{h:Number(r>>Uc&fo)|0,l:Number(r&fo)|0}}function v1(r,e=!1){let t=new Uint32Array(r.length),i=new Uint32Array(r.length);for(let n=0;n<r.length;n++){let{h:s,l:o}=gp(r[n],e);[t[n],i[n]]=[s,o]}return[t,i]}var b1=(r,e)=>BigInt(r>>>0)<<Uc|BigInt(e>>>0),E1=(r,e,t)=>r>>>t,x1=(r,e,t)=>r<<32-t|e>>>t,_1=(r,e,t)=>r>>>t|e<<32-t,S1=(r,e,t)=>r<<32-t|e>>>t,I1=(r,e,t)=>r<<64-t|e>>>t-32,A1=(r,e,t)=>r>>>t-32|e<<64-t,D1=(r,e)=>e,T1=(r,e)=>r,C1=(r,e,t)=>r<<t|e>>>32-t,O1=(r,e,t)=>e<<t|r>>>32-t,R1=(r,e,t)=>e<<t-32|r>>>64-t,N1=(r,e,t)=>r<<t-32|e>>>64-t;function P1(r,e,t,i){let n=(e>>>0)+(i>>>0);return{h:r+t+(n/2**32|0)|0,l:n|0}}var F1=(r,e,t)=>(r>>>0)+(e>>>0)+(t>>>0),B1=(r,e,t,i)=>e+t+i+(r/2**32|0)|0,U1=(r,e,t,i)=>(r>>>0)+(e>>>0)+(t>>>0)+(i>>>0),k1=(r,e,t,i,n)=>e+t+i+n+(r/2**32|0)|0,L1=(r,e,t,i,n)=>(r>>>0)+(e>>>0)+(t>>>0)+(i>>>0)+(n>>>0),M1=(r,e,t,i,n,s)=>e+t+i+n+s+(r/2**32|0)|0,Q={fromBig:gp,split:v1,toBig:b1,shrSH:E1,shrSL:x1,rotrSH:_1,rotrSL:S1,rotrBH:I1,rotrBL:A1,rotr32H:D1,rotr32L:T1,rotlSH:C1,rotlSL:O1,rotlBH:R1,rotlBL:N1,add:P1,add3L:F1,add3H:B1,add4L:U1,add4H:k1,add5H:M1,add5L:L1},[q1,z1]=Q.split(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(r=>BigInt(r))),Or=new Uint32Array(80),Rr=new Uint32Array(80),kc=class extends Bc{constructor(){super(128,64,16,!1),this.Ah=1779033703,this.Al=-205731576,this.Bh=-1150833019,this.Bl=-2067093701,this.Ch=1013904242,this.Cl=-23791573,this.Dh=-1521486534,this.Dl=1595750129,this.Eh=1359893119,this.El=-1377402159,this.Fh=-1694144372,this.Fl=725511199,this.Gh=528734635,this.Gl=-79577749,this.Hh=1541459225,this.Hl=327033209}get(){let{Ah:e,Al:t,Bh:i,Bl:n,Ch:s,Cl:o,Dh:a,Dl:c,Eh:u,El:l,Fh:h,Fl:d,Gh:p,Gl:f,Hh:g,Hl:m}=this;return[e,t,i,n,s,o,a,c,u,l,h,d,p,f,g,m]}set(e,t,i,n,s,o,a,c,u,l,h,d,p,f,g,m){this.Ah=e|0,this.Al=t|0,this.Bh=i|0,this.Bl=n|0,this.Ch=s|0,this.Cl=o|0,this.Dh=a|0,this.Dl=c|0,this.Eh=u|0,this.El=l|0,this.Fh=h|0,this.Fl=d|0,this.Gh=p|0,this.Gl=f|0,this.Hh=g|0,this.Hl=m|0}process(e,t){for(let y=0;y<16;y++,t+=4)Or[y]=e.getUint32(t),Rr[y]=e.getUint32(t+=4);for(let y=16;y<80;y++){let S=Or[y-15]|0,E=Rr[y-15]|0,C=Q.rotrSH(S,E,1)^Q.rotrSH(S,E,8)^Q.shrSH(S,E,7),R=Q.rotrSL(S,E,1)^Q.rotrSL(S,E,8)^Q.shrSL(S,E,7),P=Or[y-2]|0,b=Rr[y-2]|0,A=Q.rotrSH(P,b,19)^Q.rotrBH(P,b,61)^Q.shrSH(P,b,6),_=Q.rotrSL(P,b,19)^Q.rotrBL(P,b,61)^Q.shrSL(P,b,6),D=Q.add4L(R,_,Rr[y-7],Rr[y-16]),F=Q.add4H(D,C,A,Or[y-7],Or[y-16]);Or[y]=F|0,Rr[y]=D|0}let{Ah:i,Al:n,Bh:s,Bl:o,Ch:a,Cl:c,Dh:u,Dl:l,Eh:h,El:d,Fh:p,Fl:f,Gh:g,Gl:m,Hh:w,Hl:v}=this;for(let y=0;y<80;y++){let S=Q.rotrSH(h,d,14)^Q.rotrSH(h,d,18)^Q.rotrBH(h,d,41),E=Q.rotrSL(h,d,14)^Q.rotrSL(h,d,18)^Q.rotrBL(h,d,41),C=h&p^~h&g,R=d&f^~d&m,P=Q.add5L(v,E,R,z1[y],Rr[y]),b=Q.add5H(P,w,S,C,q1[y],Or[y]),A=P|0,_=Q.rotrSH(i,n,28)^Q.rotrBH(i,n,34)^Q.rotrBH(i,n,39),D=Q.rotrSL(i,n,28)^Q.rotrBL(i,n,34)^Q.rotrBL(i,n,39),F=i&s^i&a^s&a,k=n&o^n&c^o&c;w=g|0,v=m|0,g=p|0,m=f|0,p=h|0,f=d|0,{h,l:d}=Q.add(u|0,l|0,b|0,A|0),u=a|0,l=c|0,a=s|0,c=o|0,s=i|0,o=n|0;let I=Q.add3L(A,D,k);i=Q.add3H(I,b,_,F),n=I|0}({h:i,l:n}=Q.add(this.Ah|0,this.Al|0,i|0,n|0)),{h:s,l:o}=Q.add(this.Bh|0,this.Bl|0,s|0,o|0),{h:a,l:c}=Q.add(this.Ch|0,this.Cl|0,a|0,c|0),{h:u,l}=Q.add(this.Dh|0,this.Dl|0,u|0,l|0),{h,l:d}=Q.add(this.Eh|0,this.El|0,h|0,d|0),{h:p,l:f}=Q.add(this.Fh|0,this.Fl|0,p|0,f|0),{h:g,l:m}=Q.add(this.Gh|0,this.Gl|0,g|0,m|0),{h:w,l:v}=Q.add(this.Hh|0,this.Hl|0,w|0,v|0),this.set(i,n,s,o,a,c,u,l,h,d,p,f,g,m,w,v)}roundClean(){Or.fill(0),Rr.fill(0)}destroy(){this.buffer.fill(0),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}},j1=y1(()=>new kc);var Gc=BigInt(0),mp=BigInt(1),V1=BigInt(2);function Yc(r){return r instanceof Uint8Array||ArrayBuffer.isView(r)&&r.constructor.name==="Uint8Array"}function Jc(r){if(!Yc(r))throw new Error("Uint8Array expected")}function Dc(r,e){if(typeof e!="boolean")throw new Error(r+" boolean expected, got "+e)}var $1=Array.from({length:256},(r,e)=>e.toString(16).padStart(2,"0"));function Xc(r){Jc(r);let e="";for(let t=0;t<r.length;t++)e+=$1[r[t]];return e}function yp(r){if(typeof r!="string")throw new Error("hex string expected, got "+typeof r);return r===""?Gc:BigInt("0x"+r)}var fr={_0:48,_9:57,A:65,F:70,a:97,f:102};function Gf(r){if(r>=fr._0&&r<=fr._9)return r-fr._0;if(r>=fr.A&&r<=fr.F)return r-(fr.A-10);if(r>=fr.a&&r<=fr.f)return r-(fr.a-10)}function wp(r){if(typeof r!="string")throw new Error("hex string expected, got "+typeof r);let e=r.length,t=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);let i=new Uint8Array(t);for(let n=0,s=0;n<t;n++,s+=2){let o=Gf(r.charCodeAt(s)),a=Gf(r.charCodeAt(s+1));if(o===void 0||a===void 0){let c=r[s]+r[s+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+s)}i[n]=o*16+a}return i}function K1(r){return yp(Xc(r))}function mo(r){return Jc(r),yp(Xc(Uint8Array.from(r).reverse()))}function vp(r,e){return wp(r.toString(16).padStart(e*2,"0"))}function Lc(r,e){return vp(r,e).reverse()}function pr(r,e,t){let i;if(typeof e=="string")try{i=wp(e)}catch(s){throw new Error(r+" must be hex string or Uint8Array, cause: "+s)}else if(Yc(e))i=Uint8Array.from(e);else throw new Error(r+" must be hex string or Uint8Array");let n=i.length;if(typeof t=="number"&&n!==t)throw new Error(r+" of length "+t+" expected, got "+n);return i}function Yf(...r){let e=0;for(let i=0;i<r.length;i++){let n=r[i];Jc(n),e+=n.length}let t=new Uint8Array(e);for(let i=0,n=0;i<r.length;i++){let s=r[i];t.set(s,n),n+=s.length}return t}var Tc=r=>typeof r=="bigint"&&Gc<=r;function H1(r,e,t){return Tc(r)&&Tc(e)&&Tc(t)&&e<=r&&r<t}function Pn(r,e,t,i){if(!H1(e,t,i))throw new Error("expected valid "+r+": "+t+" <= n < "+i+", got "+e)}function W1(r){let e;for(e=0;r>Gc;r>>=mp,e+=1);return e}var G1=r=>(V1<<BigInt(r-1))-mp,Y1={bigint:r=>typeof r=="bigint",function:r=>typeof r=="function",boolean:r=>typeof r=="boolean",string:r=>typeof r=="string",stringOrUint8Array:r=>typeof r=="string"||Yc(r),isSafeInteger:r=>Number.isSafeInteger(r),array:r=>Array.isArray(r),field:(r,e)=>e.Fp.isValid(r),hash:r=>typeof r=="function"&&Number.isSafeInteger(r.outputLen)};function Qc(r,e,t={}){let i=(n,s,o)=>{let a=Y1[s];if(typeof a!="function")throw new Error("invalid validator function");let c=r[n];if(!(o&&c===void 0)&&!a(c,r))throw new Error("param "+String(n)+" is invalid. Expected "+s+", got "+c)};for(let[n,s]of Object.entries(e))i(n,s,!1);for(let[n,s]of Object.entries(t))i(n,s,!0);return r}function Jf(r){let e=new WeakMap;return(t,...i)=>{let n=e.get(t);if(n!==void 0)return n;let s=r(t,...i);return e.set(t,s),s}}var Pe=BigInt(0),Ee=BigInt(1),ui=BigInt(2),J1=BigInt(3),Mc=BigInt(4),Xf=BigInt(5),Qf=BigInt(8);function Ce(r,e){let t=r%e;return t>=Pe?t:e+t}function X1(r,e,t){if(e<Pe)throw new Error("invalid exponent, negatives unsupported");if(t<=Pe)throw new Error("invalid modulus");if(t===Ee)return Pe;let i=Ee;for(;e>Pe;)e&Ee&&(i=i*r%t),r=r*r%t,e>>=Ee;return i}function er(r,e,t){let i=r;for(;e-- >Pe;)i*=i,i%=t;return i}function Zf(r,e){if(r===Pe)throw new Error("invert: expected non-zero number");if(e<=Pe)throw new Error("invert: expected positive modulus, got "+e);let t=Ce(r,e),i=e,n=Pe,s=Ee;for(;t!==Pe;){let o=i/t,a=i%t,c=n-s*o;i=t,t=a,n=s,s=c}if(i!==Ee)throw new Error("invert: does not exist");return Ce(n,e)}function Q1(r){let e=(r-Ee)/ui,t,i,n;for(t=r-Ee,i=0;t%ui===Pe;t/=ui,i++);for(n=ui;n<r&&X1(n,e,r)!==r-Ee;n++)if(n>1e3)throw new Error("Cannot find square root: likely non-prime P");if(i===1){let o=(r+Ee)/Mc;return function(a,c){let u=a.pow(c,o);if(!a.eql(a.sqr(u),c))throw new Error("Cannot find square root");return u}}let s=(t+Ee)/ui;return function(o,a){if(o.pow(a,e)===o.neg(o.ONE))throw new Error("Cannot find square root");let c=i,u=o.pow(o.mul(o.ONE,n),t),l=o.pow(a,s),h=o.pow(a,t);for(;!o.eql(h,o.ONE);){if(o.eql(h,o.ZERO))return o.ZERO;let d=1;for(let f=o.sqr(h);d<c&&!o.eql(f,o.ONE);d++)f=o.sqr(f);let p=o.pow(u,Ee<<BigInt(c-d-1));u=o.sqr(p),l=o.mul(l,p),h=o.mul(h,u),c=d}return l}}function Z1(r){if(r%Mc===J1){let e=(r+Ee)/Mc;return function(t,i){let n=t.pow(i,e);if(!t.eql(t.sqr(n),i))throw new Error("Cannot find square root");return n}}if(r%Qf===Xf){let e=(r-Xf)/Qf;return function(t,i){let n=t.mul(i,ui),s=t.pow(n,e),o=t.mul(i,s),a=t.mul(t.mul(o,ui),s),c=t.mul(o,t.sub(a,t.ONE));if(!t.eql(t.sqr(c),i))throw new Error("Cannot find square root");return c}}return Q1(r)}var eE=(r,e)=>(Ce(r,e)&Ee)===Ee,tE=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function rE(r){let e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},t=tE.reduce((i,n)=>(i[n]="function",i),e);return Qc(r,t)}function iE(r,e,t){if(t<Pe)throw new Error("invalid exponent, negatives unsupported");if(t===Pe)return r.ONE;if(t===Ee)return e;let i=r.ONE,n=e;for(;t>Pe;)t&Ee&&(i=r.mul(i,n)),n=r.sqr(n),t>>=Ee;return i}function nE(r,e){let t=new Array(e.length),i=e.reduce((s,o,a)=>r.is0(o)?s:(t[a]=s,r.mul(s,o)),r.ONE),n=r.inv(i);return e.reduceRight((s,o,a)=>r.is0(o)?s:(t[a]=r.mul(s,t[a]),r.mul(s,o)),n),t}function bp(r,e){let t=e!==void 0?e:r.toString(2).length,i=Math.ceil(t/8);return{nBitLength:t,nByteLength:i}}function Ep(r,e,t=!1,i={}){if(r<=Pe)throw new Error("invalid field: expected ORDER > 0, got "+r);let{nBitLength:n,nByteLength:s}=bp(r,e);if(s>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let o,a=Object.freeze({ORDER:r,isLE:t,BITS:n,BYTES:s,MASK:G1(n),ZERO:Pe,ONE:Ee,create:c=>Ce(c,r),isValid:c=>{if(typeof c!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof c);return Pe<=c&&c<r},is0:c=>c===Pe,isOdd:c=>(c&Ee)===Ee,neg:c=>Ce(-c,r),eql:(c,u)=>c===u,sqr:c=>Ce(c*c,r),add:(c,u)=>Ce(c+u,r),sub:(c,u)=>Ce(c-u,r),mul:(c,u)=>Ce(c*u,r),pow:(c,u)=>iE(a,c,u),div:(c,u)=>Ce(c*Zf(u,r),r),sqrN:c=>c*c,addN:(c,u)=>c+u,subN:(c,u)=>c-u,mulN:(c,u)=>c*u,inv:c=>Zf(c,r),sqrt:i.sqrt||(c=>(o||(o=Z1(r)),o(a,c))),invertBatch:c=>nE(a,c),cmov:(c,u,l)=>l?u:c,toBytes:c=>t?Lc(c,s):vp(c,s),fromBytes:c=>{if(c.length!==s)throw new Error("Field.fromBytes: expected "+s+" bytes, got "+c.length);return t?mo(c):K1(c)}});return Object.freeze(a)}var ep=BigInt(0),po=BigInt(1);function Cc(r,e){let t=e.negate();return r?t:e}function xp(r,e){if(!Number.isSafeInteger(r)||r<=0||r>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+r)}function Oc(r,e){xp(r,e);let t=Math.ceil(e/r)+1,i=2**(r-1);return{windows:t,windowSize:i}}function sE(r,e){if(!Array.isArray(r))throw new Error("array expected");r.forEach((t,i)=>{if(!(t instanceof e))throw new Error("invalid point at index "+i)})}function oE(r,e){if(!Array.isArray(r))throw new Error("array of scalars expected");r.forEach((t,i)=>{if(!e.isValid(t))throw new Error("invalid scalar at index "+i)})}var Rc=new WeakMap,_p=new WeakMap;function Nc(r){return _p.get(r)||1}function aE(r,e){return{constTimeNegate:Cc,hasPrecomputes(t){return Nc(t)!==1},unsafeLadder(t,i,n=r.ZERO){let s=t;for(;i>ep;)i&po&&(n=n.add(s)),s=s.double(),i>>=po;return n},precomputeWindow(t,i){let{windows:n,windowSize:s}=Oc(i,e),o=[],a=t,c=a;for(let u=0;u<n;u++){c=a,o.push(c);for(let l=1;l<s;l++)c=c.add(a),o.push(c);a=c.double()}return o},wNAF(t,i,n){let{windows:s,windowSize:o}=Oc(t,e),a=r.ZERO,c=r.BASE,u=BigInt(2**t-1),l=2**t,h=BigInt(t);for(let d=0;d<s;d++){let p=d*o,f=Number(n&u);n>>=h,f>o&&(f-=l,n+=po);let g=p,m=p+Math.abs(f)-1,w=d%2!==0,v=f<0;f===0?c=c.add(Cc(w,i[g])):a=a.add(Cc(v,i[m]))}return{p:a,f:c}},wNAFUnsafe(t,i,n,s=r.ZERO){let{windows:o,windowSize:a}=Oc(t,e),c=BigInt(2**t-1),u=2**t,l=BigInt(t);for(let h=0;h<o;h++){let d=h*a;if(n===ep)break;let p=Number(n&c);if(n>>=l,p>a&&(p-=u,n+=po),p===0)continue;let f=i[d+Math.abs(p)-1];p<0&&(f=f.negate()),s=s.add(f)}return s},getPrecomputes(t,i,n){let s=Rc.get(i);return s||(s=this.precomputeWindow(i,t),t!==1&&Rc.set(i,n(s))),s},wNAFCached(t,i,n){let s=Nc(t);return this.wNAF(s,this.getPrecomputes(s,t,n),i)},wNAFCachedUnsafe(t,i,n,s){let o=Nc(t);return o===1?this.unsafeLadder(t,i,s):this.wNAFUnsafe(o,this.getPrecomputes(o,t,n),i,s)},setWindowSize(t,i){xp(i,e),_p.set(t,i),Rc.delete(t)}}}function cE(r,e,t,i){if(sE(t,r),oE(i,e),t.length!==i.length)throw new Error("arrays of points and scalars must have equal length");let n=r.ZERO,s=W1(BigInt(t.length)),o=s>12?s-3:s>4?s-2:s?2:1,a=(1<<o)-1,c=new Array(a+1).fill(n),u=Math.floor((e.BITS-1)/o)*o,l=n;for(let h=u;h>=0;h-=o){c.fill(n);for(let p=0;p<i.length;p++){let f=i[p],g=Number(f>>BigInt(h)&BigInt(a));c[g]=c[g].add(t[p])}let d=n;for(let p=c.length-1,f=n;p>0;p--)f=f.add(c[p]),d=d.add(f);if(l=l.add(d),h!==0)for(let p=0;p<o;p++)l=l.double()}return l}function uE(r){return rE(r.Fp),Qc(r,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...bp(r.n,r.nBitLength),...r,p:r.Fp.ORDER})}var qt=BigInt(0),pt=BigInt(1),go=BigInt(2),lE=BigInt(8),hE={zip215:!0};function dE(r){let e=uE(r);return Qc(r,{hash:"function",a:"bigint",d:"bigint",randomBytes:"function"},{adjustScalarBytes:"function",domain:"function",uvRatio:"function",mapToCurve:"function"}),Object.freeze({...e})}function fE(r){let e=dE(r),{Fp:t,n:i,prehash:n,hash:s,randomBytes:o,nByteLength:a,h:c}=e,u=go<<BigInt(a*8)-pt,l=t.create,h=Ep(e.n,e.nBitLength),d=e.uvRatio||((I,x)=>{try{return{isValid:!0,value:t.sqrt(I*t.inv(x))}}catch{return{isValid:!1,value:qt}}}),p=e.adjustScalarBytes||(I=>I),f=e.domain||((I,x,T)=>{if(Dc("phflag",T),x.length||T)throw new Error("Contexts/pre-hash are not supported");return I});function g(I,x){Pn("coordinate "+I,x,qt,u)}function m(I){if(!(I instanceof y))throw new Error("ExtendedPoint expected")}let w=Jf((I,x)=>{let{ex:T,ey:N,ez:O}=I,U=I.is0();x==null&&(x=U?lE:t.inv(O));let L=l(T*x),j=l(N*x),H=l(O*x);if(U)return{x:qt,y:pt};if(H!==pt)throw new Error("invZ was invalid");return{x:L,y:j}}),v=Jf(I=>{let{a:x,d:T}=e;if(I.is0())throw new Error("bad point: ZERO");let{ex:N,ey:O,ez:U,et:L}=I,j=l(N*N),H=l(O*O),W=l(U*U),Y=l(W*W),J=l(j*x),ue=l(W*l(J+H)),ce=l(Y+l(T*l(j*H)));if(ue!==ce)throw new Error("bad point: equation left != right (1)");let ee=l(N*O),be=l(U*L);if(ee!==be)throw new Error("bad point: equation left != right (2)");return!0});class y{constructor(x,T,N,O){this.ex=x,this.ey=T,this.ez=N,this.et=O,g("x",x),g("y",T),g("z",N),g("t",O),Object.freeze(this)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static fromAffine(x){if(x instanceof y)throw new Error("extended point not allowed");let{x:T,y:N}=x||{};return g("x",T),g("y",N),new y(T,N,pt,l(T*N))}static normalizeZ(x){let T=t.invertBatch(x.map(N=>N.ez));return x.map((N,O)=>N.toAffine(T[O])).map(y.fromAffine)}static msm(x,T){return cE(y,h,x,T)}_setWindowSize(x){C.setWindowSize(this,x)}assertValidity(){v(this)}equals(x){m(x);let{ex:T,ey:N,ez:O}=this,{ex:U,ey:L,ez:j}=x,H=l(T*j),W=l(U*O),Y=l(N*j),J=l(L*O);return H===W&&Y===J}is0(){return this.equals(y.ZERO)}negate(){return new y(l(-this.ex),this.ey,this.ez,l(-this.et))}double(){let{a:x}=e,{ex:T,ey:N,ez:O}=this,U=l(T*T),L=l(N*N),j=l(go*l(O*O)),H=l(x*U),W=T+N,Y=l(l(W*W)-U-L),J=H+L,ue=J-j,ce=H-L,ee=l(Y*ue),be=l(J*ce),Ue=l(Y*ce),ni=l(ue*J);return new y(ee,be,ni,Ue)}add(x){m(x);let{a:T,d:N}=e,{ex:O,ey:U,ez:L,et:j}=this,{ex:H,ey:W,ez:Y,et:J}=x;if(T===BigInt(-1)){let wd=l((U-O)*(W+H)),vd=l((U+O)*(W-H)),tc=l(vd-wd);if(tc===qt)return this.double();let bd=l(L*go*J),Ed=l(j*go*Y),xd=Ed+bd,_d=vd+wd,Sd=Ed-bd,Dv=l(xd*tc),Tv=l(_d*Sd),Cv=l(xd*Sd),Ov=l(tc*_d);return new y(Dv,Tv,Ov,Cv)}let ue=l(O*H),ce=l(U*W),ee=l(j*N*J),be=l(L*Y),Ue=l((O+U)*(H+W)-ue-ce),ni=be-ee,Us=be+ee,Oi=l(ce-T*ue),ec=l(Ue*ni),Sv=l(Us*Oi),Iv=l(Ue*Oi),Av=l(ni*Us);return new y(ec,Sv,Av,Iv)}subtract(x){return this.add(x.negate())}wNAF(x){return C.wNAFCached(this,x,y.normalizeZ)}multiply(x){let T=x;Pn("scalar",T,pt,i);let{p:N,f:O}=this.wNAF(T);return y.normalizeZ([N,O])[0]}multiplyUnsafe(x,T=y.ZERO){let N=x;return Pn("scalar",N,qt,i),N===qt?E:this.is0()||N===pt?this:C.wNAFCachedUnsafe(this,N,y.normalizeZ,T)}isSmallOrder(){return this.multiplyUnsafe(c).is0()}isTorsionFree(){return C.unsafeLadder(this,i).is0()}toAffine(x){return w(this,x)}clearCofactor(){let{h:x}=e;return x===pt?this:this.multiplyUnsafe(x)}static fromHex(x,T=!1){let{d:N,a:O}=e,U=t.BYTES;x=pr("pointHex",x,U),Dc("zip215",T);let L=x.slice(),j=x[U-1];L[U-1]=j&-129;let H=mo(L),W=T?u:t.ORDER;Pn("pointHex.y",H,qt,W);let Y=l(H*H),J=l(Y-pt),ue=l(N*Y-O),{isValid:ce,value:ee}=d(J,ue);if(!ce)throw new Error("Point.fromHex: invalid y coordinate");let be=(ee&pt)===pt,Ue=(j&128)!==0;if(!T&&ee===qt&&Ue)throw new Error("Point.fromHex: x=0 and x_0=1");return Ue!==be&&(ee=l(-ee)),y.fromAffine({x:ee,y:H})}static fromPrivateKey(x){return b(x).point}toRawBytes(){let{x,y:T}=this.toAffine(),N=Lc(T,t.BYTES);return N[N.length-1]|=x&pt?128:0,N}toHex(){return Xc(this.toRawBytes())}}y.BASE=new y(e.Gx,e.Gy,pt,l(e.Gx*e.Gy)),y.ZERO=new y(qt,pt,pt,qt);let{BASE:S,ZERO:E}=y,C=aE(y,a*8);function R(I){return Ce(I,i)}function P(I){return R(mo(I))}function b(I){let x=t.BYTES;I=pr("private key",I,x);let T=pr("hashed private key",s(I),2*x),N=p(T.slice(0,x)),O=T.slice(x,2*x),U=P(N),L=S.multiply(U),j=L.toRawBytes();return{head:N,prefix:O,scalar:U,point:L,pointBytes:j}}function A(I){return b(I).pointBytes}function _(I=new Uint8Array,...x){let T=Yf(...x);return P(s(f(T,pr("context",I),!!n)))}function D(I,x,T={}){I=pr("message",I),n&&(I=n(I));let{prefix:N,scalar:O,pointBytes:U}=b(x),L=_(T.context,N,I),j=S.multiply(L).toRawBytes(),H=_(T.context,j,U,I),W=R(L+H*O);Pn("signature.s",W,qt,i);let Y=Yf(j,Lc(W,t.BYTES));return pr("result",Y,t.BYTES*2)}let F=hE;function k(I,x,T,N=F){let{context:O,zip215:U}=N,L=t.BYTES;I=pr("signature",I,2*L),x=pr("message",x),T=pr("publicKey",T,L),U!==void 0&&Dc("zip215",U),n&&(x=n(x));let j=mo(I.slice(L,2*L)),H,W,Y;try{H=y.fromHex(T,U),W=y.fromHex(I.slice(0,L),U),Y=S.multiplyUnsafe(j)}catch{return!1}if(!U&&H.isSmallOrder())return!1;let J=_(O,W.toRawBytes(),H.toRawBytes(),x);return W.add(H.multiplyUnsafe(J)).subtract(Y).clearCofactor().equals(y.ZERO)}return S._setWindowSize(8),{CURVE:e,getPublicKey:A,sign:D,verify:k,ExtendedPoint:y,utils:{getExtendedPublicKey:b,randomPrivateKey:()=>o(t.BYTES),precompute(I=8,x=y.BASE){return x._setWindowSize(I),x.multiply(BigInt(3)),x}}}}BigInt(0),BigInt(1);var Zc=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949"),tp=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");BigInt(0);var pE=BigInt(1),rp=BigInt(2);BigInt(3);var gE=BigInt(5),mE=BigInt(8);function yE(r){let e=BigInt(10),t=BigInt(20),i=BigInt(40),n=BigInt(80),s=Zc,o=r*r%s*r%s,a=er(o,rp,s)*o%s,c=er(a,pE,s)*r%s,u=er(c,gE,s)*c%s,l=er(u,e,s)*u%s,h=er(l,t,s)*l%s,d=er(h,i,s)*h%s,p=er(d,n,s)*d%s,f=er(p,n,s)*d%s,g=er(f,e,s)*u%s;return{pow_p_5_8:er(g,rp,s)*r%s,b2:o}}function wE(r){return r[0]&=248,r[31]&=127,r[31]|=64,r}function vE(r,e){let t=Zc,i=Ce(e*e*e,t),n=Ce(i*i*e,t),s=yE(r*n).pow_p_5_8,o=Ce(r*i*s,t),a=Ce(e*o*o,t),c=o,u=Ce(o*tp,t),l=a===r,h=a===Ce(-r,t),d=a===Ce(-r*tp,t);return l&&(o=c),(h||d)&&(o=u),eE(o,t)&&(o=Ce(-o,t)),{isValid:l||h,value:o}}var bE=Ep(Zc,void 0,!0),EE={a:BigInt(-1),d:BigInt("37095705934669439343138083508754565189542113879843219016388785533085940283555"),Fp:bE,n:BigInt("7237005577332262213973186563042994240857116359379907606001950938285454250989"),h:mE,Gx:BigInt("15112221349535400772501151409588531511454012693041857206046113283949847762202"),Gy:BigInt("46316835694926478169428394003475163141307993866256225615783033603165251855960"),hash:j1,randomBytes:pp,adjustScalarBytes:wE,uvRatio:vE},Sp=fE(EE),xE="EdDSA",_E="JWT",yo=".",vo="base64url",Ip="utf8",Ap="utf8",SE=":",IE="did",AE="key",ip="base58btc",DE="z",TE="K36";var CE=32;function eu(r){return globalThis.Buffer!=null?new Uint8Array(r.buffer,r.byteOffset,r.byteLength):r}function Dp(r=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?eu(globalThis.Buffer.allocUnsafe(r)):new Uint8Array(r)}function Tp(r,e){e||(e=r.reduce((n,s)=>n+s.length,0));let t=Dp(e),i=0;for(let n of r)t.set(n,i),i+=n.length;return eu(t)}function OE(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),i=0;i<t.length;i++)t[i]=255;for(var n=0;n<r.length;n++){var s=r.charAt(n),o=s.charCodeAt(0);if(t[o]!==255)throw new TypeError(s+" is ambiguous");t[o]=n}var a=r.length,c=r.charAt(0),u=Math.log(a)/Math.log(256),l=Math.log(256)/Math.log(a);function h(f){if(f instanceof Uint8Array||(ArrayBuffer.isView(f)?f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength):Array.isArray(f)&&(f=Uint8Array.from(f))),!(f instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(f.length===0)return"";for(var g=0,m=0,w=0,v=f.length;w!==v&&f[w]===0;)w++,g++;for(var y=(v-w)*l+1>>>0,S=new Uint8Array(y);w!==v;){for(var E=f[w],C=0,R=y-1;(E!==0||C<m)&&R!==-1;R--,C++)E+=256*S[R]>>>0,S[R]=E%a>>>0,E=E/a>>>0;if(E!==0)throw new Error("Non-zero carry");m=C,w++}for(var P=y-m;P!==y&&S[P]===0;)P++;for(var b=c.repeat(g);P<y;++P)b+=r.charAt(S[P]);return b}function d(f){if(typeof f!="string")throw new TypeError("Expected String");if(f.length===0)return new Uint8Array;var g=0;if(f[g]!==" "){for(var m=0,w=0;f[g]===c;)m++,g++;for(var v=(f.length-g)*u+1>>>0,y=new Uint8Array(v);f[g];){var S=t[f.charCodeAt(g)];if(S===255)return;for(var E=0,C=v-1;(S!==0||E<w)&&C!==-1;C--,E++)S+=a*y[C]>>>0,y[C]=S%256>>>0,S=S/256>>>0;if(S!==0)throw new Error("Non-zero carry");w=E,g++}if(f[g]!==" "){for(var R=v-w;R!==v&&y[R]===0;)R++;for(var P=new Uint8Array(m+(v-R)),b=m;R!==v;)P[b++]=y[R++];return P}}}function p(f){var g=d(f);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:d,decode:p}}var RE=OE,NE=RE,Cp=r=>{if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")},PE=r=>new TextEncoder().encode(r),FE=r=>new TextDecoder().decode(r),qc=class{constructor(e,t,i){this.name=e,this.prefix=t,this.baseEncode=i}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},zc=class{constructor(e,t,i){if(this.name=e,this.prefix=t,t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=i}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return Op(this,e)}},jc=class{constructor(e){this.decoders=e}or(e){return Op(this,e)}decode(e){let t=e[0],i=this.decoders[t];if(i)return i.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}},Op=(r,e)=>new jc({...r.decoders||{[r.prefix]:r},...e.decoders||{[e.prefix]:e}}),Vc=class{constructor(e,t,i,n){this.name=e,this.prefix=t,this.baseEncode=i,this.baseDecode=n,this.encoder=new qc(e,t,i),this.decoder=new zc(e,t,n)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}},bo=({name:r,prefix:e,encode:t,decode:i})=>new Vc(r,e,t,i),Fn=({prefix:r,name:e,alphabet:t})=>{let{encode:i,decode:n}=NE(t,e);return bo({prefix:r,name:e,encode:i,decode:s=>Cp(n(s))})},BE=(r,e,t,i)=>{let n={};for(let l=0;l<e.length;++l)n[e[l]]=l;let s=r.length;for(;r[s-1]==="=";)--s;let o=new Uint8Array(s*t/8|0),a=0,c=0,u=0;for(let l=0;l<s;++l){let h=n[r[l]];if(h===void 0)throw new SyntaxError(`Non-${i} character`);c=c<<t|h,a+=t,a>=8&&(a-=8,o[u++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},UE=(r,e,t)=>{let i=e[e.length-1]==="=",n=(1<<t)-1,s="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,s+=e[n&a>>o];if(o&&(s+=e[n&a<<t-o]),i)for(;s.length*t&7;)s+="=";return s},Me=({name:r,prefix:e,bitsPerChar:t,alphabet:i})=>bo({prefix:e,name:r,encode(n){return UE(n,i,t)},decode(n){return BE(n,i,t,r)}}),kE=bo({prefix:"\0",name:"identity",encode:r=>FE(r),decode:r=>PE(r)}),LE=Object.freeze({__proto__:null,identity:kE}),ME=Me({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),qE=Object.freeze({__proto__:null,base2:ME}),zE=Me({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),jE=Object.freeze({__proto__:null,base8:zE}),VE=Fn({prefix:"9",name:"base10",alphabet:"0123456789"}),$E=Object.freeze({__proto__:null,base10:VE}),KE=Me({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),HE=Me({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),WE=Object.freeze({__proto__:null,base16:KE,base16upper:HE}),GE=Me({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),YE=Me({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),JE=Me({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),XE=Me({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),QE=Me({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),ZE=Me({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),ex=Me({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),tx=Me({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),rx=Me({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),ix=Object.freeze({__proto__:null,base32:GE,base32upper:YE,base32pad:JE,base32padupper:XE,base32hex:QE,base32hexupper:ZE,base32hexpad:ex,base32hexpadupper:tx,base32z:rx}),nx=Fn({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),sx=Fn({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),ox=Object.freeze({__proto__:null,base36:nx,base36upper:sx}),ax=Fn({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),cx=Fn({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),ux=Object.freeze({__proto__:null,base58btc:ax,base58flickr:cx}),lx=Me({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),hx=Me({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),dx=Me({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),fx=Me({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),px=Object.freeze({__proto__:null,base64:lx,base64pad:hx,base64url:dx,base64urlpad:fx}),Rp=Array.from("\u{1F680}\u{1FA90}\u2604\u{1F6F0}\u{1F30C}\u{1F311}\u{1F312}\u{1F313}\u{1F314}\u{1F315}\u{1F316}\u{1F317}\u{1F318}\u{1F30D}\u{1F30F}\u{1F30E}\u{1F409}\u2600\u{1F4BB}\u{1F5A5}\u{1F4BE}\u{1F4BF}\u{1F602}\u2764\u{1F60D}\u{1F923}\u{1F60A}\u{1F64F}\u{1F495}\u{1F62D}\u{1F618}\u{1F44D}\u{1F605}\u{1F44F}\u{1F601}\u{1F525}\u{1F970}\u{1F494}\u{1F496}\u{1F499}\u{1F622}\u{1F914}\u{1F606}\u{1F644}\u{1F4AA}\u{1F609}\u263A\u{1F44C}\u{1F917}\u{1F49C}\u{1F614}\u{1F60E}\u{1F607}\u{1F339}\u{1F926}\u{1F389}\u{1F49E}\u270C\u2728\u{1F937}\u{1F631}\u{1F60C}\u{1F338}\u{1F64C}\u{1F60B}\u{1F497}\u{1F49A}\u{1F60F}\u{1F49B}\u{1F642}\u{1F493}\u{1F929}\u{1F604}\u{1F600}\u{1F5A4}\u{1F603}\u{1F4AF}\u{1F648}\u{1F447}\u{1F3B6}\u{1F612}\u{1F92D}\u2763\u{1F61C}\u{1F48B}\u{1F440}\u{1F62A}\u{1F611}\u{1F4A5}\u{1F64B}\u{1F61E}\u{1F629}\u{1F621}\u{1F92A}\u{1F44A}\u{1F973}\u{1F625}\u{1F924}\u{1F449}\u{1F483}\u{1F633}\u270B\u{1F61A}\u{1F61D}\u{1F634}\u{1F31F}\u{1F62C}\u{1F643}\u{1F340}\u{1F337}\u{1F63B}\u{1F613}\u2B50\u2705\u{1F97A}\u{1F308}\u{1F608}\u{1F918}\u{1F4A6}\u2714\u{1F623}\u{1F3C3}\u{1F490}\u2639\u{1F38A}\u{1F498}\u{1F620}\u261D\u{1F615}\u{1F33A}\u{1F382}\u{1F33B}\u{1F610}\u{1F595}\u{1F49D}\u{1F64A}\u{1F639}\u{1F5E3}\u{1F4AB}\u{1F480}\u{1F451}\u{1F3B5}\u{1F91E}\u{1F61B}\u{1F534}\u{1F624}\u{1F33C}\u{1F62B}\u26BD\u{1F919}\u2615\u{1F3C6}\u{1F92B}\u{1F448}\u{1F62E}\u{1F646}\u{1F37B}\u{1F343}\u{1F436}\u{1F481}\u{1F632}\u{1F33F}\u{1F9E1}\u{1F381}\u26A1\u{1F31E}\u{1F388}\u274C\u270A\u{1F44B}\u{1F630}\u{1F928}\u{1F636}\u{1F91D}\u{1F6B6}\u{1F4B0}\u{1F353}\u{1F4A2}\u{1F91F}\u{1F641}\u{1F6A8}\u{1F4A8}\u{1F92C}\u2708\u{1F380}\u{1F37A}\u{1F913}\u{1F619}\u{1F49F}\u{1F331}\u{1F616}\u{1F476}\u{1F974}\u25B6\u27A1\u2753\u{1F48E}\u{1F4B8}\u2B07\u{1F628}\u{1F31A}\u{1F98B}\u{1F637}\u{1F57A}\u26A0\u{1F645}\u{1F61F}\u{1F635}\u{1F44E}\u{1F932}\u{1F920}\u{1F927}\u{1F4CC}\u{1F535}\u{1F485}\u{1F9D0}\u{1F43E}\u{1F352}\u{1F617}\u{1F911}\u{1F30A}\u{1F92F}\u{1F437}\u260E\u{1F4A7}\u{1F62F}\u{1F486}\u{1F446}\u{1F3A4}\u{1F647}\u{1F351}\u2744\u{1F334}\u{1F4A3}\u{1F438}\u{1F48C}\u{1F4CD}\u{1F940}\u{1F922}\u{1F445}\u{1F4A1}\u{1F4A9}\u{1F450}\u{1F4F8}\u{1F47B}\u{1F910}\u{1F92E}\u{1F3BC}\u{1F975}\u{1F6A9}\u{1F34E}\u{1F34A}\u{1F47C}\u{1F48D}\u{1F4E3}\u{1F942}"),gx=Rp.reduce((r,e,t)=>(r[t]=e,r),[]),mx=Rp.reduce((r,e,t)=>(r[e.codePointAt(0)]=t,r),[]);function yx(r){return r.reduce((e,t)=>(e+=gx[t],e),"")}function wx(r){let e=[];for(let t of r){let i=mx[t.codePointAt(0)];if(i===void 0)throw new Error(`Non-base256emoji character: ${t}`);e.push(i)}return new Uint8Array(e)}var vx=bo({prefix:"\u{1F680}",name:"base256emoji",encode:yx,decode:wx}),bx=Object.freeze({__proto__:null,base256emoji:vx}),Ex=Np,np=128,xx=127,_x=~xx,Sx=Math.pow(2,31);function Np(r,e,t){e=e||[],t=t||0;for(var i=t;r>=Sx;)e[t++]=r&255|np,r/=128;for(;r&_x;)e[t++]=r&255|np,r>>>=7;return e[t]=r|0,Np.bytes=t-i+1,e}var Ix=$c,Ax=128,sp=127;function $c(r,i){var t=0,i=i||0,n=0,s=i,o,a=r.length;do{if(s>=a)throw $c.bytes=0,new RangeError("Could not decode varint");o=r[s++],t+=n<28?(o&sp)<<n:(o&sp)*Math.pow(2,n),n+=7}while(o>=Ax);return $c.bytes=s-i,t}var Dx=Math.pow(2,7),Tx=Math.pow(2,14),Cx=Math.pow(2,21),Ox=Math.pow(2,28),Rx=Math.pow(2,35),Nx=Math.pow(2,42),Px=Math.pow(2,49),Fx=Math.pow(2,56),Bx=Math.pow(2,63),Ux=function(r){return r<Dx?1:r<Tx?2:r<Cx?3:r<Ox?4:r<Rx?5:r<Nx?6:r<Px?7:r<Fx?8:r<Bx?9:10},kx={encode:Ex,decode:Ix,encodingLength:Ux},Pp=kx,op=(r,e,t=0)=>(Pp.encode(r,e,t),e),ap=r=>Pp.encodingLength(r),Kc=(r,e)=>{let t=e.byteLength,i=ap(r),n=i+ap(t),s=new Uint8Array(n+t);return op(r,s,0),op(t,s,i),s.set(e,n),new Hc(r,t,e,s)},Hc=class{constructor(e,t,i,n){this.code=e,this.size=t,this.digest=i,this.bytes=n}},Fp=({name:r,code:e,encode:t})=>new Wc(r,e,t),Wc=class{constructor(e,t,i){this.name=e,this.code=t,this.encode=i}digest(e){if(e instanceof Uint8Array){let t=this.encode(e);return t instanceof Uint8Array?Kc(this.code,t):t.then(i=>Kc(this.code,i))}else throw Error("Unknown type, must be binary type")}},Bp=r=>async e=>new Uint8Array(await crypto.subtle.digest(r,e)),Lx=Fp({name:"sha2-256",code:18,encode:Bp("SHA-256")}),Mx=Fp({name:"sha2-512",code:19,encode:Bp("SHA-512")}),qx=Object.freeze({__proto__:null,sha256:Lx,sha512:Mx}),Up=0,zx="identity",kp=Cp,jx=r=>Kc(Up,kp(r)),Vx={code:Up,name:zx,encode:kp,digest:jx},$x=Object.freeze({__proto__:null,identity:Vx});new TextEncoder,new TextDecoder;var cp={...LE,...qE,...jE,...$E,...WE,...ix,...ox,...ux,...px,...bx};({...qx,...$x});function Lp(r,e,t,i){return{name:r,prefix:e,encoder:{name:r,prefix:e,encode:t},decoder:{decode:i}}}var up=Lp("utf8","u",r=>"u"+new TextDecoder("utf8").decode(r),r=>new TextEncoder().encode(r.substring(1))),Pc=Lp("ascii","a",r=>{let e="a";for(let t=0;t<r.length;t++)e+=String.fromCharCode(r[t]);return e},r=>{r=r.substring(1);let e=Dp(r.length);for(let t=0;t<r.length;t++)e[t]=r.charCodeAt(t);return e}),Mp={utf8:up,"utf-8":up,hex:cp.base16,latin1:Pc,ascii:Pc,binary:Pc,...cp};function Eo(r,e="utf8"){let t=Mp[e];if(!t)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(r.buffer,r.byteOffset,r.byteLength).toString("utf8"):t.encoder.encode(r).substring(1)}function Ki(r,e="utf8"){let t=Mp[e];if(!t)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?eu(globalThis.Buffer.from(r,"utf-8")):t.decoder.decode(`${t.prefix}${r}`)}function lp(r){return Zt(Eo(Ki(r,vo),Ip))}function wo(r){return Eo(Ki(Rt(r),Ip),vo)}function tu(r){let e=Ki(TE,ip),t=DE+Eo(Tp([e,r]),ip);return[IE,AE,t].join(SE)}function Kx(r){return Eo(r,vo)}function Hx(r){return Ki(r,vo)}function Wx(r){return Ki([wo(r.header),wo(r.payload)].join(yo),Ap)}function Gx(r){return[wo(r.header),wo(r.payload),Kx(r.signature)].join(yo)}function Bn(r){let e=r.split(yo),t=lp(e[0]),i=lp(e[1]),n=Hx(e[2]),s=Ki(e.slice(0,2).join(yo),Ap);return{header:t,payload:i,signature:n,data:s}}function ru(r=pp(CE)){let e=Sp.getPublicKey(r);return{secretKey:Tp([r,e]),publicKey:e}}async function qp(r,e,t,i,n=(0,hp.fromMiliseconds)(Date.now())){let s={alg:xE,typ:_E},o=tu(i.publicKey),a=n+t,c={iss:o,sub:r,aud:e,iat:n,exp:a},u=Wx({header:s,payload:c}),l=Sp.sign(u,i.secretKey.slice(0,32));return Gx({header:s,payload:c,signature:l})}function li(r){return globalThis.Buffer!=null?new Uint8Array(r.buffer,r.byteOffset,r.byteLength):r}function Un(r=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?li(globalThis.Buffer.allocUnsafe(r)):new Uint8Array(r)}function hi(r,e){e||(e=r.reduce((n,s)=>n+s.length,0));let t=Un(e),i=0;for(let n of r)t.set(n,i),i+=n.length;return li(t)}var au={};Ge(au,{identity:()=>t2});function Jx(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),i=0;i<t.length;i++)t[i]=255;for(var n=0;n<r.length;n++){var s=r.charAt(n),o=s.charCodeAt(0);if(t[o]!==255)throw new TypeError(s+" is ambiguous");t[o]=n}var a=r.length,c=r.charAt(0),u=Math.log(a)/Math.log(256),l=Math.log(256)/Math.log(a);function h(f){if(f instanceof Uint8Array||(ArrayBuffer.isView(f)?f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength):Array.isArray(f)&&(f=Uint8Array.from(f))),!(f instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(f.length===0)return"";for(var g=0,m=0,w=0,v=f.length;w!==v&&f[w]===0;)w++,g++;for(var y=(v-w)*l+1>>>0,S=new Uint8Array(y);w!==v;){for(var E=f[w],C=0,R=y-1;(E!==0||C<m)&&R!==-1;R--,C++)E+=256*S[R]>>>0,S[R]=E%a>>>0,E=E/a>>>0;if(E!==0)throw new Error("Non-zero carry");m=C,w++}for(var P=y-m;P!==y&&S[P]===0;)P++;for(var b=c.repeat(g);P<y;++P)b+=r.charAt(S[P]);return b}function d(f){if(typeof f!="string")throw new TypeError("Expected String");if(f.length===0)return new Uint8Array;var g=0;if(f[g]!==" "){for(var m=0,w=0;f[g]===c;)m++,g++;for(var v=(f.length-g)*u+1>>>0,y=new Uint8Array(v);f[g];){var S=t[f.charCodeAt(g)];if(S===255)return;for(var E=0,C=v-1;(S!==0||E<w)&&C!==-1;C--,E++)S+=a*y[C]>>>0,y[C]=S%256>>>0,S=S/256>>>0;if(S!==0)throw new Error("Non-zero carry");w=E,g++}if(f[g]!==" "){for(var R=v-w;R!==v&&y[R]===0;)R++;for(var P=new Uint8Array(m+(v-R)),b=m;R!==v;)P[b++]=y[R++];return P}}}function p(f){var g=d(f);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:d,decode:p}}var Xx=Jx,Qx=Xx,zp=Qx;var _6=new Uint8Array(0);var jp=(r,e)=>{if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0},gr=r=>{if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")};var Vp=r=>new TextEncoder().encode(r),$p=r=>new TextDecoder().decode(r);var iu=class{constructor(e,t,i){this.name=e,this.prefix=t,this.baseEncode=i}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},nu=class{constructor(e,t,i){if(this.name=e,this.prefix=t,t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=i}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return Hp(this,e)}},su=class{constructor(e){this.decoders=e}or(e){return Hp(this,e)}decode(e){let t=e[0],i=this.decoders[t];if(i)return i.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}},Hp=(r,e)=>new su({...r.decoders||{[r.prefix]:r},...e.decoders||{[e.prefix]:e}}),ou=class{constructor(e,t,i,n){this.name=e,this.prefix=t,this.baseEncode=i,this.baseDecode=n,this.encoder=new iu(e,t,i),this.decoder=new nu(e,t,n)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}},Hi=({name:r,prefix:e,encode:t,decode:i})=>new ou(r,e,t,i),Nr=({prefix:r,name:e,alphabet:t})=>{let{encode:i,decode:n}=zp(t,e);return Hi({prefix:r,name:e,encode:i,decode:s=>gr(n(s))})},Zx=(r,e,t,i)=>{let n={};for(let l=0;l<e.length;++l)n[e[l]]=l;let s=r.length;for(;r[s-1]==="=";)--s;let o=new Uint8Array(s*t/8|0),a=0,c=0,u=0;for(let l=0;l<s;++l){let h=n[r[l]];if(h===void 0)throw new SyntaxError(`Non-${i} character`);c=c<<t|h,a+=t,a>=8&&(a-=8,o[u++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},e2=(r,e,t)=>{let i=e[e.length-1]==="=",n=(1<<t)-1,s="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,s+=e[n&a>>o];if(o&&(s+=e[n&a<<t-o]),i)for(;s.length*t&7;)s+="=";return s},ye=({name:r,prefix:e,bitsPerChar:t,alphabet:i})=>Hi({prefix:e,name:r,encode(n){return e2(n,i,t)},decode(n){return Zx(n,i,t,r)}});var t2=Hi({prefix:"\0",name:"identity",encode:r=>$p(r),decode:r=>Vp(r)});var cu={};Ge(cu,{base2:()=>r2});var r2=ye({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var uu={};Ge(uu,{base8:()=>i2});var i2=ye({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var lu={};Ge(lu,{base10:()=>n2});var n2=Nr({prefix:"9",name:"base10",alphabet:"0123456789"});var hu={};Ge(hu,{base16:()=>s2,base16upper:()=>o2});var s2=ye({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),o2=ye({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var du={};Ge(du,{base32:()=>Wi,base32hex:()=>l2,base32hexpad:()=>d2,base32hexpadupper:()=>f2,base32hexupper:()=>h2,base32pad:()=>c2,base32padupper:()=>u2,base32upper:()=>a2,base32z:()=>p2});var Wi=ye({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),a2=ye({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),c2=ye({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),u2=ye({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),l2=ye({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),h2=ye({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),d2=ye({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),f2=ye({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),p2=ye({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var fu={};Ge(fu,{base36:()=>g2,base36upper:()=>m2});var g2=Nr({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),m2=Nr({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var pu={};Ge(pu,{base58btc:()=>tr,base58flickr:()=>y2});var tr=Nr({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),y2=Nr({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var gu={};Ge(gu,{base64:()=>w2,base64pad:()=>v2,base64url:()=>b2,base64urlpad:()=>E2});var w2=ye({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),v2=ye({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),b2=ye({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),E2=ye({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var mu={};Ge(mu,{base256emoji:()=>A2});var Wp=Array.from("\u{1F680}\u{1FA90}\u2604\u{1F6F0}\u{1F30C}\u{1F311}\u{1F312}\u{1F313}\u{1F314}\u{1F315}\u{1F316}\u{1F317}\u{1F318}\u{1F30D}\u{1F30F}\u{1F30E}\u{1F409}\u2600\u{1F4BB}\u{1F5A5}\u{1F4BE}\u{1F4BF}\u{1F602}\u2764\u{1F60D}\u{1F923}\u{1F60A}\u{1F64F}\u{1F495}\u{1F62D}\u{1F618}\u{1F44D}\u{1F605}\u{1F44F}\u{1F601}\u{1F525}\u{1F970}\u{1F494}\u{1F496}\u{1F499}\u{1F622}\u{1F914}\u{1F606}\u{1F644}\u{1F4AA}\u{1F609}\u263A\u{1F44C}\u{1F917}\u{1F49C}\u{1F614}\u{1F60E}\u{1F607}\u{1F339}\u{1F926}\u{1F389}\u{1F49E}\u270C\u2728\u{1F937}\u{1F631}\u{1F60C}\u{1F338}\u{1F64C}\u{1F60B}\u{1F497}\u{1F49A}\u{1F60F}\u{1F49B}\u{1F642}\u{1F493}\u{1F929}\u{1F604}\u{1F600}\u{1F5A4}\u{1F603}\u{1F4AF}\u{1F648}\u{1F447}\u{1F3B6}\u{1F612}\u{1F92D}\u2763\u{1F61C}\u{1F48B}\u{1F440}\u{1F62A}\u{1F611}\u{1F4A5}\u{1F64B}\u{1F61E}\u{1F629}\u{1F621}\u{1F92A}\u{1F44A}\u{1F973}\u{1F625}\u{1F924}\u{1F449}\u{1F483}\u{1F633}\u270B\u{1F61A}\u{1F61D}\u{1F634}\u{1F31F}\u{1F62C}\u{1F643}\u{1F340}\u{1F337}\u{1F63B}\u{1F613}\u2B50\u2705\u{1F97A}\u{1F308}\u{1F608}\u{1F918}\u{1F4A6}\u2714\u{1F623}\u{1F3C3}\u{1F490}\u2639\u{1F38A}\u{1F498}\u{1F620}\u261D\u{1F615}\u{1F33A}\u{1F382}\u{1F33B}\u{1F610}\u{1F595}\u{1F49D}\u{1F64A}\u{1F639}\u{1F5E3}\u{1F4AB}\u{1F480}\u{1F451}\u{1F3B5}\u{1F91E}\u{1F61B}\u{1F534}\u{1F624}\u{1F33C}\u{1F62B}\u26BD\u{1F919}\u2615\u{1F3C6}\u{1F92B}\u{1F448}\u{1F62E}\u{1F646}\u{1F37B}\u{1F343}\u{1F436}\u{1F481}\u{1F632}\u{1F33F}\u{1F9E1}\u{1F381}\u26A1\u{1F31E}\u{1F388}\u274C\u270A\u{1F44B}\u{1F630}\u{1F928}\u{1F636}\u{1F91D}\u{1F6B6}\u{1F4B0}\u{1F353}\u{1F4A2}\u{1F91F}\u{1F641}\u{1F6A8}\u{1F4A8}\u{1F92C}\u2708\u{1F380}\u{1F37A}\u{1F913}\u{1F619}\u{1F49F}\u{1F331}\u{1F616}\u{1F476}\u{1F974}\u25B6\u27A1\u2753\u{1F48E}\u{1F4B8}\u2B07\u{1F628}\u{1F31A}\u{1F98B}\u{1F637}\u{1F57A}\u26A0\u{1F645}\u{1F61F}\u{1F635}\u{1F44E}\u{1F932}\u{1F920}\u{1F927}\u{1F4CC}\u{1F535}\u{1F485}\u{1F9D0}\u{1F43E}\u{1F352}\u{1F617}\u{1F911}\u{1F30A}\u{1F92F}\u{1F437}\u260E\u{1F4A7}\u{1F62F}\u{1F486}\u{1F446}\u{1F3A4}\u{1F647}\u{1F351}\u2744\u{1F334}\u{1F4A3}\u{1F438}\u{1F48C}\u{1F4CD}\u{1F940}\u{1F922}\u{1F445}\u{1F4A1}\u{1F4A9}\u{1F450}\u{1F4F8}\u{1F47B}\u{1F910}\u{1F92E}\u{1F3BC}\u{1F975}\u{1F6A9}\u{1F34E}\u{1F34A}\u{1F47C}\u{1F48D}\u{1F4E3}\u{1F942}"),x2=Wp.reduce((r,e,t)=>(r[t]=e,r),[]),_2=Wp.reduce((r,e,t)=>(r[e.codePointAt(0)]=t,r),[]);function S2(r){return r.reduce((e,t)=>(e+=x2[t],e),"")}function I2(r){let e=[];for(let t of r){let i=_2[t.codePointAt(0)];if(i===void 0)throw new Error(`Non-base256emoji character: ${t}`);e.push(i)}return new Uint8Array(e)}var A2=Hi({prefix:"\u{1F680}",name:"base256emoji",encode:S2,decode:I2});var bu={};Ge(bu,{sha256:()=>K2,sha512:()=>H2});var D2=Jp,Gp=128,T2=127,C2=~T2,O2=Math.pow(2,31);function Jp(r,e,t){e=e||[],t=t||0;for(var i=t;r>=O2;)e[t++]=r&255|Gp,r/=128;for(;r&C2;)e[t++]=r&255|Gp,r>>>=7;return e[t]=r|0,Jp.bytes=t-i+1,e}var R2=yu,N2=128,Yp=127;function yu(r,i){var t=0,i=i||0,n=0,s=i,o,a=r.length;do{if(s>=a)throw yu.bytes=0,new RangeError("Could not decode varint");o=r[s++],t+=n<28?(o&Yp)<<n:(o&Yp)*Math.pow(2,n),n+=7}while(o>=N2);return yu.bytes=s-i,t}var P2=Math.pow(2,7),F2=Math.pow(2,14),B2=Math.pow(2,21),U2=Math.pow(2,28),k2=Math.pow(2,35),L2=Math.pow(2,42),M2=Math.pow(2,49),q2=Math.pow(2,56),z2=Math.pow(2,63),j2=function(r){return r<P2?1:r<F2?2:r<B2?3:r<U2?4:r<k2?5:r<L2?6:r<M2?7:r<q2?8:r<z2?9:10},V2={encode:D2,decode:R2,encodingLength:j2},$2=V2,kn=$2;var Ln=(r,e=0)=>[kn.decode(r,e),kn.decode.bytes],Gi=(r,e,t=0)=>(kn.encode(r,e,t),e),Yi=r=>kn.encodingLength(r);var di=(r,e)=>{let t=e.byteLength,i=Yi(r),n=i+Yi(t),s=new Uint8Array(n+t);return Gi(r,s,0),Gi(t,s,i),s.set(e,n),new Ji(r,t,e,s)},Xp=r=>{let e=gr(r),[t,i]=Ln(e),[n,s]=Ln(e.subarray(i)),o=e.subarray(i+s);if(o.byteLength!==n)throw new Error("Incorrect length");return new Ji(t,n,o,e)},Qp=(r,e)=>r===e?!0:r.code===e.code&&r.size===e.size&&jp(r.bytes,e.bytes),Ji=class{constructor(e,t,i,n){this.code=e,this.size=t,this.digest=i,this.bytes=n}};var vu=({name:r,code:e,encode:t})=>new wu(r,e,t),wu=class{constructor(e,t,i){this.name=e,this.code=t,this.encode=i}digest(e){if(e instanceof Uint8Array){let t=this.encode(e);return t instanceof Uint8Array?di(this.code,t):t.then(i=>di(this.code,i))}else throw Error("Unknown type, must be binary type")}};var eg=r=>async e=>new Uint8Array(await crypto.subtle.digest(r,e)),K2=vu({name:"sha2-256",code:18,encode:eg("SHA-256")}),H2=vu({name:"sha2-512",code:19,encode:eg("SHA-512")});var Eu={};Ge(Eu,{identity:()=>Y2});var tg=0,W2="identity",rg=gr,G2=r=>di(tg,rg(r)),Y2={code:tg,name:W2,encode:rg,digest:G2};var $6=new TextEncoder,K6=new TextDecoder;var Io=class r{constructor(e,t,i,n){this.code=t,this.version=e,this.multihash=i,this.bytes=n,this.byteOffset=n.byteOffset,this.byteLength=n.byteLength,this.asCID=this,this._baseCache=new Map,Object.defineProperties(this,{byteOffset:So,byteLength:So,code:_o,version:_o,multihash:_o,bytes:_o,_baseCache:So,asCID:So})}toV0(){switch(this.version){case 0:return this;default:{let{code:e,multihash:t}=this;if(e!==qn)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==t_)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return r.createV0(t)}}}toV1(){switch(this.version){case 0:{let{code:e,digest:t}=this.multihash,i=di(e,t);return r.createV1(this.code,i)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}equals(e){return e&&this.code===e.code&&this.version===e.version&&Qp(this.multihash,e.multihash)}toString(e){let{bytes:t,version:i,_baseCache:n}=this;switch(i){case 0:return Z2(t,n,e||tr.encoder);default:return e_(t,n,e||Wi.encoder)}}toJSON(){return{code:this.code,version:this.version,hash:this.multihash.bytes}}get[Symbol.toStringTag](){return"CID"}[Symbol.for("nodejs.util.inspect.custom")](){return"CID("+this.toString()+")"}static isCID(e){return i_(/^0\.0/,n_),!!(e&&(e[ng]||e.asCID===e))}get toBaseEncodedString(){throw new Error("Deprecated, use .toString()")}get codec(){throw new Error('"codec" property is deprecated, use integer "code" property instead')}get buffer(){throw new Error("Deprecated .buffer property, use .bytes to get Uint8Array instead")}get multibaseName(){throw new Error('"multibaseName" property is deprecated')}get prefix(){throw new Error('"prefix" property is deprecated')}static asCID(e){if(e instanceof r)return e;if(e!=null&&e.asCID===e){let{version:t,code:i,multihash:n,bytes:s}=e;return new r(t,i,n,s||ig(t,i,n.bytes))}else if(e!=null&&e[ng]===!0){let{version:t,multihash:i,code:n}=e,s=Xp(i);return r.create(t,n,s)}else return null}static create(e,t,i){if(typeof t!="number")throw new Error("String codecs are no longer supported");switch(e){case 0:{if(t!==qn)throw new Error(`Version 0 CID must use dag-pb (code: ${qn}) block encoding`);return new r(e,t,i,i.bytes)}case 1:{let n=ig(e,t,i.bytes);return new r(e,t,i,n)}default:throw new Error("Invalid version")}}static createV0(e){return r.create(0,qn,e)}static createV1(e,t){return r.create(1,e,t)}static decode(e){let[t,i]=r.decodeFirst(e);if(i.length)throw new Error("Incorrect length");return t}static decodeFirst(e){let t=r.inspectBytes(e),i=t.size-t.multihashSize,n=gr(e.subarray(i,i+t.multihashSize));if(n.byteLength!==t.multihashSize)throw new Error("Incorrect length");let s=n.subarray(t.multihashSize-t.digestSize),o=new Ji(t.multihashCode,t.digestSize,s,n);return[t.version===0?r.createV0(o):r.createV1(t.codec,o),e.subarray(t.size)]}static inspectBytes(e){let t=0,i=()=>{let[h,d]=Ln(e.subarray(t));return t+=d,h},n=i(),s=qn;if(n===18?(n=0,t=0):n===1&&(s=i()),n!==0&&n!==1)throw new RangeError(`Invalid CID version ${n}`);let o=t,a=i(),c=i(),u=t+c,l=u-o;return{version:n,codec:s,multihashCode:a,digestSize:c,multihashSize:l,size:u}}static parse(e,t){let[i,n]=Q2(e,t),s=r.decode(n);return s._baseCache.set(i,e),s}},Q2=(r,e)=>{switch(r[0]){case"Q":{let t=e||tr;return[tr.prefix,t.decode(`${tr.prefix}${r}`)]}case tr.prefix:{let t=e||tr;return[tr.prefix,t.decode(r)]}case Wi.prefix:{let t=e||Wi;return[Wi.prefix,t.decode(r)]}default:{if(e==null)throw Error("To parse non base32 or base58btc encoded CID multibase decoder must be provided");return[r[0],e.decode(r)]}}},Z2=(r,e,t)=>{let{prefix:i}=t;if(i!==tr.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);let n=e.get(i);if(n==null){let s=t.encode(r).slice(1);return e.set(i,s),s}else return n},e_=(r,e,t)=>{let{prefix:i}=t,n=e.get(i);if(n==null){let s=t.encode(r);return e.set(i,s),s}else return n},qn=112,t_=18,ig=(r,e,t)=>{let i=Yi(r),n=i+Yi(e),s=new Uint8Array(n+t.byteLength);return Gi(r,s,0),Gi(e,s,i),s.set(t,n),s},ng=Symbol.for("@ipld/js-cid/CID"),_o={writable:!1,configurable:!1,enumerable:!0},So={writable:!1,enumerable:!1,configurable:!1},r_="0.0.0-dev",i_=(r,e)=>{if(!r.test(r_))throw new Error(e)},n_=`CID.isCID(v) is deprecated and will be removed in the next major release.
Following code pattern:

if (CID.isCID(value)) {
  doSomethingWithCID(value)
}

Is replaced with:

const cid = CID.asCID(value)
if (cid) {
  // Make sure to use cid instead of value
  doSomethingWithCID(cid)
}
`;var xu={...au,...cu,...uu,...lu,...hu,...du,...fu,...pu,...gu,...mu},Z6={...bu,...Eu};function og(r,e,t,i){return{name:r,prefix:e,encoder:{name:r,prefix:e,encode:t},decoder:{decode:i}}}var sg=og("utf8","u",r=>"u"+new TextDecoder("utf8").decode(r),r=>new TextEncoder().encode(r.substring(1))),_u=og("ascii","a",r=>{let e="a";for(let t=0;t<r.length;t++)e+=String.fromCharCode(r[t]);return e},r=>{r=r.substring(1);let e=Un(r.length);for(let t=0;t<r.length;t++)e[t]=r.charCodeAt(t);return e}),s_={utf8:sg,"utf-8":sg,hex:xu.base16,latin1:_u,ascii:_u,binary:_u,...xu},Ao=s_;function gt(r,e="utf8"){let t=Ao[e];if(!t)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?li(globalThis.Buffer.from(r,"utf-8")):t.decoder.decode(`${t.prefix}${r}`)}function qe(r,e="utf8"){let t=Ao[e];if(!t)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(r.buffer,r.byteOffset,r.byteLength).toString("utf8"):t.encoder.encode(r).substring(1)}var ag={waku:{publish:"waku_publish",batchPublish:"waku_batchPublish",subscribe:"waku_subscribe",batchSubscribe:"waku_batchSubscribe",subscription:"waku_subscription",unsubscribe:"waku_unsubscribe",batchUnsubscribe:"waku_batchUnsubscribe",batchFetchMessages:"waku_batchFetchMessages"},irn:{publish:"irn_publish",batchPublish:"irn_batchPublish",subscribe:"irn_subscribe",batchSubscribe:"irn_batchSubscribe",subscription:"irn_subscription",unsubscribe:"irn_unsubscribe",batchUnsubscribe:"irn_batchUnsubscribe",batchFetchMessages:"irn_batchFetchMessages"},iridium:{publish:"iridium_publish",batchPublish:"iridium_batchPublish",subscribe:"iridium_subscribe",batchSubscribe:"iridium_batchSubscribe",subscription:"iridium_subscription",unsubscribe:"iridium_unsubscribe",batchUnsubscribe:"iridium_batchUnsubscribe",batchFetchMessages:"iridium_batchFetchMessages"}};var am=Se(Dg()),cm=":";function rs(r){let[e,t]=r.split(cm);return{namespace:e,reference:t}}function jo(r){let[e,t,i]=r.split(cm);return{namespace:e,reference:t,address:i}}function Vo(r,e=[]){let t=[];return Object.keys(r).forEach(i=>{if(e.length&&!e.includes(i))return;let n=r[i];t.push(...n.accounts)}),t}function um(r,e){return r.includes(":")?[r]:e.chains||[]}var g_=Object.defineProperty,m_=Object.defineProperties,y_=Object.getOwnPropertyDescriptors,Tg=Object.getOwnPropertySymbols,w_=Object.prototype.hasOwnProperty,v_=Object.prototype.propertyIsEnumerable,Uu=(r,e,t)=>e in r?g_(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Cg=(r,e)=>{for(var t in e||(e={}))w_.call(e,t)&&Uu(r,t,e[t]);if(Tg)for(var t of Tg(e))v_.call(e,t)&&Uu(r,t,e[t]);return r},b_=(r,e)=>m_(r,y_(e)),Og=(r,e,t)=>Uu(r,typeof e!="symbol"?e+"":e,t),E_="ReactNative",wt={reactNative:"react-native",node:"node",browser:"browser",unknown:"unknown"};var x_="js";function is(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}function Er(){return!(0,$t.getDocument)()&&!!(0,$t.getNavigator)()&&navigator.product===E_}function lm(){return Er()&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"&&(global==null?void 0:global.Platform.OS)==="android"}function hm(){return Er()&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"&&(global==null?void 0:global.Platform.OS)==="ios"}function vi(){return!is()&&!!(0,$t.getNavigator)()&&!!(0,$t.getDocument)()}function ns(){return Er()?wt.reactNative:is()?wt.node:vi()?wt.browser:wt.unknown}function el(){var r;try{return Er()&&typeof global<"u"&&typeof(global==null?void 0:global.Application)<"u"?(r=global.Application)==null?void 0:r.applicationId:void 0}catch{return}}function __(r,e){let t=new URLSearchParams(r);for(let i of Object.keys(e).sort())if(e.hasOwnProperty(i)){let n=e[i];n!==void 0&&t.set(i,n)}return t.toString()}function dm(r){var e,t;let i=tl();try{return r!=null&&r.url&&i.url&&new URL(r.url).host!==new URL(i.url).host&&(r.url=i.url),(e=r?.icons)!=null&&e.length&&r.icons.length>0&&(r.icons=r.icons.filter(n=>n!=="")),b_(Cg(Cg({},i),r),{url:r?.url||i.url,name:r?.name||i.name,description:r?.description||i.description,icons:(t=r?.icons)!=null&&t.length&&r.icons.length>0?r.icons:i.icons})}catch{return r||i}}function tl(){return(0,om.getWindowMetadata)()||{name:"",description:"",url:"",icons:[""]}}function S_(){if(ns()===wt.reactNative&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"){let{OS:t,Version:i}=global.Platform;return[t,i].join("-")}let r=bf();if(r===null)return"unknown";let e=r.os?r.os.replace(" ","").toLowerCase():"unknown";return r.type==="browser"?[e,r.name,r.version].join("-"):[e,r.version].join("-")}function I_(){var r;let e=ns();return e===wt.browser?[e,((r=(0,$t.getLocation)())==null?void 0:r.host)||"unknown"].join(":"):e}function rl(r,e,t){let i=S_(),n=I_();return[[r,e].join("-"),[x_,t].join("-"),i,n].join("/")}function fm({protocol:r,version:e,relayUrl:t,sdkVersion:i,auth:n,projectId:s,useOnCloseEvent:o,bundleId:a,packageName:c}){let u=t.split("?"),l=rl(r,e,i),h={auth:n,ua:l,projectId:s,useOnCloseEvent:o||void 0,packageName:c||void 0,bundleId:a||void 0},d=__(u[1]||"",h);return u[0]+"?"+d}function fi(r,e){return r.filter(t=>e.includes(t)).length===r.length}function $o(r){return Object.fromEntries(r.entries())}function Ko(r){return new Map(Object.entries(r))}function xr(r=vr.FIVE_MINUTES,e){let t=(0,vr.toMiliseconds)(r||vr.FIVE_MINUTES),i,n,s,o;return{resolve:a=>{s&&i&&(clearTimeout(s),i(a),o=Promise.resolve(a))},reject:a=>{s&&n&&(clearTimeout(s),n(a))},done:()=>new Promise((a,c)=>{if(o)return a(o);s=setTimeout(()=>{let u=new Error(e);o=Promise.reject(u),c(u)},t),i=a,n=c})}}function Kt(r,e,t){return new Promise(async(i,n)=>{let s=setTimeout(()=>n(new Error(t)),e);try{let o=await r;i(o)}catch(o){n(o)}clearTimeout(s)})}function pm(r,e){if(typeof e=="string"&&e.startsWith(`${r}:`))return e;if(r.toLowerCase()==="topic"){if(typeof e!="string")throw new Error('Value must be "string" for expirer target type: topic');return`topic:${e}`}else if(r.toLowerCase()==="id"){if(typeof e!="number")throw new Error('Value must be "number" for expirer target type: id');return`id:${e}`}throw new Error(`Unknown expirer target type: ${r}`)}function gm(r){return pm("topic",r)}function mm(r){return pm("id",r)}function Ho(r){let[e,t]=r.split(":"),i={id:void 0,topic:void 0};if(e==="topic"&&typeof t=="string")i.topic=t;else if(e==="id"&&Number.isInteger(Number(t)))i.id=Number(t);else throw new Error(`Invalid target, expected id:number or topic:string, got ${e}:${t}`);return i}function _e(r,e){return(0,vr.fromMiliseconds)((e||Date.now())+(0,vr.toMiliseconds)(r))}function ir(r){return Date.now()>=(0,vr.toMiliseconds)(r)}function oe(r,e){return`${r}${e?`:${e}`:""}`}function yi(r=[],e=[]){return[...new Set([...r,...e])]}async function ym({id:r,topic:e,wcDeepLink:t}){var i;try{if(!t)return;let n=typeof t=="string"?JSON.parse(t):t,s=n?.href;if(typeof s!="string")return;let o=A_(s,r,e),a=ns();if(a===wt.browser){if(!((i=(0,$t.getDocument)())!=null&&i.hasFocus()))return;D_(o)}else a===wt.reactNative&&typeof(global==null?void 0:global.Linking)<"u"&&await global.Linking.openURL(o)}catch{}}function A_(r,e,t){let i=`requestId=${e}&sessionTopic=${t}`;r.endsWith("/")&&(r=r.slice(0,-1));let n=`${r}`;if(r.startsWith("https://t.me")){let s=r.includes("?")?"&startapp=":"?startapp=";n=`${n}${s}${O_(i,!0)}`}else n=`${n}/wc?${i}`;return n}function D_(r){let e="_self";C_()?e="_top":(T_()||r.startsWith("https://")||r.startsWith("http://"))&&(e="_blank"),window.open(r,e,"noreferrer noopener")}async function wm(r,e){let t="";try{if(vi()&&(t=localStorage.getItem(e),t))return t;t=await r.getItem(e)}catch{}return t}function il(r,e){if(!r.includes(e))return null;let t=r.split(/([&,?,=])/),i=t.indexOf(e);return t[i+2]}function nl(){return typeof crypto<"u"&&crypto!=null&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/gu,r=>{let e=Math.random()*16|0;return(r==="x"?e:e&3|8).toString(16)})}function ss(){return typeof process<"u"&&process.env.IS_VITEST==="true"}function T_(){return typeof window<"u"&&(!!window.TelegramWebviewProxy||!!window.Telegram||!!window.TelegramWebviewProxyProto)}function C_(){try{return window.self!==window.top}catch{return!1}}function O_(r,e=!1){let t=Buffer.from(r).toString("base64");return e?t.replace(/[=]/g,""):t}function vm(r){return Buffer.from(r,"base64").toString("utf-8")}function bm(r){return new Promise(e=>setTimeout(e,r))}var Uo=class{constructor({limit:e}){Og(this,"limit"),Og(this,"set"),this.limit=e,this.set=new Set}add(e){if(!this.set.has(e)){if(this.set.size>=this.limit){let t=this.set.values().next().value;t&&this.set.delete(t)}this.set.add(e)}}has(e){return this.set.has(e)}},Ro=BigInt(2**32-1),Rg=BigInt(32);function Em(r,e=!1){return e?{h:Number(r&Ro),l:Number(r>>Rg&Ro)}:{h:Number(r>>Rg&Ro)|0,l:Number(r&Ro)|0}}function xm(r,e=!1){let t=r.length,i=new Uint32Array(t),n=new Uint32Array(t);for(let s=0;s<t;s++){let{h:o,l:a}=Em(r[s],e);[i[s],n[s]]=[o,a]}return[i,n]}var Ng=(r,e,t)=>r>>>t,Pg=(r,e,t)=>r<<32-t|e>>>t,jr=(r,e,t)=>r>>>t|e<<32-t,Vr=(r,e,t)=>r<<32-t|e>>>t,Hn=(r,e,t)=>r<<64-t|e>>>t-32,Wn=(r,e,t)=>r>>>t-32|e<<64-t,R_=(r,e)=>e,N_=(r,e)=>r,P_=(r,e,t)=>r<<t|e>>>32-t,F_=(r,e,t)=>e<<t|r>>>32-t,B_=(r,e,t)=>e<<t-32|r>>>64-t,U_=(r,e,t)=>r<<t-32|e>>>64-t;function jt(r,e,t,i){let n=(e>>>0)+(i>>>0);return{h:r+t+(n/2**32|0)|0,l:n|0}}var sl=(r,e,t)=>(r>>>0)+(e>>>0)+(t>>>0),ol=(r,e,t,i)=>e+t+i+(r/2**32|0)|0,k_=(r,e,t,i)=>(r>>>0)+(e>>>0)+(t>>>0)+(i>>>0),L_=(r,e,t,i,n)=>e+t+i+n+(r/2**32|0)|0,M_=(r,e,t,i,n)=>(r>>>0)+(e>>>0)+(t>>>0)+(i>>>0)+(n>>>0),q_=(r,e,t,i,n,s)=>e+t+i+n+s+(r/2**32|0)|0,Xi=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;function al(r){return r instanceof Uint8Array||ArrayBuffer.isView(r)&&r.constructor.name==="Uint8Array"}function br(r){if(!Number.isSafeInteger(r)||r<0)throw new Error("positive integer expected, got "+r)}function Pt(r,...e){if(!al(r))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(r.length))throw new Error("Uint8Array expected of length "+e+", got length="+r.length)}function cl(r){if(typeof r!="function"||typeof r.create!="function")throw new Error("Hash should be wrapped by utils.createHasher");br(r.outputLen),br(r.blockLen)}function Hr(r,e=!0){if(r.destroyed)throw new Error("Hash instance has been destroyed");if(e&&r.finished)throw new Error("Hash#digest() has already been called")}function ul(r,e){Pt(r);let t=e.outputLen;if(r.length<t)throw new Error("digestInto() expects output buffer of length at least "+t)}function Qn(r){return new Uint32Array(r.buffer,r.byteOffset,Math.floor(r.byteLength/4))}function Ft(...r){for(let e=0;e<r.length;e++)r[e].fill(0)}function Du(r){return new DataView(r.buffer,r.byteOffset,r.byteLength)}function rr(r,e){return r<<32-e|r>>>e}var _m=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function Sm(r){return r<<24&4278190080|r<<8&16711680|r>>>8&65280|r>>>24&255}var yr=_m?r=>r:r=>Sm(r);function z_(r){for(let e=0;e<r.length;e++)r[e]=Sm(r[e]);return r}var $r=_m?r=>r:z_,Im=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",j_=Array.from({length:256},(r,e)=>e.toString(16).padStart(2,"0"));function Zn(r){if(Pt(r),Im)return r.toHex();let e="";for(let t=0;t<r.length;t++)e+=j_[r[t]];return e}var mr={_0:48,_9:57,A:65,F:70,a:97,f:102};function Fg(r){if(r>=mr._0&&r<=mr._9)return r-mr._0;if(r>=mr.A&&r<=mr.F)return r-(mr.A-10);if(r>=mr.a&&r<=mr.f)return r-(mr.a-10)}function ll(r){if(typeof r!="string")throw new Error("hex string expected, got "+typeof r);if(Im)return Uint8Array.fromHex(r);let e=r.length,t=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);let i=new Uint8Array(t);for(let n=0,s=0;n<t;n++,s+=2){let o=Fg(r.charCodeAt(s)),a=Fg(r.charCodeAt(s+1));if(o===void 0||a===void 0){let c=r[s]+r[s+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+s)}i[n]=o*16+a}return i}function V_(r){if(typeof r!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(r))}function Vt(r){return typeof r=="string"&&(r=V_(r)),Pt(r),r}function pi(...r){let e=0;for(let i=0;i<r.length;i++){let n=r[i];Pt(n),e+=n.length}let t=new Uint8Array(e);for(let i=0,n=0;i<r.length;i++){let s=r[i];t.set(s,n),n+=s.length}return t}var Zi=class{};function os(r){let e=i=>r().update(Vt(i)).digest(),t=r();return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=()=>r(),e}function $_(r){let e=(i,n)=>r(n).update(Vt(i)).digest(),t=r({});return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=i=>r(i),e}function rn(r=32){if(Xi&&typeof Xi.getRandomValues=="function")return Xi.getRandomValues(new Uint8Array(r));if(Xi&&typeof Xi.randomBytes=="function")return Uint8Array.from(Xi.randomBytes(r));throw new Error("crypto.getRandomValues must be defined")}var K_=BigInt(0),$n=BigInt(1),H_=BigInt(2),W_=BigInt(7),G_=BigInt(256),Y_=BigInt(113),Am=[],Dm=[],Tm=[];for(let r=0,e=$n,t=1,i=0;r<24;r++){[t,i]=[i,(2*t+3*i)%5],Am.push(2*(5*i+t)),Dm.push((r+1)*(r+2)/2%64);let n=K_;for(let s=0;s<7;s++)e=(e<<$n^(e>>W_)*Y_)%G_,e&H_&&(n^=$n<<($n<<BigInt(s))-$n);Tm.push(n)}var Cm=xm(Tm,!0),J_=Cm[0],X_=Cm[1],Bg=(r,e,t)=>t>32?B_(r,e,t):P_(r,e,t),Ug=(r,e,t)=>t>32?U_(r,e,t):F_(r,e,t);function Q_(r,e=24){let t=new Uint32Array(10);for(let i=24-e;i<24;i++){for(let o=0;o<10;o++)t[o]=r[o]^r[o+10]^r[o+20]^r[o+30]^r[o+40];for(let o=0;o<10;o+=2){let a=(o+8)%10,c=(o+2)%10,u=t[c],l=t[c+1],h=Bg(u,l,1)^t[a],d=Ug(u,l,1)^t[a+1];for(let p=0;p<50;p+=10)r[o+p]^=h,r[o+p+1]^=d}let n=r[2],s=r[3];for(let o=0;o<24;o++){let a=Dm[o],c=Bg(n,s,a),u=Ug(n,s,a),l=Am[o];n=r[l],s=r[l+1],r[l]=c,r[l+1]=u}for(let o=0;o<50;o+=10){for(let a=0;a<10;a++)t[a]=r[o+a];for(let a=0;a<10;a++)r[o+a]^=~t[(a+2)%10]&t[(a+4)%10]}r[0]^=J_[i],r[1]^=X_[i]}Ft(t)}var ku=class r extends Zi{constructor(e,t,i,n=!1,s=24){if(super(),this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,this.enableXOF=!1,this.blockLen=e,this.suffix=t,this.outputLen=i,this.enableXOF=n,this.rounds=s,br(i),!(0<e&&e<200))throw new Error("only keccak-f1600 function is supported");this.state=new Uint8Array(200),this.state32=Qn(this.state)}clone(){return this._cloneInto()}keccak(){$r(this.state32),Q_(this.state32,this.rounds),$r(this.state32),this.posOut=0,this.pos=0}update(e){Hr(this),e=Vt(e),Pt(e);let{blockLen:t,state:i}=this,n=e.length;for(let s=0;s<n;){let o=Math.min(t-this.pos,n-s);for(let a=0;a<o;a++)i[this.pos++]^=e[s++];this.pos===t&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;let{state:e,suffix:t,pos:i,blockLen:n}=this;e[i]^=t,(t&128)!==0&&i===n-1&&this.keccak(),e[n-1]^=128,this.keccak()}writeInto(e){Hr(this,!1),Pt(e),this.finish();let t=this.state,{blockLen:i}=this;for(let n=0,s=e.length;n<s;){this.posOut>=i&&this.keccak();let o=Math.min(i-this.posOut,s-n);e.set(t.subarray(this.posOut,this.posOut+o),n),this.posOut+=o,n+=o}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return br(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(ul(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,Ft(this.state)}_cloneInto(e){let{blockLen:t,suffix:i,outputLen:n,rounds:s,enableXOF:o}=this;return e||(e=new r(t,i,n,o,s)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=s,e.suffix=i,e.outputLen=n,e.enableXOF=o,e.destroyed=this.destroyed,e}},Z_=(r,e,t)=>os(()=>new ku(e,r,t)),eS=Z_(1,136,256/8);function tS(r,e,t,i){if(typeof r.setBigUint64=="function")return r.setBigUint64(e,t,i);let n=BigInt(32),s=BigInt(4294967295),o=Number(t>>n&s),a=Number(t&s),c=i?4:0,u=i?0:4;r.setUint32(e+c,o,i),r.setUint32(e+u,a,i)}function rS(r,e,t){return r&e^~r&t}function iS(r,e,t){return r&e^r&t^e&t}var ko=class extends Zi{constructor(e,t,i,n){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=e,this.outputLen=t,this.padOffset=i,this.isLE=n,this.buffer=new Uint8Array(e),this.view=Du(this.buffer)}update(e){Hr(this),e=Vt(e),Pt(e);let{view:t,buffer:i,blockLen:n}=this,s=e.length;for(let o=0;o<s;){let a=Math.min(n-this.pos,s-o);if(a===n){let c=Du(e);for(;n<=s-o;o+=n)this.process(c,o);continue}i.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===n&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){Hr(this),ul(e,this),this.finished=!0;let{buffer:t,view:i,blockLen:n,isLE:s}=this,{pos:o}=this;t[o++]=128,Ft(this.buffer.subarray(o)),this.padOffset>n-o&&(this.process(i,0),o=0);for(let h=o;h<n;h++)t[h]=0;tS(i,n-8,BigInt(this.length*8),s),this.process(i,0);let a=Du(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");let u=c/4,l=this.get();if(u>l.length)throw new Error("_sha2: outputLen bigger than state");for(let h=0;h<u;h++)a.setUint32(4*h,l[h],s)}digest(){let{buffer:e,outputLen:t}=this;this.digestInto(e);let i=e.slice(0,t);return this.destroy(),i}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());let{blockLen:t,buffer:i,length:n,finished:s,destroyed:o,pos:a}=this;return e.destroyed=o,e.finished=s,e.length=n,e.pos=a,n%t&&e.buffer.set(i),e}clone(){return this._cloneInto()}},Ur=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Xe=Uint32Array.from([3418070365,3238371032,1654270250,914150663,2438529370,812702999,355462360,4144912697,1731405415,4290775857,2394180231,1750603025,3675008525,1694076839,1203062813,3204075428]),Qe=Uint32Array.from([1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209]),nS=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),kr=new Uint32Array(64),Lu=class extends ko{constructor(e=32){super(64,e,8,!1),this.A=Ur[0]|0,this.B=Ur[1]|0,this.C=Ur[2]|0,this.D=Ur[3]|0,this.E=Ur[4]|0,this.F=Ur[5]|0,this.G=Ur[6]|0,this.H=Ur[7]|0}get(){let{A:e,B:t,C:i,D:n,E:s,F:o,G:a,H:c}=this;return[e,t,i,n,s,o,a,c]}set(e,t,i,n,s,o,a,c){this.A=e|0,this.B=t|0,this.C=i|0,this.D=n|0,this.E=s|0,this.F=o|0,this.G=a|0,this.H=c|0}process(e,t){for(let h=0;h<16;h++,t+=4)kr[h]=e.getUint32(t,!1);for(let h=16;h<64;h++){let d=kr[h-15],p=kr[h-2],f=rr(d,7)^rr(d,18)^d>>>3,g=rr(p,17)^rr(p,19)^p>>>10;kr[h]=g+kr[h-7]+f+kr[h-16]|0}let{A:i,B:n,C:s,D:o,E:a,F:c,G:u,H:l}=this;for(let h=0;h<64;h++){let d=rr(a,6)^rr(a,11)^rr(a,25),p=l+d+rS(a,c,u)+nS[h]+kr[h]|0,f=(rr(i,2)^rr(i,13)^rr(i,22))+iS(i,n,s)|0;l=u,u=c,c=a,a=o+p|0,o=s,s=n,n=i,i=p+f|0}i=i+this.A|0,n=n+this.B|0,s=s+this.C|0,o=o+this.D|0,a=a+this.E|0,c=c+this.F|0,u=u+this.G|0,l=l+this.H|0,this.set(i,n,s,o,a,c,u,l)}roundClean(){Ft(kr)}destroy(){this.set(0,0,0,0,0,0,0,0),Ft(this.buffer)}},Om=xm(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(r=>BigInt(r))),sS=Om[0],oS=Om[1],Lr=new Uint32Array(80),Mr=new Uint32Array(80),es=class extends ko{constructor(e=64){super(128,e,16,!1),this.Ah=Qe[0]|0,this.Al=Qe[1]|0,this.Bh=Qe[2]|0,this.Bl=Qe[3]|0,this.Ch=Qe[4]|0,this.Cl=Qe[5]|0,this.Dh=Qe[6]|0,this.Dl=Qe[7]|0,this.Eh=Qe[8]|0,this.El=Qe[9]|0,this.Fh=Qe[10]|0,this.Fl=Qe[11]|0,this.Gh=Qe[12]|0,this.Gl=Qe[13]|0,this.Hh=Qe[14]|0,this.Hl=Qe[15]|0}get(){let{Ah:e,Al:t,Bh:i,Bl:n,Ch:s,Cl:o,Dh:a,Dl:c,Eh:u,El:l,Fh:h,Fl:d,Gh:p,Gl:f,Hh:g,Hl:m}=this;return[e,t,i,n,s,o,a,c,u,l,h,d,p,f,g,m]}set(e,t,i,n,s,o,a,c,u,l,h,d,p,f,g,m){this.Ah=e|0,this.Al=t|0,this.Bh=i|0,this.Bl=n|0,this.Ch=s|0,this.Cl=o|0,this.Dh=a|0,this.Dl=c|0,this.Eh=u|0,this.El=l|0,this.Fh=h|0,this.Fl=d|0,this.Gh=p|0,this.Gl=f|0,this.Hh=g|0,this.Hl=m|0}process(e,t){for(let y=0;y<16;y++,t+=4)Lr[y]=e.getUint32(t),Mr[y]=e.getUint32(t+=4);for(let y=16;y<80;y++){let S=Lr[y-15]|0,E=Mr[y-15]|0,C=jr(S,E,1)^jr(S,E,8)^Ng(S,E,7),R=Vr(S,E,1)^Vr(S,E,8)^Pg(S,E,7),P=Lr[y-2]|0,b=Mr[y-2]|0,A=jr(P,b,19)^Hn(P,b,61)^Ng(P,b,6),_=Vr(P,b,19)^Wn(P,b,61)^Pg(P,b,6),D=k_(R,_,Mr[y-7],Mr[y-16]),F=L_(D,C,A,Lr[y-7],Lr[y-16]);Lr[y]=F|0,Mr[y]=D|0}let{Ah:i,Al:n,Bh:s,Bl:o,Ch:a,Cl:c,Dh:u,Dl:l,Eh:h,El:d,Fh:p,Fl:f,Gh:g,Gl:m,Hh:w,Hl:v}=this;for(let y=0;y<80;y++){let S=jr(h,d,14)^jr(h,d,18)^Hn(h,d,41),E=Vr(h,d,14)^Vr(h,d,18)^Wn(h,d,41),C=h&p^~h&g,R=d&f^~d&m,P=M_(v,E,R,oS[y],Mr[y]),b=q_(P,w,S,C,sS[y],Lr[y]),A=P|0,_=jr(i,n,28)^Hn(i,n,34)^Hn(i,n,39),D=Vr(i,n,28)^Wn(i,n,34)^Wn(i,n,39),F=i&s^i&a^s&a,k=n&o^n&c^o&c;w=g|0,v=m|0,g=p|0,m=f|0,p=h|0,f=d|0,{h,l:d}=jt(u|0,l|0,b|0,A|0),u=a|0,l=c|0,a=s|0,c=o|0,s=i|0,o=n|0;let I=sl(A,D,k);i=ol(I,b,_,F),n=I|0}({h:i,l:n}=jt(this.Ah|0,this.Al|0,i|0,n|0)),{h:s,l:o}=jt(this.Bh|0,this.Bl|0,s|0,o|0),{h:a,l:c}=jt(this.Ch|0,this.Cl|0,a|0,c|0),{h:u,l}=jt(this.Dh|0,this.Dl|0,u|0,l|0),{h,l:d}=jt(this.Eh|0,this.El|0,h|0,d|0),{h:p,l:f}=jt(this.Fh|0,this.Fl|0,p|0,f|0),{h:g,l:m}=jt(this.Gh|0,this.Gl|0,g|0,m|0),{h:w,l:v}=jt(this.Hh|0,this.Hl|0,w|0,v|0),this.set(i,n,s,o,a,c,u,l,h,d,p,f,g,m,w,v)}roundClean(){Ft(Lr,Mr)}destroy(){Ft(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}},Mu=class extends es{constructor(){super(48),this.Ah=Xe[0]|0,this.Al=Xe[1]|0,this.Bh=Xe[2]|0,this.Bl=Xe[3]|0,this.Ch=Xe[4]|0,this.Cl=Xe[5]|0,this.Dh=Xe[6]|0,this.Dl=Xe[7]|0,this.Eh=Xe[8]|0,this.El=Xe[9]|0,this.Fh=Xe[10]|0,this.Fl=Xe[11]|0,this.Gh=Xe[12]|0,this.Gl=Xe[13]|0,this.Hh=Xe[14]|0,this.Hl=Xe[15]|0}},Ze=Uint32Array.from([573645204,4230739756,2673172387,3360449730,596883563,1867755857,2520282905,1497426621,2519219938,2827943907,3193839141,1401305490,721525244,746961066,246885852,2177182882]),qu=class extends es{constructor(){super(32),this.Ah=Ze[0]|0,this.Al=Ze[1]|0,this.Bh=Ze[2]|0,this.Bl=Ze[3]|0,this.Ch=Ze[4]|0,this.Cl=Ze[5]|0,this.Dh=Ze[6]|0,this.Dl=Ze[7]|0,this.Eh=Ze[8]|0,this.El=Ze[9]|0,this.Fh=Ze[10]|0,this.Fl=Ze[11]|0,this.Gh=Ze[12]|0,this.Gl=Ze[13]|0,this.Hh=Ze[14]|0,this.Hl=Ze[15]|0}},Wo=os(()=>new Lu),aS=os(()=>new es),cS=os(()=>new Mu),uS=os(()=>new qu),lS=Uint8Array.from([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9]),Oe=Uint32Array.from([4089235720,1779033703,2227873595,3144134277,4271175723,1013904242,1595750129,2773480762,2917565137,1359893119,725511199,2600822924,4215389547,528734635,327033209,1541459225]),z=new Uint32Array(32);function qr(r,e,t,i,n,s){let o=n[s],a=n[s+1],c=z[2*r],u=z[2*r+1],l=z[2*e],h=z[2*e+1],d=z[2*t],p=z[2*t+1],f=z[2*i],g=z[2*i+1],m=sl(c,l,o);u=ol(m,u,h,a),c=m|0,{Dh:g,Dl:f}={Dh:g^u,Dl:f^c},{Dh:g,Dl:f}={Dh:R_(g,f),Dl:N_(g)},{h:p,l:d}=jt(p,d,g,f),{Bh:h,Bl:l}={Bh:h^p,Bl:l^d},{Bh:h,Bl:l}={Bh:jr(h,l,24),Bl:Vr(h,l,24)},z[2*r]=c,z[2*r+1]=u,z[2*e]=l,z[2*e+1]=h,z[2*t]=d,z[2*t+1]=p,z[2*i]=f,z[2*i+1]=g}function zr(r,e,t,i,n,s){let o=n[s],a=n[s+1],c=z[2*r],u=z[2*r+1],l=z[2*e],h=z[2*e+1],d=z[2*t],p=z[2*t+1],f=z[2*i],g=z[2*i+1],m=sl(c,l,o);u=ol(m,u,h,a),c=m|0,{Dh:g,Dl:f}={Dh:g^u,Dl:f^c},{Dh:g,Dl:f}={Dh:jr(g,f,16),Dl:Vr(g,f,16)},{h:p,l:d}=jt(p,d,g,f),{Bh:h,Bl:l}={Bh:h^p,Bl:l^d},{Bh:h,Bl:l}={Bh:Hn(h,l,63),Bl:Wn(h,l,63)},z[2*r]=c,z[2*r+1]=u,z[2*e]=l,z[2*e+1]=h,z[2*t]=d,z[2*t+1]=p,z[2*i]=f,z[2*i+1]=g}function hS(r,e={},t,i,n){if(br(t),r<0||r>t)throw new Error("outputLen bigger than keyLen");let{key:s,salt:o,personalization:a}=e;if(s!==void 0&&(s.length<1||s.length>t))throw new Error("key length must be undefined or 1.."+t);if(o!==void 0&&o.length!==i)throw new Error("salt must be undefined or "+i);if(a!==void 0&&a.length!==n)throw new Error("personalization must be undefined or "+n)}var zu=class extends Zi{constructor(e,t){super(),this.finished=!1,this.destroyed=!1,this.length=0,this.pos=0,br(e),br(t),this.blockLen=e,this.outputLen=t,this.buffer=new Uint8Array(e),this.buffer32=Qn(this.buffer)}update(e){Hr(this),e=Vt(e),Pt(e);let{blockLen:t,buffer:i,buffer32:n}=this,s=e.length,o=e.byteOffset,a=e.buffer;for(let c=0;c<s;){this.pos===t&&($r(n),this.compress(n,0,!1),$r(n),this.pos=0);let u=Math.min(t-this.pos,s-c),l=o+c;if(u===t&&!(l%4)&&c+u<s){let h=new Uint32Array(a,l,Math.floor((s-c)/4));$r(h);for(let d=0;c+t<s;d+=n.length,c+=t)this.length+=t,this.compress(h,d,!1);$r(h);continue}i.set(e.subarray(c,c+u),this.pos),this.pos+=u,this.length+=u,c+=u}return this}digestInto(e){Hr(this),ul(e,this);let{pos:t,buffer32:i}=this;this.finished=!0,Ft(this.buffer.subarray(t)),$r(i),this.compress(i,0,!0),$r(i);let n=Qn(e);this.get().forEach((s,o)=>n[o]=yr(s))}digest(){let{buffer:e,outputLen:t}=this;this.digestInto(e);let i=e.slice(0,t);return this.destroy(),i}_cloneInto(e){let{buffer:t,length:i,finished:n,destroyed:s,outputLen:o,pos:a}=this;return e||(e=new this.constructor({dkLen:o})),e.set(...this.get()),e.buffer.set(t),e.destroyed=s,e.finished=n,e.length=i,e.pos=a,e.outputLen=o,e}clone(){return this._cloneInto()}},ju=class extends zu{constructor(e={}){let t=e.dkLen===void 0?64:e.dkLen;super(128,t),this.v0l=Oe[0]|0,this.v0h=Oe[1]|0,this.v1l=Oe[2]|0,this.v1h=Oe[3]|0,this.v2l=Oe[4]|0,this.v2h=Oe[5]|0,this.v3l=Oe[6]|0,this.v3h=Oe[7]|0,this.v4l=Oe[8]|0,this.v4h=Oe[9]|0,this.v5l=Oe[10]|0,this.v5h=Oe[11]|0,this.v6l=Oe[12]|0,this.v6h=Oe[13]|0,this.v7l=Oe[14]|0,this.v7h=Oe[15]|0,hS(t,e,64,16,16);let{key:i,personalization:n,salt:s}=e,o=0;if(i!==void 0&&(i=Vt(i),o=i.length),this.v0l^=this.outputLen|o<<8|65536|1<<24,s!==void 0){s=Vt(s);let a=Qn(s);this.v4l^=yr(a[0]),this.v4h^=yr(a[1]),this.v5l^=yr(a[2]),this.v5h^=yr(a[3])}if(n!==void 0){n=Vt(n);let a=Qn(n);this.v6l^=yr(a[0]),this.v6h^=yr(a[1]),this.v7l^=yr(a[2]),this.v7h^=yr(a[3])}if(i!==void 0){let a=new Uint8Array(this.blockLen);a.set(i),this.update(a)}}get(){let{v0l:e,v0h:t,v1l:i,v1h:n,v2l:s,v2h:o,v3l:a,v3h:c,v4l:u,v4h:l,v5l:h,v5h:d,v6l:p,v6h:f,v7l:g,v7h:m}=this;return[e,t,i,n,s,o,a,c,u,l,h,d,p,f,g,m]}set(e,t,i,n,s,o,a,c,u,l,h,d,p,f,g,m){this.v0l=e|0,this.v0h=t|0,this.v1l=i|0,this.v1h=n|0,this.v2l=s|0,this.v2h=o|0,this.v3l=a|0,this.v3h=c|0,this.v4l=u|0,this.v4h=l|0,this.v5l=h|0,this.v5h=d|0,this.v6l=p|0,this.v6h=f|0,this.v7l=g|0,this.v7h=m|0}compress(e,t,i){this.get().forEach((c,u)=>z[u]=c),z.set(Oe,16);let{h:n,l:s}=Em(BigInt(this.length));z[24]=Oe[8]^s,z[25]=Oe[9]^n,i&&(z[28]=~z[28],z[29]=~z[29]);let o=0,a=lS;for(let c=0;c<12;c++)qr(0,4,8,12,e,t+2*a[o++]),zr(0,4,8,12,e,t+2*a[o++]),qr(1,5,9,13,e,t+2*a[o++]),zr(1,5,9,13,e,t+2*a[o++]),qr(2,6,10,14,e,t+2*a[o++]),zr(2,6,10,14,e,t+2*a[o++]),qr(3,7,11,15,e,t+2*a[o++]),zr(3,7,11,15,e,t+2*a[o++]),qr(0,5,10,15,e,t+2*a[o++]),zr(0,5,10,15,e,t+2*a[o++]),qr(1,6,11,12,e,t+2*a[o++]),zr(1,6,11,12,e,t+2*a[o++]),qr(2,7,8,13,e,t+2*a[o++]),zr(2,7,8,13,e,t+2*a[o++]),qr(3,4,9,14,e,t+2*a[o++]),zr(3,4,9,14,e,t+2*a[o++]);this.v0l^=z[0]^z[16],this.v0h^=z[1]^z[17],this.v1l^=z[2]^z[18],this.v1h^=z[3]^z[19],this.v2l^=z[4]^z[20],this.v2h^=z[5]^z[21],this.v3l^=z[6]^z[22],this.v3h^=z[7]^z[23],this.v4l^=z[8]^z[24],this.v4h^=z[9]^z[25],this.v5l^=z[10]^z[26],this.v5h^=z[11]^z[27],this.v6l^=z[12]^z[28],this.v6h^=z[13]^z[29],this.v7l^=z[14]^z[30],this.v7h^=z[15]^z[31],Ft(z)}destroy(){this.destroyed=!0,Ft(this.buffer32),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}},dS=$_(r=>new ju(r)),fS="https://rpc.walletconnect.org/v1";function Rm(r){let e=`Ethereum Signed Message:
${r.length}`,t=new TextEncoder().encode(e+r);return"0x"+Buffer.from(eS(t)).toString("hex")}async function pS(r,e,t,i,n,s){switch(t.t){case"eip191":return await gS(r,e,t.s);case"eip1271":return await mS(r,e,t.s,i,n,s);default:throw new Error(`verifySignature failed: Attempted to verify CacaoSignature with unknown type: ${t.t}`)}}async function gS(r,e,t){return(await vc({hash:Rm(e),signature:t})).toLowerCase()===r.toLowerCase()}async function mS(r,e,t,i,n,s){let o=rs(i);if(!o.namespace||!o.reference)throw new Error(`isValidEip1271Signature failed: chainId must be in CAIP-2 format, received: ${i}`);try{let a="0x1626ba7e",c="0000000000000000000000000000000000000000000000000000000000000040",u=t.substring(2),l=(u.length/2).toString(16).padStart(64,"0"),h=(e.startsWith("0x")?e:Rm(e)).substring(2),d=a+h+c+l+u,p=await fetch(`${s||fS}/?chainId=${i}&projectId=${n}`,{headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify({id:yS(),jsonrpc:"2.0",method:"eth_call",params:[{to:r,data:d},"latest"]})}),{result:f}=await p.json();return f?f.slice(0,a.length).toLowerCase()===a.toLowerCase():!1}catch{return!1}}function yS(){return Date.now()+Math.floor(Math.random()*1e3)}function Nm(r){let e=atob(r),t=new Uint8Array(e.length);for(let o=0;o<e.length;o++)t[o]=e.charCodeAt(o);let i=t[0];if(i===0)throw new Error("No signatures found");let n=1+i*64;if(t.length<n)throw new Error("Transaction data too short for claimed signature count");if(t.length<100)throw new Error("Transaction too short");let s=Buffer.from(r,"base64").slice(1,65);return Vi.encode(s)}function Pm(r){let e=new Uint8Array(Buffer.from(r,"base64")),t=Array.from("TransactionData::").map(s=>s.charCodeAt(0)),i=new Uint8Array(t.length+e.length);i.set(t),i.set(e,t.length);let n=dS(i,{dkLen:32});return Vi.encode(n)}function hl(r){let e=new Uint8Array(Wo(wS(r)));return Vi.encode(e)}function wS(r){if(r instanceof Uint8Array)return r;if(Array.isArray(r))return new Uint8Array(r);if(typeof r=="object"&&r!=null&&r.data)return new Uint8Array(Object.values(r.data));if(typeof r=="object"&&r)return new Uint8Array(Object.values(r));throw new Error("getNearUint8ArrayFromBytes: Unexpected result type from bytes array")}function dl(r){let e=Buffer.from(r,"base64"),t=Ic(e).txn;if(!t)throw new Error("Invalid signed transaction: missing 'txn' field");let i=Ec(t),n=Buffer.from("TX"),s=Buffer.concat([n,Buffer.from(i)]),o=uS(s);return hf.encode(o).replace(/=+$/,"")}function Tu(r){let e=[],t=BigInt(r);for(;t>=BigInt(128);)e.push(Number(t&BigInt(127)|BigInt(128))),t>>=BigInt(7);return e.push(Number(t)),Buffer.from(e)}function Fm(r){let e=Buffer.from(r.signed.bodyBytes,"base64"),t=Buffer.from(r.signed.authInfoBytes,"base64"),i=Buffer.from(r.signature.signature,"base64"),n=[];n.push(Buffer.from([10])),n.push(Tu(e.length)),n.push(e),n.push(Buffer.from([18])),n.push(Tu(t.length)),n.push(t),n.push(Buffer.from([26])),n.push(Tu(i.length)),n.push(i);let s=Buffer.concat(n),o=Wo(s);return Buffer.from(o).toString("hex").toUpperCase()}var vS=Object.defineProperty,bS=Object.defineProperties,ES=Object.getOwnPropertyDescriptors,kg=Object.getOwnPropertySymbols,xS=Object.prototype.hasOwnProperty,_S=Object.prototype.propertyIsEnumerable,Lg=(r,e,t)=>e in r?vS(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,SS=(r,e)=>{for(var t in e||(e={}))xS.call(e,t)&&Lg(r,t,e[t]);if(kg)for(var t of kg(e))_S.call(e,t)&&Lg(r,t,e[t]);return r},IS=(r,e)=>bS(r,ES(e)),AS="did:pkh:",fl=r=>r?.split(":"),DS=r=>{let e=r&&fl(r);if(e)return r.includes(AS)?e[3]:e[1]},Go=r=>{let e=r&&fl(r);if(e)return e[2]+":"+e[3]},as=r=>{let e=r&&fl(r);if(e)return e.pop()};async function pl(r){let{cacao:e,projectId:t}=r,{s:i,p:n}=e,s=gl(n,n.iss),o=as(n.iss);return await pS(o,s,i,Go(n.iss),t)}var gl=(r,e)=>{let t=`${r.domain} wants you to sign in with your Ethereum account:`,i=as(e);if(!r.aud&&!r.uri)throw new Error("Either `aud` or `uri` is required to construct the message");let n=r.statement||void 0,s=`URI: ${r.aud||r.uri}`,o=`Version: ${r.version}`,a=`Chain ID: ${DS(e)}`,c=`Nonce: ${r.nonce}`,u=`Issued At: ${r.iat}`,l=r.exp?`Expiration Time: ${r.exp}`:void 0,h=r.nbf?`Not Before: ${r.nbf}`:void 0,d=r.requestId?`Request ID: ${r.requestId}`:void 0,p=r.resources?`Resources:${r.resources.map(g=>`
- ${g}`).join("")}`:void 0,f=cs(r.resources);if(f){let g=ts(f);n=FS(n,g)}return[t,i,"",n,"",s,o,a,c,u,l,h,d,p].filter(g=>g!=null).join(`
`)};function TS(r){return Buffer.from(JSON.stringify(r)).toString("base64")}function CS(r){return JSON.parse(Buffer.from(r,"base64").toString("utf-8"))}function wi(r){if(!r)throw new Error("No recap provided, value is undefined");if(!r.att)throw new Error("No `att` property found");let e=Object.keys(r.att);if(!(e!=null&&e.length))throw new Error("No resources found in `att` property");e.forEach(t=>{let i=r.att[t];if(Array.isArray(i))throw new Error(`Resource must be an object: ${t}`);if(typeof i!="object")throw new Error(`Resource must be an object: ${t}`);if(!Object.keys(i).length)throw new Error(`Resource object is empty: ${t}`);Object.keys(i).forEach(n=>{let s=i[n];if(!Array.isArray(s))throw new Error(`Ability limits ${n} must be an array of objects, found: ${s}`);if(!s.length)throw new Error(`Value of ${n} is empty array, must be an array with objects`);s.forEach(o=>{if(typeof o!="object")throw new Error(`Ability limits (${n}) must be an array of objects, found: ${o}`)})})})}function OS(r,e,t,i={}){return t?.sort((n,s)=>n.localeCompare(s)),{att:{[r]:RS(e,t,i)}}}function RS(r,e,t={}){e=e?.sort((n,s)=>n.localeCompare(s));let i=e.map(n=>({[`${r}/${n}`]:[t]}));return Object.assign({},...i)}function Bm(r){return wi(r),`urn:recap:${TS(r).replace(/=/g,"")}`}function ts(r){let e=CS(r.replace("urn:recap:",""));return wi(e),e}function Um(r,e,t){let i=OS(r,e,t);return Bm(i)}function NS(r){return r&&r.includes("urn:recap:")}function km(r,e){let t=ts(r),i=ts(e),n=PS(t,i);return Bm(n)}function PS(r,e){wi(r),wi(e);let t=Object.keys(r.att).concat(Object.keys(e.att)).sort((n,s)=>n.localeCompare(s)),i={att:{}};return t.forEach(n=>{var s,o;Object.keys(((s=r.att)==null?void 0:s[n])||{}).concat(Object.keys(((o=e.att)==null?void 0:o[n])||{})).sort((a,c)=>a.localeCompare(c)).forEach(a=>{var c,u;i.att[n]=IS(SS({},i.att[n]),{[a]:((c=r.att[n])==null?void 0:c[a])||((u=e.att[n])==null?void 0:u[a])})})}),i}function FS(r="",e){wi(e);let t="I further authorize the stated URI to perform the following actions on my behalf: ";if(r.includes(t))return r;let i=[],n=0;Object.keys(e.att).forEach(a=>{let c=Object.keys(e.att[a]).map(h=>({ability:h.split("/")[0],action:h.split("/")[1]}));c.sort((h,d)=>h.action.localeCompare(d.action));let u={};c.forEach(h=>{u[h.ability]||(u[h.ability]=[]),u[h.ability].push(h.action)});let l=Object.keys(u).map(h=>(n++,`(${n}) '${h}': '${u[h].join("', '")}' for '${a}'.`));i.push(l.join(", ").replace(".,","."))});let s=i.join(" "),o=`${t}${s}`;return`${r?r+" ":""}${o}`}function ml(r){var e;let t=ts(r);wi(t);let i=(e=t.att)==null?void 0:e.eip155;return i?Object.keys(i).map(n=>n.split("/")[1]):[]}function yl(r){let e=ts(r);wi(e);let t=[];return Object.values(e.att).forEach(i=>{Object.values(i).forEach(n=>{var s;(s=n?.[0])!=null&&s.chains&&t.push(n[0].chains)})}),[...new Set(t.flat())]}function cs(r){if(!r)return;let e=r?.[r.length-1];return NS(e)?e:void 0}function Lm(r){return r instanceof Uint8Array||ArrayBuffer.isView(r)&&r.constructor.name==="Uint8Array"}function Vu(r){if(typeof r!="boolean")throw new Error(`boolean expected, not ${r}`)}function Cu(r){if(!Number.isSafeInteger(r)||r<0)throw new Error("positive integer expected, got "+r)}function yt(r,...e){if(!Lm(r))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(r.length))throw new Error("Uint8Array expected of length "+e+", got length="+r.length)}function Mg(r,e=!0){if(r.destroyed)throw new Error("Hash instance has been destroyed");if(e&&r.finished)throw new Error("Hash#digest() has already been called")}function BS(r,e){yt(r);let t=e.outputLen;if(r.length<t)throw new Error("digestInto() expects output buffer of length at least "+t)}function Kr(r){return new Uint32Array(r.buffer,r.byteOffset,Math.floor(r.byteLength/4))}function en(...r){for(let e=0;e<r.length;e++)r[e].fill(0)}function US(r){return new DataView(r.buffer,r.byteOffset,r.byteLength)}var kS=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function LS(r){if(typeof r!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(r))}function $u(r){if(typeof r=="string")r=LS(r);else if(Lm(r))r=Ku(r);else throw new Error("Uint8Array expected, got "+typeof r);return r}function MS(r,e){if(e==null||typeof e!="object")throw new Error("options must be defined");return Object.assign(r,e)}function qS(r,e){if(r.length!==e.length)return!1;let t=0;for(let i=0;i<r.length;i++)t|=r[i]^e[i];return t===0}var zS=(r,e)=>{function t(i,...n){if(yt(i),!kS)throw new Error("Non little-endian hardware is not yet supported");if(r.nonceLength!==void 0){let u=n[0];if(!u)throw new Error("nonce / iv required");r.varSizeNonce?yt(u):yt(u,r.nonceLength)}let s=r.tagLength;s&&n[1]!==void 0&&yt(n[1]);let o=e(i,...n),a=(u,l)=>{if(l!==void 0){if(u!==2)throw new Error("cipher output not supported");yt(l)}},c=!1;return{encrypt(u,l){if(c)throw new Error("cannot encrypt() twice with same key + nonce");return c=!0,yt(u),a(o.encrypt.length,l),o.encrypt(u,l)},decrypt(u,l){if(yt(u),s&&u.length<s)throw new Error("invalid ciphertext length: smaller than tagLength="+s);return a(o.decrypt.length,l),o.decrypt(u,l)}}}return Object.assign(t,r),t};function qg(r,e,t=!0){if(e===void 0)return new Uint8Array(r);if(e.length!==r)throw new Error("invalid output length, expected "+r+", got: "+e.length);if(t&&!VS(e))throw new Error("invalid output, must be aligned");return e}function zg(r,e,t,i){if(typeof r.setBigUint64=="function")return r.setBigUint64(e,t,i);let n=BigInt(32),s=BigInt(4294967295),o=Number(t>>n&s),a=Number(t&s),c=i?4:0,u=i?0:4;r.setUint32(e+c,o,i),r.setUint32(e+u,a,i)}function jS(r,e,t){Vu(t);let i=new Uint8Array(16),n=US(i);return zg(n,0,BigInt(e),t),zg(n,8,BigInt(r),t),i}function VS(r){return r.byteOffset%4===0}function Ku(r){return Uint8Array.from(r)}var Mm=r=>Uint8Array.from(r.split("").map(e=>e.charCodeAt(0))),$S=Mm("expand 16-byte k"),KS=Mm("expand 32-byte k"),HS=Kr($S),WS=Kr(KS);function se(r,e){return r<<e|r>>>32-e}function Hu(r){return r.byteOffset%4===0}var No=64,GS=16,qm=2**32-1,jg=new Uint32Array;function YS(r,e,t,i,n,s,o,a){let c=n.length,u=new Uint8Array(No),l=Kr(u),h=Hu(n)&&Hu(s),d=h?Kr(n):jg,p=h?Kr(s):jg;for(let f=0;f<c;o++){if(r(e,t,i,l,o,a),o>=qm)throw new Error("arx: counter overflow");let g=Math.min(No,c-f);if(h&&g===No){let m=f/4;if(f%4!==0)throw new Error("arx: invalid block position");for(let w=0,v;w<GS;w++)v=m+w,p[v]=d[v]^l[w];f+=No;continue}for(let m=0,w;m<g;m++)w=f+m,s[w]=n[w]^u[m];f+=g}}function JS(r,e){let{allowShortKeys:t,extendNonceFn:i,counterLength:n,counterRight:s,rounds:o}=MS({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},e);if(typeof r!="function")throw new Error("core must be a function");return Cu(n),Cu(o),Vu(s),Vu(t),(a,c,u,l,h=0)=>{yt(a),yt(c),yt(u);let d=u.length;if(l===void 0&&(l=new Uint8Array(d)),yt(l),Cu(h),h<0||h>=qm)throw new Error("arx: counter overflow");if(l.length<d)throw new Error(`arx: output (${l.length}) is shorter than data (${d})`);let p=[],f=a.length,g,m;if(f===32)p.push(g=Ku(a)),m=WS;else if(f===16&&t)g=new Uint8Array(32),g.set(a),g.set(a,16),m=HS,p.push(g);else throw new Error(`arx: invalid 32-byte key, got length=${f}`);Hu(c)||p.push(c=Ku(c));let w=Kr(g);if(i){if(c.length!==24)throw new Error("arx: extended nonce must be 24 bytes");i(m,w,Kr(c.subarray(0,16)),w),c=c.subarray(16)}let v=16-n;if(v!==c.length)throw new Error(`arx: nonce must be ${v} or 16 bytes`);if(v!==12){let S=new Uint8Array(12);S.set(c,s?0:12-c.length),c=S,p.push(c)}let y=Kr(c);return YS(r,m,w,y,u,l,h,o),en(...p),l}}var je=(r,e)=>r[e++]&255|(r[e++]&255)<<8,Wu=class{constructor(e){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,e=$u(e),yt(e,32);let t=je(e,0),i=je(e,2),n=je(e,4),s=je(e,6),o=je(e,8),a=je(e,10),c=je(e,12),u=je(e,14);this.r[0]=t&8191,this.r[1]=(t>>>13|i<<3)&8191,this.r[2]=(i>>>10|n<<6)&7939,this.r[3]=(n>>>7|s<<9)&8191,this.r[4]=(s>>>4|o<<12)&255,this.r[5]=o>>>1&8190,this.r[6]=(o>>>14|a<<2)&8191,this.r[7]=(a>>>11|c<<5)&8065,this.r[8]=(c>>>8|u<<8)&8191,this.r[9]=u>>>5&127;for(let l=0;l<8;l++)this.pad[l]=je(e,16+2*l)}process(e,t,i=!1){let n=i?0:2048,{h:s,r:o}=this,a=o[0],c=o[1],u=o[2],l=o[3],h=o[4],d=o[5],p=o[6],f=o[7],g=o[8],m=o[9],w=je(e,t+0),v=je(e,t+2),y=je(e,t+4),S=je(e,t+6),E=je(e,t+8),C=je(e,t+10),R=je(e,t+12),P=je(e,t+14),b=s[0]+(w&8191),A=s[1]+((w>>>13|v<<3)&8191),_=s[2]+((v>>>10|y<<6)&8191),D=s[3]+((y>>>7|S<<9)&8191),F=s[4]+((S>>>4|E<<12)&8191),k=s[5]+(E>>>1&8191),I=s[6]+((E>>>14|C<<2)&8191),x=s[7]+((C>>>11|R<<5)&8191),T=s[8]+((R>>>8|P<<8)&8191),N=s[9]+(P>>>5|n),O=0,U=O+b*a+A*(5*m)+_*(5*g)+D*(5*f)+F*(5*p);O=U>>>13,U&=8191,U+=k*(5*d)+I*(5*h)+x*(5*l)+T*(5*u)+N*(5*c),O+=U>>>13,U&=8191;let L=O+b*c+A*a+_*(5*m)+D*(5*g)+F*(5*f);O=L>>>13,L&=8191,L+=k*(5*p)+I*(5*d)+x*(5*h)+T*(5*l)+N*(5*u),O+=L>>>13,L&=8191;let j=O+b*u+A*c+_*a+D*(5*m)+F*(5*g);O=j>>>13,j&=8191,j+=k*(5*f)+I*(5*p)+x*(5*d)+T*(5*h)+N*(5*l),O+=j>>>13,j&=8191;let H=O+b*l+A*u+_*c+D*a+F*(5*m);O=H>>>13,H&=8191,H+=k*(5*g)+I*(5*f)+x*(5*p)+T*(5*d)+N*(5*h),O+=H>>>13,H&=8191;let W=O+b*h+A*l+_*u+D*c+F*a;O=W>>>13,W&=8191,W+=k*(5*m)+I*(5*g)+x*(5*f)+T*(5*p)+N*(5*d),O+=W>>>13,W&=8191;let Y=O+b*d+A*h+_*l+D*u+F*c;O=Y>>>13,Y&=8191,Y+=k*a+I*(5*m)+x*(5*g)+T*(5*f)+N*(5*p),O+=Y>>>13,Y&=8191;let J=O+b*p+A*d+_*h+D*l+F*u;O=J>>>13,J&=8191,J+=k*c+I*a+x*(5*m)+T*(5*g)+N*(5*f),O+=J>>>13,J&=8191;let ue=O+b*f+A*p+_*d+D*h+F*l;O=ue>>>13,ue&=8191,ue+=k*u+I*c+x*a+T*(5*m)+N*(5*g),O+=ue>>>13,ue&=8191;let ce=O+b*g+A*f+_*p+D*d+F*h;O=ce>>>13,ce&=8191,ce+=k*l+I*u+x*c+T*a+N*(5*m),O+=ce>>>13,ce&=8191;let ee=O+b*m+A*g+_*f+D*p+F*d;O=ee>>>13,ee&=8191,ee+=k*h+I*l+x*u+T*c+N*a,O+=ee>>>13,ee&=8191,O=(O<<2)+O|0,O=O+U|0,U=O&8191,O=O>>>13,L+=O,s[0]=U,s[1]=L,s[2]=j,s[3]=H,s[4]=W,s[5]=Y,s[6]=J,s[7]=ue,s[8]=ce,s[9]=ee}finalize(){let{h:e,pad:t}=this,i=new Uint16Array(10),n=e[1]>>>13;e[1]&=8191;for(let a=2;a<10;a++)e[a]+=n,n=e[a]>>>13,e[a]&=8191;e[0]+=n*5,n=e[0]>>>13,e[0]&=8191,e[1]+=n,n=e[1]>>>13,e[1]&=8191,e[2]+=n,i[0]=e[0]+5,n=i[0]>>>13,i[0]&=8191;for(let a=1;a<10;a++)i[a]=e[a]+n,n=i[a]>>>13,i[a]&=8191;i[9]-=8192;let s=(n^1)-1;for(let a=0;a<10;a++)i[a]&=s;s=~s;for(let a=0;a<10;a++)e[a]=e[a]&s|i[a];e[0]=(e[0]|e[1]<<13)&65535,e[1]=(e[1]>>>3|e[2]<<10)&65535,e[2]=(e[2]>>>6|e[3]<<7)&65535,e[3]=(e[3]>>>9|e[4]<<4)&65535,e[4]=(e[4]>>>12|e[5]<<1|e[6]<<14)&65535,e[5]=(e[6]>>>2|e[7]<<11)&65535,e[6]=(e[7]>>>5|e[8]<<8)&65535,e[7]=(e[8]>>>8|e[9]<<5)&65535;let o=e[0]+t[0];e[0]=o&65535;for(let a=1;a<8;a++)o=(e[a]+t[a]|0)+(o>>>16)|0,e[a]=o&65535;en(i)}update(e){Mg(this),e=$u(e),yt(e);let{buffer:t,blockLen:i}=this,n=e.length;for(let s=0;s<n;){let o=Math.min(i-this.pos,n-s);if(o===i){for(;i<=n-s;s+=i)this.process(e,s);continue}t.set(e.subarray(s,s+o),this.pos),this.pos+=o,s+=o,this.pos===i&&(this.process(t,0,!1),this.pos=0)}return this}destroy(){en(this.h,this.r,this.buffer,this.pad)}digestInto(e){Mg(this),BS(e,this),this.finished=!0;let{buffer:t,h:i}=this,{pos:n}=this;if(n){for(t[n++]=1;n<16;n++)t[n]=0;this.process(t,0,!0)}this.finalize();let s=0;for(let o=0;o<8;o++)e[s++]=i[o]>>>0,e[s++]=i[o]>>>8;return e}digest(){let{buffer:e,outputLen:t}=this;this.digestInto(e);let i=e.slice(0,t);return this.destroy(),i}};function XS(r){let e=(i,n)=>r(n).update($u(i)).digest(),t=r(new Uint8Array(32));return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=i=>r(i),e}var QS=XS(r=>new Wu(r));function ZS(r,e,t,i,n,s=20){let o=r[0],a=r[1],c=r[2],u=r[3],l=e[0],h=e[1],d=e[2],p=e[3],f=e[4],g=e[5],m=e[6],w=e[7],v=n,y=t[0],S=t[1],E=t[2],C=o,R=a,P=c,b=u,A=l,_=h,D=d,F=p,k=f,I=g,x=m,T=w,N=v,O=y,U=S,L=E;for(let H=0;H<s;H+=2)C=C+A|0,N=se(N^C,16),k=k+N|0,A=se(A^k,12),C=C+A|0,N=se(N^C,8),k=k+N|0,A=se(A^k,7),R=R+_|0,O=se(O^R,16),I=I+O|0,_=se(_^I,12),R=R+_|0,O=se(O^R,8),I=I+O|0,_=se(_^I,7),P=P+D|0,U=se(U^P,16),x=x+U|0,D=se(D^x,12),P=P+D|0,U=se(U^P,8),x=x+U|0,D=se(D^x,7),b=b+F|0,L=se(L^b,16),T=T+L|0,F=se(F^T,12),b=b+F|0,L=se(L^b,8),T=T+L|0,F=se(F^T,7),C=C+_|0,L=se(L^C,16),x=x+L|0,_=se(_^x,12),C=C+_|0,L=se(L^C,8),x=x+L|0,_=se(_^x,7),R=R+D|0,N=se(N^R,16),T=T+N|0,D=se(D^T,12),R=R+D|0,N=se(N^R,8),T=T+N|0,D=se(D^T,7),P=P+F|0,O=se(O^P,16),k=k+O|0,F=se(F^k,12),P=P+F|0,O=se(O^P,8),k=k+O|0,F=se(F^k,7),b=b+A|0,U=se(U^b,16),I=I+U|0,A=se(A^I,12),b=b+A|0,U=se(U^b,8),I=I+U|0,A=se(A^I,7);let j=0;i[j++]=o+C|0,i[j++]=a+R|0,i[j++]=c+P|0,i[j++]=u+b|0,i[j++]=l+A|0,i[j++]=h+_|0,i[j++]=d+D|0,i[j++]=p+F|0,i[j++]=f+k|0,i[j++]=g+I|0,i[j++]=m+x|0,i[j++]=w+T|0,i[j++]=v+N|0,i[j++]=y+O|0,i[j++]=S+U|0,i[j++]=E+L|0}var eI=JS(ZS,{counterRight:!1,counterLength:4,allowShortKeys:!1}),tI=new Uint8Array(16),Vg=(r,e)=>{r.update(e);let t=e.length%16;t&&r.update(tI.subarray(t))},rI=new Uint8Array(32);function $g(r,e,t,i,n){let s=r(e,t,rI),o=QS.create(s);n&&Vg(o,n),Vg(o,i);let a=jS(i.length,n?n.length:0,!0);o.update(a);let c=o.digest();return en(s,a),c}var iI=r=>(e,t,i)=>({encrypt(n,s){let o=n.length;s=qg(o+16,s,!1),s.set(n);let a=s.subarray(0,-16);r(e,t,a,a,1);let c=$g(r,e,t,a,i);return s.set(c,o),en(c),s},decrypt(n,s){s=qg(n.length-16,s,!1);let o=n.subarray(0,-16),a=n.subarray(-16),c=$g(r,e,t,o,i);if(!qS(a,c))throw new Error("invalid tag");return s.set(n.subarray(0,-16)),r(e,t,s,s,1),en(c),s}}),zm=zS({blockSize:64,nonceLength:12,tagLength:16},iI(eI)),Lo=class extends Zi{constructor(e,t){super(),this.finished=!1,this.destroyed=!1,cl(e);let i=Vt(t);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;let n=this.blockLen,s=new Uint8Array(n);s.set(i.length>n?e.create().update(i).digest():i);for(let o=0;o<s.length;o++)s[o]^=54;this.iHash.update(s),this.oHash=e.create();for(let o=0;o<s.length;o++)s[o]^=106;this.oHash.update(s),Ft(s)}update(e){return Hr(this),this.iHash.update(e),this}digestInto(e){Hr(this),Pt(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){let e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));let{oHash:t,iHash:i,finished:n,destroyed:s,blockLen:o,outputLen:a}=this;return e=e,e.finished=n,e.destroyed=s,e.blockLen=o,e.outputLen=a,e.oHash=t._cloneInto(e.oHash),e.iHash=i._cloneInto(e.iHash),e}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}},Yo=(r,e,t)=>new Lo(r,e).update(t).digest();Yo.create=(r,e)=>new Lo(r,e);function nI(r,e,t){return cl(r),t===void 0&&(t=new Uint8Array(r.outputLen)),Yo(r,Vt(t),Vt(e))}var Ou=Uint8Array.from([0]),Kg=Uint8Array.of();function sI(r,e,t,i=32){cl(r),br(i);let n=r.outputLen;if(i>255*n)throw new Error("Length should be <= 255*HashLen");let s=Math.ceil(i/n);t===void 0&&(t=Kg);let o=new Uint8Array(s*n),a=Yo.create(r,e),c=a._cloneInto(),u=new Uint8Array(a.outputLen);for(let l=0;l<s;l++)Ou[0]=l+1,c.update(l===0?Kg:u).update(t).update(Ou).digestInto(u),o.set(u,n*l),a._cloneInto(c);return a.destroy(),c.destroy(),Ft(u,Ou),o.slice(0,i)}var oI=(r,e,t,i,n)=>sI(r,nI(r,e,t),i,n),Jo=Wo,wl=BigInt(0),Gu=BigInt(1);function Mo(r,e){if(typeof e!="boolean")throw new Error(r+" boolean expected, got "+e)}function Po(r){let e=r.toString(16);return e.length&1?"0"+e:e}function jm(r){if(typeof r!="string")throw new Error("hex string expected, got "+typeof r);return r===""?wl:BigInt("0x"+r)}function Xo(r){return jm(Zn(r))}function qo(r){return Pt(r),jm(Zn(Uint8Array.from(r).reverse()))}function vl(r,e){return ll(r.toString(16).padStart(e*2,"0"))}function bl(r,e){return vl(r,e).reverse()}function mt(r,e,t){let i;if(typeof e=="string")try{i=ll(e)}catch(s){throw new Error(r+" must be hex string or Uint8Array, cause: "+s)}else if(al(e))i=Uint8Array.from(e);else throw new Error(r+" must be hex string or Uint8Array");let n=i.length;if(typeof t=="number"&&n!==t)throw new Error(r+" of length "+t+" expected, got "+n);return i}var Ru=r=>typeof r=="bigint"&&wl<=r;function aI(r,e,t){return Ru(r)&&Ru(e)&&Ru(t)&&e<=r&&r<t}function Yu(r,e,t,i){if(!aI(e,t,i))throw new Error("expected valid "+r+": "+t+" <= n < "+i+", got "+e)}function cI(r){let e;for(e=0;r>wl;r>>=Gu,e+=1);return e}var Qo=r=>(Gu<<BigInt(r))-Gu;function uI(r,e,t){if(typeof r!="number"||r<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof t!="function")throw new Error("hmacFn must be a function");let i=d=>new Uint8Array(d),n=d=>Uint8Array.of(d),s=i(r),o=i(r),a=0,c=()=>{s.fill(1),o.fill(0),a=0},u=(...d)=>t(o,s,...d),l=(d=i(0))=>{o=u(n(0),d),s=u(),d.length!==0&&(o=u(n(1),d),s=u())},h=()=>{if(a++>=1e3)throw new Error("drbg: tried 1000 values");let d=0,p=[];for(;d<e;){s=u();let f=s.slice();p.push(f),d+=s.length}return pi(...p)};return(d,p)=>{c(),l(d);let f;for(;!(f=p(h()));)l();return c(),f}}function Zo(r,e,t={}){if(!r||typeof r!="object")throw new Error("expected valid options object");function i(n,s,o){let a=r[n];if(o&&a===void 0)return;let c=typeof a;if(c!==s||a===null)throw new Error(`param "${n}" is invalid: expected ${s}, got ${c}`)}Object.entries(e).forEach(([n,s])=>i(n,s,!1)),Object.entries(t).forEach(([n,s])=>i(n,s,!0))}function Hg(r){let e=new WeakMap;return(t,...i)=>{let n=e.get(t);if(n!==void 0)return n;let s=r(t,...i);return e.set(t,s),s}}var vt=BigInt(0),ut=BigInt(1),gi=BigInt(2),lI=BigInt(3),Vm=BigInt(4),$m=BigInt(5),Km=BigInt(8);function Nt(r,e){let t=r%e;return t>=vt?t:e+t}function zt(r,e,t){let i=r;for(;e-- >vt;)i*=i,i%=t;return i}function Wg(r,e){if(r===vt)throw new Error("invert: expected non-zero number");if(e<=vt)throw new Error("invert: expected positive modulus, got "+e);let t=Nt(r,e),i=e,n=vt,s=ut;for(;t!==vt;){let o=i/t,a=i%t,c=n-s*o;i=t,t=a,n=s,s=c}if(i!==ut)throw new Error("invert: does not exist");return Nt(n,e)}function Hm(r,e){let t=(r.ORDER+ut)/Vm,i=r.pow(e,t);if(!r.eql(r.sqr(i),e))throw new Error("Cannot find square root");return i}function hI(r,e){let t=(r.ORDER-$m)/Km,i=r.mul(e,gi),n=r.pow(i,t),s=r.mul(e,n),o=r.mul(r.mul(s,gi),n),a=r.mul(s,r.sub(o,r.ONE));if(!r.eql(r.sqr(a),e))throw new Error("Cannot find square root");return a}function dI(r){if(r<BigInt(3))throw new Error("sqrt is not defined for small field");let e=r-ut,t=0;for(;e%gi===vt;)e/=gi,t++;let i=gi,n=nn(r);for(;Gg(n,i)===1;)if(i++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(t===1)return Hm;let s=n.pow(i,e),o=(e+ut)/gi;return function(a,c){if(a.is0(c))return c;if(Gg(a,c)!==1)throw new Error("Cannot find square root");let u=t,l=a.mul(a.ONE,s),h=a.pow(c,e),d=a.pow(c,o);for(;!a.eql(h,a.ONE);){if(a.is0(h))return a.ZERO;let p=1,f=a.sqr(h);for(;!a.eql(f,a.ONE);)if(p++,f=a.sqr(f),p===u)throw new Error("Cannot find square root");let g=ut<<BigInt(u-p-1),m=a.pow(l,g);u=p,l=a.sqr(m),h=a.mul(h,l),d=a.mul(d,m)}return d}}function fI(r){return r%Vm===lI?Hm:r%Km===$m?hI:dI(r)}var pI=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function gI(r){let e={ORDER:"bigint",MASK:"bigint",BYTES:"number",BITS:"number"},t=pI.reduce((i,n)=>(i[n]="function",i),e);return Zo(r,t),r}function mI(r,e,t){if(t<vt)throw new Error("invalid exponent, negatives unsupported");if(t===vt)return r.ONE;if(t===ut)return e;let i=r.ONE,n=e;for(;t>vt;)t&ut&&(i=r.mul(i,n)),n=r.sqr(n),t>>=ut;return i}function Wm(r,e,t=!1){let i=new Array(e.length).fill(t?r.ZERO:void 0),n=e.reduce((o,a,c)=>r.is0(a)?o:(i[c]=o,r.mul(o,a)),r.ONE),s=r.inv(n);return e.reduceRight((o,a,c)=>r.is0(a)?o:(i[c]=r.mul(o,i[c]),r.mul(o,a)),s),i}function Gg(r,e){let t=(r.ORDER-ut)/gi,i=r.pow(e,t),n=r.eql(i,r.ONE),s=r.eql(i,r.ZERO),o=r.eql(i,r.neg(r.ONE));if(!n&&!s&&!o)throw new Error("invalid Legendre symbol result");return n?1:s?0:-1}function yI(r,e){e!==void 0&&br(e);let t=e!==void 0?e:r.toString(2).length,i=Math.ceil(t/8);return{nBitLength:t,nByteLength:i}}function nn(r,e,t=!1,i={}){if(r<=vt)throw new Error("invalid field: expected ORDER > 0, got "+r);let n,s;if(typeof e=="object"&&e!=null){if(i.sqrt||t)throw new Error("cannot specify opts in two arguments");let l=e;l.BITS&&(n=l.BITS),l.sqrt&&(s=l.sqrt),typeof l.isLE=="boolean"&&(t=l.isLE)}else typeof e=="number"&&(n=e),i.sqrt&&(s=i.sqrt);let{nBitLength:o,nByteLength:a}=yI(r,n);if(a>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let c,u=Object.freeze({ORDER:r,isLE:t,BITS:o,BYTES:a,MASK:Qo(o),ZERO:vt,ONE:ut,create:l=>Nt(l,r),isValid:l=>{if(typeof l!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof l);return vt<=l&&l<r},is0:l=>l===vt,isValidNot0:l=>!u.is0(l)&&u.isValid(l),isOdd:l=>(l&ut)===ut,neg:l=>Nt(-l,r),eql:(l,h)=>l===h,sqr:l=>Nt(l*l,r),add:(l,h)=>Nt(l+h,r),sub:(l,h)=>Nt(l-h,r),mul:(l,h)=>Nt(l*h,r),pow:(l,h)=>mI(u,l,h),div:(l,h)=>Nt(l*Wg(h,r),r),sqrN:l=>l*l,addN:(l,h)=>l+h,subN:(l,h)=>l-h,mulN:(l,h)=>l*h,inv:l=>Wg(l,r),sqrt:s||(l=>(c||(c=fI(r)),c(u,l))),toBytes:l=>t?bl(l,a):vl(l,a),fromBytes:l=>{if(l.length!==a)throw new Error("Field.fromBytes: expected "+a+" bytes, got "+l.length);return t?qo(l):Xo(l)},invertBatch:l=>Wm(u,l),cmov:(l,h,d)=>d?h:l});return Object.freeze(u)}function Gm(r){if(typeof r!="bigint")throw new Error("field order must be bigint");let e=r.toString(2).length;return Math.ceil(e/8)}function Ym(r){let e=Gm(r);return e+Math.ceil(e/2)}function wI(r,e,t=!1){let i=r.length,n=Gm(e),s=Ym(e);if(i<16||i<s||i>1024)throw new Error("expected "+s+"-1024 bytes of input, got "+i);let o=t?qo(r):Xo(r),a=Nt(o,e-ut)+ut;return t?bl(a,n):vl(a,n)}var tn=BigInt(0),mi=BigInt(1);function Gn(r,e){let t=e.negate();return r?t:e}function vI(r,e,t){let i=e==="pz"?s=>s.pz:s=>s.ez,n=Wm(r.Fp,t.map(i));return t.map((s,o)=>s.toAffine(n[o])).map(r.fromAffine)}function Jm(r,e){if(!Number.isSafeInteger(r)||r<=0||r>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+r)}function Nu(r,e){Jm(r,e);let t=Math.ceil(e/r)+1,i=2**(r-1),n=2**r,s=Qo(r),o=BigInt(r);return{windows:t,windowSize:i,mask:s,maxNumber:n,shiftBy:o}}function Yg(r,e,t){let{windowSize:i,mask:n,maxNumber:s,shiftBy:o}=t,a=Number(r&n),c=r>>o;a>i&&(a-=s,c+=mi);let u=e*i,l=u+Math.abs(a)-1,h=a===0,d=a<0,p=e%2!==0;return{nextN:c,offset:l,isZero:h,isNeg:d,isNegF:p,offsetF:u}}function bI(r,e){if(!Array.isArray(r))throw new Error("array expected");r.forEach((t,i)=>{if(!(t instanceof e))throw new Error("invalid point at index "+i)})}function EI(r,e){if(!Array.isArray(r))throw new Error("array of scalars expected");r.forEach((t,i)=>{if(!e.isValid(t))throw new Error("invalid scalar at index "+i)})}var Pu=new WeakMap,Xm=new WeakMap;function Fu(r){return Xm.get(r)||1}function Jg(r){if(r!==tn)throw new Error("invalid wNAF")}function xI(r,e){return{constTimeNegate:Gn,hasPrecomputes(t){return Fu(t)!==1},unsafeLadder(t,i,n=r.ZERO){let s=t;for(;i>tn;)i&mi&&(n=n.add(s)),s=s.double(),i>>=mi;return n},precomputeWindow(t,i){let{windows:n,windowSize:s}=Nu(i,e),o=[],a=t,c=a;for(let u=0;u<n;u++){c=a,o.push(c);for(let l=1;l<s;l++)c=c.add(a),o.push(c);a=c.double()}return o},wNAF(t,i,n){let s=r.ZERO,o=r.BASE,a=Nu(t,e);for(let c=0;c<a.windows;c++){let{nextN:u,offset:l,isZero:h,isNeg:d,isNegF:p,offsetF:f}=Yg(n,c,a);n=u,h?o=o.add(Gn(p,i[f])):s=s.add(Gn(d,i[l]))}return Jg(n),{p:s,f:o}},wNAFUnsafe(t,i,n,s=r.ZERO){let o=Nu(t,e);for(let a=0;a<o.windows&&n!==tn;a++){let{nextN:c,offset:u,isZero:l,isNeg:h}=Yg(n,a,o);if(n=c,!l){let d=i[u];s=s.add(h?d.negate():d)}}return Jg(n),s},getPrecomputes(t,i,n){let s=Pu.get(i);return s||(s=this.precomputeWindow(i,t),t!==1&&(typeof n=="function"&&(s=n(s)),Pu.set(i,s))),s},wNAFCached(t,i,n){let s=Fu(t);return this.wNAF(s,this.getPrecomputes(s,t,n),i)},wNAFCachedUnsafe(t,i,n,s){let o=Fu(t);return o===1?this.unsafeLadder(t,i,s):this.wNAFUnsafe(o,this.getPrecomputes(o,t,n),i,s)},setWindowSize(t,i){Jm(i,e),Xm.set(t,i),Pu.delete(t)}}}function _I(r,e,t,i){let n=e,s=r.ZERO,o=r.ZERO;for(;t>tn||i>tn;)t&mi&&(s=s.add(n)),i&mi&&(o=o.add(n)),n=n.double(),t>>=mi,i>>=mi;return{p1:s,p2:o}}function SI(r,e,t,i){bI(t,r),EI(i,e);let n=t.length,s=i.length;if(n!==s)throw new Error("arrays of points and scalars must have equal length");let o=r.ZERO,a=cI(BigInt(n)),c=1;a>12?c=a-3:a>4?c=a-2:a>0&&(c=2);let u=Qo(c),l=new Array(Number(u)+1).fill(o),h=Math.floor((e.BITS-1)/c)*c,d=o;for(let p=h;p>=0;p-=c){l.fill(o);for(let g=0;g<s;g++){let m=i[g],w=Number(m>>BigInt(p)&u);l[w]=l[w].add(t[g])}let f=o;for(let g=l.length-1,m=o;g>0;g--)m=m.add(l[g]),f=f.add(m);if(d=d.add(f),p!==0)for(let g=0;g<c;g++)d=d.double()}return d}function Xg(r,e){if(e){if(e.ORDER!==r)throw new Error("Field.ORDER must match order: Fp == p, Fn == n");return gI(e),e}else return nn(r)}function II(r,e,t={}){if(!e||typeof e!="object")throw new Error(`expected valid ${r} CURVE object`);for(let o of["p","n","h"]){let a=e[o];if(!(typeof a=="bigint"&&a>tn))throw new Error(`CURVE.${o} must be positive bigint`)}let i=Xg(e.p,t.Fp),n=Xg(e.n,t.Fn),s=["Gx","Gy","a",r==="weierstrass"?"b":"d"];for(let o of s)if(!i.isValid(e[o]))throw new Error(`CURVE.${o} must be valid field element of CURVE.Fp`);return{Fp:i,Fn:n}}BigInt(0),BigInt(1),BigInt(2),BigInt(8);var Kn=BigInt(0),Qi=BigInt(1),Fo=BigInt(2);function AI(r){return Zo(r,{adjustScalarBytes:"function",powPminus2:"function"}),Object.freeze({...r})}function DI(r){let e=AI(r),{P:t,type:i,adjustScalarBytes:n,powPminus2:s,randomBytes:o}=e,a=i==="x25519";if(!a&&i!=="x448")throw new Error("invalid type");let c=o||rn,u=a?255:448,l=a?32:56,h=BigInt(a?9:5),d=BigInt(a?121665:39081),p=a?Fo**BigInt(254):Fo**BigInt(447),f=a?BigInt(8)*Fo**BigInt(251)-Qi:BigInt(4)*Fo**BigInt(445)-Qi,g=p+f+Qi,m=b=>Nt(b,t),w=v(h);function v(b){return bl(m(b),l)}function y(b){let A=mt("u coordinate",b,l);return a&&(A[31]&=127),m(qo(A))}function S(b){return qo(n(mt("scalar",b,l)))}function E(b,A){let _=P(y(A),S(b));if(_===Kn)throw new Error("invalid private or public key received");return v(_)}function C(b){return E(b,w)}function R(b,A,_){let D=m(b*(A-_));return A=m(A-D),_=m(_+D),{x_2:A,x_3:_}}function P(b,A){Yu("u",b,Kn,t),Yu("scalar",A,p,g);let _=A,D=b,F=Qi,k=Kn,I=b,x=Qi,T=Kn;for(let O=BigInt(u-1);O>=Kn;O--){let U=_>>O&Qi;T^=U,{x_2:F,x_3:I}=R(T,F,I),{x_2:k,x_3:x}=R(T,k,x),T=U;let L=F+k,j=m(L*L),H=F-k,W=m(H*H),Y=j-W,J=I+x,ue=I-x,ce=m(ue*L),ee=m(J*H),be=ce+ee,Ue=ce-ee;I=m(be*be),x=m(D*m(Ue*Ue)),F=m(j*W),k=m(Y*(j+m(d*Y)))}({x_2:F,x_3:I}=R(T,F,I)),{x_2:k,x_3:x}=R(T,k,x);let N=s(k);return m(F*N)}return{scalarMult:E,scalarMultBase:C,getSharedSecret:(b,A)=>E(b,A),getPublicKey:b=>C(b),utils:{randomPrivateKey:()=>c(l)},GuBytes:w.slice()}}BigInt(0);var TI=BigInt(1),Qg=BigInt(2),CI=BigInt(3),OI=BigInt(5),RI=BigInt(8),Qm={p:BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffed"),n:BigInt("0x1000000000000000000000000000000014def9dea2f79cd65812631a5cf5d3ed"),h:RI,a:BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffec"),d:BigInt("0x52036cee2b6ffe738cc740797779e89800700a4d4141d8ab75eb4dca135978a3"),Gx:BigInt("0x216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51a"),Gy:BigInt("0x6666666666666666666666666666666666666666666666666666666666666658")};function NI(r){let e=BigInt(10),t=BigInt(20),i=BigInt(40),n=BigInt(80),s=Qm.p,o=r*r%s*r%s,a=zt(o,Qg,s)*o%s,c=zt(a,TI,s)*r%s,u=zt(c,OI,s)*c%s,l=zt(u,e,s)*u%s,h=zt(l,t,s)*l%s,d=zt(h,i,s)*h%s,p=zt(d,n,s)*d%s,f=zt(p,n,s)*d%s,g=zt(f,e,s)*u%s;return{pow_p_5_8:zt(g,Qg,s)*r%s,b2:o}}function PI(r){return r[0]&=248,r[31]&=127,r[31]|=64,r}var Ju=(()=>{let r=Qm.p;return DI({P:r,type:"x25519",powPminus2:e=>{let{pow_p_5_8:t,b2:i}=NI(e);return Nt(zt(t,CI,r)*i,r)},adjustScalarBytes:PI})})();function Zg(r){r.lowS!==void 0&&Mo("lowS",r.lowS),r.prehash!==void 0&&Mo("prehash",r.prehash)}var Xu=class extends Error{constructor(e=""){super(e)}},wr={Err:Xu,_tlv:{encode:(r,e)=>{let{Err:t}=wr;if(r<0||r>256)throw new t("tlv.encode: wrong tag");if(e.length&1)throw new t("tlv.encode: unpadded data");let i=e.length/2,n=Po(i);if(n.length/2&128)throw new t("tlv.encode: long form length too big");let s=i>127?Po(n.length/2|128):"";return Po(r)+s+n+e},decode(r,e){let{Err:t}=wr,i=0;if(r<0||r>256)throw new t("tlv.encode: wrong tag");if(e.length<2||e[i++]!==r)throw new t("tlv.decode: wrong tlv");let n=e[i++],s=!!(n&128),o=0;if(!s)o=n;else{let c=n&127;if(!c)throw new t("tlv.decode(long): indefinite length not supported");if(c>4)throw new t("tlv.decode(long): byte length is too big");let u=e.subarray(i,i+c);if(u.length!==c)throw new t("tlv.decode: length bytes not complete");if(u[0]===0)throw new t("tlv.decode(long): zero leftmost byte");for(let l of u)o=o<<8|l;if(i+=c,o<128)throw new t("tlv.decode(long): not minimal encoding")}let a=e.subarray(i,i+o);if(a.length!==o)throw new t("tlv.decode: wrong value length");return{v:a,l:e.subarray(i+o)}}},_int:{encode(r){let{Err:e}=wr;if(r<Yn)throw new e("integer: negative integers are not allowed");let t=Po(r);if(Number.parseInt(t[0],16)&8&&(t="00"+t),t.length&1)throw new e("unexpected DER parsing assertion: unpadded hex");return t},decode(r){let{Err:e}=wr;if(r[0]&128)throw new e("invalid signature integer: negative");if(r[0]===0&&!(r[1]&128))throw new e("invalid signature integer: unnecessary leading zero");return Xo(r)}},toSig(r){let{Err:e,_int:t,_tlv:i}=wr,n=mt("signature",r),{v:s,l:o}=i.decode(48,n);if(o.length)throw new e("invalid signature: left bytes after parsing");let{v:a,l:c}=i.decode(2,s),{v:u,l}=i.decode(2,c);if(l.length)throw new e("invalid signature: left bytes after parsing");return{r:t.decode(a),s:t.decode(u)}},hexFromSig(r){let{_tlv:e,_int:t}=wr,i=e.encode(2,t.encode(r.r)),n=e.encode(2,t.encode(r.s)),s=i+n;return e.encode(48,s)}},Yn=BigInt(0),Jn=BigInt(1),FI=BigInt(2),Bo=BigInt(3),BI=BigInt(4);function UI(r,e,t){function i(n){let s=r.sqr(n),o=r.mul(s,n);return r.add(r.add(o,r.mul(n,e)),t)}return i}function Zm(r,e,t){let{BYTES:i}=r;function n(s){let o;if(typeof s=="bigint")o=s;else{let a=mt("private key",s);if(e){if(!e.includes(a.length*2))throw new Error("invalid private key");let c=new Uint8Array(i);c.set(a,c.length-a.length),a=c}try{o=r.fromBytes(a)}catch{throw new Error(`invalid private key: expected ui8a of size ${i}, got ${typeof s}`)}}if(t&&(o=r.create(o)),!r.isValidNot0(o))throw new Error("invalid private key: out of range [1..N-1]");return o}return n}function kI(r,e={}){let{Fp:t,Fn:i}=II("weierstrass",r,e),{h:n,n:s}=r;Zo(e,{},{allowInfinityPoint:"boolean",clearCofactor:"function",isTorsionFree:"function",fromBytes:"function",toBytes:"function",endo:"object",wrapPrivateKey:"boolean"});let{endo:o}=e;if(o&&(!t.is0(r.a)||typeof o.beta!="bigint"||typeof o.splitScalar!="function"))throw new Error('invalid endo: expected "beta": bigint and "splitScalar": function');function a(){if(!t.isOdd)throw new Error("compression is not supported: Field does not have .isOdd()")}function c(P,b,A){let{x:_,y:D}=b.toAffine(),F=t.toBytes(_);if(Mo("isCompressed",A),A){a();let k=!t.isOdd(D);return pi(ey(k),F)}else return pi(Uint8Array.of(4),F,t.toBytes(D))}function u(P){Pt(P);let b=t.BYTES,A=b+1,_=2*b+1,D=P.length,F=P[0],k=P.subarray(1);if(D===A&&(F===2||F===3)){let I=t.fromBytes(k);if(!t.isValid(I))throw new Error("bad point: is not on curve, wrong x");let x=d(I),T;try{T=t.sqrt(x)}catch(O){let U=O instanceof Error?": "+O.message:"";throw new Error("bad point: is not on curve, sqrt error"+U)}a();let N=t.isOdd(T);return(F&1)===1!==N&&(T=t.neg(T)),{x:I,y:T}}else if(D===_&&F===4){let I=t.fromBytes(k.subarray(b*0,b*1)),x=t.fromBytes(k.subarray(b*1,b*2));if(!p(I,x))throw new Error("bad point: is not on curve");return{x:I,y:x}}else throw new Error(`bad point: got length ${D}, expected compressed=${A} or uncompressed=${_}`)}let l=e.toBytes||c,h=e.fromBytes||u,d=UI(t,r.a,r.b);function p(P,b){let A=t.sqr(b),_=d(P);return t.eql(A,_)}if(!p(r.Gx,r.Gy))throw new Error("bad curve params: generator point");let f=t.mul(t.pow(r.a,Bo),BI),g=t.mul(t.sqr(r.b),BigInt(27));if(t.is0(t.add(f,g)))throw new Error("bad curve params: a or b");function m(P,b,A=!1){if(!t.isValid(b)||A&&t.is0(b))throw new Error(`bad point coordinate ${P}`);return b}function w(P){if(!(P instanceof E))throw new Error("ProjectivePoint expected")}let v=Hg((P,b)=>{let{px:A,py:_,pz:D}=P;if(t.eql(D,t.ONE))return{x:A,y:_};let F=P.is0();b==null&&(b=F?t.ONE:t.inv(D));let k=t.mul(A,b),I=t.mul(_,b),x=t.mul(D,b);if(F)return{x:t.ZERO,y:t.ZERO};if(!t.eql(x,t.ONE))throw new Error("invZ was invalid");return{x:k,y:I}}),y=Hg(P=>{if(P.is0()){if(e.allowInfinityPoint&&!t.is0(P.py))return;throw new Error("bad point: ZERO")}let{x:b,y:A}=P.toAffine();if(!t.isValid(b)||!t.isValid(A))throw new Error("bad point: x or y not field elements");if(!p(b,A))throw new Error("bad point: equation left != right");if(!P.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});function S(P,b,A,_,D){return A=new E(t.mul(A.px,P),A.py,A.pz),b=Gn(_,b),A=Gn(D,A),b.add(A)}class E{constructor(b,A,_){this.px=m("x",b),this.py=m("y",A,!0),this.pz=m("z",_),Object.freeze(this)}static fromAffine(b){let{x:A,y:_}=b||{};if(!b||!t.isValid(A)||!t.isValid(_))throw new Error("invalid affine point");if(b instanceof E)throw new Error("projective point not allowed");return t.is0(A)&&t.is0(_)?E.ZERO:new E(A,_,t.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(b){return vI(E,"pz",b)}static fromBytes(b){return Pt(b),E.fromHex(b)}static fromHex(b){let A=E.fromAffine(h(mt("pointHex",b)));return A.assertValidity(),A}static fromPrivateKey(b){let A=Zm(i,e.allowedPrivateKeyLengths,e.wrapPrivateKey);return E.BASE.multiply(A(b))}static msm(b,A){return SI(E,i,b,A)}precompute(b=8,A=!0){return R.setWindowSize(this,b),A||this.multiply(Bo),this}_setWindowSize(b){this.precompute(b)}assertValidity(){y(this)}hasEvenY(){let{y:b}=this.toAffine();if(!t.isOdd)throw new Error("Field doesn't support isOdd");return!t.isOdd(b)}equals(b){w(b);let{px:A,py:_,pz:D}=this,{px:F,py:k,pz:I}=b,x=t.eql(t.mul(A,I),t.mul(F,D)),T=t.eql(t.mul(_,I),t.mul(k,D));return x&&T}negate(){return new E(this.px,t.neg(this.py),this.pz)}double(){let{a:b,b:A}=r,_=t.mul(A,Bo),{px:D,py:F,pz:k}=this,I=t.ZERO,x=t.ZERO,T=t.ZERO,N=t.mul(D,D),O=t.mul(F,F),U=t.mul(k,k),L=t.mul(D,F);return L=t.add(L,L),T=t.mul(D,k),T=t.add(T,T),I=t.mul(b,T),x=t.mul(_,U),x=t.add(I,x),I=t.sub(O,x),x=t.add(O,x),x=t.mul(I,x),I=t.mul(L,I),T=t.mul(_,T),U=t.mul(b,U),L=t.sub(N,U),L=t.mul(b,L),L=t.add(L,T),T=t.add(N,N),N=t.add(T,N),N=t.add(N,U),N=t.mul(N,L),x=t.add(x,N),U=t.mul(F,k),U=t.add(U,U),N=t.mul(U,L),I=t.sub(I,N),T=t.mul(U,O),T=t.add(T,T),T=t.add(T,T),new E(I,x,T)}add(b){w(b);let{px:A,py:_,pz:D}=this,{px:F,py:k,pz:I}=b,x=t.ZERO,T=t.ZERO,N=t.ZERO,O=r.a,U=t.mul(r.b,Bo),L=t.mul(A,F),j=t.mul(_,k),H=t.mul(D,I),W=t.add(A,_),Y=t.add(F,k);W=t.mul(W,Y),Y=t.add(L,j),W=t.sub(W,Y),Y=t.add(A,D);let J=t.add(F,I);return Y=t.mul(Y,J),J=t.add(L,H),Y=t.sub(Y,J),J=t.add(_,D),x=t.add(k,I),J=t.mul(J,x),x=t.add(j,H),J=t.sub(J,x),N=t.mul(O,Y),x=t.mul(U,H),N=t.add(x,N),x=t.sub(j,N),N=t.add(j,N),T=t.mul(x,N),j=t.add(L,L),j=t.add(j,L),H=t.mul(O,H),Y=t.mul(U,Y),j=t.add(j,H),H=t.sub(L,H),H=t.mul(O,H),Y=t.add(Y,H),L=t.mul(j,Y),T=t.add(T,L),L=t.mul(J,Y),x=t.mul(W,x),x=t.sub(x,L),L=t.mul(W,j),N=t.mul(J,N),N=t.add(N,L),new E(x,T,N)}subtract(b){return this.add(b.negate())}is0(){return this.equals(E.ZERO)}multiply(b){let{endo:A}=e;if(!i.isValidNot0(b))throw new Error("invalid scalar: out of range");let _,D,F=k=>R.wNAFCached(this,k,E.normalizeZ);if(A){let{k1neg:k,k1:I,k2neg:x,k2:T}=A.splitScalar(b),{p:N,f:O}=F(I),{p:U,f:L}=F(T);D=O.add(L),_=S(A.beta,N,U,k,x)}else{let{p:k,f:I}=F(b);_=k,D=I}return E.normalizeZ([_,D])[0]}multiplyUnsafe(b){let{endo:A}=e,_=this;if(!i.isValid(b))throw new Error("invalid scalar: out of range");if(b===Yn||_.is0())return E.ZERO;if(b===Jn)return _;if(R.hasPrecomputes(this))return this.multiply(b);if(A){let{k1neg:D,k1:F,k2neg:k,k2:I}=A.splitScalar(b),{p1:x,p2:T}=_I(E,_,F,I);return S(A.beta,x,T,D,k)}else return R.wNAFCachedUnsafe(_,b)}multiplyAndAddUnsafe(b,A,_){let D=this.multiplyUnsafe(A).add(b.multiplyUnsafe(_));return D.is0()?void 0:D}toAffine(b){return v(this,b)}isTorsionFree(){let{isTorsionFree:b}=e;return n===Jn?!0:b?b(E,this):R.wNAFCachedUnsafe(this,s).is0()}clearCofactor(){let{clearCofactor:b}=e;return n===Jn?this:b?b(E,this):this.multiplyUnsafe(n)}toBytes(b=!0){return Mo("isCompressed",b),this.assertValidity(),l(E,this,b)}toRawBytes(b=!0){return this.toBytes(b)}toHex(b=!0){return Zn(this.toBytes(b))}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}}E.BASE=new E(r.Gx,r.Gy,t.ONE),E.ZERO=new E(t.ZERO,t.ONE,t.ZERO),E.Fp=t,E.Fn=i;let C=i.BITS,R=xI(E,e.endo?Math.ceil(C/2):C);return E}function ey(r){return Uint8Array.of(r?2:3)}function LI(r,e,t={}){Zo(e,{hash:"function"},{hmac:"function",lowS:"boolean",randomBytes:"function",bits2int:"function",bits2int_modN:"function"});let i=e.randomBytes||rn,n=e.hmac||((_,...D)=>Yo(e.hash,_,pi(...D))),{Fp:s,Fn:o}=r,{ORDER:a,BITS:c}=o;function u(_){let D=a>>Jn;return _>D}function l(_){return u(_)?o.neg(_):_}function h(_,D){if(!o.isValidNot0(D))throw new Error(`invalid signature ${_}: out of range 1..CURVE.n`)}class d{constructor(D,F,k){h("r",D),h("s",F),this.r=D,this.s=F,k!=null&&(this.recovery=k),Object.freeze(this)}static fromCompact(D){let F=o.BYTES,k=mt("compactSignature",D,F*2);return new d(o.fromBytes(k.subarray(0,F)),o.fromBytes(k.subarray(F,F*2)))}static fromDER(D){let{r:F,s:k}=wr.toSig(mt("DER",D));return new d(F,k)}assertValidity(){}addRecoveryBit(D){return new d(this.r,this.s,D)}recoverPublicKey(D){let F=s.ORDER,{r:k,s:I,recovery:x}=this;if(x==null||![0,1,2,3].includes(x))throw new Error("recovery id invalid");if(a*FI<F&&x>1)throw new Error("recovery id is ambiguous for h>1 curve");let T=x===2||x===3?k+a:k;if(!s.isValid(T))throw new Error("recovery id 2 or 3 invalid");let N=s.toBytes(T),O=r.fromHex(pi(ey((x&1)===0),N)),U=o.inv(T),L=y(mt("msgHash",D)),j=o.create(-L*U),H=o.create(I*U),W=r.BASE.multiplyUnsafe(j).add(O.multiplyUnsafe(H));if(W.is0())throw new Error("point at infinify");return W.assertValidity(),W}hasHighS(){return u(this.s)}normalizeS(){return this.hasHighS()?new d(this.r,o.neg(this.s),this.recovery):this}toBytes(D){if(D==="compact")return pi(o.toBytes(this.r),o.toBytes(this.s));if(D==="der")return ll(wr.hexFromSig(this));throw new Error("invalid format")}toDERRawBytes(){return this.toBytes("der")}toDERHex(){return Zn(this.toBytes("der"))}toCompactRawBytes(){return this.toBytes("compact")}toCompactHex(){return Zn(this.toBytes("compact"))}}let p=Zm(o,t.allowedPrivateKeyLengths,t.wrapPrivateKey),f={isValidPrivateKey(_){try{return p(_),!0}catch{return!1}},normPrivateKeyToScalar:p,randomPrivateKey:()=>{let _=a;return wI(i(Ym(_)),_)},precompute(_=8,D=r.BASE){return D.precompute(_,!1)}};function g(_,D=!0){return r.fromPrivateKey(_).toBytes(D)}function m(_){if(typeof _=="bigint")return!1;if(_ instanceof r)return!0;let D=mt("key",_).length,F=s.BYTES,k=F+1,I=2*F+1;if(!(t.allowedPrivateKeyLengths||o.BYTES===k))return D===k||D===I}function w(_,D,F=!0){if(m(_)===!0)throw new Error("first arg must be private key");if(m(D)===!1)throw new Error("second arg must be public key");return r.fromHex(D).multiply(p(_)).toBytes(F)}let v=e.bits2int||function(_){if(_.length>8192)throw new Error("input is too large");let D=Xo(_),F=_.length*8-c;return F>0?D>>BigInt(F):D},y=e.bits2int_modN||function(_){return o.create(v(_))},S=Qo(c);function E(_){return Yu("num < 2^"+c,_,Yn,S),o.toBytes(_)}function C(_,D,F=R){if(["recovered","canonical"].some(W=>W in F))throw new Error("sign() legacy options not supported");let{hash:k}=e,{lowS:I,prehash:x,extraEntropy:T}=F;I==null&&(I=!0),_=mt("msgHash",_),Zg(F),x&&(_=mt("prehashed msgHash",k(_)));let N=y(_),O=p(D),U=[E(O),E(N)];if(T!=null&&T!==!1){let W=T===!0?i(s.BYTES):T;U.push(mt("extraEntropy",W))}let L=pi(...U),j=N;function H(W){let Y=v(W);if(!o.isValidNot0(Y))return;let J=o.inv(Y),ue=r.BASE.multiply(Y).toAffine(),ce=o.create(ue.x);if(ce===Yn)return;let ee=o.create(J*o.create(j+ce*O));if(ee===Yn)return;let be=(ue.x===ce?0:2)|Number(ue.y&Jn),Ue=ee;return I&&u(ee)&&(Ue=l(ee),be^=1),new d(ce,Ue,be)}return{seed:L,k2sig:H}}let R={lowS:e.lowS,prehash:!1},P={lowS:e.lowS,prehash:!1};function b(_,D,F=R){let{seed:k,k2sig:I}=C(_,D,F);return uI(e.hash.outputLen,o.BYTES,n)(k,I)}r.BASE.precompute(8);function A(_,D,F,k=P){let I=_;D=mt("msgHash",D),F=mt("publicKey",F),Zg(k);let{lowS:x,prehash:T,format:N}=k;if("strict"in k)throw new Error("options.strict was renamed to lowS");if(N!==void 0&&!["compact","der","js"].includes(N))throw new Error('format must be "compact", "der" or "js"');let O=typeof I=="string"||al(I),U=!O&&!N&&typeof I=="object"&&I!==null&&typeof I.r=="bigint"&&typeof I.s=="bigint";if(!O&&!U)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");let L,j;try{if(U)if(N===void 0||N==="js")L=new d(I.r,I.s);else throw new Error("invalid format");if(O){try{N!=="compact"&&(L=d.fromDER(I))}catch(be){if(!(be instanceof wr.Err))throw be}!L&&N!=="der"&&(L=d.fromCompact(I))}j=r.fromHex(F)}catch{return!1}if(!L||x&&L.hasHighS())return!1;T&&(D=e.hash(D));let{r:H,s:W}=L,Y=y(D),J=o.inv(W),ue=o.create(Y*J),ce=o.create(H*J),ee=r.BASE.multiplyUnsafe(ue).add(j.multiplyUnsafe(ce));return ee.is0()?!1:o.create(ee.x)===H}return Object.freeze({getPublicKey:g,getSharedSecret:w,sign:b,verify:A,utils:f,Point:r,Signature:d})}function MI(r){let e={a:r.a,b:r.b,p:r.Fp.ORDER,n:r.n,h:r.h,Gx:r.Gx,Gy:r.Gy},t=r.Fp,i=nn(e.n,r.nBitLength),n={Fp:t,Fn:i,allowedPrivateKeyLengths:r.allowedPrivateKeyLengths,allowInfinityPoint:r.allowInfinityPoint,endo:r.endo,wrapPrivateKey:r.wrapPrivateKey,isTorsionFree:r.isTorsionFree,clearCofactor:r.clearCofactor,fromBytes:r.fromBytes,toBytes:r.toBytes};return{CURVE:e,curveOpts:n}}function qI(r){let{CURVE:e,curveOpts:t}=MI(r),i={hash:r.hash,hmac:r.hmac,randomBytes:r.randomBytes,lowS:r.lowS,bits2int:r.bits2int,bits2int_modN:r.bits2int_modN};return{CURVE:e,curveOpts:t,ecdsaOpts:i}}function zI(r,e){return Object.assign({},e,{ProjectivePoint:e.Point,CURVE:r})}function jI(r){let{CURVE:e,curveOpts:t,ecdsaOpts:i}=qI(r),n=kI(e,t),s=LI(n,i,t);return zI(r,s)}function Qu(r,e){let t=i=>jI({...r,hash:i});return{...t(e),create:t}}var ty={p:BigInt("0xffffffff00000001000000000000000000000000ffffffffffffffffffffffff"),n:BigInt("0xffffffff00000000ffffffffffffffffbce6faada7179e84f3b9cac2fc632551"),h:BigInt(1),a:BigInt("0xffffffff00000001000000000000000000000000fffffffffffffffffffffffc"),b:BigInt("0x5ac635d8aa3a93e7b3ebbd55769886bc651d06b0cc53b0f63bce3c3e27d2604b"),Gx:BigInt("0x6b17d1f2e12c4247f8bce6e563a440f277037d812deb33a0f4a13945d898c296"),Gy:BigInt("0x4fe342e2fe1a7f9b8ee7eb4a7c0f9e162bce33576b315ececbb6406837bf51f5")},ry={p:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffeffffffff0000000000000000ffffffff"),n:BigInt("0xffffffffffffffffffffffffffffffffffffffffffffffffc7634d81f4372ddf581a0db248b0a77aecec196accc52973"),h:BigInt(1),a:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffeffffffff0000000000000000fffffffc"),b:BigInt("0xb3312fa7e23ee7e4988e056be3f82d19181d9c6efe8141120314088f5013875ac656398d8a2ed19d2a85c8edd3ec2aef"),Gx:BigInt("0xaa87ca22be8b05378eb1c71ef320ad746e1d3b628ba79b9859f741e082542a385502f25dbf55296c3a545e3872760ab7"),Gy:BigInt("0x3617de4a96262c6f5d9e98bf9292dc29f8f41dbd289a147ce9da3113b5f0b8c00a60b1ce1d7e819d7a431d7c90ea0e5f")},iy={p:BigInt("0x1ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff"),n:BigInt("0x01fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffa51868783bf2f966b7fcc0148f709a5d03bb5c9b8899c47aebb6fb71e91386409"),h:BigInt(1),a:BigInt("0x1fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc"),b:BigInt("0x0051953eb9618e1c9a1f929a21a0b68540eea2da725b99b315f3b8b489918ef109e156193951ec7e937b1652c0bd3bb1bf073573df883d2c34f1ef451fd46b503f00"),Gx:BigInt("0x00c6858e06b70404e9cd9e3ecb662395b4429c648139053fb521f828af606b4d3dbaa14b5e77efe75928fe1dc127a2ffa8de3348b3c1856a429bf97e7e31c2e5bd66"),Gy:BigInt("0x011839296a789a3bc0045c8a5fb42c7d1bd998f54449579b446817afbd17273e662c97ee72995ef42640c550b9013fad0761353c7086a272c24088be94769fd16650")},VI=nn(ty.p),$I=nn(ry.p),KI=nn(iy.p),HI=Qu({...ty,Fp:VI,lowS:!1},Wo);Qu({...ry,Fp:$I,lowS:!1},cS),Qu({...iy,Fp:KI,lowS:!1,allowedPrivateKeyLengths:[130,131,132]},aS);var WI=HI,ny="base10",et="base16",tt="base64pad",_r="base64url",us="utf8",sy=0,Ht=1,sn=2,GI=0,em=1,Xn=12,El=32;function oy(){let r=Ju.utils.randomPrivateKey(),e=Ju.getPublicKey(r);return{privateKey:qe(r,et),publicKey:qe(e,et)}}function ea(){let r=rn(El);return qe(r,et)}function ay(r,e){let t=Ju.getSharedSecret(gt(r,et),gt(e,et)),i=oI(Jo,t,void 0,void 0,El);return qe(i,et)}function on(r){let e=Jo(gt(r,et));return qe(e,et)}function bt(r){let e=Jo(gt(r,us));return qe(e,et)}function cy(r){return gt(`${r}`,ny)}function Wr(r){return Number(qe(r,ny))}function uy(r){return r.replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}function ly(r){let e=r.replace(/-/g,"+").replace(/_/g,"/"),t=(4-e.length%4)%4;return e+"=".repeat(t)}function hy(r){let e=cy(typeof r.type<"u"?r.type:sy);if(Wr(e)===Ht&&typeof r.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");let t=typeof r.senderPublicKey<"u"?gt(r.senderPublicKey,et):void 0,i=typeof r.iv<"u"?gt(r.iv,et):rn(Xn),n=gt(r.symKey,et),s=zm(n,i).encrypt(gt(r.message,us)),o=gy({type:e,sealed:s,iv:i,senderPublicKey:t});return r.encoding===_r?uy(o):o}function dy(r){let e=gt(r.symKey,et),{sealed:t,iv:i}=an({encoded:r.encoded,encoding:r.encoding}),n=zm(e,i).decrypt(t);if(n===null)throw new Error("Failed to decrypt");return qe(n,us)}function fy(r,e){let t=cy(sn),i=rn(Xn),n=gt(r,us),s=gy({type:t,sealed:n,iv:i});return e===_r?uy(s):s}function py(r,e){let{sealed:t}=an({encoded:r,encoding:e});return qe(t,us)}function gy(r){if(Wr(r.type)===sn)return qe(hi([r.type,r.sealed]),tt);if(Wr(r.type)===Ht){if(typeof r.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");return qe(hi([r.type,r.senderPublicKey,r.iv,r.sealed]),tt)}return qe(hi([r.type,r.iv,r.sealed]),tt)}function an(r){let e=(r.encoding||tt)===_r?ly(r.encoded):r.encoded,t=gt(e,tt),i=t.slice(GI,em),n=em;if(Wr(i)===Ht){let c=n+El,u=c+Xn,l=t.slice(n,c),h=t.slice(c,u),d=t.slice(u);return{type:i,sealed:d,iv:h,senderPublicKey:l}}if(Wr(i)===sn){let c=t.slice(n),u=rn(Xn);return{type:i,sealed:c,iv:u}}let s=n+Xn,o=t.slice(n,s),a=t.slice(s);return{type:i,sealed:a,iv:o}}function my(r,e){let t=an({encoded:r,encoding:e?.encoding});return xl({type:Wr(t.type),senderPublicKey:typeof t.senderPublicKey<"u"?qe(t.senderPublicKey,et):void 0,receiverPublicKey:e?.receiverPublicKey})}function xl(r){let e=r?.type||sy;if(e===Ht){if(typeof r?.senderPublicKey>"u")throw new Error("missing sender public key");if(typeof r?.receiverPublicKey>"u")throw new Error("missing receiver public key")}return{type:e,senderPublicKey:r?.senderPublicKey,receiverPublicKey:r?.receiverPublicKey}}function _l(r){return r.type===Ht&&typeof r.senderPublicKey=="string"&&typeof r.receiverPublicKey=="string"}function Sl(r){return r.type===sn}function YI(r){let e=Buffer.from(r.x,"base64"),t=Buffer.from(r.y,"base64");return hi([new Uint8Array([4]),e,t])}function yy(r,e){let[t,i,n]=r.split("."),s=Buffer.from(ly(n),"base64");if(s.length!==64)throw new Error("Invalid signature length");let o=s.slice(0,32),a=s.slice(32,64),c=`${t}.${i}`,u=Jo(c),l=YI(e);if(!WI.verify(hi([o,a]),u,l))throw new Error("Invalid signature");return Bn(r).payload}var JI="irn";function ls(r){return r?.relay||{protocol:JI}}function bi(r){let e=ag[r];if(typeof e>"u")throw new Error(`Relay Protocol not supported: ${r}`);return e}function XI(r,e="-"){let t={},i="relay"+e;return Object.keys(r).forEach(n=>{if(n.startsWith(i)){let s=n.replace(i,""),o=r[n];t[s]=o}}),t}function Il(r){if(!r.includes("wc:")){let u=vm(r);u!=null&&u.includes("wc:")&&(r=u)}r=r.includes("wc://")?r.replace("wc://",""):r,r=r.includes("wc:")?r.replace("wc:",""):r;let e=r.indexOf(":"),t=r.indexOf("?")!==-1?r.indexOf("?"):void 0,i=r.substring(0,e),n=r.substring(e+1,t).split("@"),s=typeof t<"u"?r.substring(t):"",o=new URLSearchParams(s),a={};o.forEach((u,l)=>{a[l]=u});let c=typeof a.methods=="string"?a.methods.split(","):void 0;return{protocol:i,topic:QI(n[0]),version:parseInt(n[1],10),symKey:a.symKey,relay:XI(a),methods:c,expiryTimestamp:a.expiryTimestamp?parseInt(a.expiryTimestamp,10):void 0}}function QI(r){return r.startsWith("//")?r.substring(2):r}function ZI(r,e="-"){let t="relay",i={};return Object.keys(r).forEach(n=>{let s=n,o=t+e+s;r[s]&&(i[o]=r[s])}),i}function Al(r){let e=new URLSearchParams,t=ZI(r.relay);Object.keys(t).sort().forEach(n=>{e.set(n,t[n])}),e.set("symKey",r.symKey),r.expiryTimestamp&&e.set("expiryTimestamp",r.expiryTimestamp.toString()),r.methods&&e.set("methods",r.methods.join(","));let i=e.toString();return`${r.protocol}:${r.topic}@${r.version}?${i}`}function hs(r,e,t){return`${r}?wc_ev=${t}&topic=${e}`}var e3=Object.defineProperty,t3=Object.defineProperties,r3=Object.getOwnPropertyDescriptors,tm=Object.getOwnPropertySymbols,i3=Object.prototype.hasOwnProperty,n3=Object.prototype.propertyIsEnumerable,rm=(r,e,t)=>e in r?e3(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,s3=(r,e)=>{for(var t in e||(e={}))i3.call(e,t)&&rm(r,t,e[t]);if(tm)for(var t of tm(e))n3.call(e,t)&&rm(r,t,e[t]);return r},o3=(r,e)=>t3(r,r3(e));function cn(r){let e=[];return r.forEach(t=>{let[i,n]=t.split(":");e.push(`${i}:${n}`)}),e}function a3(r){let e=[];return Object.values(r).forEach(t=>{e.push(...cn(t.accounts))}),e}function c3(r,e){let t=[];return Object.values(r).forEach(i=>{cn(i.accounts).includes(e)&&t.push(...i.methods)}),t}function u3(r,e){let t=[];return Object.values(r).forEach(i=>{cn(i.accounts).includes(e)&&t.push(...i.events)}),t}function wy(r){return r.includes(":")}function l3(r){return wy(r)?r.split(":")[0]:r}function im(r){var e,t,i;let n={};if(!un(r))return n;for(let[s,o]of Object.entries(r)){let a=wy(s)?[s]:o.chains,c=o.methods||[],u=o.events||[],l=l3(s);n[l]=o3(s3({},n[l]),{chains:yi(a,(e=n[l])==null?void 0:e.chains),methods:yi(c,(t=n[l])==null?void 0:t.methods),events:yi(u,(i=n[l])==null?void 0:i.events)})}return n}function h3(r){let e={};return r?.forEach(t=>{var i;let[n,s]=t.split(":");e[n]||(e[n]={accounts:[],chains:[],events:[],methods:[]}),e[n].accounts.push(t),(i=e[n].chains)==null||i.push(`${n}:${s}`)}),e}function Dl(r,e){e=e.map(i=>i.replace("did:pkh:",""));let t=h3(e);for(let[i,n]of Object.entries(t))n.methods?n.methods=yi(n.methods,r):n.methods=r,n.events=["chainChanged","accountsChanged"];return t}function vy(r,e){var t,i,n,s,o,a;let c=im(r),u=im(e),l={},h=Object.keys(c).concat(Object.keys(u));for(let d of h)l[d]={chains:yi((t=c[d])==null?void 0:t.chains,(i=u[d])==null?void 0:i.chains),methods:yi((n=c[d])==null?void 0:n.methods,(s=u[d])==null?void 0:s.methods),events:yi((o=c[d])==null?void 0:o.events,(a=u[d])==null?void 0:a.events)};return l}var d3={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},f3={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function M(r,e){let{message:t,code:i}=f3[r];return{message:e?`${t} ${e}`:t,code:i}}function he(r,e){let{message:t,code:i}=d3[r];return{message:e?`${t} ${e}`:t,code:i}}function Sr(r,e){return Array.isArray(r)?typeof e<"u"&&r.length?r.every(e):!0:!1}function un(r){return Object.getPrototypeOf(r)===Object.prototype&&Object.keys(r).length}function xe(r){return typeof r>"u"}function we(r,e){return e&&xe(r)?!0:typeof r=="string"&&!!r.trim().length}function Tl(r,e){return e&&xe(r)?!0:typeof r=="number"&&!isNaN(r)}function by(r,e){let{requiredNamespaces:t}=e,i=Object.keys(r.namespaces),n=Object.keys(t),s=!0;return fi(n,i)?(i.forEach(o=>{let{accounts:a,methods:c,events:u}=r.namespaces[o],l=cn(a),h=t[o];(!fi(um(o,h),l)||!fi(h.methods,c)||!fi(h.events,u))&&(s=!1)}),s):!1}function zo(r){return we(r,!1)&&r.includes(":")?r.split(":").length===2:!1}function p3(r){if(we(r,!1)&&r.includes(":")){let e=r.split(":");if(e.length===3){let t=e[0]+":"+e[1];return!!e[2]&&zo(t)}}return!1}function Ey(r){function e(t){try{return typeof new URL(t)<"u"}catch{return!1}}try{if(we(r,!1)){if(e(r))return!0;let t=vm(r);return e(t)}}catch{}return!1}function xy(r){var e;return(e=r?.proposer)==null?void 0:e.publicKey}function _y(r){return r?.topic}function Sy(r,e){let t=null;return we(r?.publicKey,!1)||(t=M("MISSING_OR_INVALID",`${e} controller public key should be a string`)),t}function nm(r){let e=!0;return Sr(r)?r.length&&(e=r.every(t=>we(t,!1))):e=!1,e}function g3(r,e,t){let i=null;return Sr(e)&&e.length?e.forEach(n=>{i||zo(n)||(i=he("UNSUPPORTED_CHAINS",`${t}, chain ${n} should be a string and conform to "namespace:chainId" format`))}):zo(r)||(i=he("UNSUPPORTED_CHAINS",`${t}, chains must be defined as "namespace:chainId" e.g. "eip155:1": {...} in the namespace key OR as an array of CAIP-2 chainIds e.g. eip155: { chains: ["eip155:1", "eip155:5"] }`)),i}function m3(r,e,t){let i=null;return Object.entries(r).forEach(([n,s])=>{if(i)return;let o=g3(n,um(n,s),`${e} ${t}`);o&&(i=o)}),i}function y3(r,e){let t=null;return Sr(r)?r.forEach(i=>{t||p3(i)||(t=he("UNSUPPORTED_ACCOUNTS",`${e}, account ${i} should be a string and conform to "namespace:chainId:address" format`))}):t=he("UNSUPPORTED_ACCOUNTS",`${e}, accounts should be an array of strings conforming to "namespace:chainId:address" format`),t}function w3(r,e){let t=null;return Object.values(r).forEach(i=>{if(t)return;let n=y3(i?.accounts,`${e} namespace`);n&&(t=n)}),t}function v3(r,e){let t=null;return nm(r?.methods)?nm(r?.events)||(t=he("UNSUPPORTED_EVENTS",`${e}, events should be an array of strings or empty array for no events`)):t=he("UNSUPPORTED_METHODS",`${e}, methods should be an array of strings or empty array for no methods`),t}function Iy(r,e){let t=null;return Object.values(r).forEach(i=>{if(t)return;let n=v3(i,`${e}, namespace`);n&&(t=n)}),t}function Ay(r,e,t){let i=null;if(r&&un(r)){let n=Iy(r,e);n&&(i=n);let s=m3(r,e,t);s&&(i=s)}else i=M("MISSING_OR_INVALID",`${e}, ${t} should be an object with data`);return i}function ta(r,e){let t=null;if(r&&un(r)){let i=Iy(r,e);i&&(t=i);let n=w3(r,e);n&&(t=n)}else t=M("MISSING_OR_INVALID",`${e}, namespaces should be an object with data`);return t}function Cl(r){return we(r.protocol,!0)}function Dy(r,e){let t=!1;return e&&!r?t=!0:r&&Sr(r)&&r.length&&r.forEach(i=>{t=Cl(i)}),t}function Ty(r){return typeof r=="number"}function rt(r){return typeof r<"u"&&typeof r!==null}function Cy(r){return!(!r||typeof r!="object"||!r.code||!Tl(r.code,!1)||!r.message||!we(r.message,!1))}function Oy(r){return!(xe(r)||!we(r.method,!1))}function Ry(r){return!(xe(r)||xe(r.result)&&xe(r.error)||!Tl(r.id,!1)||!we(r.jsonrpc,!1))}function Ny(r){return!(xe(r)||!we(r.name,!1))}function Ol(r,e){return!(!zo(e)||!a3(r).includes(e))}function Py(r,e,t){return we(t,!1)?c3(r,e).includes(t):!1}function Fy(r,e,t){return we(t,!1)?u3(r,e).includes(t):!1}function Rl(r,e,t){let i=null,n=b3(r),s=E3(e),o=Object.keys(n),a=Object.keys(s),c=sm(Object.keys(r)),u=sm(Object.keys(e)),l=c.filter(h=>!u.includes(h));return l.length&&(i=M("NON_CONFORMING_NAMESPACES",`${t} namespaces keys don't satisfy requiredNamespaces.
      Required: ${l.toString()}
      Received: ${Object.keys(e).toString()}`)),fi(o,a)||(i=M("NON_CONFORMING_NAMESPACES",`${t} namespaces chains don't satisfy required namespaces.
      Required: ${o.toString()}
      Approved: ${a.toString()}`)),Object.keys(e).forEach(h=>{if(!h.includes(":")||i)return;let d=cn(e[h].accounts);d.includes(h)||(i=M("NON_CONFORMING_NAMESPACES",`${t} namespaces accounts don't satisfy namespace accounts for ${h}
        Required: ${h}
        Approved: ${d.toString()}`))}),o.forEach(h=>{i||(fi(n[h].methods,s[h].methods)?fi(n[h].events,s[h].events)||(i=M("NON_CONFORMING_NAMESPACES",`${t} namespaces events don't satisfy namespace events for ${h}`)):i=M("NON_CONFORMING_NAMESPACES",`${t} namespaces methods don't satisfy namespace methods for ${h}`))}),i}function b3(r){let e={};return Object.keys(r).forEach(t=>{var i;t.includes(":")?e[t]=r[t]:(i=r[t].chains)==null||i.forEach(n=>{e[n]={methods:r[t].methods,events:r[t].events}})}),e}function sm(r){return[...new Set(r.map(e=>e.includes(":")?e.split(":")[0]:e))]}function E3(r){let e={};return Object.keys(r).forEach(t=>{t.includes(":")?e[t]=r[t]:cn(r[t].accounts)?.forEach(n=>{e[n]={accounts:r[t].accounts.filter(s=>s.includes(`${n}:`)),methods:r[t].methods,events:r[t].events}})}),e}function By(r,e){return Tl(r,!1)&&r<=e.max&&r>=e.min}function Nl(){let r=ns();return new Promise(e=>{switch(r){case wt.browser:e(x3());break;case wt.reactNative:e(_3());break;case wt.node:e(S3());break;default:e(!0)}})}function x3(){return vi()&&navigator?.onLine}async function _3(){return Er()&&typeof global<"u"&&global!=null&&global.NetInfo?(await(global==null?void 0:global.NetInfo.fetch()))?.isConnected:!0}function S3(){return!0}function Uy(r){switch(ns()){case wt.browser:I3(r);break;case wt.reactNative:A3(r);break;case wt.node:break}}function I3(r){!Er()&&vi()&&(window.addEventListener("online",()=>r(!0)),window.addEventListener("offline",()=>r(!1)))}function A3(r){Er()&&typeof global<"u"&&global!=null&&global.NetInfo&&global?.NetInfo.addEventListener(e=>r(e?.isConnected))}function ky(){var r;return vi()&&(0,$t.getDocument)()?((r=(0,$t.getDocument)())==null?void 0:r.visibilityState)==="visible":!0}var Bu={},Gr=class{static get(e){return Bu[e]}static set(e,t){Bu[e]=t}static delete(e){delete Bu[e]}};function D3(r){let e=Vi.decode(r);if(e.length<33)throw new Error("Too short to contain a public key");return e.slice(1,33)}function T3({publicKey:r,signature:e,payload:t}){var i;let n=Zu(t.method),s=128|parseInt(((i=t.version)==null?void 0:i.toString())||"4"),o=R3(t.address),a=t.era==="00"?new Uint8Array([0]):Zu(t.era);if(a.length!==1&&a.length!==2)throw new Error("Invalid era length");let c=parseInt(t.nonce,16),u=new Uint8Array([c&255,c>>8&255]),l=BigInt(`0x${O3(t.tip)}`),h=P3(l),d=new Uint8Array([0,...r,o,...e,...a,...u,...h,...n]),p=N3(d.length+1);return new Uint8Array([...p,s,...d])}function C3(r){let e=Zu(r),t=(0,am.blake2b)(e,void 0,32);return"0x"+Buffer.from(t).toString("hex")}function Zu(r){return new Uint8Array(r.replace(/^0x/,"").match(/.{1,2}/g).map(e=>parseInt(e,16)))}function O3(r){return r.startsWith("0x")?r.slice(2):r}function R3(r){let e=Vi.decode(r)[0];return e===42?0:e===60?2:1}function N3(r){if(r<64)return new Uint8Array([r<<2]);if(r<16384){let e=r<<2|1;return new Uint8Array([e&255,e>>8&255])}else if(r<1<<30){let e=r<<2|2;return new Uint8Array([e&255,e>>8&255,e>>16&255,e>>24&255])}else throw new Error("Compact encoding > 2^30 not supported")}function P3(r){if(r<BigInt(1)<<BigInt(6))return new Uint8Array([Number(r<<BigInt(2))]);if(r<BigInt(1)<<BigInt(14)){let e=r<<BigInt(2)|BigInt(1);return new Uint8Array([Number(e&BigInt(255)),Number(e>>BigInt(8)&BigInt(255))])}else if(r<BigInt(1)<<BigInt(30)){let e=r<<BigInt(2)|BigInt(2);return new Uint8Array([Number(e&BigInt(255)),Number(e>>BigInt(8)&BigInt(255)),Number(e>>BigInt(16)&BigInt(255)),Number(e>>BigInt(24)&BigInt(255))])}else throw new Error("BigInt compact encoding not supported > 2^30")}function Ly(r){let e=Uint8Array.from(Buffer.from(r.signature,"hex")),t=D3(r.transaction.address),i=T3({publicKey:t,signature:e,payload:r.transaction}),n=Buffer.from(i).toString("hex");return C3(n)}async function My(r){if(r.session.length){let e=r.session.keys.length-1;return r.session.get(r.session.keys[e])}return null}function F3(){return/Mobi|Android|iPhone|iPad|iPod|Opera Mini|IEMobile|WPDesktop/i.test(window.navigator.userAgent)}function B3(r){return r.startsWith("solana:")}async function Yr(r,e,t,i){let n=await My(r);if(!n)throw si.disconnected();return typeof window<"u"&&F3()&&n.peer.metadata.redirect&&n.peer.metadata.redirect.native&&window.open(n.peer.metadata.redirect.native,"_blank"),r.request({topic:n.topic,chainId:e,request:{method:t,params:B3(e)?Z(Z({},i),{},{pubkey:n.self.publicKey}):i}})}async function Ei(r){let e=await My(r);if(!e)throw si.disconnected();let t=Vo(e.namespaces);if(t&&t.length)return[...new Set(t.map(i=>jo(i).address))];throw It.connectionError("Failed to get accounts")}function qy({connector:r,chainId:e}){return{getPrivateKey:async()=>{throw Te.methodNotSupported()},getPublicKey:async()=>{throw Te.methodNotSupported()},getAccounts:async t=>Ei(r),processTransaction:async(t,i)=>await Yr(r,`eip155:${e}`,Tr.ETH_TRANSACTION,[t]),processSignTransaction:async(t,i)=>await Yr(r,`eip155:${e}`,"eth_signTransaction",[t]),processEthSignMessage:async(t,i)=>await Yr(r,`eip155:${e}`,Tr.ETH_SIGN,[t.from,t.data]),processPersonalMessage:async(t,i)=>await Yr(r,`eip155:${e}`,Tr.PERSONAL_SIGN,[t.data,t.from]),processTypedMessageV4:async t=>await Yr(r,`eip155:${e}`,Tr.ETH_SIGN_TYPED_DATA_V4,[t.from,t.data])}}function zy({connector:r,chainId:e}){return{requestAccounts:async t=>Ei(r),getPrivateKey:async()=>{throw Te.methodNotSupported()},getSecretKey:async()=>{throw Te.methodNotSupported()},getPublicKey:async()=>{throw Te.methodNotSupported()},getAccounts:async t=>Ei(r),signAllTransactions:async t=>{throw Te.methodNotSupported()},signAndSendTransaction:async t=>{throw Te.methodNotSupported()},signMessage:async t=>(await Yr(r,`solana:${_n[e]}`,ki.SIGN_MESSAGE,{message:Ad.encode(Buffer.from(t.params.data,"utf-8"))})).signature,signTransaction:async t=>{if((await Ei(r)).length===0)throw si.disconnected();return(await Yr(r,`solana:${_n[e]}`,ki.SIGN_TRANSACTION,{transaction:t.params.message})).signature}}}async function jy({connector:r,chainId:e,newChainId:t}){await Yr(r,`eip155:${e}`,"wallet_switchEthereumChain",[{chainId:t}])}function Vy({getAccounts:r,getPrivateKey:e,getPublicKey:t,processEthSignMessage:i,processPersonalMessage:n,processTransaction:s,processSignTransaction:o,processTypedMessageV4:a}){if(!r)throw new Error("opts.getAccounts is required");async function c(w,v){if(typeof w=="string"&&w.length>0){let S=(await r(v)).map(C=>C.toLowerCase()),E=w.toLowerCase();if(S.includes(E))return E}throw Te.invalidParams({message:"Invalid parameters: must provide an Ethereum address."})}async function u(w,v){v.result=await r(w)}async function l(w,v){if(!s)throw Te.methodNotSupported();let y=w.params[0]||{from:""};y.from=await c(y.from,w),v.result=await s(y,w)}async function h(w,v){if(!o)throw Te.methodNotSupported();let y=w.params[0]||{from:""};y.from=await c(y.from,w),v.result=await o(y,w)}async function d(w,v){if(!i)throw Te.methodNotSupported();let y=w.params,S=w.params[2]||{};if(Array.isArray(w.params)){if(w.params.length!==2)throw new Error(`WalletMiddleware - incorrect params for ${w.method} method. expected [address, message]`);let E=w.params,C=E[0],R=E[1];y={from:C,data:R}}y=Z(Z({},S),y),v.result=await i(y,w)}async function p(w,v){if(!a)throw Te.methodNotSupported();if(!(w!=null&&w.params))throw new Error("WalletMiddleware - missing params");let y=w.params;if(Array.isArray(w.params)){if(w.params.length!==2)throw new Error(`WalletMiddleware - incorrect params for ${w.method} method. expected [address, typedData]`);let S=w.params,E=S[0],C=S[1];y={from:E,data:C}}v.result=await a(y,w)}async function f(w,v){if(!n)throw Te.methodNotSupported();let y=w.params,S=w.params[2]||{};if(Array.isArray(w.params)){if(!(w.params.length>=2))throw new Error(`WalletMiddleware - incorrect params for ${w.method} method. expected [message, address]`);let E=w.params;if(typeof E[0]=="object"){let{challenge:C,address:R}=E[0];y={from:R,data:C}}else{let C=E[0];y={from:E[1],data:C}}}y=Z(Z({},S),y),v.result=await n(y,w)}async function g(w,v){if(!e)throw Te.methodNotSupported();v.result=await e(w)}async function m(w,v){if(!t)throw Te.methodNotSupported();v.result=await t(w)}return xn({eth_accounts:dt(u),eth_requestAccounts:dt(u),eth_private_key:dt(g),eth_public_key:dt(m),public_key:dt(m),private_key:dt(g),eth_sendTransaction:dt(l),eth_signTransaction:dt(h),eth_sign:dt(d),eth_signTypedData_v4:dt(p),personal_sign:dt(f)})}function $y(r){let{getAccounts:e,getPrivateKey:t,getPublicKey:i,processTransaction:n,processSignTransaction:s,processEthSignMessage:o,processTypedMessageV4:a,processPersonalMessage:c}=r;return ks([xn({eth_syncing:!1}),Vy({getAccounts:e,getPrivateKey:t,getPublicKey:i,processTransaction:n,processEthSignMessage:o,processSignTransaction:s,processTypedMessageV4:a,processPersonalMessage:c})])}function Ky({switchChain:r}){async function e(t,i){var n;let s=(n=t.params)!==null&&n!==void 0&&n.length?t.params[0]:void 0;if(!s)throw Te.invalidParams("Missing chainId");i.result=await r(s)}return xn({wallet_switchEthereumChain:dt(e)})}function U3(r){return(e,t,i,n)=>e.method==="eth_chainId"?(t.result=r,n()):i()}function k3(r){return(e,t,i,n)=>e.method==="eth_provider_config"?(t.result=r,n()):i()}function Hy(r){let{chainId:e,rpcTarget:t}=r,i=Td({rpcTarget:t});return{networkMiddleware:ks([U3(e),k3(r),i]),fetchMiddleware:i}}var Wy,xi=class extends Gd{constructor({config:e,state:t,connector:i}){super({config:{chain:e.chain,chains:e.chains,skipLookupNetwork:!!e.skipLookupNetwork},state:Z(Z({},t||{}),{},{chainId:"loading",accounts:[]})}),De(this,"connector",null),this.connector=i||null}async enable(){if(!this.connector)throw si.custom({message:"Connector is not initialized, pass wallet connect connector in constructor",code:4902});return await this.setupProvider(this.connector),this._providerEngineProxy.request({method:"eth_accounts"})}async setupProvider(e){this.onConnectorStateUpdate(e),await this.setupEngine(e,this.config.chain.chainId)}async switchChain({chainId:e}){if(!this.connector)throw si.custom({message:"Connector is not initialized, pass wallet connect connector in constructor",code:4902});let t=this.getChain(e),{chainId:i}=t,n=parseInt(i,16);await jy({connector:this.connector,chainId:n,newChainId:e}),await this.setupEngine(this.connector,e),this.lookupNetwork(this.connector,e),this.update({chainId:e})}async lookupNetwork(e,t){return t}async setupEngine(e,t){let i=this.getChain(t);if(i.chainNamespace===ke.EIP155)await this.setupEthEngine(e,t);else if(i.chainNamespace===ke.SOLANA)await this.setupSolEngine(e,t);else throw new Error(`Unsupported chainNamespace: ${i.chainNamespace}`);this.emit("chainChanged",t),this.emit("connect",{chainId:t}),this.update({chainId:t})}async setupEthEngine(e,t){let i=this.getChain(t),n=parseInt(t,16),s=qy({connector:e,chainId:n}),o=await Ei(e);this.update({accounts:o||[]});let a=$y(s),c=this.getEthChainSwitchMiddleware(),u=new ic,{networkMiddleware:l}=Hy(i);u.push(a),u.push(c),u.push(l);let h=nc(u);this.updateProviderEngineProxy(h)}async setupSolEngine(e,t){let i=this.getChain(t),n=zy({connector:e,chainId:t}),s=await Ei(e);this.update({accounts:s||[]});let o=rf(n),a=new ic,{networkMiddleware:c}=tf(i);a.push(o),a.push(c);let u=nc(a);this.updateProviderEngineProxy(u)}getEthChainSwitchMiddleware(){return Ky({switchChain:async i=>{let{chainId:n}=i;await this.switchChain({chainId:n})}})}connectedTopic(){var e;if(!this.connector)throw It.notConnectedError("Wallet connect connector is not connected");if((e=this.connector)!==null&&e!==void 0&&(e=e.session)!==null&&e!==void 0&&e.length){var t;let i=this.connector.session.keys.length-1;return(t=this.connector.session.get(this.connector.session.keys[i]))===null||t===void 0?void 0:t.topic}}checkIfAccountAllowed(e){if(!this.connector||!this.connectedTopic())return!1;let t=this.connector.session.get(this.connectedTopic()),i=Vo(t.namespaces),n=!1;for(let o of i){var s;if(((s=jo(o).address)===null||s===void 0?void 0:s.toLowerCase())===e?.toLowerCase()){n=!0;break}}return n}async onConnectorStateUpdate(e){e.events.on("session_event",async t=>{if(Ie.debug("session_event data",t),!this.provider)throw It.notConnectedError("Wallet connect connector is not connected");let{event:i}=t.params,{name:n,data:s}=i||{};if(n==="accountsChanged"&&s!==null&&s!==void 0&&s.length&&this.state.accounts[0]!==s[0]&&this.checkIfAccountAllowed(s[0])&&(this.update({accounts:s}),this.emit("accountsChanged",s)),i.name==="chainChanged"){if(!s)return;let a=`0x${s.toString(16)}`,{currentChain:c}=this;a&&c.chainId!==a&&await this.setupEngine(e,a)}})}};Wy=xi;De(xi,"getProviderInstance",async r=>{let e=new Wy({config:{chain:r.chain,chains:r.chains,skipLookupNetwork:r.skipLookupNetwork}});return await e.setupProvider(r.connector),e});var Ar=Se(Ri());var Yy=Se(Ri()),ia=Se(zi());var Wt=class{};var Pl=class extends Wt{constructor(e){super()}},Gy=ia.FIVE_SECONDS,Jr={pulse:"heartbeat_pulse"},ra=class r extends Pl{constructor(e){super(e),this.events=new Yy.EventEmitter,this.interval=Gy,this.interval=e?.interval||Gy}static async init(e){let t=new r(e);return await t.init(),t}async init(){await this.initialize()}stop(){clearInterval(this.intervalRef)}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}async initialize(){this.intervalRef=setInterval(()=>this.pulse(),(0,ia.toMiliseconds)(this.interval))}pulse(){this.events.emit(Jr.pulse)}};var L3=/"(?:_|\\u0{2}5[Ff]){2}(?:p|\\u0{2}70)(?:r|\\u0{2}72)(?:o|\\u0{2}6[Ff])(?:t|\\u0{2}74)(?:o|\\u0{2}6[Ff])(?:_|\\u0{2}5[Ff]){2}"\s*:/,M3=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/,q3=/^\s*["[{]|^\s*-?\d{1,16}(\.\d{1,17})?([Ee][+-]?\d+)?\s*$/;function z3(r,e){if(r==="__proto__"||r==="constructor"&&e&&typeof e=="object"&&"prototype"in e){return}return e}function ds(r,e={}){if(typeof r!="string")return r;if(r[0]==='"'&&r[r.length-1]==='"'&&r.indexOf("\\")===-1)return r.slice(1,-1);let t=r.trim();if(t.length<=9)switch(t.toLowerCase()){case"true":return!0;case"false":return!1;case"undefined":return;case"null":return null;case"nan":return Number.NaN;case"infinity":return Number.POSITIVE_INFINITY;case"-infinity":return Number.NEGATIVE_INFINITY}if(!q3.test(r)){if(e.strict)throw new SyntaxError("[destr] Invalid JSON");return r}try{if(L3.test(r)||M3.test(r)){if(e.strict)throw new Error("[destr] Possible prototype pollution");return JSON.parse(r,z3)}return JSON.parse(r)}catch(i){if(e.strict)throw i;return r}}function j3(r){return!r||typeof r.then!="function"?Promise.resolve(r):r}function Re(r,...e){try{return j3(r(...e))}catch(t){return Promise.reject(t)}}function V3(r){let e=typeof r;return r===null||e!=="object"&&e!=="function"}function $3(r){let e=Object.getPrototypeOf(r);return!e||e.isPrototypeOf(Object)}function fs(r){if(V3(r))return String(r);if($3(r)||Array.isArray(r))return JSON.stringify(r);if(typeof r.toJSON=="function")return fs(r.toJSON());throw new Error("[unstorage] Cannot stringify value!")}var Fl="base64:";function Jy(r){return typeof r=="string"?r:Fl+H3(r)}function Xy(r){return typeof r!="string"||!r.startsWith(Fl)?r:K3(r.slice(Fl.length))}function K3(r){return globalThis.Buffer?Buffer.from(r,"base64"):Uint8Array.from(globalThis.atob(r),e=>e.codePointAt(0))}function H3(r){return globalThis.Buffer?Buffer.from(r).toString("base64"):globalThis.btoa(String.fromCodePoint(...r))}function lt(r){return r&&r.split("?")[0]?.replace(/[/\\]/g,":").replace(/:+/g,":").replace(/^:|:$/g,"")||""}function Qy(...r){return lt(r.join(":"))}function ps(r){return r=lt(r),r?r+":":""}function Zy(r,e){if(e===void 0)return!0;let t=0,i=r.indexOf(":");for(;i>-1;)t++,i=r.indexOf(":",i+1);return t<=e}function e0(r,e){return e?r.startsWith(e)&&r[r.length-1]!=="$":r[r.length-1]!=="$"}var W3="memory",G3=()=>{let r=new Map;return{name:W3,getInstance:()=>r,hasItem(e){return r.has(e)},getItem(e){return r.get(e)??null},getItemRaw(e){return r.get(e)??null},setItem(e,t){r.set(e,t)},setItemRaw(e,t){r.set(e,t)},removeItem(e){r.delete(e)},getKeys(){return[...r.keys()]},clear(){r.clear()},dispose(){r.clear()}}};function i0(r={}){let e={mounts:{"":r.driver||G3()},mountpoints:[""],watching:!1,watchListeners:[],unwatch:{}},t=u=>{for(let l of e.mountpoints)if(u.startsWith(l))return{base:l,relativeKey:u.slice(l.length),driver:e.mounts[l]};return{base:"",relativeKey:u,driver:e.mounts[""]}},i=(u,l)=>e.mountpoints.filter(h=>h.startsWith(u)||l&&u.startsWith(h)).map(h=>({relativeBase:u.length>h.length?u.slice(h.length):void 0,mountpoint:h,driver:e.mounts[h]})),n=(u,l)=>{if(e.watching){l=lt(l);for(let h of e.watchListeners)h(u,l)}},s=async()=>{if(!e.watching){e.watching=!0;for(let u in e.mounts)e.unwatch[u]=await t0(e.mounts[u],n,u)}},o=async()=>{if(e.watching){for(let u in e.unwatch)await e.unwatch[u]();e.unwatch={},e.watching=!1}},a=(u,l,h)=>{let d=new Map,p=f=>{let g=d.get(f.base);return g||(g={driver:f.driver,base:f.base,items:[]},d.set(f.base,g)),g};for(let f of u){let g=typeof f=="string",m=lt(g?f:f.key),w=g?void 0:f.value,v=g||!f.options?l:{...l,...f.options},y=t(m);p(y).items.push({key:m,value:w,relativeKey:y.relativeKey,options:v})}return Promise.all([...d.values()].map(f=>h(f))).then(f=>f.flat())},c={hasItem(u,l={}){u=lt(u);let{relativeKey:h,driver:d}=t(u);return Re(d.hasItem,h,l)},getItem(u,l={}){u=lt(u);let{relativeKey:h,driver:d}=t(u);return Re(d.getItem,h,l).then(p=>ds(p))},getItems(u,l={}){return a(u,l,h=>h.driver.getItems?Re(h.driver.getItems,h.items.map(d=>({key:d.relativeKey,options:d.options})),l).then(d=>d.map(p=>({key:Qy(h.base,p.key),value:ds(p.value)}))):Promise.all(h.items.map(d=>Re(h.driver.getItem,d.relativeKey,d.options).then(p=>({key:d.key,value:ds(p)})))))},getItemRaw(u,l={}){u=lt(u);let{relativeKey:h,driver:d}=t(u);return d.getItemRaw?Re(d.getItemRaw,h,l):Re(d.getItem,h,l).then(p=>Xy(p))},async setItem(u,l,h={}){if(l===void 0)return c.removeItem(u);u=lt(u);let{relativeKey:d,driver:p}=t(u);p.setItem&&(await Re(p.setItem,d,fs(l),h),p.watch||n("update",u))},async setItems(u,l){await a(u,l,async h=>{if(h.driver.setItems)return Re(h.driver.setItems,h.items.map(d=>({key:d.relativeKey,value:fs(d.value),options:d.options})),l);h.driver.setItem&&await Promise.all(h.items.map(d=>Re(h.driver.setItem,d.relativeKey,fs(d.value),d.options)))})},async setItemRaw(u,l,h={}){if(l===void 0)return c.removeItem(u,h);u=lt(u);let{relativeKey:d,driver:p}=t(u);if(p.setItemRaw)await Re(p.setItemRaw,d,l,h);else if(p.setItem)await Re(p.setItem,d,Jy(l),h);else return;p.watch||n("update",u)},async removeItem(u,l={}){typeof l=="boolean"&&(l={removeMeta:l}),u=lt(u);let{relativeKey:h,driver:d}=t(u);d.removeItem&&(await Re(d.removeItem,h,l),(l.removeMeta||l.removeMata)&&await Re(d.removeItem,h+"$",l),d.watch||n("remove",u))},async getMeta(u,l={}){typeof l=="boolean"&&(l={nativeOnly:l}),u=lt(u);let{relativeKey:h,driver:d}=t(u),p=Object.create(null);if(d.getMeta&&Object.assign(p,await Re(d.getMeta,h,l)),!l.nativeOnly){let f=await Re(d.getItem,h+"$",l).then(g=>ds(g));f&&typeof f=="object"&&(typeof f.atime=="string"&&(f.atime=new Date(f.atime)),typeof f.mtime=="string"&&(f.mtime=new Date(f.mtime)),Object.assign(p,f))}return p},setMeta(u,l,h={}){return this.setItem(u+"$",l,h)},removeMeta(u,l={}){return this.removeItem(u+"$",l)},async getKeys(u,l={}){u=ps(u);let h=i(u,!0),d=[],p=[],f=!0;for(let m of h){m.driver.flags?.maxDepth||(f=!1);let w=await Re(m.driver.getKeys,m.relativeBase,l);for(let v of w){let y=m.mountpoint+lt(v);d.some(S=>y.startsWith(S))||p.push(y)}d=[m.mountpoint,...d.filter(v=>!v.startsWith(m.mountpoint))]}let g=l.maxDepth!==void 0&&!f;return p.filter(m=>(!g||Zy(m,l.maxDepth))&&e0(m,u))},async clear(u,l={}){u=ps(u),await Promise.all(i(u,!1).map(async h=>{if(h.driver.clear)return Re(h.driver.clear,h.relativeBase,l);if(h.driver.removeItem){let d=await h.driver.getKeys(h.relativeBase||"",l);return Promise.all(d.map(p=>h.driver.removeItem(p,l)))}}))},async dispose(){await Promise.all(Object.values(e.mounts).map(u=>r0(u)))},async watch(u){return await s(),e.watchListeners.push(u),async()=>{e.watchListeners=e.watchListeners.filter(l=>l!==u),e.watchListeners.length===0&&await o()}},async unwatch(){e.watchListeners=[],await o()},mount(u,l){if(u=ps(u),u&&e.mounts[u])throw new Error(`already mounted at ${u}`);return u&&(e.mountpoints.push(u),e.mountpoints.sort((h,d)=>d.length-h.length)),e.mounts[u]=l,e.watching&&Promise.resolve(t0(l,n,u)).then(h=>{e.unwatch[u]=h}).catch(console.error),c},async unmount(u,l=!0){u=ps(u),!(!u||!e.mounts[u])&&(e.watching&&u in e.unwatch&&(e.unwatch[u]?.(),delete e.unwatch[u]),l&&await r0(e.mounts[u]),e.mountpoints=e.mountpoints.filter(h=>h!==u),delete e.mounts[u])},getMount(u=""){u=lt(u)+":";let l=t(u);return{driver:l.driver,base:l.base}},getMounts(u="",l={}){return u=lt(u),i(u,l.parents).map(d=>({driver:d.driver,base:d.mountpoint}))},keys:(u,l={})=>c.getKeys(u,l),get:(u,l={})=>c.getItem(u,l),set:(u,l,h={})=>c.setItem(u,l,h),has:(u,l={})=>c.hasItem(u,l),del:(u,l={})=>c.removeItem(u,l),remove:(u,l={})=>c.removeItem(u,l)};return c}function t0(r,e,t){return r.watch?r.watch((i,n)=>e(i,t+n)):()=>{}}async function r0(r){typeof r.dispose=="function"&&await Re(r.dispose)}function _i(r){return new Promise((e,t)=>{r.oncomplete=r.onsuccess=()=>e(r.result),r.onabort=r.onerror=()=>t(r.error)})}function Ul(r,e){let t,i=()=>{if(t)return t;let n=indexedDB.open(r);return n.onupgradeneeded=()=>n.result.createObjectStore(e),t=_i(n),t.then(s=>{s.onclose=()=>t=void 0},()=>{}),t};return(n,s)=>i().then(o=>s(o.transaction(e,n).objectStore(e)))}var Bl;function gs(){return Bl||(Bl=Ul("keyval-store","keyval")),Bl}function kl(r,e=gs()){return e("readonly",t=>_i(t.get(r)))}function n0(r,e,t=gs()){return t("readwrite",i=>(i.put(e,r),_i(i.transaction)))}function s0(r,e=gs()){return e("readwrite",t=>(t.delete(r),_i(t.transaction)))}function o0(r=gs()){return r("readwrite",e=>(e.clear(),_i(e.transaction)))}function Y3(r,e){return r.openCursor().onsuccess=function(){this.result&&(e(this.result),this.result.continue())},_i(r.transaction)}function a0(r=gs()){return r("readonly",e=>{if(e.getAllKeys)return _i(e.getAllKeys());let t=[];return Y3(e,i=>t.push(i.key)).then(()=>t)})}var J3="idb-keyval",X3=(r={})=>{let e=r.base&&r.base.length>0?`${r.base}:`:"",t=n=>e+n,i;return r.dbName&&r.storeName&&(i=Ul(r.dbName,r.storeName)),{name:J3,options:r,async hasItem(n){return!(typeof await kl(t(n),i)>"u")},async getItem(n){return await kl(t(n),i)??null},setItem(n,s){return n0(t(n),s,i)},removeItem(n){return s0(t(n),i)},getKeys(){return a0(i)},clear(){return o0(i)}}},Q3="WALLET_CONNECT_V2_INDEXED_DB",Z3="keyvaluestorage",Ml=class{constructor(){this.indexedDb=i0({driver:X3({dbName:Q3,storeName:Z3})})}async getKeys(){return this.indexedDb.getKeys()}async getEntries(){return(await this.indexedDb.getItems(await this.indexedDb.getKeys())).map(e=>[e.key,e.value])}async getItem(e){let t=await this.indexedDb.getItem(e);if(t!==null)return t}async setItem(e,t){await this.indexedDb.setItem(e,Rt(t))}async removeItem(e){await this.indexedDb.removeItem(e)}},Ll=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},na={exports:{}};(function(){let r;function e(){}r=e,r.prototype.getItem=function(t){return this.hasOwnProperty(t)?String(this[t]):null},r.prototype.setItem=function(t,i){this[t]=String(i)},r.prototype.removeItem=function(t){delete this[t]},r.prototype.clear=function(){let t=this;Object.keys(t).forEach(function(i){t[i]=void 0,delete t[i]})},r.prototype.key=function(t){return t=t||0,Object.keys(this)[t]},r.prototype.__defineGetter__("length",function(){return Object.keys(this).length}),typeof Ll<"u"&&Ll.localStorage?na.exports=Ll.localStorage:typeof window<"u"&&window.localStorage?na.exports=window.localStorage:na.exports=new e})();function eA(r){var e;return[r[0],Zt((e=r[1])!=null?e:"")]}var ql=class{constructor(){this.localStorage=na.exports}async getKeys(){return Object.keys(this.localStorage)}async getEntries(){return Object.entries(this.localStorage).map(eA)}async getItem(e){let t=this.localStorage.getItem(e);if(t!==null)return Zt(t)}async setItem(e,t){this.localStorage.setItem(e,Rt(t))}async removeItem(e){this.localStorage.removeItem(e)}},tA="wc_storage_version",c0=1,rA=async(r,e,t)=>{let i=tA,n=await e.getItem(i);if(n&&n>=c0){t(e);return}let s=await r.getKeys();if(!s.length){t(e);return}let o=[];for(;s.length;){let a=s.shift();if(!a)continue;let c=a.toLowerCase();if(c.includes("wc@")||c.includes("walletconnect")||c.includes("wc_")||c.includes("wallet_connect")){let u=await r.getItem(a);await e.setItem(a,u),o.push(a)}}await e.setItem(i,c0),t(e),iA(r,o)},iA=async(r,e)=>{e.length&&e.forEach(async t=>{await r.removeItem(t)})},sa=class{constructor(){this.initialized=!1,this.setInitialized=t=>{this.storage=t,this.initialized=!0};let e=new ql;this.storage=e;try{let t=new Ml;rA(e,t,this.setInitialized)}catch{this.initialized=!0}}async getKeys(){return await this.initialize(),this.storage.getKeys()}async getEntries(){return await this.initialize(),this.storage.getEntries()}async getItem(e){return await this.initialize(),this.storage.getItem(e)}async setItem(e,t){return await this.initialize(),this.storage.setItem(e,t)}async removeItem(e){return await this.initialize(),this.storage.removeItem(e)}async initialize(){this.initialized||await new Promise(e=>{let t=setInterval(()=>{this.initialized&&(clearInterval(t),e())},20)})}};var Ir=Se(Vl()),ws=Se(Vl());var mA={level:"info"},vs="custom_context",Wl=1e3*1024,$l=class{constructor(e){this.nodeValue=e,this.sizeInBytes=new TextEncoder().encode(this.nodeValue).length,this.next=null}get value(){return this.nodeValue}get size(){return this.sizeInBytes}},ca=class{constructor(e){this.head=null,this.tail=null,this.lengthInNodes=0,this.maxSizeInBytes=e,this.sizeInBytes=0}append(e){let t=new $l(e);if(t.size>this.maxSizeInBytes)throw new Error(`[LinkedList] Value too big to insert into list: ${e} with size ${t.size}`);for(;this.size+t.size>this.maxSizeInBytes;)this.shift();this.head?(this.tail&&(this.tail.next=t),this.tail=t):(this.head=t,this.tail=t),this.lengthInNodes++,this.sizeInBytes+=t.size}shift(){if(!this.head)return;let e=this.head;this.head=this.head.next,this.head||(this.tail=null),this.lengthInNodes--,this.sizeInBytes-=e.size}toArray(){let e=[],t=this.head;for(;t!==null;)e.push(t.value),t=t.next;return e}get length(){return this.lengthInNodes}get size(){return this.sizeInBytes}toOrderedArray(){return Array.from(this)}[Symbol.iterator](){let e=this.head;return{next:()=>{if(!e)return{done:!0,value:null};let t=e.value;return e=e.next,{done:!1,value:t}}}}},ua=class{constructor(e,t=Wl){this.level=e??"error",this.levelValue=Ir.levels.values[this.level],this.MAX_LOG_SIZE_IN_BYTES=t,this.logs=new ca(this.MAX_LOG_SIZE_IN_BYTES)}forwardToConsole(e,t){t===Ir.levels.values.error||t===Ir.levels.values.warn||t===Ir.levels.values.debug||Ir.levels.values.trace}appendToLogs(e){this.logs.append(Rt({timestamp:new Date().toISOString(),log:e}));let t=typeof e=="string"?JSON.parse(e).level:e.level;t>=this.levelValue&&this.forwardToConsole(e,t)}getLogs(){return this.logs}clearLogs(){this.logs=new ca(this.MAX_LOG_SIZE_IN_BYTES)}getLogArray(){return Array.from(this.logs)}logsToBlob(e){let t=this.getLogArray();return t.push(Rt({extraMetadata:e})),new Blob(t,{type:"application/json"})}},Kl=class{constructor(e,t=Wl){this.baseChunkLogger=new ua(e,t)}write(e){this.baseChunkLogger.appendToLogs(e)}getLogs(){return this.baseChunkLogger.getLogs()}clearLogs(){this.baseChunkLogger.clearLogs()}getLogArray(){return this.baseChunkLogger.getLogArray()}logsToBlob(e){return this.baseChunkLogger.logsToBlob(e)}downloadLogsBlobInBrowser(e){let t=URL.createObjectURL(this.logsToBlob(e)),i=document.createElement("a");i.href=t,i.download=`walletconnect-logs-${new Date().toISOString()}.txt`,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(t)}},Hl=class{constructor(e,t=Wl){this.baseChunkLogger=new ua(e,t)}write(e){this.baseChunkLogger.appendToLogs(e)}getLogs(){return this.baseChunkLogger.getLogs()}clearLogs(){this.baseChunkLogger.clearLogs()}getLogArray(){return this.baseChunkLogger.getLogArray()}logsToBlob(e){return this.baseChunkLogger.logsToBlob(e)}},yA=Object.defineProperty,wA=Object.defineProperties,vA=Object.getOwnPropertyDescriptors,g0=Object.getOwnPropertySymbols,bA=Object.prototype.hasOwnProperty,EA=Object.prototype.propertyIsEnumerable,m0=(r,e,t)=>e in r?yA(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,la=(r,e)=>{for(var t in e||(e={}))bA.call(e,t)&&m0(r,t,e[t]);if(g0)for(var t of g0(e))EA.call(e,t)&&m0(r,t,e[t]);return r},ha=(r,e)=>wA(r,vA(e));function bs(r){return ha(la({},r),{level:r?.level||mA.level})}function xA(r,e=vs){return r[e]||""}function _A(r,e,t=vs){return r[t]=e,r}function it(r,e=vs){let t="";return typeof r.bindings>"u"?t=xA(r,e):t=r.bindings().context||"",t}function SA(r,e,t=vs){let i=it(r,t);return i.trim()?`${i}/${e}`:e}function Ve(r,e,t=vs){let i=SA(r,e,t),n=r.child({context:i});return _A(n,i,t)}function IA(r){var e,t;let i=new Kl((e=r.opts)==null?void 0:e.level,r.maxSizeInBytes);return{logger:(0,Ir.default)(ha(la({},r.opts),{level:"trace",browser:ha(la({},(t=r.opts)==null?void 0:t.browser),{write:n=>i.write(n)})})),chunkLoggerController:i}}function AA(r){var e;let t=new Hl((e=r.opts)==null?void 0:e.level,r.maxSizeInBytes);return{logger:(0,Ir.default)(ha(la({},r.opts),{level:"trace"}),t),chunkLoggerController:t}}function y0(r){return typeof r.loggerOverride<"u"&&typeof r.loggerOverride!="string"?{logger:r.loggerOverride,chunkLoggerController:null}:typeof window<"u"?IA(r):AA(r)}var b0=Se(Ri()),DA=Object.defineProperty,TA=(r,e,t)=>e in r?DA(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,w0=(r,e,t)=>TA(r,typeof e!="symbol"?e+"":e,t),da=class extends Wt{constructor(e){super(),this.opts=e,w0(this,"protocol","wc"),w0(this,"version",2)}};var CA=Object.defineProperty,OA=(r,e,t)=>e in r?CA(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,RA=(r,e,t)=>OA(r,typeof e!="symbol"?e+"":e,t),fa=class extends Wt{constructor(e,t){super(),this.core=e,this.logger=t,RA(this,"records",new Map)}},pa=class{constructor(e,t){this.logger=e,this.core=t}},ga=class extends Wt{constructor(e,t){super(),this.relayer=e,this.logger=t}},ma=class extends Wt{constructor(e){super()}},ya=class{constructor(e,t,i,n){this.core=e,this.logger=t,this.name=i}};var wa=class extends Wt{constructor(e,t){super(),this.relayer=e,this.logger=t}};var va=class extends Wt{constructor(e,t){super(),this.core=e,this.logger=t}};var ba=class{constructor(e,t,i){this.core=e,this.logger=t,this.store=i}},Ea=class{constructor(e,t){this.projectId=e,this.logger=t}},xa=class{constructor(e,t,i){this.core=e,this.logger=t,this.telemetryEnabled=i}},NA=Object.defineProperty,PA=(r,e,t)=>e in r?NA(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,v0=(r,e,t)=>PA(r,typeof e!="symbol"?e+"":e,t);var _a=class{constructor(e){this.opts=e,v0(this,"protocol","wc"),v0(this,"version",2)}};var Sa=class{constructor(e){this.client=e}};var G=Se(zi());var M0=Se(Ri());var st={};Ge(st,{DEFAULT_ERROR:()=>xs,IBaseJsonRpcProvider:()=>Pa,IEvents:()=>Ss,IJsonRpcConnection:()=>th,IJsonRpcProvider:()=>Is,INTERNAL_ERROR:()=>Ia,INVALID_PARAMS:()=>S0,INVALID_REQUEST:()=>x0,METHOD_NOT_FOUND:()=>_0,PARSE_ERROR:()=>E0,RESERVED_ERROR_CODES:()=>Gl,SERVER_ERROR:()=>Es,SERVER_ERROR_CODE_RANGE:()=>Aa,STANDARD_ERROR_MAP:()=>Xr,formatErrorMessage:()=>k0,formatJsonRpcError:()=>Ii,formatJsonRpcRequest:()=>At,formatJsonRpcResult:()=>Si,getBigIntRpcId:()=>Ut,getError:()=>Ta,getErrorByCode:()=>Ca,isHttpUrl:()=>uD,isJsonRpcError:()=>nt,isJsonRpcPayload:()=>ih,isJsonRpcRequest:()=>dn,isJsonRpcResponse:()=>ei,isJsonRpcResult:()=>Dt,isJsonRpcValidationInvalid:()=>lD,isLocalhostUrl:()=>rh,isNodeJs:()=>U0,isReservedErrorCode:()=>Da,isServerErrorCode:()=>FA,isValidDefaultRoute:()=>Ra,isValidErrorCode:()=>I0,isValidLeadingWildcardRoute:()=>nD,isValidRoute:()=>iD,isValidTrailingWildcardRoute:()=>sD,isValidWildcardRoute:()=>Na,isWsUrl:()=>Fa,parseConnectionError:()=>Yl,payloadId:()=>Bt,validateJsonRpcError:()=>BA});var E0="PARSE_ERROR",x0="INVALID_REQUEST",_0="METHOD_NOT_FOUND",S0="INVALID_PARAMS",Ia="INTERNAL_ERROR",Es="SERVER_ERROR",Gl=[-32700,-32600,-32601,-32602,-32603],Aa=[-32e3,-32099],Xr={[E0]:{code:-32700,message:"Parse error"},[x0]:{code:-32600,message:"Invalid Request"},[_0]:{code:-32601,message:"Method not found"},[S0]:{code:-32602,message:"Invalid params"},[Ia]:{code:-32603,message:"Internal error"},[Es]:{code:-32e3,message:"Server error"}},xs=Es;function FA(r){return r<=Aa[0]&&r>=Aa[1]}function Da(r){return Gl.includes(r)}function I0(r){return typeof r=="number"}function Ta(r){return Object.keys(Xr).includes(r)?Xr[r]:Xr[xs]}function Ca(r){let e=Object.values(Xr).find(t=>t.code===r);return e||Xr[xs]}function BA(r){if(typeof r.error.code>"u")return{valid:!1,error:"Missing code for JSON-RPC error"};if(typeof r.error.message>"u")return{valid:!1,error:"Missing message for JSON-RPC error"};if(!I0(r.error.code))return{valid:!1,error:`Invalid error code type for JSON-RPC: ${r.error.code}`};if(Da(r.error.code)){let e=Ca(r.error.code);if(e.message!==Xr[xs].message&&r.error.message===e.message)return{valid:!1,error:`Invalid error code message for JSON-RPC: ${r.error.code}`}}return{valid:!0}}function Yl(r,e,t){return r.message.includes("getaddrinfo ENOTFOUND")||r.message.includes("connect ECONNREFUSED")?new Error(`Unavailable ${t} RPC url at ${e}`):r}var ht={};Ge(ht,{isNodeJs:()=>U0});var B0=Se(eh());xt(ht,Se(eh()));var U0=B0.isNode;xt(st,ht);function Bt(r=3){let e=Date.now()*Math.pow(10,r),t=Math.floor(Math.random()*Math.pow(10,r));return e+t}function Ut(r=6){return BigInt(Bt(r))}function At(r,e,t){return{id:t||Bt(),jsonrpc:"2.0",method:r,params:e}}function Si(r,e){return{id:r,jsonrpc:"2.0",result:e}}function Ii(r,e,t){return{id:r,jsonrpc:"2.0",error:k0(e,t)}}function k0(r,e){return typeof r>"u"?Ta(Ia):(typeof r=="string"&&(r=Object.assign(Object.assign({},Ta(Es)),{message:r})),typeof e<"u"&&(r.data=e),Da(r.code)&&(r=Ca(r.code)),r)}function iD(r){return r.includes("*")?Na(r):!/\W/g.test(r)}function Ra(r){return r==="*"}function Na(r){return Ra(r)?!0:!(!r.includes("*")||r.split("*").length!==2||r.split("*").filter(e=>e.trim()==="").length!==1)}function nD(r){return!Ra(r)&&Na(r)&&!r.split("*")[0].trim()}function sD(r){return!Ra(r)&&Na(r)&&!r.split("*")[1].trim()}var Ss=class{},th=class extends Ss{constructor(e){super()}},Pa=class extends Ss{constructor(){super()}},Is=class extends Pa{constructor(e){super()}};var oD="^https?:",aD="^wss?:";function cD(r){let e=r.match(new RegExp(/^\w+:/,"gi"));if(!(!e||!e.length))return e[0]}function L0(r,e){let t=cD(r);return typeof t>"u"?!1:new RegExp(e).test(t)}function uD(r){return L0(r,oD)}function Fa(r){return L0(r,aD)}function rh(r){return new RegExp("wss?://localhost(:d{2,5})?").test(r)}function ih(r){return typeof r=="object"&&"id"in r&&"jsonrpc"in r&&r.jsonrpc==="2.0"}function dn(r){return ih(r)&&"method"in r}function ei(r){return ih(r)&&(Dt(r)||nt(r))}function Dt(r){return"result"in r}function nt(r){return"error"in r}function lD(r){return"error"in r&&r.valid===!1}var Ba=class extends Is{constructor(e){super(e),this.events=new M0.EventEmitter,this.hasRegisteredEventListeners=!1,this.connection=this.setConnection(e),this.connection.connected&&this.registerEventListeners()}async connect(e=this.connection){await this.open(e)}async disconnect(){await this.close()}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}async request(e,t){return this.requestStrict(At(e.method,e.params||[],e.id||Ut().toString()),t)}async requestStrict(e,t){return new Promise(async(i,n)=>{if(!this.connection.connected)try{await this.open()}catch(s){n(s)}this.events.on(`${e.id}`,s=>{nt(s)?n(s.error):i(s.result)});try{await this.connection.send(e,t)}catch(s){n(s)}})}setConnection(e=this.connection){return e}onPayload(e){this.events.emit("payload",e),ei(e)?this.events.emit(`${e.id}`,e):this.events.emit("message",{type:e.method,data:e.params})}onClose(e){e&&e.code===3e3&&this.events.emit("error",new Error(`WebSocket connection closed abnormally with code: ${e.code} ${e.reason?`(${e.reason})`:""}`)),this.events.emit("disconnect")}async open(e=this.connection){this.connection===e&&this.connection.connected||(this.connection.connected&&this.close(),typeof e=="string"&&(await this.connection.open(e),e=this.connection),this.connection=this.setConnection(e),await this.connection.open(),this.registerEventListeners(),this.events.emit("connect"))}async close(){await this.connection.close()}registerEventListeners(){this.hasRegisteredEventListeners||(this.connection.on("payload",e=>this.onPayload(e)),this.connection.on("close",e=>this.onClose(e)),this.connection.on("error",e=>this.events.emit("error",e)),this.connection.on("register_error",e=>this.onClose()),this.hasRegisteredEventListeners=!0)}};var $0=Se(Ri());var hD=()=>typeof WebSocket<"u"?WebSocket:typeof global<"u"&&typeof global.WebSocket<"u"?global.WebSocket:typeof window<"u"&&typeof window.WebSocket<"u"?window.WebSocket:typeof self<"u"&&typeof self.WebSocket<"u"?self.WebSocket:z0(),dD=()=>typeof WebSocket<"u"||typeof global<"u"&&typeof global.WebSocket<"u"||typeof window<"u"&&typeof window.WebSocket<"u"||typeof self<"u"&&typeof self.WebSocket<"u",j0=r=>r.split("?")[0],V0=10,fD=hD(),Ua=class{constructor(e){if(this.url=e,this.events=new $0.EventEmitter,this.registering=!1,!Fa(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);this.url=e}get connected(){return typeof this.socket<"u"}get connecting(){return this.registering}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}async open(e=this.url){await this.register(e)}async close(){return new Promise((e,t)=>{if(typeof this.socket>"u"){t(new Error("Connection already closed"));return}this.socket.onclose=i=>{this.onClose(i),e()},this.socket.close()})}async send(e){typeof this.socket>"u"&&(this.socket=await this.register());try{this.socket.send(Rt(e))}catch(t){this.onError(e.id,t)}}register(e=this.url){if(!Fa(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);if(this.registering){let t=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=t||this.events.listenerCount("open")>=t)&&this.events.setMaxListeners(t+1),new Promise((i,n)=>{this.events.once("register_error",s=>{this.resetMaxListeners(),n(s)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.socket>"u")return n(new Error("WebSocket connection is missing or invalid"));i(this.socket)})})}return this.url=e,this.registering=!0,new Promise((t,i)=>{let n=(0,st.isReactNative)()?void 0:{rejectUnauthorized:!rh(e)},s=new fD(e,[],n);dD()?s.onerror=o=>{let a=o;i(this.emitError(a.error))}:s.on("error",o=>{i(this.emitError(o))}),s.onopen=()=>{this.onOpen(s),t(s)}})}onOpen(e){e.onmessage=t=>this.onPayload(t),e.onclose=t=>this.onClose(t),this.socket=e,this.registering=!1,this.events.emit("open")}onClose(e){this.socket=void 0,this.registering=!1,this.events.emit("close",e)}onPayload(e){if(typeof e.data>"u")return;let t=typeof e.data=="string"?Zt(e.data):e.data;this.events.emit("payload",t)}onError(e,t){let i=this.parseError(t),n=i.message||i.toString(),s=Ii(e,n);this.events.emit("payload",s)}parseError(e,t=this.url){return Yl(e,j0(t),"WS")}resetMaxListeners(){this.events.getMaxListeners()>V0&&this.events.setMaxListeners(V0)}emitError(e){let t=this.parseError(new Error(e?.message||`WebSocket connection failed for host: ${j0(this.url)}`));return this.events.emit("register_error",t),t}};var gw=Se(no()),mw="wc",yw=2,La="core",ar=`${mw}@2:${La}:`,pD={name:La,logger:"error"},gD={database:":memory:"},mD="crypto",K0="client_ed25519_seed",yD=G.ONE_DAY,wD="keychain",vD="0.3",bD="messages",ED="0.3",xD=G.SIX_HOURS,_D="publisher",kh="irn",SD="error",ww="wss://relay.walletconnect.org",ID="relayer",ve={message:"relayer_message",message_ack:"relayer_message_ack",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},AD="_subscription",kt={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},DD=.1;var ah="2.21.8";var ge={link_mode:"link_mode",relay:"relay"},ka={inbound:"inbound",outbound:"outbound"},TD="0.3",CD="WALLETCONNECT_CLIENT_ID",H0="WALLETCONNECT_LINK_MODE_APPS",Ct={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"};var OD="subscription",RD="0.3",EP=G.FIVE_SECONDS*1e3,ND="pairing",PD="0.3";var As={wc_pairingDelete:{req:{ttl:G.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:G.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:G.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:G.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:G.ONE_DAY,prompt:!1,tag:0},res:{ttl:G.ONE_DAY,prompt:!1,tag:0}}},ti={create:"pairing_create",expire:"pairing_expire",delete:"pairing_delete",ping:"pairing_ping"},Gt={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},FD="history",BD="0.3",UD="expirer",Ot={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},kD="0.3";var LD="verify-api",MD="https://verify.walletconnect.com",vw="https://verify.walletconnect.org",gn=vw,qD=`${gn}/v3`,zD=[MD,vw],jD="echo",VD="https://echo.walletconnect.com";var Yt={pairing_started:"pairing_started",pairing_uri_validation_success:"pairing_uri_validation_success",pairing_uri_not_expired:"pairing_uri_not_expired",store_new_pairing:"store_new_pairing",subscribing_pairing_topic:"subscribing_pairing_topic",subscribe_pairing_topic_success:"subscribe_pairing_topic_success",existing_pairing:"existing_pairing",pairing_not_expired:"pairing_not_expired",emit_inactive_pairing:"emit_inactive_pairing",emit_session_proposal:"emit_session_proposal",subscribing_to_pairing_topic:"subscribing_to_pairing_topic"},or={no_wss_connection:"no_wss_connection",no_internet_connection:"no_internet_connection",malformed_pairing_uri:"malformed_pairing_uri",active_pairing_already_exists:"active_pairing_already_exists",subscribe_pairing_topic_failure:"subscribe_pairing_topic_failure",pairing_expired:"pairing_expired",proposal_expired:"proposal_expired",proposal_listener_not_found:"proposal_listener_not_found"},Dr={session_approve_started:"session_approve_started",proposal_not_expired:"proposal_not_expired",session_namespaces_validation_success:"session_namespaces_validation_success",create_session_topic:"create_session_topic",subscribing_session_topic:"subscribing_session_topic",subscribe_session_topic_success:"subscribe_session_topic_success",publishing_session_approve:"publishing_session_approve",session_approve_publish_success:"session_approve_publish_success",store_session:"store_session",publishing_session_settle:"publishing_session_settle",session_settle_publish_success:"session_settle_publish_success"},mn={no_internet_connection:"no_internet_connection",no_wss_connection:"no_wss_connection",proposal_expired:"proposal_expired",subscribe_session_topic_failure:"subscribe_session_topic_failure",session_approve_publish_failure:"session_approve_publish_failure",session_settle_publish_failure:"session_settle_publish_failure",session_approve_namespace_validation_failure:"session_approve_namespace_validation_failure",proposal_not_found:"proposal_not_found"},ri={authenticated_session_approve_started:"authenticated_session_approve_started",authenticated_session_not_expired:"authenticated_session_not_expired",chains_caip2_compliant:"chains_caip2_compliant",chains_evm_compliant:"chains_evm_compliant",create_authenticated_session_topic:"create_authenticated_session_topic",cacaos_verified:"cacaos_verified",store_authenticated_session:"store_authenticated_session",subscribing_authenticated_session_topic:"subscribing_authenticated_session_topic",subscribe_authenticated_session_topic_success:"subscribe_authenticated_session_topic_success",publishing_authenticated_session_approve:"publishing_authenticated_session_approve",authenticated_session_approve_publish_success:"authenticated_session_approve_publish_success"},yn={no_internet_connection:"no_internet_connection",no_wss_connection:"no_wss_connection",missing_session_authenticate_request:"missing_session_authenticate_request",session_authenticate_request_expired:"session_authenticate_request_expired",chains_caip2_compliant_failure:"chains_caip2_compliant_failure",chains_evm_compliant_failure:"chains_evm_compliant_failure",invalid_cacao:"invalid_cacao",subscribe_authenticated_session_topic_failure:"subscribe_authenticated_session_topic_failure",authenticated_session_approve_publish_failure:"authenticated_session_approve_publish_failure",authenticated_session_pending_request_not_found:"authenticated_session_pending_request_not_found"},$D=.1,KD="event-client",HD=86400,WD="https://pulse.walletconnect.org/batch";function GD(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),i=0;i<t.length;i++)t[i]=255;for(var n=0;n<r.length;n++){var s=r.charAt(n),o=s.charCodeAt(0);if(t[o]!==255)throw new TypeError(s+" is ambiguous");t[o]=n}var a=r.length,c=r.charAt(0),u=Math.log(a)/Math.log(256),l=Math.log(256)/Math.log(a);function h(f){if(f instanceof Uint8Array||(ArrayBuffer.isView(f)?f=new Uint8Array(f.buffer,f.byteOffset,f.byteLength):Array.isArray(f)&&(f=Uint8Array.from(f))),!(f instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(f.length===0)return"";for(var g=0,m=0,w=0,v=f.length;w!==v&&f[w]===0;)w++,g++;for(var y=(v-w)*l+1>>>0,S=new Uint8Array(y);w!==v;){for(var E=f[w],C=0,R=y-1;(E!==0||C<m)&&R!==-1;R--,C++)E+=256*S[R]>>>0,S[R]=E%a>>>0,E=E/a>>>0;if(E!==0)throw new Error("Non-zero carry");m=C,w++}for(var P=y-m;P!==y&&S[P]===0;)P++;for(var b=c.repeat(g);P<y;++P)b+=r.charAt(S[P]);return b}function d(f){if(typeof f!="string")throw new TypeError("Expected String");if(f.length===0)return new Uint8Array;var g=0;if(f[g]!==" "){for(var m=0,w=0;f[g]===c;)m++,g++;for(var v=(f.length-g)*u+1>>>0,y=new Uint8Array(v);f[g];){var S=t[f.charCodeAt(g)];if(S===255)return;for(var E=0,C=v-1;(S!==0||E<w)&&C!==-1;C--,E++)S+=a*y[C]>>>0,y[C]=S%256>>>0,S=S/256>>>0;if(S!==0)throw new Error("Non-zero carry");w=E,g++}if(f[g]!==" "){for(var R=v-w;R!==v&&y[R]===0;)R++;for(var P=new Uint8Array(m+(v-R)),b=m;R!==v;)P[b++]=y[R++];return P}}}function p(f){var g=d(f);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:d,decode:p}}var YD=GD,JD=YD,bw=r=>{if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")},XD=r=>new TextEncoder().encode(r),QD=r=>new TextDecoder().decode(r),ch=class{constructor(e,t,i){this.name=e,this.prefix=t,this.baseEncode=i}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},uh=class{constructor(e,t,i){if(this.name=e,this.prefix=t,t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=i}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return Ew(this,e)}},lh=class{constructor(e){this.decoders=e}or(e){return Ew(this,e)}decode(e){let t=e[0],i=this.decoders[t];if(i)return i.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}},Ew=(r,e)=>new lh({...r.decoders||{[r.prefix]:r},...e.decoders||{[e.prefix]:e}}),hh=class{constructor(e,t,i,n){this.name=e,this.prefix=t,this.baseEncode=i,this.baseDecode=n,this.encoder=new ch(e,t,i),this.decoder=new uh(e,t,n)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}},Ma=({name:r,prefix:e,encode:t,decode:i})=>new hh(r,e,t,i),Rs=({prefix:r,name:e,alphabet:t})=>{let{encode:i,decode:n}=JD(t,e);return Ma({prefix:r,name:e,encode:i,decode:s=>bw(n(s))})},ZD=(r,e,t,i)=>{let n={};for(let l=0;l<e.length;++l)n[e[l]]=l;let s=r.length;for(;r[s-1]==="=";)--s;let o=new Uint8Array(s*t/8|0),a=0,c=0,u=0;for(let l=0;l<s;++l){let h=n[r[l]];if(h===void 0)throw new SyntaxError(`Non-${i} character`);c=c<<t|h,a+=t,a>=8&&(a-=8,o[u++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},eT=(r,e,t)=>{let i=e[e.length-1]==="=",n=(1<<t)-1,s="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,s+=e[n&a>>o];if(o&&(s+=e[n&a<<t-o]),i)for(;s.length*t&7;)s+="=";return s},He=({name:r,prefix:e,bitsPerChar:t,alphabet:i})=>Ma({prefix:e,name:r,encode(n){return eT(n,i,t)},decode(n){return ZD(n,i,t,r)}}),tT=Ma({prefix:"\0",name:"identity",encode:r=>QD(r),decode:r=>XD(r)}),rT=Object.freeze({__proto__:null,identity:tT}),iT=He({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),nT=Object.freeze({__proto__:null,base2:iT}),sT=He({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),oT=Object.freeze({__proto__:null,base8:sT}),aT=Rs({prefix:"9",name:"base10",alphabet:"0123456789"}),cT=Object.freeze({__proto__:null,base10:aT}),uT=He({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),lT=He({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),hT=Object.freeze({__proto__:null,base16:uT,base16upper:lT}),dT=He({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),fT=He({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),pT=He({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),gT=He({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),mT=He({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),yT=He({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),wT=He({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),vT=He({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),bT=He({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),ET=Object.freeze({__proto__:null,base32:dT,base32upper:fT,base32pad:pT,base32padupper:gT,base32hex:mT,base32hexupper:yT,base32hexpad:wT,base32hexpadupper:vT,base32z:bT}),xT=Rs({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),_T=Rs({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),ST=Object.freeze({__proto__:null,base36:xT,base36upper:_T}),IT=Rs({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),AT=Rs({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),DT=Object.freeze({__proto__:null,base58btc:IT,base58flickr:AT}),TT=He({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),CT=He({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),OT=He({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),RT=He({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),NT=Object.freeze({__proto__:null,base64:TT,base64pad:CT,base64url:OT,base64urlpad:RT}),xw=Array.from("\u{1F680}\u{1FA90}\u2604\u{1F6F0}\u{1F30C}\u{1F311}\u{1F312}\u{1F313}\u{1F314}\u{1F315}\u{1F316}\u{1F317}\u{1F318}\u{1F30D}\u{1F30F}\u{1F30E}\u{1F409}\u2600\u{1F4BB}\u{1F5A5}\u{1F4BE}\u{1F4BF}\u{1F602}\u2764\u{1F60D}\u{1F923}\u{1F60A}\u{1F64F}\u{1F495}\u{1F62D}\u{1F618}\u{1F44D}\u{1F605}\u{1F44F}\u{1F601}\u{1F525}\u{1F970}\u{1F494}\u{1F496}\u{1F499}\u{1F622}\u{1F914}\u{1F606}\u{1F644}\u{1F4AA}\u{1F609}\u263A\u{1F44C}\u{1F917}\u{1F49C}\u{1F614}\u{1F60E}\u{1F607}\u{1F339}\u{1F926}\u{1F389}\u{1F49E}\u270C\u2728\u{1F937}\u{1F631}\u{1F60C}\u{1F338}\u{1F64C}\u{1F60B}\u{1F497}\u{1F49A}\u{1F60F}\u{1F49B}\u{1F642}\u{1F493}\u{1F929}\u{1F604}\u{1F600}\u{1F5A4}\u{1F603}\u{1F4AF}\u{1F648}\u{1F447}\u{1F3B6}\u{1F612}\u{1F92D}\u2763\u{1F61C}\u{1F48B}\u{1F440}\u{1F62A}\u{1F611}\u{1F4A5}\u{1F64B}\u{1F61E}\u{1F629}\u{1F621}\u{1F92A}\u{1F44A}\u{1F973}\u{1F625}\u{1F924}\u{1F449}\u{1F483}\u{1F633}\u270B\u{1F61A}\u{1F61D}\u{1F634}\u{1F31F}\u{1F62C}\u{1F643}\u{1F340}\u{1F337}\u{1F63B}\u{1F613}\u2B50\u2705\u{1F97A}\u{1F308}\u{1F608}\u{1F918}\u{1F4A6}\u2714\u{1F623}\u{1F3C3}\u{1F490}\u2639\u{1F38A}\u{1F498}\u{1F620}\u261D\u{1F615}\u{1F33A}\u{1F382}\u{1F33B}\u{1F610}\u{1F595}\u{1F49D}\u{1F64A}\u{1F639}\u{1F5E3}\u{1F4AB}\u{1F480}\u{1F451}\u{1F3B5}\u{1F91E}\u{1F61B}\u{1F534}\u{1F624}\u{1F33C}\u{1F62B}\u26BD\u{1F919}\u2615\u{1F3C6}\u{1F92B}\u{1F448}\u{1F62E}\u{1F646}\u{1F37B}\u{1F343}\u{1F436}\u{1F481}\u{1F632}\u{1F33F}\u{1F9E1}\u{1F381}\u26A1\u{1F31E}\u{1F388}\u274C\u270A\u{1F44B}\u{1F630}\u{1F928}\u{1F636}\u{1F91D}\u{1F6B6}\u{1F4B0}\u{1F353}\u{1F4A2}\u{1F91F}\u{1F641}\u{1F6A8}\u{1F4A8}\u{1F92C}\u2708\u{1F380}\u{1F37A}\u{1F913}\u{1F619}\u{1F49F}\u{1F331}\u{1F616}\u{1F476}\u{1F974}\u25B6\u27A1\u2753\u{1F48E}\u{1F4B8}\u2B07\u{1F628}\u{1F31A}\u{1F98B}\u{1F637}\u{1F57A}\u26A0\u{1F645}\u{1F61F}\u{1F635}\u{1F44E}\u{1F932}\u{1F920}\u{1F927}\u{1F4CC}\u{1F535}\u{1F485}\u{1F9D0}\u{1F43E}\u{1F352}\u{1F617}\u{1F911}\u{1F30A}\u{1F92F}\u{1F437}\u260E\u{1F4A7}\u{1F62F}\u{1F486}\u{1F446}\u{1F3A4}\u{1F647}\u{1F351}\u2744\u{1F334}\u{1F4A3}\u{1F438}\u{1F48C}\u{1F4CD}\u{1F940}\u{1F922}\u{1F445}\u{1F4A1}\u{1F4A9}\u{1F450}\u{1F4F8}\u{1F47B}\u{1F910}\u{1F92E}\u{1F3BC}\u{1F975}\u{1F6A9}\u{1F34E}\u{1F34A}\u{1F47C}\u{1F48D}\u{1F4E3}\u{1F942}"),PT=xw.reduce((r,e,t)=>(r[t]=e,r),[]),FT=xw.reduce((r,e,t)=>(r[e.codePointAt(0)]=t,r),[]);function BT(r){return r.reduce((e,t)=>(e+=PT[t],e),"")}function UT(r){let e=[];for(let t of r){let i=FT[t.codePointAt(0)];if(i===void 0)throw new Error(`Non-base256emoji character: ${t}`);e.push(i)}return new Uint8Array(e)}var kT=Ma({prefix:"\u{1F680}",name:"base256emoji",encode:BT,decode:UT}),LT=Object.freeze({__proto__:null,base256emoji:kT}),MT=_w,W0=128,qT=127,zT=~qT,jT=Math.pow(2,31);function _w(r,e,t){e=e||[],t=t||0;for(var i=t;r>=jT;)e[t++]=r&255|W0,r/=128;for(;r&zT;)e[t++]=r&255|W0,r>>>=7;return e[t]=r|0,_w.bytes=t-i+1,e}var VT=dh,$T=128,G0=127;function dh(r,i){var t=0,i=i||0,n=0,s=i,o,a=r.length;do{if(s>=a)throw dh.bytes=0,new RangeError("Could not decode varint");o=r[s++],t+=n<28?(o&G0)<<n:(o&G0)*Math.pow(2,n),n+=7}while(o>=$T);return dh.bytes=s-i,t}var KT=Math.pow(2,7),HT=Math.pow(2,14),WT=Math.pow(2,21),GT=Math.pow(2,28),YT=Math.pow(2,35),JT=Math.pow(2,42),XT=Math.pow(2,49),QT=Math.pow(2,56),ZT=Math.pow(2,63),e8=function(r){return r<KT?1:r<HT?2:r<WT?3:r<GT?4:r<YT?5:r<JT?6:r<XT?7:r<QT?8:r<ZT?9:10},t8={encode:MT,decode:VT,encodingLength:e8},Sw=t8,Y0=(r,e,t=0)=>(Sw.encode(r,e,t),e),J0=r=>Sw.encodingLength(r),fh=(r,e)=>{let t=e.byteLength,i=J0(r),n=i+J0(t),s=new Uint8Array(n+t);return Y0(r,s,0),Y0(t,s,i),s.set(e,n),new ph(r,t,e,s)},ph=class{constructor(e,t,i,n){this.code=e,this.size=t,this.digest=i,this.bytes=n}},Iw=({name:r,code:e,encode:t})=>new gh(r,e,t),gh=class{constructor(e,t,i){this.name=e,this.code=t,this.encode=i}digest(e){if(e instanceof Uint8Array){let t=this.encode(e);return t instanceof Uint8Array?fh(this.code,t):t.then(i=>fh(this.code,i))}else throw Error("Unknown type, must be binary type")}},Aw=r=>async e=>new Uint8Array(await crypto.subtle.digest(r,e)),r8=Iw({name:"sha2-256",code:18,encode:Aw("SHA-256")}),i8=Iw({name:"sha2-512",code:19,encode:Aw("SHA-512")}),n8=Object.freeze({__proto__:null,sha256:r8,sha512:i8}),Dw=0,s8="identity",Tw=bw,o8=r=>fh(Dw,Tw(r)),a8={code:Dw,name:s8,encode:Tw,digest:o8},c8=Object.freeze({__proto__:null,identity:a8});new TextEncoder,new TextDecoder;var X0={...rT,...nT,...oT,...cT,...hT,...ET,...ST,...DT,...NT,...LT};({...n8,...c8});function Cw(r){return globalThis.Buffer!=null?new Uint8Array(r.buffer,r.byteOffset,r.byteLength):r}function u8(r=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?Cw(globalThis.Buffer.allocUnsafe(r)):new Uint8Array(r)}function Ow(r,e,t,i){return{name:r,prefix:e,encoder:{name:r,prefix:e,encode:t},decoder:{decode:i}}}var Q0=Ow("utf8","u",r=>"u"+new TextDecoder("utf8").decode(r),r=>new TextEncoder().encode(r.substring(1))),nh=Ow("ascii","a",r=>{let e="a";for(let t=0;t<r.length;t++)e+=String.fromCharCode(r[t]);return e},r=>{r=r.substring(1);let e=u8(r.length);for(let t=0;t<r.length;t++)e[t]=r.charCodeAt(t);return e}),l8={utf8:Q0,"utf-8":Q0,hex:X0.base16,latin1:nh,ascii:nh,binary:nh,...X0};function h8(r,e="utf8"){let t=l8[e];if(!t)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?Cw(globalThis.Buffer.from(r,"utf-8")):t.decoder.decode(`${t.prefix}${r}`)}var d8=Object.defineProperty,f8=(r,e,t)=>e in r?d8(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,sr=(r,e,t)=>f8(r,typeof e!="symbol"?e+"":e,t),mh=class{constructor(e,t){this.core=e,this.logger=t,sr(this,"keychain",new Map),sr(this,"name",wD),sr(this,"version",vD),sr(this,"initialized",!1),sr(this,"storagePrefix",ar),sr(this,"init",async()=>{if(!this.initialized){let i=await this.getKeyChain();typeof i<"u"&&(this.keychain=i),this.initialized=!0}}),sr(this,"has",i=>(this.isInitialized(),this.keychain.has(i))),sr(this,"set",async(i,n)=>{this.isInitialized(),this.keychain.set(i,n),await this.persist()}),sr(this,"get",i=>{this.isInitialized();let n=this.keychain.get(i);if(typeof n>"u"){let{message:s}=M("NO_MATCHING_KEY",`${this.name}: ${i}`);throw new Error(s)}return n}),sr(this,"del",async i=>{this.isInitialized(),this.keychain.delete(i),await this.persist()}),this.core=e,this.logger=Ve(t,this.name)}get context(){return it(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setKeyChain(e){await this.core.storage.setItem(this.storageKey,$o(e))}async getKeyChain(){let e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?Ko(e):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){let{message:e}=M("NOT_INITIALIZED",this.name);throw new Error(e)}}},p8=Object.defineProperty,g8=(r,e,t)=>e in r?p8(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,$e=(r,e,t)=>g8(r,typeof e!="symbol"?e+"":e,t),yh=class{constructor(e,t,i){this.core=e,this.logger=t,$e(this,"name",mD),$e(this,"keychain"),$e(this,"randomSessionIdentifier",ea()),$e(this,"initialized",!1),$e(this,"init",async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)}),$e(this,"hasKeys",n=>(this.isInitialized(),this.keychain.has(n))),$e(this,"getClientId",async()=>{this.isInitialized();let n=await this.getClientSeed(),s=ru(n);return tu(s.publicKey)}),$e(this,"generateKeyPair",()=>{this.isInitialized();let n=oy();return this.setPrivateKey(n.publicKey,n.privateKey)}),$e(this,"signJWT",async n=>{this.isInitialized();let s=await this.getClientSeed(),o=ru(s),a=this.randomSessionIdentifier;return await qp(a,n,yD,o)}),$e(this,"generateSharedKey",(n,s,o)=>{this.isInitialized();let a=this.getPrivateKey(n),c=ay(a,s);return this.setSymKey(c,o)}),$e(this,"setSymKey",async(n,s)=>{this.isInitialized();let o=s||on(n);return await this.keychain.set(o,n),o}),$e(this,"deleteKeyPair",async n=>{this.isInitialized(),await this.keychain.del(n)}),$e(this,"deleteSymKey",async n=>{this.isInitialized(),await this.keychain.del(n)}),$e(this,"encode",async(n,s,o)=>{this.isInitialized();let a=xl(o),c=Rt(s);if(Sl(a))return fy(c,o?.encoding);if(_l(a)){let d=a.senderPublicKey,p=a.receiverPublicKey;n=await this.generateSharedKey(d,p)}let u=this.getSymKey(n),{type:l,senderPublicKey:h}=a;return hy({type:l,symKey:u,message:c,senderPublicKey:h,encoding:o?.encoding})}),$e(this,"decode",async(n,s,o)=>{this.isInitialized();let a=my(s,o);if(Sl(a)){let c=py(s,o?.encoding);return Zt(c)}if(_l(a)){let c=a.receiverPublicKey,u=a.senderPublicKey;n=await this.generateSharedKey(c,u)}try{let c=this.getSymKey(n),u=dy({symKey:c,encoded:s,encoding:o?.encoding});return Zt(u)}catch(c){this.logger.error(`Failed to decode message from topic: '${n}', clientId: '${await this.getClientId()}'`),this.logger.error(c)}}),$e(this,"getPayloadType",(n,s=tt)=>{let o=an({encoded:n,encoding:s});return Wr(o.type)}),$e(this,"getPayloadSenderPublicKey",(n,s=tt)=>{let o=an({encoded:n,encoding:s});return o.senderPublicKey?qe(o.senderPublicKey,et):void 0}),this.core=e,this.logger=Ve(t,this.name),this.keychain=i||new mh(this.core,this.logger)}get context(){return it(this.logger)}async setPrivateKey(e,t){return await this.keychain.set(e,t),e}getPrivateKey(e){return this.keychain.get(e)}async getClientSeed(){let e="";try{e=this.keychain.get(K0)}catch{e=ea(),await this.keychain.set(K0,e)}return h8(e,"base16")}getSymKey(e){return this.keychain.get(e)}isInitialized(){if(!this.initialized){let{message:e}=M("NOT_INITIALIZED",this.name);throw new Error(e)}}},m8=Object.defineProperty,y8=Object.defineProperties,w8=Object.getOwnPropertyDescriptors,Z0=Object.getOwnPropertySymbols,v8=Object.prototype.hasOwnProperty,b8=Object.prototype.propertyIsEnumerable,wh=(r,e,t)=>e in r?m8(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,E8=(r,e)=>{for(var t in e||(e={}))v8.call(e,t)&&wh(r,t,e[t]);if(Z0)for(var t of Z0(e))b8.call(e,t)&&wh(r,t,e[t]);return r},x8=(r,e)=>y8(r,w8(e)),Tt=(r,e,t)=>wh(r,typeof e!="symbol"?e+"":e,t),vh=class extends pa{constructor(e,t){super(e,t),this.logger=e,this.core=t,Tt(this,"messages",new Map),Tt(this,"messagesWithoutClientAck",new Map),Tt(this,"name",bD),Tt(this,"version",ED),Tt(this,"initialized",!1),Tt(this,"storagePrefix",ar),Tt(this,"init",async()=>{if(!this.initialized){this.logger.trace("Initialized");try{let i=await this.getRelayerMessages();typeof i<"u"&&(this.messages=i);let n=await this.getRelayerMessagesWithoutClientAck();typeof n<"u"&&(this.messagesWithoutClientAck=n),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(i){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(i)}finally{this.initialized=!0}}}),Tt(this,"set",async(i,n,s)=>{this.isInitialized();let o=bt(n),a=this.messages.get(i);if(typeof a>"u"&&(a={}),typeof a[o]<"u")return o;if(a[o]=n,this.messages.set(i,a),s===ka.inbound){let c=this.messagesWithoutClientAck.get(i)||{};this.messagesWithoutClientAck.set(i,x8(E8({},c),{[o]:n}))}return await this.persist(),o}),Tt(this,"get",i=>{this.isInitialized();let n=this.messages.get(i);return typeof n>"u"&&(n={}),n}),Tt(this,"getWithoutAck",i=>{this.isInitialized();let n={};for(let s of i){let o=this.messagesWithoutClientAck.get(s)||{};n[s]=Object.values(o)}return n}),Tt(this,"has",(i,n)=>{this.isInitialized();let s=this.get(i),o=bt(n);return typeof s[o]<"u"}),Tt(this,"ack",async(i,n)=>{this.isInitialized();let s=this.messagesWithoutClientAck.get(i);if(typeof s>"u")return;let o=bt(n);delete s[o],Object.keys(s).length===0?this.messagesWithoutClientAck.delete(i):this.messagesWithoutClientAck.set(i,s),await this.persist()}),Tt(this,"del",async i=>{this.isInitialized(),this.messages.delete(i),this.messagesWithoutClientAck.delete(i),await this.persist()}),this.logger=Ve(e,this.name),this.core=t}get context(){return it(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get storageKeyWithoutClientAck(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name+"_withoutClientAck"}async setRelayerMessages(e){await this.core.storage.setItem(this.storageKey,$o(e))}async setRelayerMessagesWithoutClientAck(e){await this.core.storage.setItem(this.storageKeyWithoutClientAck,$o(e))}async getRelayerMessages(){let e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?Ko(e):void 0}async getRelayerMessagesWithoutClientAck(){let e=await this.core.storage.getItem(this.storageKeyWithoutClientAck);return typeof e<"u"?Ko(e):void 0}async persist(){await this.setRelayerMessages(this.messages),await this.setRelayerMessagesWithoutClientAck(this.messagesWithoutClientAck)}isInitialized(){if(!this.initialized){let{message:e}=M("NOT_INITIALIZED",this.name);throw new Error(e)}}},_8=Object.defineProperty,S8=Object.defineProperties,I8=Object.getOwnPropertyDescriptors,ew=Object.getOwnPropertySymbols,A8=Object.prototype.hasOwnProperty,D8=Object.prototype.propertyIsEnumerable,bh=(r,e,t)=>e in r?_8(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,fn=(r,e)=>{for(var t in e||(e={}))A8.call(e,t)&&bh(r,t,e[t]);if(ew)for(var t of ew(e))D8.call(e,t)&&bh(r,t,e[t]);return r},tw=(r,e)=>S8(r,I8(e)),Lt=(r,e,t)=>bh(r,typeof e!="symbol"?e+"":e,t),Eh=class extends ga{constructor(e,t){super(e,t),this.relayer=e,this.logger=t,Lt(this,"events",new Ar.EventEmitter),Lt(this,"name",_D),Lt(this,"queue",new Map),Lt(this,"publishTimeout",(0,G.toMiliseconds)(G.ONE_MINUTE)),Lt(this,"initialPublishTimeout",(0,G.toMiliseconds)(G.ONE_SECOND*15)),Lt(this,"needsTransportRestart",!1),Lt(this,"publish",async(i,n,s)=>{var o,a,c,u,l;this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:i,message:n,opts:s}});let h=s?.ttl||xD,d=s?.prompt||!1,p=s?.tag||0,f=s?.id||Ut().toString(),g=bi(ls().protocol),m={id:f,method:s?.publishMethod||g.publish,params:fn({topic:i,message:n,ttl:h,prompt:d,tag:p,attestation:s?.attestation},s?.tvf&&{tvf:s.tvf})},w=`Failed to publish payload, please try again. id:${f} tag:${p}`;try{xe((o=m.params)==null?void 0:o.prompt)&&((a=m.params)==null||delete a.prompt),xe((c=m.params)==null?void 0:c.tag)&&((u=m.params)==null||delete u.tag);let v=new Promise(async y=>{let S=({id:C})=>{var R;((R=m.id)==null?void 0:R.toString())===C.toString()&&(this.removeRequestFromQueue(C),this.relayer.events.removeListener(ve.publish,S),y())};this.relayer.events.on(ve.publish,S);let E=Kt(new Promise((C,R)=>{this.rpcPublish(m,s).then(C).catch(P=>{this.logger.warn(P,P?.message),R(P)})}),this.initialPublishTimeout,`Failed initial publish, retrying.... id:${f} tag:${p}`);try{await E,this.events.removeListener(ve.publish,S)}catch(C){this.queue.set(f,{request:m,opts:s,attempt:1}),this.logger.warn(C,C?.message)}});this.logger.trace({type:"method",method:"publish",params:{id:f,topic:i,message:n,opts:s}}),await Kt(v,this.publishTimeout,w)}catch(v){if(this.logger.debug("Failed to Publish Payload"),this.logger.error(v),(l=s?.internal)!=null&&l.throwOnFailedPublish)throw v}finally{this.queue.delete(f)}}),Lt(this,"publishCustom",async i=>{var n,s,o,a,c;this.logger.debug("Publishing custom payload"),this.logger.trace({type:"method",method:"publishCustom",params:i});let{payload:u,opts:l={}}=i,{attestation:h,tvf:d,publishMethod:p,prompt:f,tag:g,ttl:m=G.FIVE_MINUTES}=l,w=l.id||Ut().toString(),v=bi(ls().protocol),y=p||v.publish,S={id:w,method:y,params:fn(tw(fn({},u),{ttl:m,prompt:f,tag:g,attestation:h}),d)},E=`Failed to publish custom payload, please try again. id:${w} tag:${g}`;try{xe((n=S.params)==null?void 0:n.prompt)&&((s=S.params)==null||delete s.prompt),xe((o=S.params)==null?void 0:o.tag)&&((a=S.params)==null||delete a.tag);let C=new Promise(async R=>{let P=({id:A})=>{var _;((_=S.id)==null?void 0:_.toString())===A.toString()&&(this.removeRequestFromQueue(A),this.relayer.events.removeListener(ve.publish,P),R())};this.relayer.events.on(ve.publish,P);let b=Kt(new Promise((A,_)=>{this.rpcPublish(S,l).then(A).catch(D=>{this.logger.warn(D,D?.message),_(D)})}),this.initialPublishTimeout,`Failed initial custom payload publish, retrying.... method:${y} id:${w} tag:${g}`);try{await b,this.events.removeListener(ve.publish,P)}catch(A){this.queue.set(w,{request:S,opts:l,attempt:1}),this.logger.warn(A,A?.message)}});this.logger.trace({type:"method",method:"publish",params:{id:w,payload:u,opts:l}}),await Kt(C,this.publishTimeout,E)}catch(C){if(this.logger.debug("Failed to Publish Payload"),this.logger.error(C),(c=l?.internal)!=null&&c.throwOnFailedPublish)throw C}finally{this.queue.delete(w)}}),Lt(this,"on",(i,n)=>{this.events.on(i,n)}),Lt(this,"once",(i,n)=>{this.events.once(i,n)}),Lt(this,"off",(i,n)=>{this.events.off(i,n)}),Lt(this,"removeListener",(i,n)=>{this.events.removeListener(i,n)}),this.relayer=e,this.logger=Ve(t,this.name),this.registerEventListeners()}get context(){return it(this.logger)}async rpcPublish(e,t){this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:e});let i=await this.relayer.request(e);return this.relayer.events.emit(ve.publish,fn(fn({},e),t)),this.logger.debug("Successfully Published Payload"),i}removeRequestFromQueue(e){this.queue.delete(e)}checkQueue(){this.queue.forEach(async(e,t)=>{var i;let n=e.attempt+1;this.queue.set(t,tw(fn({},e),{attempt:n})),this.logger.warn({},`Publisher: queue->publishing: ${e.request.id}, tag: ${(i=e.request.params)==null?void 0:i.tag}, attempt: ${n}`),await this.rpcPublish(e.request,e.opts),this.logger.warn({},`Publisher: queue->published: ${e.request.id}`)})}registerEventListeners(){this.relayer.core.heartbeat.on(Jr.pulse,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit(ve.connection_stalled);return}this.checkQueue()}),this.relayer.on(ve.message_ack,e=>{this.removeRequestFromQueue(e.id.toString())})}},T8=Object.defineProperty,C8=(r,e,t)=>e in r?T8(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,pn=(r,e,t)=>C8(r,typeof e!="symbol"?e+"":e,t),xh=class{constructor(){pn(this,"map",new Map),pn(this,"set",(e,t)=>{let i=this.get(e);this.exists(e,t)||this.map.set(e,[...i,t])}),pn(this,"get",e=>this.map.get(e)||[]),pn(this,"exists",(e,t)=>this.get(e).includes(t)),pn(this,"delete",(e,t)=>{if(typeof t>"u"){this.map.delete(e);return}if(!this.map.has(e))return;let i=this.get(e);if(!this.exists(e,t))return;let n=i.filter(s=>s!==t);if(!n.length){this.map.delete(e);return}this.map.set(e,n)}),pn(this,"clear",()=>{this.map.clear()})}get topics(){return Array.from(this.map.keys())}},O8=Object.defineProperty,R8=Object.defineProperties,N8=Object.getOwnPropertyDescriptors,rw=Object.getOwnPropertySymbols,P8=Object.prototype.hasOwnProperty,F8=Object.prototype.propertyIsEnumerable,_h=(r,e,t)=>e in r?O8(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Ds=(r,e)=>{for(var t in e||(e={}))P8.call(e,t)&&_h(r,t,e[t]);if(rw)for(var t of rw(e))F8.call(e,t)&&_h(r,t,e[t]);return r},sh=(r,e)=>R8(r,N8(e)),de=(r,e,t)=>_h(r,typeof e!="symbol"?e+"":e,t),Sh=class extends wa{constructor(e,t){super(e,t),this.relayer=e,this.logger=t,de(this,"subscriptions",new Map),de(this,"topicMap",new xh),de(this,"events",new Ar.EventEmitter),de(this,"name",OD),de(this,"version",RD),de(this,"pending",new Map),de(this,"cached",[]),de(this,"initialized",!1),de(this,"storagePrefix",ar),de(this,"subscribeTimeout",(0,G.toMiliseconds)(G.ONE_MINUTE)),de(this,"initialSubscribeTimeout",(0,G.toMiliseconds)(G.ONE_SECOND*15)),de(this,"clientId"),de(this,"batchSubscribeTopicsLimit",500),de(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),this.registerEventListeners(),await this.restore()),this.initialized=!0}),de(this,"subscribe",async(i,n)=>{var s;this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:i,opts:n}});try{let o=ls(n),a={topic:i,relay:o,transportType:n?.transportType};(s=n?.internal)!=null&&s.skipSubscribe||this.pending.set(i,a);let c=await this.rpcSubscribe(i,o,n);return typeof c=="string"&&(this.onSubscribe(c,a),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:i,opts:n}})),c}catch(o){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(o),o}}),de(this,"unsubscribe",async(i,n)=>{this.isInitialized(),typeof n?.id<"u"?await this.unsubscribeById(i,n.id,n):await this.unsubscribeByTopic(i,n)}),de(this,"isSubscribed",i=>new Promise(n=>{n(this.topicMap.topics.includes(i))})),de(this,"isKnownTopic",i=>new Promise(n=>{n(this.topicMap.topics.includes(i)||this.pending.has(i)||this.cached.some(s=>s.topic===i))})),de(this,"on",(i,n)=>{this.events.on(i,n)}),de(this,"once",(i,n)=>{this.events.once(i,n)}),de(this,"off",(i,n)=>{this.events.off(i,n)}),de(this,"removeListener",(i,n)=>{this.events.removeListener(i,n)}),de(this,"start",async()=>{await this.onConnect()}),de(this,"stop",async()=>{await this.onDisconnect()}),de(this,"restart",async()=>{await this.restore(),await this.onRestart()}),de(this,"checkPending",async()=>{if(this.pending.size===0&&(!this.initialized||!this.relayer.connected))return;let i=[];this.pending.forEach(n=>{i.push(n)}),await this.batchSubscribe(i)}),de(this,"registerEventListeners",()=>{this.relayer.core.heartbeat.on(Jr.pulse,async()=>{await this.checkPending()}),this.events.on(Ct.created,async i=>{let n=Ct.created;this.logger.info(`Emitting ${n}`),this.logger.debug({type:"event",event:n,data:i}),await this.persist()}),this.events.on(Ct.deleted,async i=>{let n=Ct.deleted;this.logger.info(`Emitting ${n}`),this.logger.debug({type:"event",event:n,data:i}),await this.persist()})}),this.relayer=e,this.logger=Ve(t,this.name),this.clientId=""}get context(){return it(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.relayer.core.customStoragePrefix+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}get hasAnyTopics(){return this.topicMap.topics.length>0||this.pending.size>0||this.cached.length>0||this.subscriptions.size>0}hasSubscription(e,t){let i=!1;try{i=this.getSubscription(e).topic===t}catch{}return i}reset(){this.cached=[],this.initialized=!0}onDisable(){this.values.length>0&&(this.cached=this.values),this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(e,t){let i=this.topicMap.get(e);await Promise.all(i.map(async n=>await this.unsubscribeById(e,n,t)))}async unsubscribeById(e,t,i){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:t,opts:i}});try{let n=ls(i);await this.restartToComplete({topic:e,id:t,relay:n}),await this.rpcUnsubscribe(e,t,n);let s=he("USER_DISCONNECTED",`${this.name}, ${e}`);await this.onUnsubscribe(e,t,s),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:t,opts:i}})}catch(n){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(n),n}}async rpcSubscribe(e,t,i){var n,s;let o=await this.getSubscriptionId(e);if((n=i?.internal)!=null&&n.skipSubscribe)return o;(!i||i?.transportType===ge.relay)&&await this.restartToComplete({topic:e,id:e,relay:t});let a={method:bi(t.protocol).subscribe,params:{topic:e}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:a});let c=(s=i?.internal)==null?void 0:s.throwOnFailedPublish;try{if(i?.transportType===ge.link_mode)return setTimeout(()=>{(this.relayer.connected||this.relayer.connecting)&&this.relayer.request(a).catch(h=>this.logger.warn(h))},(0,G.toMiliseconds)(G.ONE_SECOND)),o;let u=new Promise(async h=>{let d=p=>{p.topic===e&&(this.events.removeListener(Ct.created,d),h(p.id))};this.events.on(Ct.created,d);try{let p=await Kt(new Promise((f,g)=>{this.relayer.request(a).catch(m=>{this.logger.warn(m,m?.message),g(m)}).then(f)}),this.initialSubscribeTimeout,`Subscribing to ${e} failed, please try again`);this.events.removeListener(Ct.created,d),h(p)}catch{}}),l=await Kt(u,this.subscribeTimeout,`Subscribing to ${e} failed, please try again`);if(!l&&c)throw new Error(`Subscribing to ${e} failed, please try again`);return l?o:null}catch(u){if(this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(ve.connection_stalled),c)throw u}return null}async rpcBatchSubscribe(e){if(!e.length)return;let t=e[0].relay,i={method:bi(t.protocol).batchSubscribe,params:{topics:e.map(n=>n.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:i});try{await await Kt(new Promise(n=>{this.relayer.request(i).catch(s=>this.logger.warn(s)).then(n)}),this.subscribeTimeout,"rpcBatchSubscribe failed, please try again")}catch{this.relayer.events.emit(ve.connection_stalled)}}async rpcBatchFetchMessages(e){if(!e.length)return;let t=e[0].relay,i={method:bi(t.protocol).batchFetchMessages,params:{topics:e.map(s=>s.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:i});let n;try{n=await await Kt(new Promise((s,o)=>{this.relayer.request(i).catch(a=>{this.logger.warn(a),o(a)}).then(s)}),this.subscribeTimeout,"rpcBatchFetchMessages failed, please try again")}catch{this.relayer.events.emit(ve.connection_stalled)}return n}rpcUnsubscribe(e,t,i){let n={method:bi(i.protocol).unsubscribe,params:{topic:e,id:t}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:n}),this.relayer.request(n)}onSubscribe(e,t){this.setSubscription(e,sh(Ds({},t),{id:e})),this.pending.delete(t.topic)}onBatchSubscribe(e){e.length&&e.forEach(t=>{this.setSubscription(t.id,Ds({},t)),this.pending.delete(t.topic)})}async onUnsubscribe(e,t,i){this.events.removeAllListeners(t),this.hasSubscription(t,e)&&this.deleteSubscription(t,i),await this.relayer.messages.del(e)}async setRelayerSubscriptions(e){await this.relayer.core.storage.setItem(this.storageKey,e)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(e,t){this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:e,subscription:t}),this.addSubscription(e,t)}addSubscription(e,t){this.subscriptions.set(e,Ds({},t)),this.topicMap.set(t.topic,e),this.events.emit(Ct.created,t)}getSubscription(e){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:e});let t=this.subscriptions.get(e);if(!t){let{message:i}=M("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(i)}return t}deleteSubscription(e,t){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:e,reason:t});let i=this.getSubscription(e);this.subscriptions.delete(e),this.topicMap.delete(i.topic,e),this.events.emit(Ct.deleted,sh(Ds({},i),{reason:t}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(Ct.sync)}async onRestart(){if(this.cached.length){let e=[...this.cached],t=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let i=0;i<t;i++){let n=e.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(n)}}this.events.emit(Ct.resubscribed)}async restore(){try{let e=await this.getRelayerSubscriptions();if(typeof e>"u"||!e.length)return;if(this.subscriptions.size&&!e.every(t=>{var i;return t.topic===((i=this.subscriptions.get(t.id))==null?void 0:i.topic)})){let{message:t}=M("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(t),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),new Error(t)}this.cached=e,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(e){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(e)}}async batchSubscribe(e){e.length&&(await this.rpcBatchSubscribe(e),this.onBatchSubscribe(await Promise.all(e.map(async t=>sh(Ds({},t),{id:await this.getSubscriptionId(t.topic)})))))}async batchFetchMessages(e){if(!e.length)return;this.logger.trace(`Fetching batch messages for ${e.length} subscriptions`);let t=await this.rpcBatchFetchMessages(e);t&&t.messages&&(await bm((0,G.toMiliseconds)(G.ONE_SECOND)),await this.relayer.handleBatchMessageEvents(t.messages))}async onConnect(){await this.restart(),this.reset()}onDisconnect(){this.onDisable()}isInitialized(){if(!this.initialized){let{message:e}=M("NOT_INITIALIZED",this.name);throw new Error(e)}}async restartToComplete(e){!this.relayer.connected&&!this.relayer.connecting&&(this.cached.push(e),await this.relayer.transportOpen())}async getClientId(){return this.clientId||(this.clientId=await this.relayer.core.crypto.getClientId()),this.clientId}async getSubscriptionId(e){return bt(e+await this.getClientId())}},B8=Object.defineProperty,iw=Object.getOwnPropertySymbols,U8=Object.prototype.hasOwnProperty,k8=Object.prototype.propertyIsEnumerable,Ih=(r,e,t)=>e in r?B8(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,nw=(r,e)=>{for(var t in e||(e={}))U8.call(e,t)&&Ih(r,t,e[t]);if(iw)for(var t of iw(e))k8.call(e,t)&&Ih(r,t,e[t]);return r},ae=(r,e,t)=>Ih(r,typeof e!="symbol"?e+"":e,t),Ah=class extends ma{constructor(e){super(e),ae(this,"protocol","wc"),ae(this,"version",2),ae(this,"core"),ae(this,"logger"),ae(this,"events",new Ar.EventEmitter),ae(this,"provider"),ae(this,"messages"),ae(this,"subscriber"),ae(this,"publisher"),ae(this,"name",ID),ae(this,"transportExplicitlyClosed",!1),ae(this,"initialized",!1),ae(this,"connectionAttemptInProgress",!1),ae(this,"relayUrl"),ae(this,"projectId"),ae(this,"packageName"),ae(this,"bundleId"),ae(this,"hasExperiencedNetworkDisruption",!1),ae(this,"pingTimeout"),ae(this,"heartBeatTimeout",(0,G.toMiliseconds)(G.THIRTY_SECONDS+G.FIVE_SECONDS)),ae(this,"reconnectTimeout"),ae(this,"connectPromise"),ae(this,"reconnectInProgress",!1),ae(this,"requestsInFlight",[]),ae(this,"connectTimeout",(0,G.toMiliseconds)(G.ONE_SECOND*15)),ae(this,"request",async t=>{var i,n;this.logger.debug("Publishing Request Payload");let s=t.id||Ut().toString();await this.toEstablishConnection();try{this.logger.trace({id:s,method:t.method,topic:(i=t.params)==null?void 0:i.topic},"relayer.request - publishing...");let o=`${s}:${((n=t.params)==null?void 0:n.tag)||""}`;this.requestsInFlight.push(o);let a=await this.provider.request(t);return this.requestsInFlight=this.requestsInFlight.filter(c=>c!==o),a}catch(o){throw this.logger.debug(`Failed to Publish Request: ${s}`),o}}),ae(this,"resetPingTimeout",()=>{is()&&(clearTimeout(this.pingTimeout),this.pingTimeout=setTimeout(()=>{var t,i,n,s;try{this.logger.debug({},"pingTimeout: Connection stalled, terminating..."),(s=(n=(i=(t=this.provider)==null?void 0:t.connection)==null?void 0:i.socket)==null?void 0:n.terminate)==null||s.call(n)}catch(o){this.logger.warn(o,o?.message)}},this.heartBeatTimeout))}),ae(this,"onPayloadHandler",t=>{this.onProviderPayload(t),this.resetPingTimeout()}),ae(this,"onConnectHandler",()=>{this.logger.warn({},"Relayer connected \u{1F6DC}"),this.startPingTimeout(),this.events.emit(ve.connect)}),ae(this,"onDisconnectHandler",()=>{this.logger.warn({},"Relayer disconnected \u{1F6D1}"),this.requestsInFlight=[],this.onProviderDisconnect()}),ae(this,"onProviderErrorHandler",t=>{this.logger.fatal(`Fatal socket error: ${t.message}`),this.events.emit(ve.error,t),this.logger.fatal("Fatal socket error received, closing transport"),this.transportClose()}),ae(this,"registerProviderListeners",()=>{this.provider.on(kt.payload,this.onPayloadHandler),this.provider.on(kt.connect,this.onConnectHandler),this.provider.on(kt.disconnect,this.onDisconnectHandler),this.provider.on(kt.error,this.onProviderErrorHandler)}),this.core=e.core,this.logger=typeof e.logger<"u"&&typeof e.logger!="string"?Ve(e.logger,this.name):(0,ws.default)(bs({level:e.logger||SD})),this.messages=new vh(this.logger,e.core),this.subscriber=new Sh(this,this.logger),this.publisher=new Eh(this,this.logger),this.projectId=e?.projectId,this.relayUrl=e?.relayUrl||ww,lm()?this.packageName=el():hm()&&(this.bundleId=el()),this.provider={}}async init(){this.logger.trace("Initialized"),this.registerEventListeners(),await Promise.all([this.messages.init(),this.subscriber.init()]),this.initialized=!0,this.transportOpen().catch(e=>this.logger.warn(e,e?.message))}get context(){return it(this.logger)}get connected(){var e,t,i;return((i=(t=(e=this.provider)==null?void 0:e.connection)==null?void 0:t.socket)==null?void 0:i.readyState)===1||!1}get connecting(){var e,t,i;return((i=(t=(e=this.provider)==null?void 0:e.connection)==null?void 0:t.socket)==null?void 0:i.readyState)===0||this.connectPromise!==void 0||!1}async publish(e,t,i){this.isInitialized(),await this.publisher.publish(e,t,i),await this.recordMessageEvent({topic:e,message:t,publishedAt:Date.now(),transportType:ge.relay},ka.outbound)}async publishCustom(e){this.isInitialized(),await this.publisher.publishCustom(e)}async subscribe(e,t){var i,n,s;this.isInitialized(),(!(t!=null&&t.transportType)||t?.transportType==="relay")&&await this.toEstablishConnection();let o=typeof((i=t?.internal)==null?void 0:i.throwOnFailedPublish)>"u"?!0:(n=t?.internal)==null?void 0:n.throwOnFailedPublish,a=((s=this.subscriber.topicMap.get(e))==null?void 0:s[0])||"",c,u=l=>{l.topic===e&&(this.subscriber.off(Ct.created,u),c())};return await Promise.all([new Promise(l=>{c=l,this.subscriber.on(Ct.created,u)}),new Promise(async(l,h)=>{a=await this.subscriber.subscribe(e,nw({internal:{throwOnFailedPublish:o}},t)).catch(d=>{o&&h(d)})||a,l()})]),a}async unsubscribe(e,t){this.isInitialized(),await this.subscriber.unsubscribe(e,t)}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}async transportDisconnect(){this.provider.disconnect&&(this.hasExperiencedNetworkDisruption||this.connected)?await Kt(this.provider.disconnect(),2e3,"provider.disconnect()").catch(()=>this.onProviderDisconnect()):this.onProviderDisconnect()}async transportClose(){this.transportExplicitlyClosed=!0,await this.transportDisconnect()}async transportOpen(e){if(!this.subscriber.hasAnyTopics){this.logger.info("Starting WS connection skipped because the client has no topics to work with.");return}if(this.connectPromise?(this.logger.debug({},"Waiting for existing connection attempt to resolve..."),await this.connectPromise,this.logger.debug({},"Existing connection attempt resolved")):(this.connectPromise=new Promise(async(t,i)=>{await this.connect(e).then(t).catch(i).finally(()=>{this.connectPromise=void 0})}),await this.connectPromise),!this.connected)throw new Error(`Couldn't establish socket connection to the relay server: ${this.relayUrl}`)}async restartTransport(e){this.logger.debug({},"Restarting transport..."),!this.connectionAttemptInProgress&&(this.relayUrl=e||this.relayUrl,await this.confirmOnlineStateOrThrow(),await this.transportClose(),await this.transportOpen())}async confirmOnlineStateOrThrow(){if(!await Nl())throw new Error("No internet connection detected. Please restart your network and try again.")}async handleBatchMessageEvents(e){if(e?.length===0){this.logger.trace("Batch message events is empty. Ignoring...");return}let t=e.sort((i,n)=>i.publishedAt-n.publishedAt);this.logger.debug(`Batch of ${t.length} message events sorted`);for(let i of t)try{await this.onMessageEvent(i)}catch(n){this.logger.warn(n,"Error while processing batch message event: "+n?.message)}this.logger.trace(`Batch of ${t.length} message events processed`)}async onLinkMessageEvent(e,t){let{topic:i}=e;if(!t.sessionExists){let n=_e(G.FIVE_MINUTES),s={topic:i,expiry:n,relay:{protocol:"irn"},active:!1};await this.core.pairing.pairings.set(i,s)}this.events.emit(ve.message,e),await this.recordMessageEvent(e,ka.inbound)}async connect(e){await this.confirmOnlineStateOrThrow(),e&&e!==this.relayUrl&&(this.relayUrl=e,await this.transportDisconnect()),this.connectionAttemptInProgress=!0,this.transportExplicitlyClosed=!1;let t=1;for(;t<6;){try{if(this.transportExplicitlyClosed)break;this.logger.debug({},`Connecting to ${this.relayUrl}, attempt: ${t}...`),await this.createProvider(),await new Promise(async(i,n)=>{let s=()=>{n(new Error("Connection interrupted while trying to connect"))};this.provider.once(kt.disconnect,s),await Kt(new Promise((o,a)=>{this.provider.connect().then(o).catch(a)}),this.connectTimeout,`Socket stalled when trying to connect to ${this.relayUrl}`).catch(o=>{n(o)}).finally(()=>{this.provider.off(kt.disconnect,s),clearTimeout(this.reconnectTimeout)}),await new Promise(async(o,a)=>{let c=()=>{n(new Error("Connection interrupted while trying to subscribe"))};this.provider.once(kt.disconnect,c),await this.subscriber.start().then(o).catch(a).finally(()=>{this.provider.off(kt.disconnect,c)})}),this.hasExperiencedNetworkDisruption=!1,i()})}catch(i){await this.subscriber.stop();let n=i;this.logger.warn({},n.message),this.hasExperiencedNetworkDisruption=!0}finally{this.connectionAttemptInProgress=!1}if(this.connected){this.logger.debug({},`Connected to ${this.relayUrl} successfully on attempt: ${t}`);break}await new Promise(i=>setTimeout(i,(0,G.toMiliseconds)(t*1))),t++}}startPingTimeout(){var e,t,i,n,s;if(is())try{(t=(e=this.provider)==null?void 0:e.connection)!=null&&t.socket&&((s=(n=(i=this.provider)==null?void 0:i.connection)==null?void 0:n.socket)==null||s.on("ping",()=>{this.resetPingTimeout()})),this.resetPingTimeout()}catch(o){this.logger.warn(o,o?.message)}}async createProvider(){this.provider.connection&&this.unregisterProviderListeners();let e=await this.core.crypto.signJWT(this.relayUrl);this.provider=new Ba(new Ua(fm({sdkVersion:ah,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:e,useOnCloseEvent:!0,bundleId:this.bundleId,packageName:this.packageName}))),this.registerProviderListeners()}async recordMessageEvent(e,t){let{topic:i,message:n}=e;await this.messages.set(i,n,t)}async shouldIgnoreMessageEvent(e){let{topic:t,message:i}=e;if(!i||i.length===0)return this.logger.warn(`Ignoring invalid/empty message: ${i}`),!0;if(!await this.subscriber.isKnownTopic(t))return this.logger.warn(`Ignoring message for unknown topic ${t}`),!0;let n=this.messages.has(t,i);return n&&this.logger.warn(`Ignoring duplicate message: ${i}`),n}async onProviderPayload(e){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:e}),dn(e)){if(!e.method.endsWith(AD))return;let t=e.params,{topic:i,message:n,publishedAt:s,attestation:o}=t.data,a={topic:i,message:n,publishedAt:s,transportType:ge.relay,attestation:o};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(nw({type:"event",event:t.id},a)),this.events.emit(t.id,a),await this.acknowledgePayload(e),await this.onMessageEvent(a)}else ei(e)&&this.events.emit(ve.message_ack,e)}async onMessageEvent(e){await this.shouldIgnoreMessageEvent(e)||(await this.recordMessageEvent(e,ka.inbound),this.events.emit(ve.message,e))}async acknowledgePayload(e){let t=Si(e.id,!0);await this.provider.connection.send(t)}unregisterProviderListeners(){this.provider.off(kt.payload,this.onPayloadHandler),this.provider.off(kt.connect,this.onConnectHandler),this.provider.off(kt.disconnect,this.onDisconnectHandler),this.provider.off(kt.error,this.onProviderErrorHandler),clearTimeout(this.pingTimeout)}async registerEventListeners(){let e=await Nl();Uy(async t=>{e!==t&&(e=t,t?await this.transportOpen().catch(i=>this.logger.error(i,i?.message)):(this.hasExperiencedNetworkDisruption=!0,await this.transportDisconnect(),this.transportExplicitlyClosed=!1))}),this.core.heartbeat.on(Jr.pulse,async()=>{if(!this.transportExplicitlyClosed&&!this.connected&&ky())try{await this.confirmOnlineStateOrThrow(),await this.transportOpen()}catch(t){this.logger.warn(t,t?.message)}})}async onProviderDisconnect(){clearTimeout(this.pingTimeout),this.events.emit(ve.disconnect),this.connectionAttemptInProgress=!1,!this.reconnectInProgress&&(this.reconnectInProgress=!0,await this.subscriber.stop(),this.subscriber.hasAnyTopics&&(this.transportExplicitlyClosed||(this.reconnectTimeout=setTimeout(async()=>{await this.transportOpen().catch(e=>this.logger.error(e,e?.message)),this.reconnectTimeout=void 0,this.reconnectInProgress=!1},(0,G.toMiliseconds)(DD)))))}isInitialized(){if(!this.initialized){let{message:e}=M("NOT_INITIALIZED",this.name);throw new Error(e)}}async toEstablishConnection(){if(await this.confirmOnlineStateOrThrow(),!this.connected){if(this.connectPromise){await this.connectPromise;return}await this.connect()}}};function L8(r,e){return r===e||Number.isNaN(r)&&Number.isNaN(e)}function sw(r){return Object.getOwnPropertySymbols(r).filter(e=>Object.prototype.propertyIsEnumerable.call(r,e))}function ow(r){return r==null?r===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(r)}var M8="[object RegExp]",q8="[object String]",z8="[object Number]",j8="[object Boolean]",aw="[object Arguments]",V8="[object Symbol]",$8="[object Date]",K8="[object Map]",H8="[object Set]",W8="[object Array]",G8="[object Function]",Y8="[object ArrayBuffer]",oh="[object Object]",J8="[object Error]",X8="[object DataView]",Q8="[object Uint8Array]",Z8="[object Uint8ClampedArray]",eC="[object Uint16Array]",tC="[object Uint32Array]",rC="[object BigUint64Array]",iC="[object Int8Array]",nC="[object Int16Array]",sC="[object Int32Array]",oC="[object BigInt64Array]",aC="[object Float32Array]",cC="[object Float64Array]";function uC(){}function cw(r){if(!r||typeof r!="object")return!1;let e=Object.getPrototypeOf(r);return e===null||e===Object.prototype||Object.getPrototypeOf(e)===null?Object.prototype.toString.call(r)==="[object Object]":!1}function lC(r,e,t){return Cs(r,e,void 0,void 0,void 0,void 0,t)}function Cs(r,e,t,i,n,s,o){let a=o(r,e,t,i,n,s);if(a!==void 0)return a;if(typeof r==typeof e)switch(typeof r){case"bigint":case"string":case"boolean":case"symbol":case"undefined":return r===e;case"number":return r===e||Object.is(r,e);case"function":return r===e;case"object":return Os(r,e,s,o)}return Os(r,e,s,o)}function Os(r,e,t,i){if(Object.is(r,e))return!0;let n=ow(r),s=ow(e);if(n===aw&&(n=oh),s===aw&&(s=oh),n!==s)return!1;switch(n){case q8:return r.toString()===e.toString();case z8:{let c=r.valueOf(),u=e.valueOf();return L8(c,u)}case j8:case $8:case V8:return Object.is(r.valueOf(),e.valueOf());case M8:return r.source===e.source&&r.flags===e.flags;case G8:return r===e}t=t??new Map;let o=t.get(r),a=t.get(e);if(o!=null&&a!=null)return o===e;t.set(r,e),t.set(e,r);try{switch(n){case K8:{if(r.size!==e.size)return!1;for(let[c,u]of r.entries())if(!e.has(c)||!Cs(u,e.get(c),c,r,e,t,i))return!1;return!0}case H8:{if(r.size!==e.size)return!1;let c=Array.from(r.values()),u=Array.from(e.values());for(let l=0;l<c.length;l++){let h=c[l],d=u.findIndex(p=>Cs(h,p,void 0,r,e,t,i));if(d===-1)return!1;u.splice(d,1)}return!0}case W8:case Q8:case Z8:case eC:case tC:case rC:case iC:case nC:case sC:case oC:case aC:case cC:{if(typeof Buffer<"u"&&Buffer.isBuffer(r)!==Buffer.isBuffer(e)||r.length!==e.length)return!1;for(let c=0;c<r.length;c++)if(!Cs(r[c],e[c],c,r,e,t,i))return!1;return!0}case Y8:return r.byteLength!==e.byteLength?!1:Os(new Uint8Array(r),new Uint8Array(e),t,i);case X8:return r.byteLength!==e.byteLength||r.byteOffset!==e.byteOffset?!1:Os(new Uint8Array(r),new Uint8Array(e),t,i);case J8:return r.name===e.name&&r.message===e.message;case oh:{if(!(Os(r.constructor,e.constructor,t,i)||cw(r)&&cw(e)))return!1;let c=[...Object.keys(r),...sw(r)],u=[...Object.keys(e),...sw(e)];if(c.length!==u.length)return!1;for(let l=0;l<c.length;l++){let h=c[l],d=r[h];if(!Object.hasOwn(e,h))return!1;let p=e[h];if(!Cs(d,p,h,r,e,t,i))return!1}return!0}default:return!1}}finally{t.delete(r),t.delete(e)}}function hC(r,e){return lC(r,e,uC)}var dC=Object.defineProperty,uw=Object.getOwnPropertySymbols,fC=Object.prototype.hasOwnProperty,pC=Object.prototype.propertyIsEnumerable,Dh=(r,e,t)=>e in r?dC(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,lw=(r,e)=>{for(var t in e||(e={}))fC.call(e,t)&&Dh(r,t,e[t]);if(uw)for(var t of uw(e))pC.call(e,t)&&Dh(r,t,e[t]);return r},Et=(r,e,t)=>Dh(r,typeof e!="symbol"?e+"":e,t),cr=class extends ya{constructor(e,t,i,n=ar,s=void 0){super(e,t,i,n),this.core=e,this.logger=t,this.name=i,Et(this,"map",new Map),Et(this,"version",TD),Et(this,"cached",[]),Et(this,"initialized",!1),Et(this,"getKey"),Et(this,"storagePrefix",ar),Et(this,"recentlyDeleted",[]),Et(this,"recentlyDeletedLimit",200),Et(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(o=>{this.getKey&&o!==null&&!xe(o)?this.map.set(this.getKey(o),o):xy(o)?this.map.set(o.id,o):_y(o)&&this.map.set(o.topic,o)}),this.cached=[],this.initialized=!0)}),Et(this,"set",async(o,a)=>{this.isInitialized(),this.map.has(o)?await this.update(o,a):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:o,value:a}),this.map.set(o,a),await this.persist())}),Et(this,"get",o=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:o}),this.getData(o))),Et(this,"getAll",o=>(this.isInitialized(),o?this.values.filter(a=>Object.keys(o).every(c=>hC(a[c],o[c]))):this.values)),Et(this,"update",async(o,a)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:o,update:a});let c=lw(lw({},this.getData(o)),a);this.map.set(o,c),await this.persist()}),Et(this,"delete",async(o,a)=>{this.isInitialized(),this.map.has(o)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:o,reason:a}),this.map.delete(o),this.addToRecentlyDeleted(o),await this.persist())}),this.logger=Ve(t,this.name),this.storagePrefix=n,this.getKey=s}get context(){return it(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}addToRecentlyDeleted(e){this.recentlyDeleted.push(e),this.recentlyDeleted.length>=this.recentlyDeletedLimit&&this.recentlyDeleted.splice(0,this.recentlyDeletedLimit/2)}async setDataStore(e){await this.core.storage.setItem(this.storageKey,e)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(e){let t=this.map.get(e);if(!t){if(this.recentlyDeleted.includes(e)){let{message:n}=M("MISSING_OR_INVALID",`Record was recently deleted - ${this.name}: ${e}`);throw this.logger.error(n),new Error(n)}let{message:i}=M("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.error(i),new Error(i)}return t}async persist(){await this.setDataStore(this.values)}async restore(){try{let e=await this.getDataStore();if(typeof e>"u"||!e.length)return;if(this.map.size){let{message:t}=M("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(t),new Error(t)}this.cached=e,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(e){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(e)}}isInitialized(){if(!this.initialized){let{message:e}=M("NOT_INITIALIZED",this.name);throw new Error(e)}}},gC=Object.defineProperty,mC=(r,e,t)=>e in r?gC(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,re=(r,e,t)=>mC(r,typeof e!="symbol"?e+"":e,t),Th=class{constructor(e,t){this.core=e,this.logger=t,re(this,"name",ND),re(this,"version",PD),re(this,"events",new Ar.default),re(this,"pairings"),re(this,"initialized",!1),re(this,"storagePrefix",ar),re(this,"ignoredPayloadTypes",[Ht]),re(this,"registeredMethods",[]),re(this,"init",async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))}),re(this,"register",({methods:i})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...i])]}),re(this,"create",async i=>{this.isInitialized();let n=ea(),s=await this.core.crypto.setSymKey(n),o=_e(G.FIVE_MINUTES),a={protocol:kh},c={topic:s,expiry:o,relay:a,active:!1,methods:i?.methods},u=Al({protocol:this.core.protocol,version:this.core.version,topic:s,symKey:n,relay:a,expiryTimestamp:o,methods:i?.methods});return this.events.emit(ti.create,c),this.core.expirer.set(s,o),await this.pairings.set(s,c),await this.core.relayer.subscribe(s,{transportType:i?.transportType,internal:i?.internal}),{topic:s,uri:u}}),re(this,"pair",async i=>{this.isInitialized();let n=this.core.eventClient.createEvent({properties:{topic:i?.uri,trace:[Yt.pairing_started]}});this.isValidPair(i,n);let{topic:s,symKey:o,relay:a,expiryTimestamp:c,methods:u}=Il(i.uri);n.props.properties.topic=s,n.addTrace(Yt.pairing_uri_validation_success),n.addTrace(Yt.pairing_uri_not_expired);let l;if(this.pairings.keys.includes(s)){if(l=this.pairings.get(s),n.addTrace(Yt.existing_pairing),l.active)throw n.setError(or.active_pairing_already_exists),new Error(`Pairing already exists: ${s}. Please try again with a new connection URI.`);n.addTrace(Yt.pairing_not_expired)}let h=c||_e(G.FIVE_MINUTES),d={topic:s,relay:a,expiry:h,active:!1,methods:u};this.core.expirer.set(s,h),await this.pairings.set(s,d),n.addTrace(Yt.store_new_pairing),i.activatePairing&&await this.activate({topic:s}),this.events.emit(ti.create,d),n.addTrace(Yt.emit_inactive_pairing),this.core.crypto.keychain.has(s)||await this.core.crypto.setSymKey(o,s),n.addTrace(Yt.subscribing_pairing_topic);try{await this.core.relayer.confirmOnlineStateOrThrow()}catch{n.setError(or.no_internet_connection)}try{await this.core.relayer.subscribe(s,{relay:a})}catch(p){throw n.setError(or.subscribe_pairing_topic_failure),p}return n.addTrace(Yt.subscribe_pairing_topic_success),d}),re(this,"activate",async({topic:i})=>{this.isInitialized();let n=_e(G.FIVE_MINUTES);this.core.expirer.set(i,n),await this.pairings.update(i,{active:!0,expiry:n})}),re(this,"ping",async i=>{this.isInitialized(),await this.isValidPing(i),this.logger.warn("ping() is deprecated and will be removed in the next major release.");let{topic:n}=i;if(this.pairings.keys.includes(n)){let s=await this.sendRequest(n,"wc_pairingPing",{}),{done:o,resolve:a,reject:c}=xr();this.events.once(oe("pairing_ping",s),({error:u})=>{u?c(u):a()}),await o()}}),re(this,"updateExpiry",async({topic:i,expiry:n})=>{this.isInitialized(),await this.pairings.update(i,{expiry:n})}),re(this,"updateMetadata",async({topic:i,metadata:n})=>{this.isInitialized(),await this.pairings.update(i,{peerMetadata:n})}),re(this,"getPairings",()=>(this.isInitialized(),this.pairings.values)),re(this,"disconnect",async i=>{this.isInitialized(),await this.isValidDisconnect(i);let{topic:n}=i;this.pairings.keys.includes(n)&&(await this.sendRequest(n,"wc_pairingDelete",he("USER_DISCONNECTED")),await this.deletePairing(n))}),re(this,"formatUriFromPairing",i=>{this.isInitialized();let{topic:n,relay:s,expiry:o,methods:a}=i,c=this.core.crypto.keychain.get(n);return Al({protocol:this.core.protocol,version:this.core.version,topic:n,symKey:c,relay:s,expiryTimestamp:o,methods:a})}),re(this,"sendRequest",async(i,n,s)=>{let o=At(n,s),a=await this.core.crypto.encode(i,o),c=As[n].req;return this.core.history.set(i,o),this.core.relayer.publish(i,a,c),o.id}),re(this,"sendResult",async(i,n,s)=>{let o=Si(i,s),a=await this.core.crypto.encode(n,o),c=(await this.core.history.get(n,i)).request.method,u=As[c].res;await this.core.relayer.publish(n,a,u),await this.core.history.resolve(o)}),re(this,"sendError",async(i,n,s)=>{let o=Ii(i,s),a=await this.core.crypto.encode(n,o),c=(await this.core.history.get(n,i)).request.method,u=As[c]?As[c].res:As.unregistered_method.res;await this.core.relayer.publish(n,a,u),await this.core.history.resolve(o)}),re(this,"deletePairing",async(i,n)=>{await this.core.relayer.unsubscribe(i),await Promise.all([this.pairings.delete(i,he("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(i),n?Promise.resolve():this.core.expirer.del(i)])}),re(this,"cleanup",async()=>{let i=this.pairings.getAll().filter(n=>ir(n.expiry));await Promise.all(i.map(n=>this.deletePairing(n.topic)))}),re(this,"onRelayEventRequest",async i=>{let{topic:n,payload:s}=i;switch(s.method){case"wc_pairingPing":return await this.onPairingPingRequest(n,s);case"wc_pairingDelete":return await this.onPairingDeleteRequest(n,s);default:return await this.onUnknownRpcMethodRequest(n,s)}}),re(this,"onRelayEventResponse",async i=>{let{topic:n,payload:s}=i,o=(await this.core.history.get(n,s.id)).request.method;switch(o){case"wc_pairingPing":return this.onPairingPingResponse(n,s);default:return this.onUnknownRpcMethodResponse(o)}}),re(this,"onPairingPingRequest",async(i,n)=>{let{id:s}=n;try{this.isValidPing({topic:i}),await this.sendResult(s,i,!0),this.events.emit(ti.ping,{id:s,topic:i})}catch(o){await this.sendError(s,i,o),this.logger.error(o)}}),re(this,"onPairingPingResponse",(i,n)=>{let{id:s}=n;setTimeout(()=>{Dt(n)?this.events.emit(oe("pairing_ping",s),{}):nt(n)&&this.events.emit(oe("pairing_ping",s),{error:n.error})},500)}),re(this,"onPairingDeleteRequest",async(i,n)=>{let{id:s}=n;try{this.isValidDisconnect({topic:i}),await this.deletePairing(i),this.events.emit(ti.delete,{id:s,topic:i})}catch(o){await this.sendError(s,i,o),this.logger.error(o)}}),re(this,"onUnknownRpcMethodRequest",async(i,n)=>{let{id:s,method:o}=n;try{if(this.registeredMethods.includes(o))return;let a=he("WC_METHOD_UNSUPPORTED",o);await this.sendError(s,i,a),this.logger.error(a)}catch(a){await this.sendError(s,i,a),this.logger.error(a)}}),re(this,"onUnknownRpcMethodResponse",i=>{this.registeredMethods.includes(i)||this.logger.error(he("WC_METHOD_UNSUPPORTED",i))}),re(this,"isValidPair",(i,n)=>{var s;if(!rt(i)){let{message:a}=M("MISSING_OR_INVALID",`pair() params: ${i}`);throw n.setError(or.malformed_pairing_uri),new Error(a)}if(!Ey(i.uri)){let{message:a}=M("MISSING_OR_INVALID",`pair() uri: ${i.uri}`);throw n.setError(or.malformed_pairing_uri),new Error(a)}let o=Il(i?.uri);if(!((s=o?.relay)!=null&&s.protocol)){let{message:a}=M("MISSING_OR_INVALID","pair() uri#relay-protocol");throw n.setError(or.malformed_pairing_uri),new Error(a)}if(!(o!=null&&o.symKey)){let{message:a}=M("MISSING_OR_INVALID","pair() uri#symKey");throw n.setError(or.malformed_pairing_uri),new Error(a)}if(o!=null&&o.expiryTimestamp&&(0,G.toMiliseconds)(o?.expiryTimestamp)<Date.now()){n.setError(or.pairing_expired);let{message:a}=M("EXPIRED","pair() URI has expired. Please try again with a new connection URI.");throw new Error(a)}}),re(this,"isValidPing",async i=>{if(!rt(i)){let{message:s}=M("MISSING_OR_INVALID",`ping() params: ${i}`);throw new Error(s)}let{topic:n}=i;await this.isValidPairingTopic(n)}),re(this,"isValidDisconnect",async i=>{if(!rt(i)){let{message:s}=M("MISSING_OR_INVALID",`disconnect() params: ${i}`);throw new Error(s)}let{topic:n}=i;await this.isValidPairingTopic(n)}),re(this,"isValidPairingTopic",async i=>{if(!we(i,!1)){let{message:n}=M("MISSING_OR_INVALID",`pairing topic should be a string: ${i}`);throw new Error(n)}if(!this.pairings.keys.includes(i)){let{message:n}=M("NO_MATCHING_KEY",`pairing topic doesn't exist: ${i}`);throw new Error(n)}if(ir(this.pairings.get(i).expiry)){await this.deletePairing(i);let{message:n}=M("EXPIRED",`pairing topic: ${i}`);throw new Error(n)}}),this.core=e,this.logger=Ve(t,this.name),this.pairings=new cr(this.core,this.logger,this.name,this.storagePrefix)}get context(){return it(this.logger)}isInitialized(){if(!this.initialized){let{message:e}=M("NOT_INITIALIZED",this.name);throw new Error(e)}}registerRelayerEvents(){this.core.relayer.on(ve.message,async e=>{let{topic:t,message:i,transportType:n}=e;if(this.pairings.keys.includes(t)&&n!==ge.link_mode&&!this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(i)))try{let s=await this.core.crypto.decode(t,i);dn(s)?(this.core.history.set(t,s),await this.onRelayEventRequest({topic:t,payload:s})):ei(s)&&(await this.core.history.resolve(s),await this.onRelayEventResponse({topic:t,payload:s}),this.core.history.delete(t,s.id)),await this.core.relayer.messages.ack(t,i)}catch(s){this.logger.error(s)}})}registerExpirerEvents(){this.core.expirer.on(Ot.expired,async e=>{let{topic:t}=Ho(e.target);t&&this.pairings.keys.includes(t)&&(await this.deletePairing(t,!0),this.events.emit(ti.expire,{topic:t}))})}},yC=Object.defineProperty,wC=(r,e,t)=>e in r?yC(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Ke=(r,e,t)=>wC(r,typeof e!="symbol"?e+"":e,t),Ch=class extends fa{constructor(e,t){super(e,t),this.core=e,this.logger=t,Ke(this,"records",new Map),Ke(this,"events",new Ar.EventEmitter),Ke(this,"name",FD),Ke(this,"version",BD),Ke(this,"cached",[]),Ke(this,"initialized",!1),Ke(this,"storagePrefix",ar),Ke(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(i=>this.records.set(i.id,i)),this.cached=[],this.registerEventListeners(),this.initialized=!0)}),Ke(this,"set",(i,n,s)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:i,request:n,chainId:s}),this.records.has(n.id))return;let o={id:n.id,topic:i,request:{method:n.method,params:n.params||null},chainId:s,expiry:_e(G.THIRTY_DAYS)};this.records.set(o.id,o),this.persist(),this.events.emit(Gt.created,o)}),Ke(this,"resolve",async i=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:i}),!this.records.has(i.id))return;let n=await this.getRecord(i.id);typeof n.response>"u"&&(n.response=nt(i)?{error:i.error}:{result:i.result},this.records.set(n.id,n),this.persist(),this.events.emit(Gt.updated,n))}),Ke(this,"get",async(i,n)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:i,id:n}),await this.getRecord(n))),Ke(this,"delete",(i,n)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:n}),this.values.forEach(s=>{if(s.topic===i){if(typeof n<"u"&&s.id!==n)return;this.records.delete(s.id),this.events.emit(Gt.deleted,s)}}),this.persist()}),Ke(this,"exists",async(i,n)=>(this.isInitialized(),this.records.has(n)?(await this.getRecord(n)).topic===i:!1)),Ke(this,"on",(i,n)=>{this.events.on(i,n)}),Ke(this,"once",(i,n)=>{this.events.once(i,n)}),Ke(this,"off",(i,n)=>{this.events.off(i,n)}),Ke(this,"removeListener",(i,n)=>{this.events.removeListener(i,n)}),this.logger=Ve(t,this.name)}get context(){return it(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){let e=[];return this.values.forEach(t=>{if(typeof t.response<"u")return;let i={topic:t.topic,request:At(t.request.method,t.request.params,t.id),chainId:t.chainId};return e.push(i)}),e}async setJsonRpcRecords(e){await this.core.storage.setItem(this.storageKey,e)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(e){this.isInitialized();let t=this.records.get(e);if(!t){let{message:i}=M("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(i)}return t}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(Gt.sync)}async restore(){try{let e=await this.getJsonRpcRecords();if(typeof e>"u"||!e.length)return;if(this.records.size){let{message:t}=M("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(t),new Error(t)}this.cached=e,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(e){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(e)}}registerEventListeners(){this.events.on(Gt.created,e=>{let t=Gt.created;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,record:e})}),this.events.on(Gt.updated,e=>{let t=Gt.updated;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,record:e})}),this.events.on(Gt.deleted,e=>{let t=Gt.deleted;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,record:e})}),this.core.heartbeat.on(Jr.pulse,()=>{this.cleanup()})}cleanup(){try{this.isInitialized();let e=!1;this.records.forEach(t=>{(0,G.toMiliseconds)(t.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${t.id}`),this.records.delete(t.id),this.events.emit(Gt.deleted,t,!1),e=!0)}),e&&this.persist()}catch(e){this.logger.warn(e)}}isInitialized(){if(!this.initialized){let{message:e}=M("NOT_INITIALIZED",this.name);throw new Error(e)}}},vC=Object.defineProperty,bC=(r,e,t)=>e in r?vC(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,ot=(r,e,t)=>bC(r,typeof e!="symbol"?e+"":e,t),Oh=class extends va{constructor(e,t){super(e,t),this.core=e,this.logger=t,ot(this,"expirations",new Map),ot(this,"events",new Ar.EventEmitter),ot(this,"name",UD),ot(this,"version",kD),ot(this,"cached",[]),ot(this,"initialized",!1),ot(this,"storagePrefix",ar),ot(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(i=>this.expirations.set(i.target,i)),this.cached=[],this.registerEventListeners(),this.initialized=!0)}),ot(this,"has",i=>{try{let n=this.formatTarget(i);return typeof this.getExpiration(n)<"u"}catch{return!1}}),ot(this,"set",(i,n)=>{this.isInitialized();let s=this.formatTarget(i),o={target:s,expiry:n};this.expirations.set(s,o),this.checkExpiry(s,o),this.events.emit(Ot.created,{target:s,expiration:o})}),ot(this,"get",i=>{this.isInitialized();let n=this.formatTarget(i);return this.getExpiration(n)}),ot(this,"del",i=>{if(this.isInitialized(),this.has(i)){let n=this.formatTarget(i),s=this.getExpiration(n);this.expirations.delete(n),this.events.emit(Ot.deleted,{target:n,expiration:s})}}),ot(this,"on",(i,n)=>{this.events.on(i,n)}),ot(this,"once",(i,n)=>{this.events.once(i,n)}),ot(this,"off",(i,n)=>{this.events.off(i,n)}),ot(this,"removeListener",(i,n)=>{this.events.removeListener(i,n)}),this.logger=Ve(t,this.name)}get context(){return it(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(e){if(typeof e=="string")return gm(e);if(typeof e=="number")return mm(e);let{message:t}=M("UNKNOWN_TYPE",`Target type: ${typeof e}`);throw new Error(t)}async setExpirations(e){await this.core.storage.setItem(this.storageKey,e)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(Ot.sync)}async restore(){try{let e=await this.getExpirations();if(typeof e>"u"||!e.length)return;if(this.expirations.size){let{message:t}=M("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(t),new Error(t)}this.cached=e,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(e){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(e)}}getExpiration(e){let t=this.expirations.get(e);if(!t){let{message:i}=M("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.warn(i),new Error(i)}return t}checkExpiry(e,t){let{expiry:i}=t;(0,G.toMiliseconds)(i)-Date.now()<=0&&this.expire(e,t)}expire(e,t){this.expirations.delete(e),this.events.emit(Ot.expired,{target:e,expiration:t})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((e,t)=>this.checkExpiry(t,e))}registerEventListeners(){this.core.heartbeat.on(Jr.pulse,()=>this.checkExpirations()),this.events.on(Ot.created,e=>{let t=Ot.created;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:e}),this.persist()}),this.events.on(Ot.expired,e=>{let t=Ot.expired;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:e}),this.persist()}),this.events.on(Ot.deleted,e=>{let t=Ot.deleted;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:e}),this.persist()})}isInitialized(){if(!this.initialized){let{message:e}=M("NOT_INITIALIZED",this.name);throw new Error(e)}}},EC=Object.defineProperty,xC=(r,e,t)=>e in r?EC(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Ae=(r,e,t)=>xC(r,typeof e!="symbol"?e+"":e,t),Rh=class extends ba{constructor(e,t,i){super(e,t,i),this.core=e,this.logger=t,this.store=i,Ae(this,"name",LD),Ae(this,"abortController"),Ae(this,"isDevEnv"),Ae(this,"verifyUrlV3",qD),Ae(this,"storagePrefix",ar),Ae(this,"version",yw),Ae(this,"publicKey"),Ae(this,"fetchPromise"),Ae(this,"init",async()=>{var n;this.isDevEnv||(this.publicKey=await this.store.getItem(this.storeKey),this.publicKey&&(0,G.toMiliseconds)((n=this.publicKey)==null?void 0:n.expiresAt)<Date.now()&&(this.logger.debug("verify v2 public key expired"),await this.removePublicKey()))}),Ae(this,"register",async n=>{if(!vi()||this.isDevEnv)return;let s=window.location.origin,{id:o,decryptedId:a}=n,c=`${this.verifyUrlV3}/attestation?projectId=${this.core.projectId}&origin=${s}&id=${o}&decryptedId=${a}`;try{let u=(0,gw.getDocument)(),l=this.startAbortTimer(G.ONE_SECOND*5),h=await new Promise((d,p)=>{let f=()=>{window.removeEventListener("message",m),u.body.removeChild(g),p("attestation aborted")};this.abortController.signal.addEventListener("abort",f);let g=u.createElement("iframe");g.src=c,g.style.display="none",g.addEventListener("error",f,{signal:this.abortController.signal});let m=w=>{if(w.data&&typeof w.data=="string")try{let v=JSON.parse(w.data);if(v.type==="verify_attestation"){if(Bn(v.attestation).payload.id!==o)return;clearInterval(l),u.body.removeChild(g),this.abortController.signal.removeEventListener("abort",f),window.removeEventListener("message",m),d(v.attestation===null?"":v.attestation)}}catch(v){this.logger.warn(v)}};u.body.appendChild(g),window.addEventListener("message",m,{signal:this.abortController.signal})});return this.logger.debug("jwt attestation",h),h}catch(u){this.logger.warn(u)}return""}),Ae(this,"resolve",async n=>{if(this.isDevEnv)return"";let{attestationId:s,hash:o,encryptedId:a}=n;if(s===""){this.logger.debug("resolve: attestationId is empty, skipping");return}if(s){if(Bn(s).payload.id!==a)return;let u=await this.isValidJwtAttestation(s);if(u){if(!u.isVerified){this.logger.warn("resolve: jwt attestation: origin url not verified");return}return u}}if(!o)return;let c=this.getVerifyUrl(n?.verifyUrl);return this.fetchAttestation(o,c)}),Ae(this,"fetchAttestation",async(n,s)=>{this.logger.debug(`resolving attestation: ${n} from url: ${s}`);let o=this.startAbortTimer(G.ONE_SECOND*5),a=await fetch(`${s}/attestation/${n}?v2Supported=true`,{signal:this.abortController.signal});return clearTimeout(o),a.status===200?await a.json():void 0}),Ae(this,"getVerifyUrl",n=>{let s=n||gn;return zD.includes(s)||(this.logger.info(`verify url: ${s}, not included in trusted list, assigning default: ${gn}`),s=gn),s}),Ae(this,"fetchPublicKey",async()=>{try{this.logger.debug(`fetching public key from: ${this.verifyUrlV3}`);let n=this.startAbortTimer(G.FIVE_SECONDS),s=await fetch(`${this.verifyUrlV3}/public-key`,{signal:this.abortController.signal});return clearTimeout(n),await s.json()}catch(n){this.logger.warn(n)}}),Ae(this,"persistPublicKey",async n=>{this.logger.debug("persisting public key to local storage",n),await this.store.setItem(this.storeKey,n),this.publicKey=n}),Ae(this,"removePublicKey",async()=>{this.logger.debug("removing verify v2 public key from storage"),await this.store.removeItem(this.storeKey),this.publicKey=void 0}),Ae(this,"isValidJwtAttestation",async n=>{let s=await this.getPublicKey();try{if(s)return this.validateAttestation(n,s)}catch(a){this.logger.error(a),this.logger.warn("error validating attestation")}let o=await this.fetchAndPersistPublicKey();try{if(o)return this.validateAttestation(n,o)}catch(a){this.logger.error(a),this.logger.warn("error validating attestation")}}),Ae(this,"getPublicKey",async()=>this.publicKey?this.publicKey:await this.fetchAndPersistPublicKey()),Ae(this,"fetchAndPersistPublicKey",async()=>{if(this.fetchPromise)return await this.fetchPromise,this.publicKey;this.fetchPromise=new Promise(async s=>{let o=await this.fetchPublicKey();o&&(await this.persistPublicKey(o),s(o))});let n=await this.fetchPromise;return this.fetchPromise=void 0,n}),Ae(this,"validateAttestation",(n,s)=>{let o=yy(n,s.publicKey),a={hasExpired:(0,G.toMiliseconds)(o.exp)<Date.now(),payload:o};if(a.hasExpired)throw this.logger.warn("resolve: jwt attestation expired"),new Error("JWT attestation expired");return{origin:a.payload.origin,isScam:a.payload.isScam,isVerified:a.payload.isVerified}}),this.logger=Ve(t,this.name),this.abortController=new AbortController,this.isDevEnv=ss(),this.init()}get storeKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//verify:public:key"}get context(){return it(this.logger)}startAbortTimer(e){return this.abortController=new AbortController,setTimeout(()=>this.abortController.abort(),(0,G.toMiliseconds)(e))}},_C=Object.defineProperty,SC=(r,e,t)=>e in r?_C(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,hw=(r,e,t)=>SC(r,typeof e!="symbol"?e+"":e,t),Nh=class extends Ea{constructor(e,t){super(e,t),this.projectId=e,this.logger=t,hw(this,"context",jD),hw(this,"registerDeviceToken",async i=>{let{clientId:n,token:s,notificationType:o,enableEncrypted:a=!1}=i,c=`${VD}/${this.projectId}/clients`;await fetch(c,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({client_id:n,type:o,token:s,always_raw:a})})}),this.logger=Ve(t,this.context)}},IC=Object.defineProperty,dw=Object.getOwnPropertySymbols,AC=Object.prototype.hasOwnProperty,DC=Object.prototype.propertyIsEnumerable,Ph=(r,e,t)=>e in r?IC(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Ts=(r,e)=>{for(var t in e||(e={}))AC.call(e,t)&&Ph(r,t,e[t]);if(dw)for(var t of dw(e))DC.call(e,t)&&Ph(r,t,e[t]);return r},Fe=(r,e,t)=>Ph(r,typeof e!="symbol"?e+"":e,t),Fh=class extends xa{constructor(e,t,i=!0){super(e,t,i),this.core=e,this.logger=t,Fe(this,"context",KD),Fe(this,"storagePrefix",ar),Fe(this,"storageVersion",$D),Fe(this,"events",new Map),Fe(this,"shouldPersist",!1),Fe(this,"init",async()=>{if(!ss())try{let n={eventId:nl(),timestamp:Date.now(),domain:this.getAppDomain(),props:{event:"INIT",type:"",properties:{client_id:await this.core.crypto.getClientId(),user_agent:rl(this.core.relayer.protocol,this.core.relayer.version,ah)}}};await this.sendEvent([n])}catch(n){this.logger.warn(n)}}),Fe(this,"createEvent",n=>{let{event:s="ERROR",type:o="",properties:{topic:a,trace:c}}=n,u=nl(),l=this.core.projectId||"",h=Date.now(),d=Ts({eventId:u,timestamp:h,props:{event:s,type:o,properties:{topic:a,trace:c}},bundleId:l,domain:this.getAppDomain()},this.setMethods(u));return this.telemetryEnabled&&(this.events.set(u,d),this.shouldPersist=!0),d}),Fe(this,"getEvent",n=>{let{eventId:s,topic:o}=n;if(s)return this.events.get(s);let a=Array.from(this.events.values()).find(c=>c.props.properties.topic===o);if(a)return Ts(Ts({},a),this.setMethods(a.eventId))}),Fe(this,"deleteEvent",n=>{let{eventId:s}=n;this.events.delete(s),this.shouldPersist=!0}),Fe(this,"setEventListeners",()=>{this.core.heartbeat.on(Jr.pulse,async()=>{this.shouldPersist&&await this.persist(),this.events.forEach(n=>{(0,G.fromMiliseconds)(Date.now())-(0,G.fromMiliseconds)(n.timestamp)>HD&&(this.events.delete(n.eventId),this.shouldPersist=!0)})})}),Fe(this,"setMethods",n=>({addTrace:s=>this.addTrace(n,s),setError:s=>this.setError(n,s)})),Fe(this,"addTrace",(n,s)=>{let o=this.events.get(n);o&&(o.props.properties.trace.push(s),this.events.set(n,o),this.shouldPersist=!0)}),Fe(this,"setError",(n,s)=>{let o=this.events.get(n);o&&(o.props.type=s,o.timestamp=Date.now(),this.events.set(n,o),this.shouldPersist=!0)}),Fe(this,"persist",async()=>{await this.core.storage.setItem(this.storageKey,Array.from(this.events.values())),this.shouldPersist=!1}),Fe(this,"restore",async()=>{try{let n=await this.core.storage.getItem(this.storageKey)||[];if(!n.length)return;n.forEach(s=>{this.events.set(s.eventId,Ts(Ts({},s),this.setMethods(s.eventId)))})}catch(n){this.logger.warn(n)}}),Fe(this,"submit",async()=>{if(!this.telemetryEnabled||this.events.size===0)return;let n=[];for(let[s,o]of this.events)o.props.type&&n.push(o);if(n.length!==0)try{if((await this.sendEvent(n)).ok)for(let s of n)this.events.delete(s.eventId),this.shouldPersist=!0}catch(s){this.logger.warn(s)}}),Fe(this,"sendEvent",async n=>{let s=this.getAppDomain()?"":"&sp=desktop";return await fetch(`${WD}?projectId=${this.core.projectId}&st=events_sdk&sv=js-${ah}${s}`,{method:"POST",body:JSON.stringify(n)})}),Fe(this,"getAppDomain",()=>tl().url),this.logger=Ve(t,this.context),this.telemetryEnabled=i,i?this.restore().then(async()=>{await this.submit(),this.setEventListeners()}):this.persist()}get storageKey(){return this.storagePrefix+this.storageVersion+this.core.customStoragePrefix+"//"+this.context}},TC=Object.defineProperty,fw=Object.getOwnPropertySymbols,CC=Object.prototype.hasOwnProperty,OC=Object.prototype.propertyIsEnumerable,Bh=(r,e,t)=>e in r?TC(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,pw=(r,e)=>{for(var t in e||(e={}))CC.call(e,t)&&Bh(r,t,e[t]);if(fw)for(var t of fw(e))OC.call(e,t)&&Bh(r,t,e[t]);return r},pe=(r,e,t)=>Bh(r,typeof e!="symbol"?e+"":e,t),Uh=class r extends da{constructor(e){var t;super(e),pe(this,"protocol",mw),pe(this,"version",yw),pe(this,"name",La),pe(this,"relayUrl"),pe(this,"projectId"),pe(this,"customStoragePrefix"),pe(this,"events",new Ar.EventEmitter),pe(this,"logger"),pe(this,"heartbeat"),pe(this,"relayer"),pe(this,"crypto"),pe(this,"storage"),pe(this,"history"),pe(this,"expirer"),pe(this,"pairing"),pe(this,"verify"),pe(this,"echoClient"),pe(this,"linkModeSupportedApps"),pe(this,"eventClient"),pe(this,"initialized",!1),pe(this,"logChunkController"),pe(this,"on",(a,c)=>this.events.on(a,c)),pe(this,"once",(a,c)=>this.events.once(a,c)),pe(this,"off",(a,c)=>this.events.off(a,c)),pe(this,"removeListener",(a,c)=>this.events.removeListener(a,c)),pe(this,"dispatchEnvelope",({topic:a,message:c,sessionExists:u})=>{if(!a||!c)return;let l={topic:a,message:c,publishedAt:Date.now(),transportType:ge.link_mode};this.relayer.onLinkMessageEvent(l,{sessionExists:u})});let i=this.getGlobalCore(e?.customStoragePrefix);if(i)try{return this.customStoragePrefix=i.customStoragePrefix,this.logger=i.logger,this.heartbeat=i.heartbeat,this.crypto=i.crypto,this.history=i.history,this.expirer=i.expirer,this.storage=i.storage,this.relayer=i.relayer,this.pairing=i.pairing,this.verify=i.verify,this.echoClient=i.echoClient,this.linkModeSupportedApps=i.linkModeSupportedApps,this.eventClient=i.eventClient,this.initialized=i.initialized,this.logChunkController=i.logChunkController,i}catch{}this.projectId=e?.projectId,this.relayUrl=e?.relayUrl||ww,this.customStoragePrefix=e!=null&&e.customStoragePrefix?`:${e.customStoragePrefix}`:"";let n=bs({level:typeof e?.logger=="string"&&e.logger?e.logger:pD.logger,name:La}),{logger:s,chunkLoggerController:o}=y0({opts:n,maxSizeInBytes:e?.maxLogBlobSizeInBytes,loggerOverride:e?.logger});this.logChunkController=o,(t=this.logChunkController)!=null&&t.downloadLogsBlobInBrowser&&(window.downloadLogsBlobInBrowser=async()=>{var a,c;(a=this.logChunkController)!=null&&a.downloadLogsBlobInBrowser&&((c=this.logChunkController)==null||c.downloadLogsBlobInBrowser({clientId:await this.crypto.getClientId()}))}),this.logger=Ve(s,this.name),this.heartbeat=new ra,this.crypto=new yh(this,this.logger,e?.keychain),this.history=new Ch(this,this.logger),this.expirer=new Oh(this,this.logger),this.storage=e!=null&&e.storage?e.storage:new sa(pw(pw({},gD),e?.storageOptions)),this.relayer=new Ah({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new Th(this,this.logger),this.verify=new Rh(this,this.logger,this.storage),this.echoClient=new Nh(this.projectId||"",this.logger),this.linkModeSupportedApps=[],this.eventClient=new Fh(this,this.logger,e?.telemetryEnabled),this.setGlobalCore(this)}static async init(e){let t=new r(e);await t.initialize();let i=await t.crypto.getClientId();return await t.storage.setItem(CD,i),t}get context(){return it(this.logger)}async start(){this.initialized||await this.initialize()}async getLogsBlob(){var e;return(e=this.logChunkController)==null?void 0:e.logsToBlob({clientId:await this.crypto.getClientId()})}async addLinkModeSupportedApp(e){this.linkModeSupportedApps.includes(e)||(this.linkModeSupportedApps.push(e),await this.storage.setItem(H0,this.linkModeSupportedApps))}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.linkModeSupportedApps=await this.storage.getItem(H0)||[],this.initialized=!0,this.logger.info("Core Initialization Success")}catch(e){throw this.logger.warn(`Core Initialization Failure at epoch ${Date.now()}`,e),this.logger.error(e.message),e}}getGlobalCore(e=""){try{if(this.isGlobalCoreDisabled())return;let t=`_walletConnectCore_${e}`,i=`${t}_count`;return globalThis[i]=(globalThis[i]||0)+1,globalThis[i]>1,globalThis[t]}catch{return}}setGlobalCore(e){var t;try{if(this.isGlobalCoreDisabled())return;let i=`_walletConnectCore_${((t=e.opts)==null?void 0:t.customStoragePrefix)||""}`;globalThis[i]=e}catch{}}isGlobalCoreDisabled(){try{return typeof process<"u"&&process.env.DISABLE_GLOBAL_CORE==="true"}catch{return!0}}},Rw=Uh;var ja=Se(Ri()),te=Se(zi());var Bw="wc",Uw=2,kw="client",Jh=`${Bw}@${Uw}:${kw}:`,Lh={name:kw,logger:"error",controller:!1,relayUrl:"wss://relay.walletconnect.org"};var Nw="WALLETCONNECT_DEEPLINK_CHOICE";var RC="proposal";var Pw="Proposal expired",NC="session",wn=te.SEVEN_DAYS,PC="engine",We={wc_sessionPropose:{req:{ttl:te.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:te.FIVE_MINUTES,prompt:!1,tag:1101},reject:{ttl:te.FIVE_MINUTES,prompt:!1,tag:1120},autoReject:{ttl:te.FIVE_MINUTES,prompt:!1,tag:1121}},wc_sessionSettle:{req:{ttl:te.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:te.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:te.ONE_DAY,prompt:!1,tag:1104},res:{ttl:te.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:te.ONE_DAY,prompt:!1,tag:1106},res:{ttl:te.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:te.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:te.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:te.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:te.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:te.ONE_DAY,prompt:!1,tag:1112},res:{ttl:te.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:te.ONE_DAY,prompt:!1,tag:1114},res:{ttl:te.ONE_DAY,prompt:!1,tag:1115}},wc_sessionAuthenticate:{req:{ttl:te.ONE_HOUR,prompt:!0,tag:1116},res:{ttl:te.ONE_HOUR,prompt:!1,tag:1117},reject:{ttl:te.FIVE_MINUTES,prompt:!1,tag:1118},autoReject:{ttl:te.FIVE_MINUTES,prompt:!1,tag:1119}}},Mh={min:te.FIVE_MINUTES,max:te.SEVEN_DAYS},ur={idle:"IDLE",active:"ACTIVE"},FC={eth_sendTransaction:{key:""},eth_sendRawTransaction:{key:""},wallet_sendCalls:{key:""},solana_signTransaction:{key:"signature"},solana_signAllTransactions:{key:"transactions"},solana_signAndSendTransaction:{key:"signature"},sui_signAndExecuteTransaction:{key:"digest"},sui_signTransaction:{key:""},hedera_signAndExecuteTransaction:{key:"transactionId"},hedera_executeTransaction:{key:"transactionId"},near_signTransaction:{key:""},near_signTransactions:{key:""},tron_signTransaction:{key:"txID"},xrpl_signTransaction:{key:""},xrpl_signTransactionFor:{key:""},algo_signTxn:{key:""},sendTransfer:{key:"txid"},stacks_stxTransfer:{key:"txId"},polkadot_signTransaction:{key:""},cosmos_signDirect:{key:""}},BC="request",UC=["wc_sessionPropose","wc_sessionRequest","wc_authRequest","wc_sessionAuthenticate"],kC="wc";var LC="auth",MC="authKeys",qC="pairingTopics",zC="requests",Va=`${kC}@${1.5}:${LC}:`,qa=`${Va}:PUB_KEY`,jC=Object.defineProperty,VC=Object.defineProperties,$C=Object.getOwnPropertyDescriptors,Fw=Object.getOwnPropertySymbols,KC=Object.prototype.hasOwnProperty,HC=Object.prototype.propertyIsEnumerable,zh=(r,e,t)=>e in r?jC(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,le=(r,e)=>{for(var t in e||(e={}))KC.call(e,t)&&zh(r,t,e[t]);if(Fw)for(var t of Fw(e))HC.call(e,t)&&zh(r,t,e[t]);return r},at=(r,e)=>VC(r,$C(e)),B=(r,e,t)=>zh(r,typeof e!="symbol"?e+"":e,t),jh=class extends Sa{constructor(e){super(e),B(this,"name",PC),B(this,"events",new ja.default),B(this,"initialized",!1),B(this,"requestQueue",{state:ur.idle,queue:[]}),B(this,"sessionRequestQueue",{state:ur.idle,queue:[]}),B(this,"emittedSessionRequests",new Uo({limit:500})),B(this,"requestQueueDelay",te.ONE_SECOND),B(this,"expectedPairingMethodMap",new Map),B(this,"recentlyDeletedMap",new Map),B(this,"recentlyDeletedLimit",200),B(this,"relayMessageCache",[]),B(this,"pendingSessions",new Map),B(this,"init",async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.registerPairingEvents(),await this.registerLinkModeListeners(),this.client.core.pairing.register({methods:Object.keys(We)}),this.initialized=!0,setTimeout(async()=>{await this.processPendingMessageEvents(),this.sessionRequestQueue.queue=this.getPendingSessionRequests(),this.processSessionRequestQueue()},(0,te.toMiliseconds)(this.requestQueueDelay)))}),B(this,"connect",async t=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();let i=at(le({},t),{requiredNamespaces:t.requiredNamespaces||{},optionalNamespaces:t.optionalNamespaces||{}});await this.isValidConnect(i),i.optionalNamespaces=vy(i.requiredNamespaces,i.optionalNamespaces),i.requiredNamespaces={};let{pairingTopic:n,requiredNamespaces:s,optionalNamespaces:o,sessionProperties:a,scopedProperties:c,relays:u}=i,l=n,h,d=!1;try{if(l){let C=this.client.core.pairing.pairings.get(l);this.client.logger.warn("connect() with existing pairing topic is deprecated and will be removed in the next major release."),d=C.active}}catch(C){throw this.client.logger.error(`connect() -> pairing.get(${l}) failed`),C}if(!l||!d){let{topic:C,uri:R}=await this.client.core.pairing.create({internal:{skipSubscribe:!0}});l=C,h=R}if(!l){let{message:C}=M("NO_MATCHING_KEY",`connect() pairing topic: ${l}`);throw new Error(C)}let p=await this.client.core.crypto.generateKeyPair(),f=We.wc_sessionPropose.req.ttl||te.FIVE_MINUTES,g=_e(f),m=at(le(le({requiredNamespaces:s,optionalNamespaces:o,relays:u??[{protocol:kh}],proposer:{publicKey:p,metadata:this.client.metadata},expiryTimestamp:g,pairingTopic:l},a&&{sessionProperties:a}),c&&{scopedProperties:c}),{id:Bt()}),w=oe("session_connect",m.id),{reject:v,resolve:y,done:S}=xr(f,Pw),E=({id:C})=>{C===m.id&&(this.client.events.off("proposal_expire",E),this.pendingSessions.delete(m.id),this.events.emit(w,{error:{message:Pw,code:0}}))};return this.client.events.on("proposal_expire",E),this.events.once(w,({error:C,session:R})=>{this.client.events.off("proposal_expire",E),C?v(C):R&&y(R)}),await this.sendProposeSession({proposal:m,publishOpts:{internal:{throwOnFailedPublish:!0},tvf:{correlationId:m.id}}}),await this.setProposal(m.id,m),{uri:h,approval:S}}),B(this,"pair",async t=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{return await this.client.core.pairing.pair(t)}catch(i){throw this.client.logger.error("pair() failed"),i}}),B(this,"approve",async t=>{var i,n,s;let o=this.client.core.eventClient.createEvent({properties:{topic:(i=t?.id)==null?void 0:i.toString(),trace:[Dr.session_approve_started]}});try{this.isInitialized(),await this.confirmOnlineStateOrThrow()}catch(b){throw o.setError(mn.no_internet_connection),b}try{await this.isValidProposalId(t?.id)}catch(b){throw this.client.logger.error(`approve() -> proposal.get(${t?.id}) failed`),o.setError(mn.proposal_not_found),b}try{await this.isValidApprove(t)}catch(b){throw this.client.logger.error("approve() -> isValidApprove() failed"),o.setError(mn.session_approve_namespace_validation_failure),b}let{id:a,relayProtocol:c,namespaces:u,sessionProperties:l,scopedProperties:h,sessionConfig:d}=t,p=this.client.proposal.get(a);this.client.core.eventClient.deleteEvent({eventId:o.eventId});let{pairingTopic:f,proposer:g,requiredNamespaces:m,optionalNamespaces:w}=p,v=(n=this.client.core.eventClient)==null?void 0:n.getEvent({topic:f});v||(v=(s=this.client.core.eventClient)==null?void 0:s.createEvent({type:Dr.session_approve_started,properties:{topic:f,trace:[Dr.session_approve_started,Dr.session_namespaces_validation_success]}}));let y=await this.client.core.crypto.generateKeyPair(),S=g.publicKey,E=await this.client.core.crypto.generateSharedKey(y,S),C=le(le(le({relay:{protocol:c??"irn"},namespaces:u,controller:{publicKey:y,metadata:this.client.metadata},expiry:_e(wn)},l&&{sessionProperties:l}),h&&{scopedProperties:h}),d&&{sessionConfig:d}),R=ge.relay;v.addTrace(Dr.subscribing_session_topic);try{await this.client.core.relayer.subscribe(E,{transportType:R,internal:{skipSubscribe:!0}})}catch(b){throw v.setError(mn.subscribe_session_topic_failure),b}v.addTrace(Dr.subscribe_session_topic_success);let P=at(le({},C),{topic:E,requiredNamespaces:m,optionalNamespaces:w,pairingTopic:f,acknowledged:!1,self:C.controller,peer:{publicKey:g.publicKey,metadata:g.metadata},controller:y,transportType:ge.relay});await this.client.session.set(E,P),v.addTrace(Dr.store_session);try{await this.sendApproveSession({sessionTopic:E,proposal:p,pairingProposalResponse:{relay:{protocol:c??"irn"},responderPublicKey:y},sessionSettleRequest:C,publishOpts:{internal:{throwOnFailedPublish:!0},tvf:{correlationId:a}}}),v.addTrace(Dr.session_approve_publish_success)}catch(b){throw this.client.logger.error(b),this.client.session.delete(E,he("USER_DISCONNECTED")),await this.client.core.relayer.unsubscribe(E),b}return this.client.core.eventClient.deleteEvent({eventId:v.eventId}),await this.client.core.pairing.updateMetadata({topic:f,metadata:g.metadata}),await this.deleteProposal(a),await this.client.core.pairing.activate({topic:f}),await this.setExpiry(E,_e(wn)),{topic:E,acknowledged:()=>Promise.resolve(this.client.session.get(E))}}),B(this,"reject",async t=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidReject(t)}catch(o){throw this.client.logger.error("reject() -> isValidReject() failed"),o}let{id:i,reason:n}=t,s;try{s=this.client.proposal.get(i).pairingTopic}catch(o){throw this.client.logger.error(`reject() -> proposal.get(${i}) failed`),o}s&&await this.sendError({id:i,topic:s,error:n,rpcOpts:We.wc_sessionPropose.reject}),await this.deleteProposal(i)}),B(this,"update",async t=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidUpdate(t)}catch(h){throw this.client.logger.error("update() -> isValidUpdate() failed"),h}let{topic:i,namespaces:n}=t,{done:s,resolve:o,reject:a}=xr(),c=Bt(),u=Ut().toString(),l=this.client.session.get(i).namespaces;return this.events.once(oe("session_update",c),({error:h})=>{h?a(h):o()}),await this.client.session.update(i,{namespaces:n}),await this.sendRequest({topic:i,method:"wc_sessionUpdate",params:{namespaces:n},throwOnFailedPublish:!0,clientRpcId:c,relayRpcId:u}).catch(h=>{this.client.logger.error(h),this.client.session.update(i,{namespaces:l}),a(h)}),{acknowledged:s}}),B(this,"extend",async t=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidExtend(t)}catch(c){throw this.client.logger.error("extend() -> isValidExtend() failed"),c}let{topic:i}=t,n=Bt(),{done:s,resolve:o,reject:a}=xr();return this.events.once(oe("session_extend",n),({error:c})=>{c?a(c):o()}),await this.setExpiry(i,_e(wn)),this.sendRequest({topic:i,method:"wc_sessionExtend",params:{},clientRpcId:n,throwOnFailedPublish:!0}).catch(c=>{a(c)}),{acknowledged:s}}),B(this,"request",async t=>{this.isInitialized();try{await this.isValidRequest(t)}catch(m){throw this.client.logger.error("request() -> isValidRequest() failed"),m}let{chainId:i,request:n,topic:s,expiry:o=We.wc_sessionRequest.req.ttl}=t,a=this.client.session.get(s);a?.transportType===ge.relay&&await this.confirmOnlineStateOrThrow();let c=Bt(),u=Ut().toString(),{done:l,resolve:h,reject:d}=xr(o,"Request expired. Please try again.");this.events.once(oe("session_request",c),({error:m,result:w})=>{m?d(m):h(w)});let p="wc_sessionRequest",f=this.getAppLinkIfEnabled(a.peer.metadata,a.transportType);if(f)return await this.sendRequest({clientRpcId:c,relayRpcId:u,topic:s,method:p,params:{request:at(le({},n),{expiryTimestamp:_e(o)}),chainId:i},expiry:o,throwOnFailedPublish:!0,appLink:f}).catch(m=>d(m)),this.client.events.emit("session_request_sent",{topic:s,request:n,chainId:i,id:c}),await l();let g={request:at(le({},n),{expiryTimestamp:_e(o)}),chainId:i};return await Promise.all([new Promise(async m=>{await this.sendRequest({clientRpcId:c,relayRpcId:u,topic:s,method:p,params:g,expiry:o,throwOnFailedPublish:!0,tvf:this.getTVFParams(c,g)}).catch(w=>d(w)),this.client.events.emit("session_request_sent",{topic:s,request:n,chainId:i,id:c}),m()}),new Promise(async m=>{var w;if(!((w=a.sessionConfig)!=null&&w.disableDeepLink)){let v=await wm(this.client.core.storage,Nw);await ym({id:c,topic:s,wcDeepLink:v})}m()}),l()]).then(m=>m[2])}),B(this,"respond",async t=>{this.isInitialized(),await this.isValidRespond(t);let{topic:i,response:n}=t,{id:s}=n,o=this.client.session.get(i);o.transportType===ge.relay&&await this.confirmOnlineStateOrThrow();let a=this.getAppLinkIfEnabled(o.peer.metadata,o.transportType);Dt(n)?await this.sendResult({id:s,topic:i,result:n.result,throwOnFailedPublish:!0,appLink:a}):nt(n)&&await this.sendError({id:s,topic:i,error:n.error,appLink:a}),this.cleanupAfterResponse(t)}),B(this,"ping",async t=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidPing(t)}catch(n){throw this.client.logger.error("ping() -> isValidPing() failed"),n}let{topic:i}=t;if(this.client.session.keys.includes(i)){let n=Bt(),s=Ut().toString(),{done:o,resolve:a,reject:c}=xr();this.events.once(oe("session_ping",n),({error:u})=>{u?c(u):a()}),await Promise.all([this.sendRequest({topic:i,method:"wc_sessionPing",params:{},throwOnFailedPublish:!0,clientRpcId:n,relayRpcId:s}),o()])}else this.client.core.pairing.pairings.keys.includes(i)&&(this.client.logger.warn("ping() on pairing topic is deprecated and will be removed in the next major release."),await this.client.core.pairing.ping({topic:i}))}),B(this,"emit",async t=>{this.isInitialized(),await this.confirmOnlineStateOrThrow(),await this.isValidEmit(t);let{topic:i,event:n,chainId:s}=t,o=Ut().toString(),a=Bt();await this.sendRequest({topic:i,method:"wc_sessionEvent",params:{event:n,chainId:s},throwOnFailedPublish:!0,relayRpcId:o,clientRpcId:a})}),B(this,"disconnect",async t=>{this.isInitialized(),await this.confirmOnlineStateOrThrow(),await this.isValidDisconnect(t);let{topic:i}=t;if(this.client.session.keys.includes(i))await this.sendRequest({topic:i,method:"wc_sessionDelete",params:he("USER_DISCONNECTED"),throwOnFailedPublish:!0}),await this.deleteSession({topic:i,emitEvent:!1});else if(this.client.core.pairing.pairings.keys.includes(i))await this.client.core.pairing.disconnect({topic:i});else{let{message:n}=M("MISMATCHED_TOPIC",`Session or pairing topic not found: ${i}`);throw new Error(n)}}),B(this,"find",t=>(this.isInitialized(),this.client.session.getAll().filter(i=>by(i,t)))),B(this,"getPendingSessionRequests",()=>this.client.pendingRequest.getAll()),B(this,"authenticate",async(t,i)=>{var n;this.isInitialized(),this.isValidAuthenticate(t);let s=i&&this.client.core.linkModeSupportedApps.includes(i)&&((n=this.client.metadata.redirect)==null?void 0:n.linkMode),o=s?ge.link_mode:ge.relay;o===ge.relay&&await this.confirmOnlineStateOrThrow();let{chains:a,statement:c="",uri:u,domain:l,nonce:h,type:d,exp:p,nbf:f,methods:g=[],expiry:m}=t,w=[...t.resources||[]],{topic:v,uri:y}=await this.client.core.pairing.create({methods:["wc_sessionAuthenticate"],transportType:o});this.client.logger.info({message:"Generated new pairing",pairing:{topic:v,uri:y}});let S=await this.client.core.crypto.generateKeyPair(),E=on(S);if(await Promise.all([this.client.auth.authKeys.set(qa,{responseTopic:E,publicKey:S}),this.client.auth.pairingTopics.set(E,{topic:E,pairingTopic:v})]),await this.client.core.relayer.subscribe(E,{transportType:o}),this.client.logger.info(`sending request to new pairing topic: ${v}`),g.length>0){let{namespace:O}=rs(a[0]),U=Um(O,"request",g);cs(w)&&(U=km(U,w.pop())),w.push(U)}let C=m&&m>We.wc_sessionAuthenticate.req.ttl?m:We.wc_sessionAuthenticate.req.ttl,R={authPayload:{type:d??"caip122",chains:a,statement:c,aud:u,domain:l,version:"1",nonce:h,iat:new Date().toISOString(),exp:p,nbf:f,resources:w},requester:{publicKey:S,metadata:this.client.metadata},expiryTimestamp:_e(C)},P={eip155:{chains:a,methods:[...new Set(["personal_sign",...g])],events:["chainChanged","accountsChanged"]}},b={requiredNamespaces:{},optionalNamespaces:P,relays:[{protocol:"irn"}],pairingTopic:v,proposer:{publicKey:S,metadata:this.client.metadata},expiryTimestamp:_e(We.wc_sessionPropose.req.ttl),id:Bt()},{done:A,resolve:_,reject:D}=xr(C,"Request expired"),F=Bt(),k=oe("session_connect",b.id),I=oe("session_request",F),x=async({error:O,session:U})=>{this.events.off(I,T),O?D(O):U&&_({session:U})},T=async O=>{var U,L,j;if(await this.deletePendingAuthRequest(F,{message:"fulfilled",code:0}),O.error){let ee=he("WC_METHOD_UNSUPPORTED","wc_sessionAuthenticate");return O.error.code===ee.code?void 0:(this.events.off(k,x),D(O.error.message))}await this.deleteProposal(b.id),this.events.off(k,x);let{cacaos:H,responder:W}=O.result,Y=[],J=[];for(let ee of H){await pl({cacao:ee,projectId:this.client.core.projectId})||(this.client.logger.error(ee,"Signature verification failed"),D(he("SESSION_SETTLEMENT_FAILED","Signature verification failed")));let{p:be}=ee,Ue=cs(be.resources),ni=[Go(be.iss)],Us=as(be.iss);if(Ue){let Oi=ml(Ue),ec=yl(Ue);Y.push(...Oi),ni.push(...ec)}for(let Oi of ni)J.push(`${Oi}:${Us}`)}let ue=await this.client.core.crypto.generateSharedKey(S,W.publicKey),ce;Y.length>0&&(ce={topic:ue,acknowledged:!0,self:{publicKey:S,metadata:this.client.metadata},peer:W,controller:W.publicKey,expiry:_e(wn),requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:v,namespaces:Dl([...new Set(Y)],[...new Set(J)]),transportType:o},await this.client.core.relayer.subscribe(ue,{transportType:o}),await this.client.session.set(ue,ce),v&&await this.client.core.pairing.updateMetadata({topic:v,metadata:W.metadata}),ce=this.client.session.get(ue)),(U=this.client.metadata.redirect)!=null&&U.linkMode&&(L=W.metadata.redirect)!=null&&L.linkMode&&(j=W.metadata.redirect)!=null&&j.universal&&i&&(this.client.core.addLinkModeSupportedApp(W.metadata.redirect.universal),this.client.session.update(ue,{transportType:ge.link_mode})),_({auths:H,session:ce})};this.events.once(k,x),this.events.once(I,T);let N;try{if(s){let O=At("wc_sessionAuthenticate",R,F);this.client.core.history.set(v,O);let U=await this.client.core.crypto.encode("",O,{type:sn,encoding:_r});N=hs(i,v,U)}else await Promise.all([this.sendRequest({topic:v,method:"wc_sessionAuthenticate",params:R,expiry:t.expiry,throwOnFailedPublish:!0,clientRpcId:F}),this.sendRequest({topic:v,method:"wc_sessionPropose",params:b,expiry:We.wc_sessionPropose.req.ttl,throwOnFailedPublish:!0,clientRpcId:b.id})])}catch(O){throw this.events.off(k,x),this.events.off(I,T),O}return await this.setProposal(b.id,b),await this.setAuthRequest(F,{request:at(le({},R),{verifyContext:{}}),pairingTopic:v,transportType:o}),{uri:N??y,response:A}}),B(this,"approveSessionAuthenticate",async t=>{let{id:i,auths:n}=t,s=this.client.core.eventClient.createEvent({properties:{topic:i.toString(),trace:[ri.authenticated_session_approve_started]}});try{this.isInitialized()}catch(m){throw s.setError(yn.no_internet_connection),m}let o=this.getPendingAuthRequest(i);if(!o)throw s.setError(yn.authenticated_session_pending_request_not_found),new Error(`Could not find pending auth request with id ${i}`);let a=o.transportType||ge.relay;a===ge.relay&&await this.confirmOnlineStateOrThrow();let c=o.requester.publicKey,u=await this.client.core.crypto.generateKeyPair(),l=on(c),h={type:Ht,receiverPublicKey:c,senderPublicKey:u},d=[],p=[];for(let m of n){if(!await pl({cacao:m,projectId:this.client.core.projectId})){s.setError(yn.invalid_cacao);let E=he("SESSION_SETTLEMENT_FAILED","Signature verification failed");throw await this.sendError({id:i,topic:l,error:E,encodeOpts:h}),new Error(E.message)}s.addTrace(ri.cacaos_verified);let{p:w}=m,v=cs(w.resources),y=[Go(w.iss)],S=as(w.iss);if(v){let E=ml(v),C=yl(v);d.push(...E),y.push(...C)}for(let E of y)p.push(`${E}:${S}`)}let f=await this.client.core.crypto.generateSharedKey(u,c);s.addTrace(ri.create_authenticated_session_topic);let g;if(d?.length>0){g={topic:f,acknowledged:!0,self:{publicKey:u,metadata:this.client.metadata},peer:{publicKey:c,metadata:o.requester.metadata},controller:c,expiry:_e(wn),authentication:n,requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:o.pairingTopic,namespaces:Dl([...new Set(d)],[...new Set(p)]),transportType:a},s.addTrace(ri.subscribing_authenticated_session_topic);try{await this.client.core.relayer.subscribe(f,{transportType:a})}catch(m){throw s.setError(yn.subscribe_authenticated_session_topic_failure),m}s.addTrace(ri.subscribe_authenticated_session_topic_success),await this.client.session.set(f,g),s.addTrace(ri.store_authenticated_session),await this.client.core.pairing.updateMetadata({topic:o.pairingTopic,metadata:o.requester.metadata})}s.addTrace(ri.publishing_authenticated_session_approve);try{await this.sendResult({topic:l,id:i,result:{cacaos:n,responder:{publicKey:u,metadata:this.client.metadata}},encodeOpts:h,throwOnFailedPublish:!0,appLink:this.getAppLinkIfEnabled(o.requester.metadata,a)})}catch(m){throw s.setError(yn.authenticated_session_approve_publish_failure),m}return await this.client.auth.requests.delete(i,{message:"fulfilled",code:0}),await this.client.core.pairing.activate({topic:o.pairingTopic}),this.client.core.eventClient.deleteEvent({eventId:s.eventId}),{session:g}}),B(this,"rejectSessionAuthenticate",async t=>{this.isInitialized();let{id:i,reason:n}=t,s=this.getPendingAuthRequest(i);if(!s)throw new Error(`Could not find pending auth request with id ${i}`);s.transportType===ge.relay&&await this.confirmOnlineStateOrThrow();let o=s.requester.publicKey,a=await this.client.core.crypto.generateKeyPair(),c=on(o),u={type:Ht,receiverPublicKey:o,senderPublicKey:a};await this.sendError({id:i,topic:c,error:n,encodeOpts:u,rpcOpts:We.wc_sessionAuthenticate.reject,appLink:this.getAppLinkIfEnabled(s.requester.metadata,s.transportType)}),await this.client.auth.requests.delete(i,{message:"rejected",code:0}),await this.deleteProposal(i)}),B(this,"formatAuthMessage",t=>{this.isInitialized();let{request:i,iss:n}=t;return gl(i,n)}),B(this,"processRelayMessageCache",()=>{setTimeout(async()=>{if(this.relayMessageCache.length!==0)for(;this.relayMessageCache.length>0;)try{let t=this.relayMessageCache.shift();t&&await this.onRelayMessage(t)}catch(t){this.client.logger.error(t)}},50)}),B(this,"cleanupDuplicatePairings",async t=>{if(t.pairingTopic)try{let i=this.client.core.pairing.pairings.get(t.pairingTopic),n=this.client.core.pairing.pairings.getAll().filter(s=>{var o,a;return((o=s.peerMetadata)==null?void 0:o.url)&&((a=s.peerMetadata)==null?void 0:a.url)===t.peer.metadata.url&&s.topic&&s.topic!==i.topic});if(n.length===0)return;this.client.logger.info(`Cleaning up ${n.length} duplicate pairing(s)`),await Promise.all(n.map(s=>this.client.core.pairing.disconnect({topic:s.topic}))),this.client.logger.info("Duplicate pairings clean up finished")}catch(i){this.client.logger.error(i)}}),B(this,"deleteSession",async t=>{var i;let{topic:n,expirerHasDeleted:s=!1,emitEvent:o=!0,id:a=0}=t,{self:c}=this.client.session.get(n);await this.client.core.relayer.unsubscribe(n),await this.client.session.delete(n,he("USER_DISCONNECTED")),this.addToRecentlyDeleted(n,"session"),this.client.core.crypto.keychain.has(c.publicKey)&&await this.client.core.crypto.deleteKeyPair(c.publicKey),this.client.core.crypto.keychain.has(n)&&await this.client.core.crypto.deleteSymKey(n),s||this.client.core.expirer.del(n),this.client.core.storage.removeItem(Nw).catch(u=>this.client.logger.warn(u)),this.getPendingSessionRequests().forEach(u=>{u.topic===n&&this.deletePendingSessionRequest(u.id,he("USER_DISCONNECTED"))}),n===((i=this.sessionRequestQueue.queue[0])==null?void 0:i.topic)&&(this.sessionRequestQueue.state=ur.idle),o&&this.client.events.emit("session_delete",{id:a,topic:n})}),B(this,"deleteProposal",async(t,i)=>{if(i)try{let n=this.client.proposal.get(t);this.client.core.eventClient.getEvent({topic:n.pairingTopic})?.setError(mn.proposal_expired)}catch{}await Promise.all([this.client.proposal.delete(t,he("USER_DISCONNECTED")),i?Promise.resolve():this.client.core.expirer.del(t)]),this.addToRecentlyDeleted(t,"proposal")}),B(this,"deletePendingSessionRequest",async(t,i,n=!1)=>{await Promise.all([this.client.pendingRequest.delete(t,i),n?Promise.resolve():this.client.core.expirer.del(t)]),this.addToRecentlyDeleted(t,"request"),this.sessionRequestQueue.queue=this.sessionRequestQueue.queue.filter(s=>s.id!==t),n&&(this.sessionRequestQueue.state=ur.idle,this.client.events.emit("session_request_expire",{id:t}))}),B(this,"deletePendingAuthRequest",async(t,i,n=!1)=>{await Promise.all([this.client.auth.requests.delete(t,i),n?Promise.resolve():this.client.core.expirer.del(t)])}),B(this,"setExpiry",async(t,i)=>{this.client.session.keys.includes(t)&&(this.client.core.expirer.set(t,i),await this.client.session.update(t,{expiry:i}))}),B(this,"setProposal",async(t,i)=>{this.client.core.expirer.set(t,_e(We.wc_sessionPropose.req.ttl)),await this.client.proposal.set(t,i)}),B(this,"setAuthRequest",async(t,i)=>{let{request:n,pairingTopic:s,transportType:o=ge.relay}=i;this.client.core.expirer.set(t,n.expiryTimestamp),await this.client.auth.requests.set(t,{authPayload:n.authPayload,requester:n.requester,expiryTimestamp:n.expiryTimestamp,id:t,pairingTopic:s,verifyContext:n.verifyContext,transportType:o})}),B(this,"setPendingSessionRequest",async t=>{let{id:i,topic:n,params:s,verifyContext:o}=t,a=s.request.expiryTimestamp||_e(We.wc_sessionRequest.req.ttl);this.client.core.expirer.set(i,a),await this.client.pendingRequest.set(i,{id:i,topic:n,params:s,verifyContext:o})}),B(this,"sendRequest",async t=>{let{topic:i,method:n,params:s,expiry:o,relayRpcId:a,clientRpcId:c,throwOnFailedPublish:u,appLink:l,tvf:h,publishOpts:d={}}=t,p=At(n,s,c),f,g=!!l;try{let v=g?_r:tt;f=await this.client.core.crypto.encode(i,p,{encoding:v})}catch(v){throw await this.cleanup(),this.client.logger.error(`sendRequest() -> core.crypto.encode() for topic ${i} failed`),v}let m;if(UC.includes(n)){let v=bt(JSON.stringify(p)),y=bt(f);m=await this.client.core.verify.register({id:y,decryptedId:v})}let w=le(le({},We[n].req),d);if(w.attestation=m,o&&(w.ttl=o),a&&(w.id=a),this.client.core.history.set(i,p),g){let v=hs(l,i,f);await global.Linking.openURL(v,this.client.name)}else w.tvf=at(le({},h),{correlationId:p.id}),u?(w.internal=at(le({},w.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(i,f,w)):this.client.core.relayer.publish(i,f,w).catch(v=>this.client.logger.error(v));return p.id}),B(this,"sendProposeSession",async t=>{let{proposal:i,publishOpts:n}=t,s=At("wc_sessionPropose",i,i.id);this.client.core.history.set(i.pairingTopic,s);let o=await this.client.core.crypto.encode(i.pairingTopic,s,{encoding:tt}),a=bt(JSON.stringify(s)),c=bt(o),u=await this.client.core.verify.register({id:c,decryptedId:a});await this.client.core.relayer.publishCustom({payload:{pairingTopic:i.pairingTopic,sessionProposal:o},opts:at(le({},n),{publishMethod:"wc_proposeSession",attestation:u})})}),B(this,"sendApproveSession",async t=>{let{sessionTopic:i,pairingProposalResponse:n,proposal:s,sessionSettleRequest:o,publishOpts:a}=t,c=Si(s.id,n),u=await this.client.core.crypto.encode(s.pairingTopic,c,{encoding:tt}),l=At("wc_sessionSettle",o,a?.id),h=await this.client.core.crypto.encode(i,l,{encoding:tt});this.client.core.history.set(i,l),await this.client.core.relayer.publishCustom({payload:{sessionTopic:i,pairingTopic:s.pairingTopic,sessionProposalResponse:u,sessionSettlementRequest:h},opts:at(le({},a),{publishMethod:"wc_approveSession"})})}),B(this,"sendResult",async t=>{let{id:i,topic:n,result:s,throwOnFailedPublish:o,encodeOpts:a,appLink:c}=t,u=Si(i,s),l,h=c&&typeof(global==null?void 0:global.Linking)<"u";try{let f=h?_r:tt;l=await this.client.core.crypto.encode(n,u,at(le({},a||{}),{encoding:f}))}catch(f){throw await this.cleanup(),this.client.logger.error(`sendResult() -> core.crypto.encode() for topic ${n} failed`),f}let d,p;try{d=await this.client.core.history.get(n,i);let f=d.request;try{p=this.getTVFParams(i,f.params,s)}catch(g){this.client.logger.warn(`sendResult() -> getTVFParams() failed: ${g?.message}`)}}catch(f){throw this.client.logger.error(`sendResult() -> history.get(${n}, ${i}) failed`),f}if(h){let f=hs(c,n,l);await global.Linking.openURL(f,this.client.name)}else{let f=d.request.method,g=We[f].res;g.tvf=at(le({},p),{correlationId:i}),o?(g.internal=at(le({},g.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(n,l,g)):this.client.core.relayer.publish(n,l,g).catch(m=>this.client.logger.error(m))}await this.client.core.history.resolve(u)}),B(this,"sendError",async t=>{let{id:i,topic:n,error:s,encodeOpts:o,rpcOpts:a,appLink:c}=t,u=Ii(i,s),l,h=c&&typeof(global==null?void 0:global.Linking)<"u";try{let p=h?_r:tt;l=await this.client.core.crypto.encode(n,u,at(le({},o||{}),{encoding:p}))}catch(p){throw await this.cleanup(),this.client.logger.error(`sendError() -> core.crypto.encode() for topic ${n} failed`),p}let d;try{d=await this.client.core.history.get(n,i)}catch(p){throw this.client.logger.error(`sendError() -> history.get(${n}, ${i}) failed`),p}if(h){let p=hs(c,n,l);await global.Linking.openURL(p,this.client.name)}else{let p=d.request.method,f=a||We[p].res;this.client.core.relayer.publish(n,l,f)}await this.client.core.history.resolve(u)}),B(this,"cleanup",async()=>{let t=[],i=[];this.client.session.getAll().forEach(n=>{let s=!1;ir(n.expiry)&&(s=!0),this.client.core.crypto.keychain.has(n.topic)||(s=!0),s&&t.push(n.topic)}),this.client.proposal.getAll().forEach(n=>{ir(n.expiryTimestamp)&&i.push(n.id)}),await Promise.all([...t.map(n=>this.deleteSession({topic:n})),...i.map(n=>this.deleteProposal(n))])}),B(this,"onProviderMessageEvent",async t=>{!this.initialized||this.relayMessageCache.length>0?this.relayMessageCache.push(t):await this.onRelayMessage(t)}),B(this,"onRelayEventRequest",async t=>{this.requestQueue.queue.push(t),await this.processRequestsQueue()}),B(this,"processRequestsQueue",async()=>{if(this.requestQueue.state===ur.active){this.client.logger.info("Request queue already active, skipping...");return}for(this.client.logger.info(`Request queue starting with ${this.requestQueue.queue.length} requests`);this.requestQueue.queue.length>0;){this.requestQueue.state=ur.active;let t=this.requestQueue.queue.shift();if(t)try{await this.processRequest(t)}catch(i){this.client.logger.warn(i)}}this.requestQueue.state=ur.idle}),B(this,"processRequest",async t=>{let{topic:i,payload:n,attestation:s,transportType:o,encryptedId:a}=t,c=n.method;if(!this.shouldIgnorePairingRequest({topic:i,requestMethod:c}))switch(c){case"wc_sessionPropose":return await this.onSessionProposeRequest({topic:i,payload:n,attestation:s,encryptedId:a});case"wc_sessionSettle":return await this.onSessionSettleRequest(i,n);case"wc_sessionUpdate":return await this.onSessionUpdateRequest(i,n);case"wc_sessionExtend":return await this.onSessionExtendRequest(i,n);case"wc_sessionPing":return await this.onSessionPingRequest(i,n);case"wc_sessionDelete":return await this.onSessionDeleteRequest(i,n);case"wc_sessionRequest":return await this.onSessionRequest({topic:i,payload:n,attestation:s,encryptedId:a,transportType:o});case"wc_sessionEvent":return await this.onSessionEventRequest(i,n);case"wc_sessionAuthenticate":return await this.onSessionAuthenticateRequest({topic:i,payload:n,attestation:s,encryptedId:a,transportType:o});default:return this.client.logger.info(`Unsupported request method ${c}`)}}),B(this,"onRelayEventResponse",async t=>{let{topic:i,payload:n,transportType:s}=t,o=(await this.client.core.history.get(i,n.id)).request.method;switch(o){case"wc_sessionPropose":return this.onSessionProposeResponse(i,n,s);case"wc_sessionSettle":return this.onSessionSettleResponse(i,n);case"wc_sessionUpdate":return this.onSessionUpdateResponse(i,n);case"wc_sessionExtend":return this.onSessionExtendResponse(i,n);case"wc_sessionPing":return this.onSessionPingResponse(i,n);case"wc_sessionRequest":return this.onSessionRequestResponse(i,n);case"wc_sessionAuthenticate":return this.onSessionAuthenticateResponse(i,n);default:return this.client.logger.info(`Unsupported response method ${o}`)}}),B(this,"onRelayEventUnknownPayload",t=>{let{topic:i}=t,{message:n}=M("MISSING_OR_INVALID",`Decoded payload on topic ${i} is not identifiable as a JSON-RPC request or a response.`);throw new Error(n)}),B(this,"shouldIgnorePairingRequest",t=>{let{topic:i,requestMethod:n}=t,s=this.expectedPairingMethodMap.get(i);return!s||s.includes(n)?!1:!!(s.includes("wc_sessionAuthenticate")&&this.client.events.listenerCount("session_authenticate")>0)}),B(this,"onSessionProposeRequest",async t=>{let{topic:i,payload:n,attestation:s,encryptedId:o}=t,{params:a,id:c}=n;try{let u=this.client.core.eventClient.getEvent({topic:i});this.client.events.listenerCount("session_proposal")===0&&u?.setError(or.proposal_listener_not_found),this.isValidConnect(le({},n.params));let l=a.expiryTimestamp||_e(We.wc_sessionPropose.req.ttl),h=le({id:c,pairingTopic:i,expiryTimestamp:l,attestation:s,encryptedId:o},a);await this.setProposal(c,h);let d=await this.getVerifyContext({attestationId:s,hash:bt(JSON.stringify(n)),encryptedId:o,metadata:h.proposer.metadata});u?.addTrace(Yt.emit_session_proposal),this.client.events.emit("session_proposal",{id:c,params:h,verifyContext:d})}catch(u){await this.sendError({id:c,topic:i,error:u,rpcOpts:We.wc_sessionPropose.autoReject}),this.client.logger.error(u)}}),B(this,"onSessionProposeResponse",async(t,i,n)=>{let{id:s}=i;if(Dt(i)){let{result:o}=i;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:o});let a=this.client.proposal.get(s);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:a});let c=a.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:c});let u=o.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:u});let l=await this.client.core.crypto.generateSharedKey(c,u);this.pendingSessions.set(s,{sessionTopic:l,pairingTopic:t,proposalId:s,publicKey:c});let h=await this.client.core.relayer.subscribe(l,{transportType:n});this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:h}),await this.client.core.pairing.activate({topic:t})}else if(nt(i)){await this.deleteProposal(s);let o=oe("session_connect",s);if(this.events.listenerCount(o)===0)throw new Error(`emitting ${o} without any listeners, 954`);this.events.emit(o,{error:i.error})}}),B(this,"onSessionSettleRequest",async(t,i)=>{let{id:n,params:s}=i;try{this.isValidSessionSettleRequest(s);let{relay:o,controller:a,expiry:c,namespaces:u,sessionProperties:l,scopedProperties:h,sessionConfig:d}=i.params,p=[...this.pendingSessions.values()].find(m=>m.sessionTopic===t);if(!p)return this.client.logger.error(`Pending session not found for topic ${t}`);let f=this.client.proposal.get(p.proposalId),g=at(le(le(le({topic:t,relay:o,expiry:c,namespaces:u,acknowledged:!0,pairingTopic:p.pairingTopic,requiredNamespaces:f.requiredNamespaces,optionalNamespaces:f.optionalNamespaces,controller:a.publicKey,self:{publicKey:p.publicKey,metadata:this.client.metadata},peer:{publicKey:a.publicKey,metadata:a.metadata}},l&&{sessionProperties:l}),h&&{scopedProperties:h}),d&&{sessionConfig:d}),{transportType:ge.relay});await this.client.session.set(g.topic,g),await this.setExpiry(g.topic,g.expiry),await this.client.core.pairing.updateMetadata({topic:p.pairingTopic,metadata:g.peer.metadata}),this.client.events.emit("session_connect",{session:g}),this.events.emit(oe("session_connect",p.proposalId),{session:g}),this.pendingSessions.delete(p.proposalId),this.deleteProposal(p.proposalId,!1),this.cleanupDuplicatePairings(g),await this.sendResult({id:i.id,topic:t,result:!0})}catch(o){await this.sendError({id:n,topic:t,error:o}),this.client.logger.error(o)}}),B(this,"onSessionSettleResponse",async(t,i)=>{let{id:n}=i;Dt(i)?(await this.client.session.update(t,{acknowledged:!0}),this.events.emit(oe("session_approve",n),{})):nt(i)&&(await this.client.session.delete(t,he("USER_DISCONNECTED")),this.events.emit(oe("session_approve",n),{error:i.error}))}),B(this,"onSessionUpdateRequest",async(t,i)=>{let{params:n,id:s}=i;try{let o=`${t}_session_update`,a=Gr.get(o);if(a&&this.isRequestOutOfSync(a,s)){this.client.logger.warn(`Discarding out of sync request - ${s}`),this.sendError({id:s,topic:t,error:he("INVALID_UPDATE_REQUEST")});return}this.isValidUpdate(le({topic:t},n));try{Gr.set(o,s),await this.client.session.update(t,{namespaces:n.namespaces}),await this.sendResult({id:s,topic:t,result:!0})}catch(c){throw Gr.delete(o),c}this.client.events.emit("session_update",{id:s,topic:t,params:n})}catch(o){await this.sendError({id:s,topic:t,error:o}),this.client.logger.error(o)}}),B(this,"isRequestOutOfSync",(t,i)=>i.toString().slice(0,-3)<t.toString().slice(0,-3)),B(this,"onSessionUpdateResponse",(t,i)=>{let{id:n}=i,s=oe("session_update",n);if(this.events.listenerCount(s)===0)throw new Error(`emitting ${s} without any listeners`);Dt(i)?this.events.emit(oe("session_update",n),{}):nt(i)&&this.events.emit(oe("session_update",n),{error:i.error})}),B(this,"onSessionExtendRequest",async(t,i)=>{let{id:n}=i;try{this.isValidExtend({topic:t}),await this.setExpiry(t,_e(wn)),await this.sendResult({id:n,topic:t,result:!0}),this.client.events.emit("session_extend",{id:n,topic:t})}catch(s){await this.sendError({id:n,topic:t,error:s}),this.client.logger.error(s)}}),B(this,"onSessionExtendResponse",(t,i)=>{let{id:n}=i,s=oe("session_extend",n);if(this.events.listenerCount(s)===0)throw new Error(`emitting ${s} without any listeners`);Dt(i)?this.events.emit(oe("session_extend",n),{}):nt(i)&&this.events.emit(oe("session_extend",n),{error:i.error})}),B(this,"onSessionPingRequest",async(t,i)=>{let{id:n}=i;try{this.isValidPing({topic:t}),await this.sendResult({id:n,topic:t,result:!0,throwOnFailedPublish:!0}),this.client.events.emit("session_ping",{id:n,topic:t})}catch(s){await this.sendError({id:n,topic:t,error:s}),this.client.logger.error(s)}}),B(this,"onSessionPingResponse",(t,i)=>{let{id:n}=i,s=oe("session_ping",n);setTimeout(()=>{if(this.events.listenerCount(s)===0)throw new Error(`emitting ${s} without any listeners 2176`);Dt(i)?this.events.emit(oe("session_ping",n),{}):nt(i)&&this.events.emit(oe("session_ping",n),{error:i.error})},500)}),B(this,"onSessionDeleteRequest",async(t,i)=>{let{id:n}=i;try{this.isValidDisconnect({topic:t,reason:i.params}),await Promise.all([new Promise(s=>{this.client.core.relayer.once(ve.publish,async()=>{s(await this.deleteSession({topic:t,id:n}))})}),this.sendResult({id:n,topic:t,result:!0}),this.cleanupPendingSentRequestsForTopic({topic:t,error:he("USER_DISCONNECTED")})]).catch(s=>this.client.logger.error(s))}catch(s){this.client.logger.error(s)}}),B(this,"onSessionRequest",async t=>{var i,n,s;let{topic:o,payload:a,attestation:c,encryptedId:u,transportType:l}=t,{id:h,params:d}=a;try{await this.isValidRequest(le({topic:o},d));let p=this.client.session.get(o),f=await this.getVerifyContext({attestationId:c,hash:bt(JSON.stringify(At("wc_sessionRequest",d,h))),encryptedId:u,metadata:p.peer.metadata,transportType:l}),g={id:h,topic:o,params:d,verifyContext:f};await this.setPendingSessionRequest(g),l===ge.link_mode&&(i=p.peer.metadata.redirect)!=null&&i.universal&&this.client.core.addLinkModeSupportedApp((n=p.peer.metadata.redirect)==null?void 0:n.universal),(s=this.client.signConfig)!=null&&s.disableRequestQueue?this.emitSessionRequest(g):(this.addSessionRequestToSessionRequestQueue(g),this.processSessionRequestQueue())}catch(p){await this.sendError({id:h,topic:o,error:p}),this.client.logger.error(p)}}),B(this,"onSessionRequestResponse",(t,i)=>{let{id:n}=i,s=oe("session_request",n);if(this.events.listenerCount(s)===0)throw new Error(`emitting ${s} without any listeners`);Dt(i)?this.events.emit(oe("session_request",n),{result:i.result}):nt(i)&&this.events.emit(oe("session_request",n),{error:i.error})}),B(this,"onSessionEventRequest",async(t,i)=>{let{id:n,params:s}=i;try{let o=`${t}_session_event_${s.event.name}`,a=Gr.get(o);if(a&&this.isRequestOutOfSync(a,n)){this.client.logger.info(`Discarding out of sync request - ${n}`);return}this.isValidEmit(le({topic:t},s)),this.client.events.emit("session_event",{id:n,topic:t,params:s}),Gr.set(o,n)}catch(o){await this.sendError({id:n,topic:t,error:o}),this.client.logger.error(o)}}),B(this,"onSessionAuthenticateResponse",(t,i)=>{let{id:n}=i;this.client.logger.trace({type:"method",method:"onSessionAuthenticateResponse",topic:t,payload:i}),Dt(i)?this.events.emit(oe("session_request",n),{result:i.result}):nt(i)&&this.events.emit(oe("session_request",n),{error:i.error})}),B(this,"onSessionAuthenticateRequest",async t=>{var i;let{topic:n,payload:s,attestation:o,encryptedId:a,transportType:c}=t;try{let{requester:u,authPayload:l,expiryTimestamp:h}=s.params,d=await this.getVerifyContext({attestationId:o,hash:bt(JSON.stringify(s)),encryptedId:a,metadata:u.metadata,transportType:c}),p={requester:u,pairingTopic:n,id:s.id,authPayload:l,verifyContext:d,expiryTimestamp:h};await this.setAuthRequest(s.id,{request:p,pairingTopic:n,transportType:c}),c===ge.link_mode&&(i=u.metadata.redirect)!=null&&i.universal&&this.client.core.addLinkModeSupportedApp(u.metadata.redirect.universal),this.client.events.emit("session_authenticate",{topic:n,params:s.params,id:s.id,verifyContext:d})}catch(u){this.client.logger.error(u);let l=s.params.requester.publicKey,h=await this.client.core.crypto.generateKeyPair(),d=this.getAppLinkIfEnabled(s.params.requester.metadata,c),p={type:Ht,receiverPublicKey:l,senderPublicKey:h};await this.sendError({id:s.id,topic:n,error:u,encodeOpts:p,rpcOpts:We.wc_sessionAuthenticate.autoReject,appLink:d})}}),B(this,"addSessionRequestToSessionRequestQueue",t=>{this.sessionRequestQueue.queue.push(t)}),B(this,"cleanupAfterResponse",t=>{this.deletePendingSessionRequest(t.response.id,{message:"fulfilled",code:0}),setTimeout(()=>{this.sessionRequestQueue.state=ur.idle,this.processSessionRequestQueue()},(0,te.toMiliseconds)(this.requestQueueDelay))}),B(this,"cleanupPendingSentRequestsForTopic",({topic:t,error:i})=>{let n=this.client.core.history.pending;n.length>0&&n.filter(s=>s.topic===t&&s.request.method==="wc_sessionRequest").forEach(s=>{let o=s.request.id,a=oe("session_request",o);if(this.events.listenerCount(a)===0)throw new Error(`emitting ${a} without any listeners`);this.events.emit(oe("session_request",s.request.id),{error:i})})}),B(this,"processSessionRequestQueue",()=>{if(this.sessionRequestQueue.state===ur.active){this.client.logger.info("session request queue is already active.");return}let t=this.sessionRequestQueue.queue[0];if(!t){this.client.logger.info("session request queue is empty.");return}try{this.emitSessionRequest(t)}catch(i){this.client.logger.error(i)}}),B(this,"emitSessionRequest",t=>{if(this.emittedSessionRequests.has(t.id)){this.client.logger.warn({id:t.id},`Skipping emitting \`session_request\` event for duplicate request. id: ${t.id}`);return}this.sessionRequestQueue.state=ur.active,this.emittedSessionRequests.add(t.id),this.client.events.emit("session_request",t)}),B(this,"onPairingCreated",t=>{if(t.methods&&this.expectedPairingMethodMap.set(t.topic,t.methods),t.active)return;let i=this.client.proposal.getAll().find(n=>n.pairingTopic===t.topic);i&&this.onSessionProposeRequest({topic:t.topic,payload:At("wc_sessionPropose",at(le({},i),{requiredNamespaces:i.requiredNamespaces,optionalNamespaces:i.optionalNamespaces,relays:i.relays,proposer:i.proposer,sessionProperties:i.sessionProperties,scopedProperties:i.scopedProperties}),i.id),attestation:i.attestation,encryptedId:i.encryptedId})}),B(this,"isValidConnect",async t=>{if(!rt(t)){let{message:u}=M("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(t)}`);throw new Error(u)}let{pairingTopic:i,requiredNamespaces:n,optionalNamespaces:s,sessionProperties:o,scopedProperties:a,relays:c}=t;if(xe(i)||await this.isValidPairingTopic(i),!Dy(c,!0)){let{message:u}=M("MISSING_OR_INVALID",`connect() relays: ${c}`);throw new Error(u)}if(!xe(n)&&un(n)!==0&&(["fatal","error","silent"].includes(this.client.logger.level)||this.client.logger.warn("requiredNamespaces are deprecated and are automatically assigned to optionalNamespaces"),this.validateNamespaces(n,"requiredNamespaces")),!xe(s)&&un(s)!==0&&this.validateNamespaces(s,"optionalNamespaces"),xe(o)||this.validateSessionProps(o,"sessionProperties"),!xe(a)){this.validateSessionProps(a,"scopedProperties");let u=Object.keys(n||{}).concat(Object.keys(s||{}));if(!Object.keys(a).every(l=>u.includes(l.split(":")[0])))throw new Error(`Scoped properties must be a subset of required/optional namespaces, received: ${JSON.stringify(a)}, required/optional namespaces: ${JSON.stringify(u)}`)}}),B(this,"validateNamespaces",(t,i)=>{let n=Ay(t,"connect()",i);if(n)throw new Error(n.message)}),B(this,"isValidApprove",async t=>{if(!rt(t))throw new Error(M("MISSING_OR_INVALID",`approve() params: ${t}`).message);let{id:i,namespaces:n,relayProtocol:s,sessionProperties:o,scopedProperties:a}=t;this.checkRecentlyDeleted(i),await this.isValidProposalId(i);let c=this.client.proposal.get(i),u=ta(n,"approve()");if(u)throw new Error(u.message);let l=Rl(c.requiredNamespaces,n,"approve()");if(l)throw new Error(l.message);if(!we(s,!0)){let{message:h}=M("MISSING_OR_INVALID",`approve() relayProtocol: ${s}`);throw new Error(h)}if(xe(o)||this.validateSessionProps(o,"sessionProperties"),!xe(a)){this.validateSessionProps(a,"scopedProperties");let h=new Set(Object.keys(n));if(!Object.keys(a).every(d=>h.has(d.split(":")[0])))throw new Error(`Scoped properties must be a subset of approved namespaces, received: ${JSON.stringify(a)}, approved namespaces: ${Array.from(h).join(", ")}`)}}),B(this,"isValidReject",async t=>{if(!rt(t)){let{message:s}=M("MISSING_OR_INVALID",`reject() params: ${t}`);throw new Error(s)}let{id:i,reason:n}=t;if(this.checkRecentlyDeleted(i),await this.isValidProposalId(i),!Cy(n)){let{message:s}=M("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(n)}`);throw new Error(s)}}),B(this,"isValidSessionSettleRequest",t=>{if(!rt(t)){let{message:u}=M("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${t}`);throw new Error(u)}let{relay:i,controller:n,namespaces:s,expiry:o}=t;if(!Cl(i)){let{message:u}=M("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(u)}let a=Sy(n,"onSessionSettleRequest()");if(a)throw new Error(a.message);let c=ta(s,"onSessionSettleRequest()");if(c)throw new Error(c.message);if(ir(o)){let{message:u}=M("EXPIRED","onSessionSettleRequest()");throw new Error(u)}}),B(this,"isValidUpdate",async t=>{if(!rt(t)){let{message:c}=M("MISSING_OR_INVALID",`update() params: ${t}`);throw new Error(c)}let{topic:i,namespaces:n}=t;this.checkRecentlyDeleted(i),await this.isValidSessionTopic(i);let s=this.client.session.get(i),o=ta(n,"update()");if(o)throw new Error(o.message);let a=Rl(s.requiredNamespaces,n,"update()");if(a)throw new Error(a.message)}),B(this,"isValidExtend",async t=>{if(!rt(t)){let{message:n}=M("MISSING_OR_INVALID",`extend() params: ${t}`);throw new Error(n)}let{topic:i}=t;this.checkRecentlyDeleted(i),await this.isValidSessionTopic(i)}),B(this,"isValidRequest",async t=>{if(!rt(t)){let{message:c}=M("MISSING_OR_INVALID",`request() params: ${t}`);throw new Error(c)}let{topic:i,request:n,chainId:s,expiry:o}=t;this.checkRecentlyDeleted(i),await this.isValidSessionTopic(i);let{namespaces:a}=this.client.session.get(i);if(!Ol(a,s)){let{message:c}=M("MISSING_OR_INVALID",`request() chainId: ${s}`);throw new Error(c)}if(!Oy(n)){let{message:c}=M("MISSING_OR_INVALID",`request() ${JSON.stringify(n)}`);throw new Error(c)}if(!Py(a,s,n.method)){let{message:c}=M("MISSING_OR_INVALID",`request() method: ${n.method}`);throw new Error(c)}if(o&&!By(o,Mh)){let{message:c}=M("MISSING_OR_INVALID",`request() expiry: ${o}. Expiry must be a number (in seconds) between ${Mh.min} and ${Mh.max}`);throw new Error(c)}}),B(this,"isValidRespond",async t=>{var i;if(!rt(t)){let{message:o}=M("MISSING_OR_INVALID",`respond() params: ${t}`);throw new Error(o)}let{topic:n,response:s}=t;try{await this.isValidSessionTopic(n)}catch(o){throw(i=t?.response)!=null&&i.id&&this.cleanupAfterResponse(t),o}if(!Ry(s)){let{message:o}=M("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(s)}`);throw new Error(o)}}),B(this,"isValidPing",async t=>{if(!rt(t)){let{message:n}=M("MISSING_OR_INVALID",`ping() params: ${t}`);throw new Error(n)}let{topic:i}=t;await this.isValidSessionOrPairingTopic(i)}),B(this,"isValidEmit",async t=>{if(!rt(t)){let{message:a}=M("MISSING_OR_INVALID",`emit() params: ${t}`);throw new Error(a)}let{topic:i,event:n,chainId:s}=t;await this.isValidSessionTopic(i);let{namespaces:o}=this.client.session.get(i);if(!Ol(o,s)){let{message:a}=M("MISSING_OR_INVALID",`emit() chainId: ${s}`);throw new Error(a)}if(!Ny(n)){let{message:a}=M("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(n)}`);throw new Error(a)}if(!Fy(o,s,n.name)){let{message:a}=M("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(n)}`);throw new Error(a)}}),B(this,"isValidDisconnect",async t=>{if(!rt(t)){let{message:n}=M("MISSING_OR_INVALID",`disconnect() params: ${t}`);throw new Error(n)}let{topic:i}=t;await this.isValidSessionOrPairingTopic(i)}),B(this,"isValidAuthenticate",t=>{let{chains:i,uri:n,domain:s,nonce:o}=t;if(!Array.isArray(i)||i.length===0)throw new Error("chains is required and must be a non-empty array");if(!we(n,!1))throw new Error("uri is required parameter");if(!we(s,!1))throw new Error("domain is required parameter");if(!we(o,!1))throw new Error("nonce is required parameter");if([...new Set(i.map(c=>rs(c).namespace))].length>1)throw new Error("Multi-namespace requests are not supported. Please request single namespace only.");let{namespace:a}=rs(i[0]);if(a!=="eip155")throw new Error("Only eip155 namespace is supported for authenticated sessions. Please use .connect() for non-eip155 chains.")}),B(this,"getVerifyContext",async t=>{let{attestationId:i,hash:n,encryptedId:s,metadata:o,transportType:a}=t,c={verified:{verifyUrl:o.verifyUrl||gn,validation:"UNKNOWN",origin:o.url||""}};try{if(a===ge.link_mode){let l=this.getAppLinkIfEnabled(o,a);return c.verified.validation=l&&new URL(l).origin===new URL(o.url).origin?"VALID":"INVALID",c}let u=await this.client.core.verify.resolve({attestationId:i,hash:n,encryptedId:s,verifyUrl:o.verifyUrl});u&&(c.verified.origin=u.origin,c.verified.isScam=u.isScam,c.verified.validation=u.origin===new URL(o.url).origin?"VALID":"INVALID")}catch(u){this.client.logger.warn(u)}return this.client.logger.debug(`Verify context: ${JSON.stringify(c)}`),c}),B(this,"validateSessionProps",(t,i)=>{Object.values(t).forEach((n,s)=>{if(n==null){let{message:o}=M("MISSING_OR_INVALID",`${i} must contain an existing value for each key. Received: ${n} for key ${Object.keys(t)[s]}`);throw new Error(o)}})}),B(this,"getPendingAuthRequest",t=>{let i=this.client.auth.requests.get(t);return typeof i=="object"?i:void 0}),B(this,"addToRecentlyDeleted",(t,i)=>{if(this.recentlyDeletedMap.set(t,i),this.recentlyDeletedMap.size>=this.recentlyDeletedLimit){let n=0,s=this.recentlyDeletedLimit/2;for(let o of this.recentlyDeletedMap.keys()){if(n++>=s)break;this.recentlyDeletedMap.delete(o)}}}),B(this,"checkRecentlyDeleted",t=>{let i=this.recentlyDeletedMap.get(t);if(i){let{message:n}=M("MISSING_OR_INVALID",`Record was recently deleted - ${i}: ${t}`);throw new Error(n)}}),B(this,"isLinkModeEnabled",(t,i)=>{var n,s,o,a,c,u,l,h,d;return!t||i!==ge.link_mode?!1:((s=(n=this.client.metadata)==null?void 0:n.redirect)==null?void 0:s.linkMode)===!0&&((a=(o=this.client.metadata)==null?void 0:o.redirect)==null?void 0:a.universal)!==void 0&&((u=(c=this.client.metadata)==null?void 0:c.redirect)==null?void 0:u.universal)!==""&&((l=t?.redirect)==null?void 0:l.universal)!==void 0&&((h=t?.redirect)==null?void 0:h.universal)!==""&&((d=t?.redirect)==null?void 0:d.linkMode)===!0&&this.client.core.linkModeSupportedApps.includes(t.redirect.universal)&&typeof(global==null?void 0:global.Linking)<"u"}),B(this,"getAppLinkIfEnabled",(t,i)=>{var n;return this.isLinkModeEnabled(t,i)?(n=t?.redirect)==null?void 0:n.universal:void 0}),B(this,"handleLinkModeMessage",({url:t})=>{if(!t||!t.includes("wc_ev")||!t.includes("topic"))return;let i=il(t,"topic")||"",n=decodeURIComponent(il(t,"wc_ev")||""),s=this.client.session.keys.includes(i);s&&this.client.session.update(i,{transportType:ge.link_mode}),this.client.core.dispatchEnvelope({topic:i,message:n,sessionExists:s})}),B(this,"registerLinkModeListeners",async()=>{var t;if(ss()||Er()&&(t=this.client.metadata.redirect)!=null&&t.linkMode){let i=global==null?void 0:global.Linking;if(typeof i<"u"){i.addEventListener("url",this.handleLinkModeMessage,this.client.name);let n=await i.getInitialURL();n&&setTimeout(()=>{this.handleLinkModeMessage({url:n})},50)}}}),B(this,"getTVFParams",(t,i,n)=>{var s,o,a;if(!((s=i.request)!=null&&s.method))return{};let c={correlationId:t,rpcMethods:[i.request.method],chainId:i.chainId};try{let u=this.extractTxHashesFromResult(i.request,n);c.txHashes=u,c.contractAddresses=this.isValidContractData(i.request.params)?[(a=(o=i.request.params)==null?void 0:o[0])==null?void 0:a.to]:[]}catch(u){this.client.logger.warn("Error getting TVF params",u)}return c}),B(this,"isValidContractData",t=>{var i;if(!t)return!1;try{let n=t?.data||((i=t?.[0])==null?void 0:i.data);if(!n.startsWith("0x"))return!1;let s=n.slice(2);return/^[0-9a-fA-F]*$/.test(s)?s.length%2===0:!1}catch{}return!1}),B(this,"extractTxHashesFromResult",(t,i)=>{var n;try{if(!i)return[];let s=t.method,o=FC[s];if(s==="sui_signTransaction")return[Pm(i.transactionBytes)];if(s==="near_signTransaction")return[hl(i)];if(s==="near_signTransactions")return i.map(c=>hl(c));if(s==="xrpl_signTransactionFor"||s==="xrpl_signTransaction")return[(n=i.tx_json)==null?void 0:n.hash];if(s==="polkadot_signTransaction")return[Ly({transaction:t.params.transactionPayload,signature:i.signature})];if(s==="algo_signTxn")return Sr(i)?i.map(c=>dl(c)):[dl(i)];if(s==="cosmos_signDirect")return[Fm(i)];if(typeof i=="string")return[i];let a=i[o.key];if(Sr(a))return s==="solana_signAllTransactions"?a.map(c=>Nm(c)):a;if(typeof a=="string")return[a]}catch(s){this.client.logger.warn("Error extracting tx hashes from result",s)}return[]})}async processPendingMessageEvents(){try{let e=this.client.session.keys,t=this.client.core.relayer.messages.getWithoutAck(e);for(let[i,n]of Object.entries(t))for(let s of n)try{await this.onProviderMessageEvent({topic:i,message:s,publishedAt:Date.now()})}catch{this.client.logger.warn(`Error processing pending message event for topic: ${i}, message: ${s}`)}}catch(e){this.client.logger.warn("processPendingMessageEvents failed",e)}}isInitialized(){if(!this.initialized){let{message:e}=M("NOT_INITIALIZED",this.name);throw new Error(e)}}async confirmOnlineStateOrThrow(){await this.client.core.relayer.confirmOnlineStateOrThrow()}registerRelayerEvents(){this.client.core.relayer.on(ve.message,e=>{this.onProviderMessageEvent(e)})}async onRelayMessage(e){let{topic:t,message:i,attestation:n,transportType:s}=e,{publicKey:o}=this.client.auth.authKeys.keys.includes(qa)?this.client.auth.authKeys.get(qa):{responseTopic:void 0,publicKey:void 0};try{let a=await this.client.core.crypto.decode(t,i,{receiverPublicKey:o,encoding:s===ge.link_mode?_r:tt});dn(a)?(this.client.core.history.set(t,a),await this.onRelayEventRequest({topic:t,payload:a,attestation:n,transportType:s,encryptedId:bt(i)})):ei(a)?(await this.client.core.history.resolve(a),await this.onRelayEventResponse({topic:t,payload:a,transportType:s}),this.client.core.history.delete(t,a.id)):await this.onRelayEventUnknownPayload({topic:t,payload:a,transportType:s}),await this.client.core.relayer.messages.ack(t,i)}catch(a){this.client.logger.error(a)}}registerExpirerEvents(){this.client.core.expirer.on(Ot.expired,async e=>{let{topic:t,id:i}=Ho(e.target);if(i&&this.client.pendingRequest.keys.includes(i))return await this.deletePendingSessionRequest(i,M("EXPIRED"),!0);if(i&&this.client.auth.requests.keys.includes(i))return await this.deletePendingAuthRequest(i,M("EXPIRED"),!0);t?this.client.session.keys.includes(t)&&(await this.deleteSession({topic:t,expirerHasDeleted:!0}),this.client.events.emit("session_expire",{topic:t})):i&&(await this.deleteProposal(i,!0),this.client.events.emit("proposal_expire",{id:i}))})}registerPairingEvents(){this.client.core.pairing.events.on(ti.create,e=>this.onPairingCreated(e)),this.client.core.pairing.events.on(ti.delete,e=>{this.addToRecentlyDeleted(e.topic,"pairing")})}isValidPairingTopic(e){if(!we(e,!1)){let{message:t}=M("MISSING_OR_INVALID",`pairing topic should be a string: ${e}`);throw new Error(t)}if(!this.client.core.pairing.pairings.keys.includes(e)){let{message:t}=M("NO_MATCHING_KEY",`pairing topic doesn't exist: ${e}`);throw new Error(t)}if(ir(this.client.core.pairing.pairings.get(e).expiry)){let{message:t}=M("EXPIRED",`pairing topic: ${e}`);throw new Error(t)}}async isValidSessionTopic(e){if(!we(e,!1)){let{message:t}=M("MISSING_OR_INVALID",`session topic should be a string: ${e}`);throw new Error(t)}if(this.checkRecentlyDeleted(e),!this.client.session.keys.includes(e)){let{message:t}=M("NO_MATCHING_KEY",`session topic doesn't exist: ${e}`);throw new Error(t)}if(ir(this.client.session.get(e).expiry)){await this.deleteSession({topic:e});let{message:t}=M("EXPIRED",`session topic: ${e}`);throw new Error(t)}if(!this.client.core.crypto.keychain.has(e)){let{message:t}=M("MISSING_OR_INVALID",`session topic does not exist in keychain: ${e}`);throw await this.deleteSession({topic:e}),new Error(t)}}async isValidSessionOrPairingTopic(e){if(this.checkRecentlyDeleted(e),this.client.session.keys.includes(e))await this.isValidSessionTopic(e);else if(this.client.core.pairing.pairings.keys.includes(e))this.isValidPairingTopic(e);else if(we(e,!1)){let{message:t}=M("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${e}`);throw new Error(t)}else{let{message:t}=M("MISSING_OR_INVALID",`session or pairing topic should be a string: ${e}`);throw new Error(t)}}async isValidProposalId(e){if(!Ty(e)){let{message:t}=M("MISSING_OR_INVALID",`proposal id should be a number: ${e}`);throw new Error(t)}if(!this.client.proposal.keys.includes(e)){let{message:t}=M("NO_MATCHING_KEY",`proposal id doesn't exist: ${e}`);throw new Error(t)}if(ir(this.client.proposal.get(e).expiryTimestamp)){await this.deleteProposal(e);let{message:t}=M("EXPIRED",`proposal id: ${e}`);throw new Error(t)}}},Vh=class extends cr{constructor(e,t){super(e,t,RC,Jh),this.core=e,this.logger=t}},$h=class extends cr{constructor(e,t){super(e,t,NC,Jh),this.core=e,this.logger=t}},Kh=class extends cr{constructor(e,t){super(e,t,BC,Jh,i=>i.id),this.core=e,this.logger=t}},Hh=class extends cr{constructor(e,t){super(e,t,MC,Va,()=>qa),this.core=e,this.logger=t}},Wh=class extends cr{constructor(e,t){super(e,t,qC,Va),this.core=e,this.logger=t}},Gh=class extends cr{constructor(e,t){super(e,t,zC,Va,i=>i.id),this.core=e,this.logger=t}},WC=Object.defineProperty,GC=(r,e,t)=>e in r?WC(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,qh=(r,e,t)=>GC(r,typeof e!="symbol"?e+"":e,t),Yh=class{constructor(e,t){this.core=e,this.logger=t,qh(this,"authKeys"),qh(this,"pairingTopics"),qh(this,"requests"),this.authKeys=new Hh(this.core,this.logger),this.pairingTopics=new Wh(this.core,this.logger),this.requests=new Gh(this.core,this.logger)}async init(){await this.authKeys.init(),await this.pairingTopics.init(),await this.requests.init()}},YC=Object.defineProperty,JC=(r,e,t)=>e in r?YC(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,ie=(r,e,t)=>JC(r,typeof e!="symbol"?e+"":e,t),za=class r extends _a{constructor(e){super(e),ie(this,"protocol",Bw),ie(this,"version",Uw),ie(this,"name",Lh.name),ie(this,"metadata"),ie(this,"core"),ie(this,"logger"),ie(this,"events",new ja.EventEmitter),ie(this,"engine"),ie(this,"session"),ie(this,"proposal"),ie(this,"pendingRequest"),ie(this,"auth"),ie(this,"signConfig"),ie(this,"on",(i,n)=>this.events.on(i,n)),ie(this,"once",(i,n)=>this.events.once(i,n)),ie(this,"off",(i,n)=>this.events.off(i,n)),ie(this,"removeListener",(i,n)=>this.events.removeListener(i,n)),ie(this,"removeAllListeners",i=>this.events.removeAllListeners(i)),ie(this,"connect",async i=>{try{return await this.engine.connect(i)}catch(n){throw this.logger.error(n.message),n}}),ie(this,"pair",async i=>{try{return await this.engine.pair(i)}catch(n){throw this.logger.error(n.message),n}}),ie(this,"approve",async i=>{try{return await this.engine.approve(i)}catch(n){throw this.logger.error(n.message),n}}),ie(this,"reject",async i=>{try{return await this.engine.reject(i)}catch(n){throw this.logger.error(n.message),n}}),ie(this,"update",async i=>{try{return await this.engine.update(i)}catch(n){throw this.logger.error(n.message),n}}),ie(this,"extend",async i=>{try{return await this.engine.extend(i)}catch(n){throw this.logger.error(n.message),n}}),ie(this,"request",async i=>{try{return await this.engine.request(i)}catch(n){throw this.logger.error(n.message),n}}),ie(this,"respond",async i=>{try{return await this.engine.respond(i)}catch(n){throw this.logger.error(n.message),n}}),ie(this,"ping",async i=>{try{return await this.engine.ping(i)}catch(n){throw this.logger.error(n.message),n}}),ie(this,"emit",async i=>{try{return await this.engine.emit(i)}catch(n){throw this.logger.error(n.message),n}}),ie(this,"disconnect",async i=>{try{return await this.engine.disconnect(i)}catch(n){throw this.logger.error(n.message),n}}),ie(this,"find",i=>{try{return this.engine.find(i)}catch(n){throw this.logger.error(n.message),n}}),ie(this,"getPendingSessionRequests",()=>{try{return this.engine.getPendingSessionRequests()}catch(i){throw this.logger.error(i.message),i}}),ie(this,"authenticate",async(i,n)=>{try{return await this.engine.authenticate(i,n)}catch(s){throw this.logger.error(s.message),s}}),ie(this,"formatAuthMessage",i=>{try{return this.engine.formatAuthMessage(i)}catch(n){throw this.logger.error(n.message),n}}),ie(this,"approveSessionAuthenticate",async i=>{try{return await this.engine.approveSessionAuthenticate(i)}catch(n){throw this.logger.error(n.message),n}}),ie(this,"rejectSessionAuthenticate",async i=>{try{return await this.engine.rejectSessionAuthenticate(i)}catch(n){throw this.logger.error(n.message),n}}),this.name=e?.name||Lh.name,this.metadata=dm(e?.metadata),this.signConfig=e?.signConfig;let t=typeof e?.logger<"u"&&typeof e?.logger!="string"?e.logger:(0,ws.default)(bs({level:e?.logger||Lh.logger}));this.core=e?.core||new Rw(e),this.logger=Ve(t,this.name),this.session=new $h(this.core,this.logger),this.proposal=new Vh(this.core,this.logger),this.pendingRequest=new Kh(this.core,this.logger),this.engine=new jh(this),this.auth=new Yh(this.core,this.logger)}static async init(e){let t=new r(e);return await t.initialize(),t}get context(){return it(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.auth.init(),await this.engine.init(),this.logger.info("SignClient Initialization Success")}catch(e){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(e.message),e}}};var _v=Se(Rv());var Lw=function(r,e){return Object.keys(r).filter(function(t){return e(t,r[t])}).reduce(function(t,i){return t[i]=r[i],t},{})};var ii=(function(r){Le(e,r);function e(t,i){var n=r.call(this,"".concat(t," ").concat(i))||this;return n.field=t,n}return e})(Error);var Xh="is not a string",Qh="is not an object",XC="is nil";function QC(r){if(!Rd(r))throw new ii("Event",XC);if(typeof r!="object")throw new ii("Event",Qh)}function ZC(r){if(!Jt(r.type))throw new ii(".type",Xh)}function eO(r){if(!Jt(r.event))throw new ii(".event",Xh)}function tO(r){if(!_t(r.properties))throw new ii(".properties",Qh)}function rO(r){if(!_t(r.traits))throw new ii(".traits",Qh)}function iO(r){if(!Jt(r.messageId))throw new ii(".messageId",Xh)}function Mw(r){QC(r),ZC(r),iO(r),r.type==="track"&&(eO(r),tO(r)),["group","identify"].includes(r.type)&&rO(r)}var nO=(function(){function r(e){var t,i;this.settings=e,this.createMessageId=e.createMessageId,this.onEventMethodCall=(t=e.onEventMethodCall)!==null&&t!==void 0?t:(function(){}),this.onFinishedEvent=(i=e.onFinishedEvent)!==null&&i!==void 0?i:(function(){})}return r})(),qw=(function(){function r(e){this.settings=new nO(e)}return r.prototype.track=function(e,t,i,n){return this.settings.onEventMethodCall({type:"track",options:i}),this.normalize(q(q({},this.baseEvent()),{event:e,type:"track",properties:t??{},options:q({},i),integrations:q({},n)}))},r.prototype.page=function(e,t,i,n,s){var o;this.settings.onEventMethodCall({type:"page",options:n});var a={type:"page",properties:q({},i),options:q({},n),integrations:q({},s)};return e!==null&&(a.category=e,a.properties=(o=a.properties)!==null&&o!==void 0?o:{},a.properties.category=e),t!==null&&(a.name=t),this.normalize(q(q({},this.baseEvent()),a))},r.prototype.screen=function(e,t,i,n,s){this.settings.onEventMethodCall({type:"screen",options:n});var o={type:"screen",properties:q({},i),options:q({},n),integrations:q({},s)};return e!==null&&(o.category=e),t!==null&&(o.name=t),this.normalize(q(q({},this.baseEvent()),o))},r.prototype.identify=function(e,t,i,n){return this.settings.onEventMethodCall({type:"identify",options:i}),this.normalize(q(q({},this.baseEvent()),{type:"identify",userId:e,traits:t??{},options:q({},i),integrations:n}))},r.prototype.group=function(e,t,i,n){return this.settings.onEventMethodCall({type:"group",options:i}),this.normalize(q(q({},this.baseEvent()),{type:"group",traits:t??{},options:q({},i),integrations:q({},n),groupId:e}))},r.prototype.alias=function(e,t,i,n){this.settings.onEventMethodCall({type:"alias",options:i});var s={userId:e,type:"alias",options:q({},i),integrations:q({},n)};return t!==null&&(s.previousId=t),e===void 0?this.normalize(q(q({},s),this.baseEvent())):this.normalize(q(q({},this.baseEvent()),s))},r.prototype.baseEvent=function(){return{integrations:{},options:{}}},r.prototype.context=function(e){var t,i=["userId","anonymousId","timestamp","messageId"];delete e.integrations;var n=Object.keys(e),s=(t=e.context)!==null&&t!==void 0?t:{},o={};return n.forEach(function(a){a!=="context"&&(i.includes(a)?sc(o,a,e[a]):sc(s,a,e[a]))}),[s,o]},r.prototype.normalize=function(e){var t,i,n=Object.keys((t=e.integrations)!==null&&t!==void 0?t:{}).reduce(function(d,p){var f,g;return q(q({},d),(f={},f[p]=!!(!((g=e.integrations)===null||g===void 0)&&g[p]),f))},{});e.options=Lw(e.options||{},function(d,p){return p!==void 0});var s=q(q({},n),(i=e.options)===null||i===void 0?void 0:i.integrations),o=e.options?this.context(e.options):[],a=o[0],c=o[1],u=e.options,l=Ls(e,["options"]),h=q(q(q(q({timestamp:new Date},l),{context:a,integrations:s}),c),{messageId:u.messageId||this.settings.createMessageId()});return this.settings.onFinishedEvent(h),Mw(h),h},r})();function zw(r,e){var t={};return r.forEach(function(i){var n,s=void 0;if(typeof e=="string"){var o=i[e];s=typeof o!="string"?JSON.stringify(o):o}else e instanceof Function&&(s=e(i));s!==void 0&&(t[s]=Ne(Ne([],(n=t[s])!==null&&n!==void 0?n:[],!0),[i],!1))}),t}var jw=function(r){return typeof r=="object"&&r!==null&&"then"in r&&typeof r.then=="function"};var Vw=function(){var r,e,t=0;return{done:function(){return r},run:function(i){var n=i();return jw(n)&&(++t===1&&(r=new Promise(function(s){return e=s})),n.finally(function(){return--t===0&&e()})),n}}};var $w=(function(r){Le(e,r);function e(t){var i=r.call(this)||this;return i.criticalTasks=Vw(),i.plugins=[],i.failedInitializations=[],i.flushing=!1,i.queue=t,i.queue.on(Pd,function(){i.scheduleFlush(0)}),i}return e.prototype.register=function(t,i,n){return $(this,void 0,void 0,function(){var s,o,a=this;return K(this,function(c){switch(c.label){case 0:return this.plugins.push(i),s=function(u){a.failedInitializations.push(i.name),a.emit("initialization_failure",i),t.log("warn","Failed to load destination",{plugin:i.name,error:u}),a.plugins=a.plugins.filter(function(l){return l!==i})},i.type==="destination"&&i.name!=="Segment.io"?(i.load(t,n).catch(s),[3,4]):[3,1];case 1:return c.trys.push([1,3,,4]),[4,i.load(t,n)];case 2:return c.sent(),[3,4];case 3:return o=c.sent(),s(o),[3,4];case 4:return[2]}})})},e.prototype.deregister=function(t,i,n){return $(this,void 0,void 0,function(){var s;return K(this,function(o){switch(o.label){case 0:return o.trys.push([0,3,,4]),i.unload?[4,Promise.resolve(i.unload(t,n))]:[3,2];case 1:o.sent(),o.label=2;case 2:return this.plugins=this.plugins.filter(function(a){return a.name!==i.name}),[3,4];case 3:return s=o.sent(),t.log("warn","Failed to unload destination",{plugin:i.name,error:s}),[3,4];case 4:return[2]}})})},e.prototype.dispatch=function(t){return $(this,void 0,void 0,function(){var i;return K(this,function(n){return t.log("debug","Dispatching"),t.stats.increment("message_dispatched"),this.queue.push(t),i=this.subscribeToDelivery(t),this.scheduleFlush(0),[2,i]})})},e.prototype.subscribeToDelivery=function(t){return $(this,void 0,void 0,function(){var i=this;return K(this,function(n){return[2,new Promise(function(s){var o=function(a,c){a.isSame(t)&&(i.off("flush",o),s(a))};i.on("flush",o)})]})})},e.prototype.dispatchSingle=function(t){return $(this,void 0,void 0,function(){var i=this;return K(this,function(n){return t.log("debug","Dispatching"),t.stats.increment("message_dispatched"),this.queue.updateAttempts(t),t.attempts=1,[2,this.deliver(t).catch(function(s){var o=i.enqueuRetry(s,t);return o?i.subscribeToDelivery(t):(t.setFailedDelivery({reason:s}),t)})]})})},e.prototype.isEmpty=function(){return this.queue.length===0},e.prototype.scheduleFlush=function(t){var i=this;t===void 0&&(t=500),!this.flushing&&(this.flushing=!0,setTimeout(function(){i.flush().then(function(){setTimeout(function(){i.flushing=!1,i.queue.length&&i.scheduleFlush(0)},0)})},t))},e.prototype.deliver=function(t){return $(this,void 0,void 0,function(){var i,n,s,o;return K(this,function(a){switch(a.label){case 0:return[4,this.criticalTasks.done()];case 1:a.sent(),i=Date.now(),a.label=2;case 2:return a.trys.push([2,4,,5]),[4,this.flushOne(t)];case 3:return t=a.sent(),n=Date.now()-i,this.emit("delivery_success",t),t.stats.gauge("delivered",n),t.log("debug","Delivered",t.event),[2,t];case 4:throw s=a.sent(),o=s,t.log("error","Failed to deliver",o),this.emit("delivery_failure",t,o),t.stats.increment("delivery_failed"),s;case 5:return[2]}})})},e.prototype.enqueuRetry=function(t,i){var n=!(t instanceof $s)||t.retry;return n?this.queue.pushWithBackoff(i):!1},e.prototype.flush=function(){return $(this,void 0,void 0,function(){var t,i,n;return K(this,function(s){switch(s.label){case 0:if(this.queue.length===0)return[2,[]];if(t=this.queue.pop(),!t)return[2,[]];t.attempts=this.queue.getAttempts(t),s.label=1;case 1:return s.trys.push([1,3,,4]),[4,this.deliver(t)];case 2:return t=s.sent(),this.emit("flush",t,!0),[3,4];case 3:return i=s.sent(),n=this.enqueuRetry(i,t),n||(t.setFailedDelivery({reason:i}),this.emit("flush",t,!1)),[2,[]];case 4:return[2,[t]]}})})},e.prototype.isReady=function(){return!0},e.prototype.availableExtensions=function(t){var i=this.plugins.filter(function(p){var f,g,m;if(p.type!=="destination"&&p.name!=="Segment.io")return!0;var w=void 0;return(f=p.alternativeNames)===null||f===void 0||f.forEach(function(v){t[v]!==void 0&&(w=t[v])}),(m=(g=t[p.name])!==null&&g!==void 0?g:w)!==null&&m!==void 0?m:(p.name==="Segment.io"?!0:t.All)!==!1}),n=zw(i,"type"),s=n.before,o=s===void 0?[]:s,a=n.enrichment,c=a===void 0?[]:a,u=n.destination,l=u===void 0?[]:u,h=n.after,d=h===void 0?[]:h;return{before:o,enrichment:c,destinations:l,after:d}},e.prototype.flushOne=function(t){var i,n;return $(this,void 0,void 0,function(){var s,o,a,c,u,l,f,h,d,p,f,g,m,w,v;return K(this,function(y){switch(y.label){case 0:if(!this.isReady())throw new Error("Not ready");t.attempts>1&&this.emit("delivery_retry",t),s=this.availableExtensions((i=t.event.integrations)!==null&&i!==void 0?i:{}),o=s.before,a=s.enrichment,c=0,u=o,y.label=1;case 1:return c<u.length?(l=u[c],[4,Fd(t,l)]):[3,4];case 2:f=y.sent(),f instanceof oc&&(t=f),this.emit("message_enriched",t,l),y.label=3;case 3:return c++,[3,1];case 4:h=0,d=a,y.label=5;case 5:return h<d.length?(p=d[h],[4,Ni(t,p)]):[3,8];case 6:f=y.sent(),f instanceof oc&&(t=f),this.emit("message_enriched",t,p),y.label=7;case 7:return h++,[3,5];case 8:return g=this.availableExtensions((n=t.event.integrations)!==null&&n!==void 0?n:{}),m=g.destinations,w=g.after,[4,new Promise(function(S,E){setTimeout(function(){var C=m.map(function(R){return Ni(t,R)});Promise.all(C).then(S).catch(E)},0)})];case 9:return y.sent(),t.stats.increment("message_delivered"),this.emit("message_delivered",t),v=w.map(function(S){return Ni(t,S)}),[4,Promise.all(v)];case 10:return y.sent(),[2,t]}})})},e})(zs);var sO=function(r,e){var t=Date.now()-r;return Math.max((e??300)-t,0)};function Kw(r,e,t,i){return $(this,void 0,void 0,function(){var n,s;return K(this,function(o){switch(o.label){case 0:return t.emit("dispatch_start",r),n=Date.now(),e.isEmpty()?[4,e.dispatchSingle(r)]:[3,2];case 1:return s=o.sent(),[3,4];case 2:return[4,e.dispatch(r)];case 3:s=o.sent(),o.label=4;case 4:return i?.callback?[4,Nd(s,i.callback,sO(n,i.timeout))]:[3,6];case 5:s=o.sent(),o.label=6;case 6:return i?.debug&&s.flush(),[2,s]}})})}function Hw(r,e,t,i){var n,s=[r,e,t,i],o=_t(r)?r.event:r;if(!o||!Jt(o))throw new Error("Event missing");var a=_t(r)?(n=r.properties)!==null&&n!==void 0?n:{}:_t(e)?e:{},c={};oi(t)||(c=t??{}),_t(r)&&!oi(e)&&(c=e??{});var u=s.find(oi);return[o,a,c,u]}function Zh(r,e,t,i,n){var s,o,a=null,c=null,u=[r,e,t,i,n],l=u.filter(Jt);l.length===1?Jt(u[1])?(c=u[1],a=null):(c=l[0],a=null):l.length===2&&(typeof u[0]=="string"&&(a=u[0]),typeof u[1]=="string"&&(c=u[1]));var h=u.find(oi),d=u.filter(_t);return d.length===1?_t(u[2])?(o={},s=u[2]):_t(u[3])?(s={},o=u[3]):(s=d[0],o={}):d.length===2&&(s=d[0],o=d[1]),[a,c,s??(s={}),o??(o={}),h]}var ed=function(r){return function(){for(var e,t,i,n=[],s=0;s<arguments.length;s++)n[s]=arguments[s];for(var o={},a=["callback","options","traits","id"],c=0,u=n;c<u.length;c++){var l=u[c],h=a.pop();if(h==="id"){if(Jt(l)||Ms(l)){o.id=l.toString();continue}if(l==null)continue;h=a.pop()}if((h==="traits"||h==="options")&&(l==null||_t(l))&&(o[h]=l),oi(l)){o.callback=l;break}}return[(e=o.id)!==null&&e!==void 0?e:r.id(),(t=o.traits)!==null&&t!==void 0?t:{},(i=o.options)!==null&&i!==void 0?i:{},o.callback]}};function Ww(r,e,t,i){Ms(r)&&(r=r.toString()),Ms(e)&&(e=e.toString());var n=[r,e,t,i],s=n.filter(Jt),o=s[0],a=o===void 0?r:o,c=s[1],u=c===void 0?null:c,l=n.filter(_t)[0],h=l===void 0?{}:l,d=n.find(oi);return[a,u,h,d]}function oO(r){return Object.prototype.toString.call(r).slice(8,-1).toLowerCase()==="object"}var td="bpc",rd=function(r,e,t,i,n,s){return{__t:td,c:e,p:i,u:r,s:t,t:n,r:s}},aO=Object.keys(rd("","","","","",""));function id(r){if(!oO(r)||r.__t!==td)return!1;for(var e in r)if(!aO.includes(e))return!1;return!0}var cO=function(r,e){return r.indexOf("?")>-1?r:r+e},uO=function(r){var e=r.indexOf("#");return e===-1?r:r.slice(0,e)},lO=function(r){try{return new URL(r).pathname}catch{return r[0]==="/"?r:"/"+r}},$a=function(r){var e=r.c,t=r.p,i=r.s,n=r.u,s=r.r,o=r.t,a=e?lO(e):t,c=e?cO(e,i):uO(n);return{path:a,referrer:s,search:i,title:o,url:c}},Ka=function(){var r=document.querySelector("link[rel='canonical']");return rd(location.href,r&&r.getAttribute("href")||void 0,location.search,location.pathname,document.title,document.referrer)},nd=function(){return $a(Ka())};function Gw(r,e){return Object.assign.apply(Object,Ne([{}],e.map(function(t){var i;if(r&&Object.prototype.hasOwnProperty.call(r,t))return i={},i[t]=r[t],i}),!1))}var Ai=function(r,e){e===void 0&&(e=nd());var t=r.context,i;r.type==="page"&&(i=r.properties&&Gw(r.properties,Object.keys(e)),r.properties=q(q(q({},e),r.properties),r.name?{name:r.name}:{})),t.page=q(q(q({},e),i),t.page)};var Yw=(function(r){Le(e,r);function e(t){var i=r.call(this,{createMessageId:function(){return"ajs-next-".concat(Date.now(),"-").concat(Vs())},onEventMethodCall:function(n){var s=n.options;i.maybeUpdateAnonId(s)},onFinishedEvent:function(n){return i.addIdentity(n),n}})||this;return i.user=t,i}return e.prototype.maybeUpdateAnonId=function(t){t?.anonymousId&&this.user.anonymousId(t.anonymousId)},e.prototype.addIdentity=function(t){this.user.id()&&(t.userId=this.user.id()),this.user.anonymousId()&&(t.anonymousId=this.user.anonymousId())},e.prototype.track=function(t,i,n,s,o){var a=r.prototype.track.call(this,t,i,n,s);return Ai(a,o),a},e.prototype.page=function(t,i,n,s,o,a){var c=r.prototype.page.call(this,t,i,n,s,o);return Ai(c,a),c},e.prototype.screen=function(t,i,n,s,o,a){var c=r.prototype.screen.call(this,t,i,n,s,o);return Ai(c,a),c},e.prototype.identify=function(t,i,n,s,o){var a=r.prototype.identify.call(this,t,i,n,s);return Ai(a,o),a},e.prototype.group=function(t,i,n,s,o){var a=r.prototype.group.call(this,t,i,n,s);return Ai(a,o),a},e.prototype.alias=function(t,i,n,s,o){var a=r.prototype.alias.call(this,t,i,n,s);return Ai(a,o),a},e})(qw);var Jw=function(r){return"addMiddleware"in r&&r.type==="destination"};var Xw=(function(r){Le(e,r);function e(t){return r.call(this,typeof t=="string"?new Bi(4,t):t)||this}return e.prototype.flush=function(){return $(this,void 0,void 0,function(){return K(this,function(t){return dr()?[2,[]]:[2,r.prototype.flush.call(this)]})})},e})($w);function vn(r){for(var e=r.constructor.prototype,t=0,i=Object.getOwnPropertyNames(e);t<i.length;t++){var n=i[t];if(n!=="constructor"){var s=Object.getOwnPropertyDescriptor(r.constructor.prototype,n);s&&typeof s.value=="function"&&(r[n]=r[n].bind(r))}}return r}function Ha(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var i in t)r[i]=t[i]}return r}var hO={read:function(r){return r[0]==='"'&&(r=r.slice(1,-1)),r.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent)},write:function(r){return encodeURIComponent(r).replace(/%(2[346BF]|3[AC-F]|40|5[BDE]|60|7[BCD])/g,decodeURIComponent)}};function sd(r,e){function t(n,s,o){if(!(typeof document>"u")){o=Ha({},e,o),typeof o.expires=="number"&&(o.expires=new Date(Date.now()+o.expires*864e5)),o.expires&&(o.expires=o.expires.toUTCString()),n=encodeURIComponent(n).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);var a="";for(var c in o)o[c]&&(a+="; "+c,o[c]!==!0&&(a+="="+o[c].split(";")[0]));return document.cookie=n+"="+r.write(s,n)+a}}function i(n){if(!(typeof document>"u"||arguments.length&&!n)){for(var s=document.cookie?document.cookie.split("; "):[],o={},a=0;a<s.length;a++){var c=s[a].split("="),u=c.slice(1).join("=");try{var l=decodeURIComponent(c[0]);if(o[l]=r.read(u,l),n===l)break}catch{}}return n?o[n]:o}}return Object.create({set:t,get:i,remove:function(n,s){t(n,"",Ha({},s,{expires:-1}))},withAttributes:function(n){return sd(this.converter,Ha({},this.attributes,n))},withConverter:function(n){return sd(Ha({},this.converter,n),this.attributes)}},{attributes:{value:Object.freeze(e)},converter:{value:Object.freeze(r)}})}var dO=sd(hO,{path:"/"}),Mt=dO;function fO(r){var e=r.hostname,t=e.split("."),i=t[t.length-1],n=[];if(t.length===4&&parseInt(i,10)>0||t.length<=1)return n;for(var s=t.length-2;s>=0;--s)n.push(t.slice(s).join("."));return n}function pO(r){try{return new URL(r)}catch{return}}function Wa(r){var e=pO(r);if(e)for(var t=fO(e),i=0;i<t.length;++i){var n="__tld__",s=t[i],o={domain:"."+s};try{if(Mt.set(n,"1",o),Mt.get(n))return Mt.remove(n,o),s}catch{return}}}var gO=365,Ga=(function(){function r(e){e===void 0&&(e=r.defaults),this.options=q(q({},r.defaults),e)}return Object.defineProperty(r,"defaults",{get:function(){return{maxage:gO,domain:Wa(window.location.href),path:"/",sameSite:"Lax"}},enumerable:!1,configurable:!0}),r.prototype.opts=function(){return{sameSite:this.options.sameSite,expires:this.options.maxage,domain:this.options.domain,path:this.options.path,secure:this.options.secure}},r.prototype.get=function(e){var t;try{var i=Mt.get(e);if(i==null)return null;try{return(t=JSON.parse(i))!==null&&t!==void 0?t:null}catch{return i??null}}catch{return null}},r.prototype.set=function(e,t){typeof t=="string"?Mt.set(e,t,this.opts()):t===null?Mt.remove(e,this.opts()):Mt.set(e,JSON.stringify(t),this.opts())},r.prototype.remove=function(e){return Mt.remove(e,this.opts())},r})();var Qw=(function(){function r(){}return r.prototype.localStorageWarning=function(e,t){},r.prototype.get=function(e){var t;try{var i=localStorage.getItem(e);if(i===null)return null;try{return(t=JSON.parse(i))!==null&&t!==void 0?t:null}catch{return i??null}}catch{return this.localStorageWarning(e,"unavailable"),null}},r.prototype.set=function(e,t){try{localStorage.setItem(e,JSON.stringify(t))}catch{this.localStorageWarning(e,"full")}},r.prototype.remove=function(e){try{return localStorage.removeItem(e)}catch{this.localStorageWarning(e,"unavailable")}},r})();var bn=(function(){function r(){this.cache={}}return r.prototype.get=function(e){var t;return(t=this.cache[e])!==null&&t!==void 0?t:null},r.prototype.set=function(e,t){this.cache[e]=t},r.prototype.remove=function(e){delete this.cache[e]},r})();var Be={Cookie:"cookie",LocalStorage:"localStorage",Memory:"memory"};function Ya(r){return r&&r.stores&&Array.isArray(r.stores)&&r.stores.every(function(e){return Object.values(Be).includes(e)})}function Zw(r){return typeof r=="object"&&r.name!==void 0}var od=function(r,e,t,i){},lr=(function(){function r(e){this.stores=e}return r.prototype.get=function(e){for(var t=null,i=0,n=this.stores;i<n.length;i++){var s=n[i];try{if(t=s.get(e),t!=null)return t}catch(o){od(s,"get",e,o)}}return null},r.prototype.set=function(e,t){this.stores.forEach(function(i){try{i.set(e,t)}catch(n){od(i,"set",e,n)}})},r.prototype.clear=function(e){this.stores.forEach(function(t){try{t.remove(e)}catch(i){od(t,"remove",e,i)}})},r.prototype.getAndSync=function(e){var t=this.get(e),i=typeof t=="number"?t.toString():t;return this.set(e,i),i},r})();function Ns(r){var e=r.map(function(t){var i,n;switch(Zw(t)?(i=t.name,n=t.settings):i=t,i){case Be.Cookie:return new Ga(n);case Be.LocalStorage:return new Qw;case Be.Memory:return new bn;default:throw new Error("Unknown Store Type: ".concat(t))}});return e}function Ja(r,e){return r.map(function(t){return e&&t===Be.Cookie?{name:t,settings:e}:t})}var Di={persist:!0,cookie:{key:"ajs_user_id",oldKey:"ajs_user"},localStorage:{key:"ajs_user_traits"}},ad=(function(){function r(e,t){e===void 0&&(e=Di);var i=this,n,s,o,a;this.options={},this.id=function(u){if(i.options.disable)return null;var l=i.identityStore.getAndSync(i.idKey);if(u!==void 0){i.identityStore.set(i.idKey,u);var h=u!==l&&l!==null&&u!==null;h&&i.anonymousId(null)}var d=i.identityStore.getAndSync(i.idKey);if(d)return d;var p=i.legacyUserStore.get(Di.cookie.oldKey);return p?typeof p=="object"?p.id:p:null},this.anonymousId=function(u){var l,h;if(i.options.disable)return null;if(u===void 0){var d=(l=i.identityStore.getAndSync(i.anonKey))!==null&&l!==void 0?l:(h=i.legacySIO())===null||h===void 0?void 0:h[0];if(d)return d}return u===null?(i.identityStore.set(i.anonKey,null),i.identityStore.getAndSync(i.anonKey)):(i.identityStore.set(i.anonKey,u??Vs()),i.identityStore.getAndSync(i.anonKey))},this.traits=function(u){var l;if(!i.options.disable)return u===null&&(u={}),u&&i.traitsStore.set(i.traitsKey,u??{}),(l=i.traitsStore.get(i.traitsKey))!==null&&l!==void 0?l:{}},this.options=q(q({},Di),e),this.cookieOptions=t,this.idKey=(s=(n=e.cookie)===null||n===void 0?void 0:n.key)!==null&&s!==void 0?s:Di.cookie.key,this.traitsKey=(a=(o=e.localStorage)===null||o===void 0?void 0:o.key)!==null&&a!==void 0?a:Di.localStorage.key,this.anonKey="ajs_anonymous_id",this.identityStore=this.createStorage(this.options,t),this.legacyUserStore=this.createStorage(this.options,t,function(u){return u===Be.Cookie}),this.traitsStore=this.createStorage(this.options,t,function(u){return u!==Be.Cookie});var c=this.legacyUserStore.get(Di.cookie.oldKey);c&&typeof c=="object"&&(c.id&&this.id(c.id),c.traits&&this.traits(c.traits)),vn(this)}return r.prototype.legacySIO=function(){var e=this.legacyUserStore.get("_sio");if(!e)return null;var t=e.split("----"),i=t[0],n=t[1];return[i,n]},r.prototype.identify=function(e,t){if(!this.options.disable){t=t??{};var i=this.id();(i===null||i===e)&&(t=q(q({},this.traits()),t)),e&&this.id(e),this.traits(t)}},r.prototype.logout=function(){this.anonymousId(null),this.id(null),this.traits({})},r.prototype.reset=function(){this.logout(),this.identityStore.clear(this.idKey),this.identityStore.clear(this.anonKey),this.traitsStore.clear(this.traitsKey)},r.prototype.load=function(){return new r(this.options,this.cookieOptions)},r.prototype.save=function(){return!0},r.prototype.createStorage=function(e,t,i){var n=[Be.LocalStorage,Be.Cookie,Be.Memory];return e.disable?new lr([]):e.persist?(e.storage!==void 0&&e.storage!==null&&Ya(e.storage)&&(n=e.storage.stores),e.localStorageFallbackDisabled&&(n=n.filter(function(s){return s!==Be.LocalStorage})),i&&(n=n.filter(i)),new lr(Ns(Ja(n,t)))):new lr([new bn])},r.defaults=Di,r})();var ev={persist:!0,cookie:{key:"ajs_group_id"},localStorage:{key:"ajs_group_properties"}},tv=(function(r){Le(e,r);function e(t,i){t===void 0&&(t=ev);var n=r.call(this,q(q({},ev),t),i)||this;return n.anonymousId=function(s){},vn(n),n}return e})(ad);var rv=function(r){return typeof r=="object"&&r!==null&&"then"in r&&typeof r.then=="function"};var iv=function(r,e,t){t.getAndRemove(r).forEach(function(i){Xa(e,i).catch(console.error)})},nv=function(r,e){return $(void 0,void 0,void 0,function(){var t,i,n;return K(this,function(s){switch(s.label){case 0:t=0,i=e.getAndRemove("addSourceMiddleware"),s.label=1;case 1:return t<i.length?(n=i[t],[4,Xa(r,n).catch(console.error)]):[3,4];case 2:s.sent(),s.label=3;case 3:return t++,[3,1];case 4:return[2]}})})},sv=function(r,e){return $(void 0,void 0,void 0,function(){var t,i,n;return K(this,function(s){switch(s.label){case 0:t=0,i=e.getAndRemove("register"),s.label=1;case 1:return t<i.length?(n=i[t],[4,Xa(r,n).catch(console.error)]):[3,4];case 2:s.sent(),s.label=3;case 3:return t++,[3,1];case 4:return[2]}})})},ov=iv.bind(void 0,"on"),av=iv.bind(void 0,"setAnonymousId"),cv=function(r,e){Object.keys(e.calls).forEach(function(t){e.getAndRemove(t).forEach(function(i){setTimeout(function(){Xa(r,i).catch(console.error)},0)})})},Ti=function(r){if(uv(r)){var e=r.pop();return $a(e)}},uv=function(r){var e=r[r.length-1];return id(e)},Ps=(function(){function r(e,t,i,n){i===void 0&&(i=function(){}),n===void 0&&(n=console.error),this.method=e,this.resolve=i,this.reject=n,this.called=!1,this.args=t}return r})();var mO=(function(){function r(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._callMap={},this.add.apply(this,e)}return Object.defineProperty(r.prototype,"calls",{get:function(){return this._pushSnippetWindowBuffer(),this._callMap},set:function(e){this._callMap=e},enumerable:!1,configurable:!0}),r.prototype.get=function(e){var t;return(t=this.calls[e])!==null&&t!==void 0?t:[]},r.prototype.getAndRemove=function(e){var t=this.get(e);return this.calls[e]=[],t},r.prototype.add=function(){for(var e=this,t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];t.forEach(function(n){var s=["track","screen","alias","group","page","identify"];s.includes(n.method)&&!uv(n.args)&&(n.args=Ne(Ne([],n.args,!0),[Ka()],!1)),e.calls[n.method]?e.calls[n.method].push(n):e.calls[n.method]=[n]})},r.prototype.clear=function(){this._pushSnippetWindowBuffer(),this.calls={}},r.prototype.toArray=function(){var e;return(e=[]).concat.apply(e,Object.values(this.calls))},r.prototype._pushSnippetWindowBuffer=function(){if(Hs()!=="npm"){var e=kd();if(Array.isArray(e)){var t=e.splice(0,e.length),i=t.map(function(n){var s=n[0],o=n.slice(1);return new Ps(s,o)});this.add.apply(this,i)}}},r})();function Xa(r,e){return $(this,void 0,void 0,function(){var t,i;return K(this,function(n){switch(n.label){case 0:return n.trys.push([0,3,,4]),e.called?[2,void 0]:(e.called=!0,t=r[e.method].apply(r,e.args),rv(t)?[4,t]:[3,2]);case 1:n.sent(),n.label=2;case 2:return e.resolve(t),[3,4];case 3:return i=n.sent(),e.reject(i),[3,4];case 4:return[2]}})})}var lv=(function(){function r(e){var t=this;this.trackSubmit=this._createMethod("trackSubmit"),this.trackClick=this._createMethod("trackClick"),this.trackLink=this._createMethod("trackLink"),this.pageView=this._createMethod("pageview"),this.identify=this._createMethod("identify"),this.reset=this._createMethod("reset"),this.group=this._createMethod("group"),this.track=this._createMethod("track"),this.ready=this._createMethod("ready"),this.alias=this._createMethod("alias"),this.debug=this._createChainableMethod("debug"),this.page=this._createMethod("page"),this.once=this._createChainableMethod("once"),this.off=this._createChainableMethod("off"),this.on=this._createChainableMethod("on"),this.addSourceMiddleware=this._createMethod("addSourceMiddleware"),this.setAnonymousId=this._createMethod("setAnonymousId"),this.addDestinationMiddleware=this._createMethod("addDestinationMiddleware"),this.screen=this._createMethod("screen"),this.register=this._createMethod("register"),this.deregister=this._createMethod("deregister"),this.user=this._createMethod("user"),this.VERSION=Fi,this._preInitBuffer=new mO,this._promise=e(this._preInitBuffer),this._promise.then(function(i){var n=i[0],s=i[1];t.instance=n,t.ctx=s}).catch(function(){})}return r.prototype.then=function(){for(var e,t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return(e=this._promise).then.apply(e,t)},r.prototype.catch=function(){for(var e,t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return(e=this._promise).catch.apply(e,t)},r.prototype.finally=function(){for(var e,t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return(e=this._promise).finally.apply(e,t)},r.prototype._createMethod=function(e){var t=this;return function(){for(var i,n=[],s=0;s<arguments.length;s++)n[s]=arguments[s];if(t.instance){var o=(i=t.instance)[e].apply(i,n);return Promise.resolve(o)}return new Promise(function(a,c){t._preInitBuffer.add(new Ps(e,n,a,c))})}},r.prototype._createChainableMethod=function(e){var t=this;return function(){for(var i,n=[],s=0;s<arguments.length;s++)n[s]=arguments[s];return t.instance?((i=t.instance)[e].apply(i,n),t):(t._preInitBuffer.add(new Ps(e,n)),t)}},r})();var hv=function(r){var e=!1;window.addEventListener("pagehide",function(){e||(e=!0,r(e))}),document.addEventListener("visibilitychange",function(){if(document.visibilityState=="hidden"){if(e)return;e=!0}else e=!1;r(e)})};var Qa=(function(r){Le(e,r);function e(t,i){var n=r.call(this,t)||this;return n.retryTimeout=i,n.name="RateLimitError",n}return e})(Error);var Za=function(r){return q({"Content-Type":"text/plain"},typeof r=="function"?r():r)};var yO=500,wO=64;function cd(r){var e=encodeURI(JSON.stringify(r)).split(/%..|./).length-1;return e/1024}function vO(r){return cd(r)>=yO-50}function bO(r){return cd(r)>=wO-10}function EO(r){var e=[],t=0;return r.forEach(function(i){var n=cd(e[t]);n>=64&&t++,e[t]?e[t].push(i):e[t]=[i]}),e}function ud(r,e){var t,i,n=[],s=!1,o=(t=e?.size)!==null&&t!==void 0?t:10,a=(i=e?.timeout)!==null&&i!==void 0?i:5e3,c=0;function u(f){var g;if(f.length!==0){var m=(g=f[0])===null||g===void 0?void 0:g.writeKey,w=f.map(function(v){var y=v,S=y.sentAt,E=Ls(y,["sentAt"]);return E});return Pi("https://".concat(r,"/b"),{credentials:e?.credentials,keepalive:e?.keepalive||s,headers:Za(e?.headers),method:"post",body:JSON.stringify({writeKey:m,batch:w,sentAt:new Date().toISOString()}),priority:e?.priority}).then(function(v){var y;if(v.status>=500)throw new Error("Bad response from server: ".concat(v.status));if(v.status===429){var S=(y=v.headers)===null||y===void 0?void 0:y.get("x-ratelimit-reset"),E=typeof S=="string"?parseInt(S)*1e3:a;throw new Qa("Rate limit exceeded: ".concat(v.status),E)}})}}function l(f){var g;return f===void 0&&(f=1),$(this,void 0,void 0,function(){var m;return K(this,function(w){return n.length?(m=n,n=[],[2,(g=u(m))===null||g===void 0?void 0:g.catch(function(v){var y,S=St.system();S.log("error","Error sending batch",v),f<=((y=e?.maxRetries)!==null&&y!==void 0?y:10)&&(v.name==="RateLimitError"&&(c=v.retryTimeout),n.push.apply(n,m),n.map(function(E){if("_metadata"in E){var C=E;C._metadata=q(q({},C._metadata),{retryCount:f})}}),d(f+1))})]):[2]})})}var h;function d(f){f===void 0&&(f=1),!h&&(h=setTimeout(function(){h=void 0,l(f).catch(console.error)},c||a),c=0)}hv(function(f){if(s=f,s&&n.length){var g=EO(n).map(u);Promise.all(g).catch(console.error)}});function p(f,g){return $(this,void 0,void 0,function(){var m;return K(this,function(w){return n.push(g),m=n.length>=o||vO(n)||e?.keepalive&&bO(n),[2,m||s?l():d()]})})}return{dispatch:p}}function dv(r){function e(t,i){return Pi(t,{credentials:r?.credentials,keepalive:r?.keepalive,headers:Za(r?.headers),method:"post",body:JSON.stringify(i),priority:r?.priority}).then(function(n){var s;if(n.status>=500)throw new Error("Bad response from server: ".concat(n.status));if(n.status===429){var o=(s=n.headers)===null||s===void 0?void 0:s.get("x-ratelimit-reset"),a=o?parseInt(o)*1e3:5e3;throw new Qa("Rate limit exceeded: ".concat(n.status),a)}})}return{dispatch:e}}function fv(r,e,t,i,n){var s,o=r.user();delete e.options,e.writeKey=t?.apiKey,e.userId=e.userId||o.id(),e.anonymousId=e.anonymousId||o.anonymousId(),e.sentAt=new Date;var a=r.queue.failedInitializations||[];a.length>0&&(e._metadata={failedInitializations:a}),n!=null&&(n.attempts>1&&(e._metadata=q(q({},e._metadata),{retryCount:n.attempts})),n.attempts++);var c=[],u=[];for(var l in i){var h=i[l];l==="Segment.io"&&c.push(l),h.bundlingStatus==="bundled"&&c.push(l),h.bundlingStatus==="unbundled"&&u.push(l)}for(var d=0,p=t?.unbundledIntegrations||[];d<p.length;d++){var f=p[d];u.includes(f)||u.push(f)}var g=(s=t?.maybeBundledConfigIds)!==null&&s!==void 0?s:{},m=[];return c.sort().forEach(function(w){var v;((v=g[w])!==null&&v!==void 0?v:[]).forEach(function(y){m.push(y)})}),t?.addBundledMetadata!==!1&&(e._metadata=q(q({},e._metadata),{bundled:c.sort(),unbundled:u.sort(),bundledIds:m})),e}function xO(r,e){return $(this,void 0,void 0,function(){var t,i=this;return K(this,function(n){switch(n.label){case 0:return t=[],dr()?[2,e]:[4,zd(function(){return e.length>0&&!dr()},function(){return $(i,void 0,void 0,function(){var s,o,a;return K(this,function(c){switch(c.label){case 0:return s=e.pop(),s?[4,Ni(s,r)]:[2];case 1:return o=c.sent(),a=o instanceof St,a||t.push(s),[2]}})})})];case 1:return n.sent(),t.map(function(s){return e.pushWithBackoff(s)}),[2,e]}})})}function Ci(r,e,t,i){var n=this;r||setTimeout(function(){return $(n,void 0,void 0,function(){var s,o;return K(this,function(a){switch(a.label){case 0:return s=!0,[4,xO(t,e)];case 1:return o=a.sent(),s=!1,e.todo>0&&i(s,o,t,i),[2]}})})},Math.random()*5e3)}function _O(r,e){var t,i,n,s,o=r.user();return e.previousId=(n=(i=(t=e.previousId)!==null&&t!==void 0?t:e.from)!==null&&i!==void 0?i:o.id())!==null&&n!==void 0?n:o.anonymousId(),e.userId=(s=e.userId)!==null&&s!==void 0?s:e.to,delete e.from,delete e.to,e}var pv=function(r){return r.name==="Segment.io"};function gv(r,e,t){var i,n,s;window.addEventListener("pagehide",function(){a.push.apply(a,Array.from(c)),c.clear()});var o=(i=e?.apiKey)!==null&&i!==void 0?i:"",a=r.options.disableClientPersistence?new js(r.queue.queue.maxAttempts,[]):new Bi(r.queue.queue.maxAttempts,"".concat(o,":dest-Segment.io")),c=new Set,u=!1,l=(n=e?.apiHost)!==null&&n!==void 0?n:Bd,h=(s=e?.protocol)!==null&&s!==void 0?s:"https",d="".concat(h,"://").concat(l),p=e?.deliveryStrategy,f=p&&"strategy"in p&&p.strategy==="batching"?ud(l,p.config):dv(p?.config);function g(w){return $(this,void 0,void 0,function(){var v,y;return K(this,function(S){return dr()?(a.push(w),Ci(u,a,m,Ci),[2,w]):(c.add(w),v=w.event.type.charAt(0),y=qd(w.event).json(),w.event.type==="track"&&delete y.traits,w.event.type==="alias"&&(y=_O(r,y)),a.getAttempts(w)>=a.maxAttempts?(c.delete(w),[2,w]):[2,f.dispatch("".concat(d,"/").concat(v),fv(r,y,e,t,w)).then(function(){return w}).catch(function(E){if(w.log("error","Error sending event",E),E.name==="RateLimitError"){var C=E.retryTimeout;a.pushWithBackoff(w,C)}else a.pushWithBackoff(w);return Ci(u,a,m,Ci),w}).finally(function(){c.delete(w)})])})})}var m={metadata:{writeKey:o,apiHost:l,protocol:h},name:"Segment.io",type:"destination",version:"0.1.0",isLoaded:function(){return!0},load:function(){return Promise.resolve()},track:g,identify:g,page:g,alias:g,group:g,screen:g};return a.todo&&Ci(u,a,m,Ci),m}var ld=Ks(),hd=ld?.analytics;function SO(r,e,t){e===void 0&&(e=!1),t===void 0&&(t=!1);var i=e?10:1,n=t?new js(i,[]):new Bi(i,r);return new Xw(n)}var IO=(function(){function r(e,t){var i;this.timeout=300,this._getSegmentPluginMetadata=function(){var s;return(s=t.plugins.find(pv))===null||s===void 0?void 0:s.metadata},this.writeKey=e.writeKey;var n={integrations:{"Segment.io":{apiKey:""}}};this.cdnSettings=(i=e.cdnSettings)!==null&&i!==void 0?i:n,this.cdnURL=e.cdnURL}return Object.defineProperty(r.prototype,"apiHost",{get:function(){var e,t;return(t=(e=this._getSegmentPluginMetadata)===null||e===void 0?void 0:e.call(this))===null||t===void 0?void 0:t.apiHost},enumerable:!1,configurable:!0}),r})();function hr(){}var dd=(function(r){Le(e,r);function e(t,i,n,s,o){var a=this,c,u;a=r.call(this)||this,a._debug=!1,a.initialized=!1,a.user=function(){return a._user},a.init=a.initialize.bind(a),a.log=hr,a.addIntegrationMiddleware=hr,a.listeners=hr,a.addEventListener=hr,a.removeAllListeners=hr,a.removeListener=hr,a.removeEventListener=hr,a.hasListeners=hr,a.add=hr,a.addIntegration=hr;var l=i?.cookie,h=(c=i?.disableClientPersistence)!==null&&c!==void 0?c:!1;a.queue=n??SO("".concat(t.writeKey,":event-queue"),i?.retryQueue,h),a.settings=new IO(t,a.queue);var d=i?.storage;return a._universalStorage=a.createStore(h,d,l),a._user=s??new ad(q({persist:!h,storage:i?.storage},i?.user),l).load(),a._group=o??new tv(q({persist:!h,storage:i?.storage},i?.group),l).load(),a.eventFactory=new Yw(a._user),a.integrations=(u=i?.integrations)!==null&&u!==void 0?u:{},a.options=i??{},vn(a),a}return e.prototype.createStore=function(t,i,n){return t?new lr([new bn]):i&&Ya(i)?new lr(Ns(Ja(i.stores,n))):new lr(Ns([Be.LocalStorage,{name:Be.Cookie,settings:n},Be.Memory]))},Object.defineProperty(e.prototype,"storage",{get:function(){return this._universalStorage},enumerable:!1,configurable:!0}),e.prototype.track=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return $(this,void 0,void 0,function(){var n,s,o,a,c,u,l,h=this;return K(this,function(d){return n=Ti(t),s=Hw.apply(void 0,t),o=s[0],a=s[1],c=s[2],u=s[3],l=this.eventFactory.track(o,a,c,this.integrations,n),[2,this._dispatch(l,u).then(function(p){return h.emit("track",o,p.event.properties,p.event.options),p})]})})},e.prototype.page=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return $(this,void 0,void 0,function(){var n,s,o,a,c,u,l,h,d=this;return K(this,function(p){return n=Ti(t),s=Zh.apply(void 0,t),o=s[0],a=s[1],c=s[2],u=s[3],l=s[4],h=this.eventFactory.page(o,a,c,u,this.integrations,n),[2,this._dispatch(h,l).then(function(f){return d.emit("page",o,a,f.event.properties,f.event.options),f})]})})},e.prototype.identify=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return $(this,void 0,void 0,function(){var n,s,o,a,c,u,l,h=this;return K(this,function(d){return n=Ti(t),s=ed(this._user).apply(void 0,t),o=s[0],a=s[1],c=s[2],u=s[3],this._user.identify(o,a),l=this.eventFactory.identify(this._user.id(),this._user.traits(),c,this.integrations,n),[2,this._dispatch(l,u).then(function(p){return h.emit("identify",p.event.userId,p.event.traits,p.event.options),p})]})})},e.prototype.group=function(){for(var t=this,i=[],n=0;n<arguments.length;n++)i[n]=arguments[n];var s=Ti(i);if(i.length===0)return this._group;var o=ed(this._group).apply(void 0,i),a=o[0],c=o[1],u=o[2],l=o[3];this._group.identify(a,c);var h=this._group.id(),d=this._group.traits(),p=this.eventFactory.group(h,d,u,this.integrations,s);return this._dispatch(p,l).then(function(f){return t.emit("group",f.event.groupId,f.event.traits,f.event.options),f})},e.prototype.alias=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return $(this,void 0,void 0,function(){var n,s,o,a,c,u,l,h=this;return K(this,function(d){return n=Ti(t),s=Ww.apply(void 0,t),o=s[0],a=s[1],c=s[2],u=s[3],l=this.eventFactory.alias(o,a,c,this.integrations,n),[2,this._dispatch(l,u).then(function(p){return h.emit("alias",o,a,p.event.options),p})]})})},e.prototype.screen=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return $(this,void 0,void 0,function(){var n,s,o,a,c,u,l,h,d=this;return K(this,function(p){return n=Ti(t),s=Zh.apply(void 0,t),o=s[0],a=s[1],c=s[2],u=s[3],l=s[4],h=this.eventFactory.screen(o,a,c,u,this.integrations,n),[2,this._dispatch(h,l).then(function(f){return d.emit("screen",o,a,f.event.properties,f.event.options),f})]})})},e.prototype.trackClick=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return $(this,void 0,void 0,function(){var n,s;return K(this,function(o){switch(o.label){case 0:return[4,import("./auto-track-AX4UVKO6.js")];case 1:return n=o.sent(),[2,(s=n.link).call.apply(s,Ne([this],t,!1))]}})})},e.prototype.trackLink=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return $(this,void 0,void 0,function(){var n,s;return K(this,function(o){switch(o.label){case 0:return[4,import("./auto-track-AX4UVKO6.js")];case 1:return n=o.sent(),[2,(s=n.link).call.apply(s,Ne([this],t,!1))]}})})},e.prototype.trackSubmit=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return $(this,void 0,void 0,function(){var n,s;return K(this,function(o){switch(o.label){case 0:return[4,import("./auto-track-AX4UVKO6.js")];case 1:return n=o.sent(),[2,(s=n.form).call.apply(s,Ne([this],t,!1))]}})})},e.prototype.trackForm=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return $(this,void 0,void 0,function(){var n,s;return K(this,function(o){switch(o.label){case 0:return[4,import("./auto-track-AX4UVKO6.js")];case 1:return n=o.sent(),[2,(s=n.form).call.apply(s,Ne([this],t,!1))]}})})},e.prototype.register=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return $(this,void 0,void 0,function(){var n,s,o=this;return K(this,function(a){switch(a.label){case 0:return n=St.system(),s=t.map(function(c){return o.queue.register(n,c,o)}),[4,Promise.all(s)];case 1:return a.sent(),[2,n]}})})},e.prototype.deregister=function(){for(var t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];return $(this,void 0,void 0,function(){var n,s,o=this;return K(this,function(a){switch(a.label){case 0:return n=St.system(),s=t.map(function(c){var u=o.queue.plugins.find(function(l){return l.name===c});if(u)return o.queue.deregister(n,u,o);n.log("warn","plugin ".concat(c," not found"))}),[4,Promise.all(s)];case 1:return a.sent(),[2,n]}})})},e.prototype.debug=function(t){return t===!1&&localStorage.getItem("debug")&&localStorage.removeItem("debug"),this._debug=t,this},e.prototype.reset=function(){this._user.reset(),this._group.reset(),this.emit("reset")},e.prototype.timeout=function(t){this.settings.timeout=t},e.prototype._dispatch=function(t,i){return $(this,void 0,void 0,function(){var n;return K(this,function(s){return n=new St(t),n.stats.increment("analytics_js.invoke",1,[t.type]),dr()&&!this.options.retryQueue?[2,n]:[2,Kw(n,this.queue,this,{callback:i,debug:this._debug,timeout:this.settings.timeout})]})})},e.prototype.addSourceMiddleware=function(t){return $(this,void 0,void 0,function(){var i=this;return K(this,function(n){switch(n.label){case 0:return[4,this.queue.criticalTasks.run(function(){return $(i,void 0,void 0,function(){var s,o,a;return K(this,function(c){switch(c.label){case 0:return[4,import("./middleware-2XY3FKDX.js")];case 1:return s=c.sent().sourceMiddlewarePlugin,o={},this.queue.plugins.forEach(function(u){if(u.type==="destination")return o[u.name]=!0}),a=s(t,o),[4,this.register(a)];case 2:return c.sent(),[2]}})})})];case 1:return n.sent(),[2,this]}})})},e.prototype.addDestinationMiddleware=function(t){for(var i=[],n=1;n<arguments.length;n++)i[n-1]=arguments[n];return this.queue.plugins.filter(Jw).forEach(function(s){(t==="*"||s.name.toLowerCase()===t.toLowerCase())&&s.addMiddleware.apply(s,i)}),Promise.resolve(this)},e.prototype.setAnonymousId=function(t){return this._user.anonymousId(t)},e.prototype.queryString=function(t){return $(this,void 0,void 0,function(){var i;return K(this,function(n){switch(n.label){case 0:return this.options.useQueryString===!1?[2,[]]:[4,import("./query-string-GXZDO3NF.js")];case 1:return i=n.sent().queryString,[2,i(this,t)]}})})},e.prototype.use=function(t){return t(this),this},e.prototype.ready=function(t){return t===void 0&&(t=function(i){return i}),$(this,void 0,void 0,function(){return K(this,function(i){return[2,Promise.all(this.queue.plugins.map(function(n){return n.ready?n.ready():Promise.resolve()})).then(function(n){return t(n),n})]})})},e.prototype.noConflict=function(){return Md(hd??this),this},e.prototype.normalize=function(t){return this.eventFactory.normalize(t)},Object.defineProperty(e.prototype,"failedInitializations",{get:function(){return this.queue.failedInitializations},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"VERSION",{get:function(){return Fi},enumerable:!1,configurable:!0}),e.prototype.initialize=function(t,i){return $(this,void 0,void 0,function(){return K(this,function(n){return[2,Promise.resolve(this)]})})},e.prototype.pageview=function(t){return $(this,void 0,void 0,function(){return K(this,function(i){switch(i.label){case 0:return[4,this.page({path:t})];case 1:return i.sent(),[2,this]}})})},Object.defineProperty(e.prototype,"plugins",{get:function(){var t;return(t=this._plugins)!==null&&t!==void 0?t:{}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"Integrations",{get:function(){var t=this.queue.plugins.filter(function(i){return i.type==="destination"}).reduce(function(i,n){var s="".concat(n.name.toLowerCase().replace(".","").split(" ").join("-"),"Integration"),o=window[s];if(!o)return i;var a=o.Integration;return a?(i[n.name]=a,i):(i[n.name]=o,i)},{});return t},enumerable:!1,configurable:!0}),e.prototype.push=function(t){var i=this,n=t.shift();n&&!i[n]||i[n].apply(this,t)},e})(zs);var fd=(function(r){Le(e,r);function e(){var t=r.call(this,{writeKey:""},{disableClientPersistence:!0})||this;return t.initialized=!0,t}return e})(dd);function pd(){return typeof process>"u"||!process.env?{}:process.env}function mv(r){return $(this,void 0,void 0,function(){var e;return K(this,function(t){return e=navigator.userAgentData,e?r?[2,e.getHighEntropyValues(r).catch(function(){return e.toJSON()})]:[2,e.toJSON()]:[2,void 0]})})}var Fs;function AO(){if(Fs)return Fs;var r=Wa(window.location.href);return Fs={expires:31536e6,secure:!1,path:"/"},r&&(Fs.domain=r),Fs}function DO(r){var e={btid:"dataxu",urid:"millennial-media"};r.startsWith("?")&&(r=r.substring(1)),r=r.replace(/\?/g,"&");for(var t=r.split("&"),i=0,n=t;i<n.length;i++){var s=n[i],o=s.split("="),a=o[0],c=o[1];if(e[a])return{id:c,type:e[a]}}}function TO(r){return r.startsWith("?")&&(r=r.substring(1)),r=r.replace(/\?/g,"&"),r.split("&").reduce(function(e,t){var i=t.split("="),n=i[0],s=i[1],o=s===void 0?"":s;if(n.includes("utm_")&&n.length>4){var a=n.slice(4);a==="campaign"&&(a="name"),e[a]=Vd(o)}return e},{})}function CO(){var r=Mt.get("_ga");if(r&&r.startsWith("amp"))return r}function OO(r,e,t){var i,n=new lr(t?[]:[new Ga(AO())]),s=n.get("s:context.referrer"),o=(i=DO(r))!==null&&i!==void 0?i:s;o&&(e&&(e.referrer=q(q({},e.referrer),o)),n.set("s:context.referrer",o))}var RO=function(r){try{var e=new URLSearchParams;return Object.entries(r).forEach(function(t){var i=t[0],n=t[1];Array.isArray(n)?n.forEach(function(s){return e.append(i,s)}):e.append(i,n)}),e.toString()}catch{return""}},NO=(function(){function r(){var e=this;this.name="Page Enrichment",this.type="before",this.version="0.1.0",this.isLoaded=function(){return!0},this.load=function(t,i){return $(e,void 0,void 0,function(){var n,s;return K(this,function(o){switch(o.label){case 0:this.instance=i,o.label=1;case 1:return o.trys.push([1,3,,4]),n=this,[4,mv(this.instance.options.highEntropyValuesClientHints)];case 2:return n.userAgentData=o.sent(),[3,4];case 3:return s=o.sent(),[3,4];case 4:return[2,Promise.resolve()]}})})},this.enrich=function(t){var i,n,s=t.event.context,o=s.page.search||"",a=typeof o=="object"?RO(o):o;s.userAgent=navigator.userAgent,s.userAgentData=e.userAgentData;var c=navigator.userLanguage||navigator.language;typeof s.locale>"u"&&typeof c<"u"&&(s.locale=c),(i=s.library)!==null&&i!==void 0||(s.library={name:"analytics.js",version:"".concat(Hs()==="web"?"next":"npm:next","-").concat(Fi)}),a&&!s.campaign&&(s.campaign=TO(a));var u=CO();u&&(s.amp={id:u}),OO(a,s,(n=e.instance.options.disableClientPersistence)!==null&&n!==void 0?n:!1);try{s.timezone=Intl.DateTimeFormat().resolvedOptions().timeZone}catch{}return t},this.track=this.enrich,this.identify=this.enrich,this.page=this.enrich,this.group=this.enrich,this.alias=this.enrich,this.screen=this.enrich}return r})(),yv=new NO;var PO=(function(){function r(e,t){this.version="1.0.0",this.alternativeNames=[],this.loadPromise=qs(),this.middleware=[],this.alias=this._createMethod("alias"),this.group=this._createMethod("group"),this.identify=this._createMethod("identify"),this.page=this._createMethod("page"),this.screen=this._createMethod("screen"),this.track=this._createMethod("track"),this.action=t,this.name=e,this.type=t.type,this.alternativeNames.push(t.name)}return r.prototype.addMiddleware=function(){for(var e,t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];this.type==="destination"&&(e=this.middleware).push.apply(e,t)},r.prototype.transform=function(e){return $(this,void 0,void 0,function(){var t;return K(this,function(i){switch(i.label){case 0:return[4,jd(this.name,e.event,this.middleware)];case 1:return t=i.sent(),t===null&&e.cancel(new $s({retry:!1,reason:"dropped by destination middleware"})),[2,new St(t)]}})})},r.prototype._createMethod=function(e){var t=this;return function(i){return $(t,void 0,void 0,function(){var n,s;return K(this,function(o){switch(o.label){case 0:return this.action[e]?(n=i,this.type!=="destination"?[3,2]:[4,this.transform(i)]):[2,i];case 1:n=o.sent(),o.label=2;case 2:return o.trys.push([2,5,,6]),[4,this.ready()];case 3:if(!o.sent())throw new Error("Something prevented the destination from getting ready");return Sn(i,{integrationName:this.action.name,methodName:e,type:"action"}),[4,this.action[e](n)];case 4:return o.sent(),[3,6];case 5:throw s=o.sent(),Sn(i,{integrationName:this.action.name,methodName:e,type:"action",didError:!0}),s;case 6:return[2,i]}})})}},r.prototype.isLoaded=function(){return this.action.isLoaded()},r.prototype.ready=function(){return $(this,void 0,void 0,function(){var e;return K(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,this.loadPromise.promise];case 1:return t.sent(),[2,!0];case 2:return e=t.sent(),[2,!1];case 3:return[2]}})})},r.prototype.load=function(e,t){return $(this,void 0,void 0,function(){var i,n,s,o;return K(this,function(a){switch(a.label){case 0:if(this.loadPromise.isSettled())return[2,this.loadPromise.promise];a.label=1;case 1:return a.trys.push([1,3,,4]),Sn(e,{integrationName:this.action.name,methodName:"load",type:"action"}),i=this.action.load(e,t),s=(n=this.loadPromise).resolve,[4,i];case 2:return s.apply(n,[a.sent()]),[2,i];case 3:throw o=a.sent(),Sn(e,{integrationName:this.action.name,methodName:"load",type:"action",didError:!0}),this.loadPromise.reject(o),o;case 4:return[2]}})})},r.prototype.unload=function(e,t){var i,n;return(n=(i=this.action).unload)===null||n===void 0?void 0:n.call(i,e,t)},r})();function FO(r){if(!Array.isArray(r))throw new Error("Not a valid list of plugins");var e=["load","isLoaded","name","version","type"];return r.forEach(function(t){e.forEach(function(i){var n;if(t[i]===void 0)throw new Error("Plugin: ".concat((n=t.name)!==null&&n!==void 0?n:"unknown"," missing required function ").concat(i))})}),!0}function BO(r,e){var t=r[e.creationName],i=r[e.name];return r.All===!1&&!t&&!i||t===!1||i===!1}function UO(r,e){return $(this,void 0,void 0,function(){var t,i,n,s,o,a,c;return K(this,function(u){switch(u.label){case 0:if(u.trys.push([0,9,,10]),t=new RegExp("https://cdn.segment.(com|build)"),i=Ws(),!e)return[3,6];n=r.url.split("/"),s=n[n.length-2],o=r.url.replace(s,btoa(s).replace(/=/g,"")),u.label=1;case 1:return u.trys.push([1,3,,5]),[4,Gs(o.replace(t,i))];case 2:return u.sent(),[3,5];case 3:return a=u.sent(),[4,Gs(r.url.replace(t,i))];case 4:return u.sent(),[3,5];case 5:return[3,8];case 6:return[4,Gs(r.url.replace(t,i))];case 7:u.sent(),u.label=8;case 8:return typeof window[r.libraryName]=="function"?[2,window[r.libraryName]]:[3,10];case 9:throw c=u.sent(),c;case 10:return[2]}})})}function wv(r,e,t,i,n,s){var o,a,c;return $(this,void 0,void 0,function(){var u,l,h,d=this;return K(this,function(p){switch(p.label){case 0:return u=[],l=(a=(o=r.middlewareSettings)===null||o===void 0?void 0:o.routingRules)!==null&&a!==void 0?a:[],h=((c=r.remotePlugins)!==null&&c!==void 0?c:[]).map(function(f){return $(d,void 0,void 0,function(){var g,m,w,v,y,S,E;return K(this,function(C){switch(C.label){case 0:if(BO(e,f))return[2];C.label=1;case 1:return C.trys.push([1,6,,7]),m=s?.find(function(R){var P=R.pluginName;return P===f.name}),m?[3,3]:[4,UO(f,i?.obfuscate)];case 2:m=C.sent(),C.label=3;case 3:return g=m,g?(w=t[f.name],[4,g(q(q({},f.settings),w))]):[3,5];case 4:v=C.sent(),y=Array.isArray(v)?v:[v],FO(y),S=l.filter(function(R){return R.destinationName===f.creationName}),y.forEach(function(R){var P=new PO(f.creationName,R);S.length&&n&&P.addMiddleware(n),u.push(P)}),C.label=5;case 5:return[3,7];case 6:return E=C.sent(),[3,7];case 7:return[2]}})})}),[4,Promise.all(h)];case 1:return p.sent(),[2,u.filter(Boolean)]}})})}var gd,vv,kO=Ks(),bv=(gd=(vv=kO).__SEGMENT_INSPECTOR__)!==null&&gd!==void 0?gd:vv.__SEGMENT_INSPECTOR__={},Ev=function(r){var e;return(e=bv.attach)===null||e===void 0?void 0:e.call(bv,r)};function LO(r,e){return Pi("".concat(e,"/v1/projects/").concat(r,"/settings")).then(function(t){return t.ok?t.json():t.text().then(function(i){throw new Error(i)})}).catch(function(t){throw t})}function MO(r){return pd().NODE_ENV!=="test"&&Object.keys(r.integrations).length>1}function qO(r){var e,t,i;return pd().NODE_ENV!=="test"&&((i=(t=(e=r.middlewareSettings)===null||e===void 0?void 0:e.routingRules)===null||t===void 0?void 0:t.length)!==null&&i!==void 0?i:0)>0}function zO(r,e){av(r,e),ov(r,e)}function jO(r,e,t){return $(this,void 0,void 0,function(){return K(this,function(i){switch(i.label){case 0:return[4,$O(r,e)];case 1:return i.sent(),cv(r,t),[2]}})})}var VO=function(){var r,e,t=(r=window.location.hash)!==null&&r!==void 0?r:"",i=(e=window.location.search)!==null&&e!==void 0?e:"",n=i.length?i:t.replace(/(?=#).*(?=\?)/,"");return n},$O=function(r,e){return $(void 0,void 0,void 0,function(){return K(this,function(t){switch(t.label){case 0:return e.includes("ajs_")?[4,r.queryString(e).catch(console.error)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})};function KO(r,e,t,i,n,s,o){var a,c,u;return n===void 0&&(n=[]),$(this,void 0,void 0,function(){var l,h,d,p,f,g,m,w,v,y,S,E,C,R,P,b=this;return K(this,function(A){switch(A.label){case 0:return zO(t,o),l=n?.filter(function(_){return typeof _=="object"}),h=n?.filter(function(_){return typeof _=="function"&&typeof _.pluginName=="string"}),qO(e)?[4,import("./routing-middleware-VCQLGMEI.js").then(function(_){return _.tsubMiddleware(e.middlewareSettings.routingRules)})]:[3,2];case 1:return p=A.sent(),[3,3];case 2:p=void 0,A.label=3;case 3:return d=p,MO(e)||s.length>0?[4,import("./ajs-destination-K6JUGV3Q.js").then(function(_){return _.ajsDestinations(r,e,t.integrations,i,d,s)})]:[3,5];case 4:return g=A.sent(),[3,6];case 5:g=[],A.label=6;case 6:return f=g,e.legacyVideoPluginsEnabled?[4,import("./legacy-video-plugins-GVVLIGAF.js").then(function(_){return _.loadLegacyVideoPlugins(t)})]:[3,8];case 7:A.sent(),A.label=8;case 8:return!((a=i.plan)===null||a===void 0)&&a.track?[4,import("./schema-filter-HT7IN5DS.js").then(function(_){var D;return _.schemaFilter((D=i.plan)===null||D===void 0?void 0:D.track,e)})]:[3,10];case 9:return w=A.sent(),[3,11];case 10:w=void 0,A.label=11;case 11:return m=w,v=Kd(e,i),[4,wv(e,t.integrations,v,i,d,h).catch(function(){return[]})];case 12:return y=A.sent(),S=Ne(Ne([yv],f,!0),y,!0),m&&S.push(m),E=((c=i.integrations)===null||c===void 0?void 0:c.All)===!1&&!i.integrations["Segment.io"]||i.integrations&&i.integrations["Segment.io"]===!1,E?[3,14]:(R=(C=S).push,[4,gv(t,v["Segment.io"],e.integrations)]);case 13:R.apply(C,[A.sent()]),A.label=14;case 14:return[4,t.register.apply(t,Ne(Ne([],S,!1),l,!1))];case 15:return P=A.sent(),[4,sv(t,o)];case 16:return A.sent(),Object.entries((u=e.enabledMiddleware)!==null&&u!==void 0?u:{}).some(function(_){var D=_[1];return D})?[4,import("./remote-middleware-LW5UF5QX.js").then(function(_){var D=_.remoteMiddlewares;return $(b,void 0,void 0,function(){var F,k;return K(this,function(I){switch(I.label){case 0:return[4,D(P,e,i.obfuscate)];case 1:return F=I.sent(),k=F.map(function(x){return t.addSourceMiddleware(x)}),[2,Promise.all(k)]}})})})]:[3,18];case 17:A.sent(),A.label=18;case 18:return[4,nv(t,o)];case 19:return A.sent(),[2,P]}})})}function HO(r,e,t){var i,n,s,o,a,c,u,l,h;return e===void 0&&(e={}),$(this,void 0,void 0,function(){var d,p,f,g,m,w,v,y,S,E,C;return K(this,function(R){switch(R.label){case 0:return e.disable===!0?[2,[new fd,St.system()]]:(e.globalAnalyticsKey&&Ld(e.globalAnalyticsKey),r.cdnURL&&$d(r.cdnURL),e.initialPageview&&t.add(new Ps("page",[])),d=VO(),p=(i=r.cdnURL)!==null&&i!==void 0?i:Ws(),(n=r.cdnSettings)!==null&&n!==void 0?(g=n,[3,3]):[3,1]);case 1:return[4,LO(r.writeKey,p)];case 2:g=R.sent(),R.label=3;case 3:return f=g,e.updateCDNSettings&&(f=e.updateCDNSettings(f)),typeof e.disable!="function"?[3,5]:[4,e.disable(f)];case 4:if(m=R.sent(),m)return[2,[new fd,St.system()]];R.label=5;case 5:return w=(o=(s=f.integrations["Segment.io"])===null||s===void 0?void 0:s.retryQueue)!==null&&o!==void 0?o:!0,e=q({retryQueue:w},e),v=new dd(q(q({},r),{cdnSettings:f,cdnURL:p}),e),Ev(v),y=(a=r.plugins)!==null&&a!==void 0?a:[],S=(c=r.classicIntegrations)!==null&&c!==void 0?c:[],E=(u=e.integrations)===null||u===void 0?void 0:u["Segment.io"],Ud.initRemoteMetrics(q(q({},f.metrics),{host:(l=E?.apiHost)!==null&&l!==void 0?l:(h=f.metrics)===null||h===void 0?void 0:h.host,protocol:E?.protocol})),[4,KO(r.writeKey,f,v,e,y,S,t)];case 6:return C=R.sent(),v.initialized=!0,v.emit("initialize",r,e),[4,jO(v,d,t)];case 7:return R.sent(),[2,[v,C]]}})})}var md=(function(r){Le(e,r);function e(){var t=this,i=qs(),n=i.promise,s=i.resolve;return t=r.call(this,function(o){return n.then(function(a){var c=a[0],u=a[1];return HO(c,u,o)})})||this,t._resolveLoadStart=function(o,a){return s([o,a])},t}return e.prototype.load=function(t,i){return i===void 0&&(i={}),this._resolveLoadStart(t,i),this},e.load=function(t,i){return i===void 0&&(i={}),new e().load(t,i)},e.standalone=function(t,i){return e.load({writeKey:t},i).then(function(n){return n[0]})},e})(lv);var WO="f6LbNqCeVRf512ggdME4b6CyflhF1tsX",xv=class{constructor(){De(this,"segment",void 0),De(this,"globalProperties",{}),De(this,"enabled",!0)}init(){if(!this.isSkipped()){if(this.segment)throw new Error("Analytics already initialized");this.segment=new md,this.segment.load({writeKey:WO},{user:{cookie:{key:"web3auth_ajs_user_id"},localStorage:{key:"web3auth_ajs_user_traits"}},globalAnalyticsKey:"web3auth_analytics"}).then(()=>(Ie.debug("Analytics initialized"),!0)).catch(e=>{Ie.error("Failed to initialize Analytics",e)})}}enable(){this.enabled=!0}disable(){this.enabled=!1}setGlobalProperties(e){this.globalProperties=Z(Z({},this.globalProperties),e)}async identify(e,t){if(this.enabled&&!this.isSkipped())try{return this.getSegment().identify(e,Z({},t))}catch(i){Ie.error(`Failed to identify user ${e} in analytics`,i)}}async track(e,t){if(this.enabled&&!this.isSkipped())try{return this.getSegment().track(e,Z(Z({},t),this.globalProperties))}catch(i){Ie.error(`Failed to track event ${e}`,i)}}getSegment(){if(!this.segment)throw Ie.error("Analytics not initialized. Call Analytics.init() first."),new Error("Analytics not initialized. Call Analytics.init() first.");return this.segment}isSkipped(){let e=window.location.origin;return!!(e.startsWith("http://")||e.includes("localhost"))}},Bs={SDK_INITIALIZATION_COMPLETED:"SDK Initialization Completed",SDK_INITIALIZATION_FAILED:"SDK Initialization Failed",CONNECTION_STARTED:"Connection Started",CONNECTION_COMPLETED:"Connection Completed",CONNECTION_FAILED:"Connection Failed",IDENTITY_TOKEN_STARTED:"Identity Token Started",IDENTITY_TOKEN_COMPLETED:"Identity Token Completed",IDENTITY_TOKEN_FAILED:"Identity Token Failed",MFA_ENABLEMENT_STARTED:"MFA Enablement Started",MFA_ENABLEMENT_COMPLETED:"MFA Enablement Completed",MFA_ENABLEMENT_FAILED:"MFA Enablement Failed",MFA_MANAGEMENT_SELECTED:"MFA Management Selected",MFA_MANAGEMENT_FAILED:"MFA Management Failed",LOGIN_MODAL_OPENED:"Login Modal Opened",LOGIN_MODAL_CLOSED:"Login Modal Closed",SOCIAL_LOGIN_SELECTED:"Social Login Selected",EXTERNAL_WALLET_SELECTED:"External Wallet Selected",EXTERNAL_WALLET_LIST_EXPANDED:"External Wallet List Expanded",WALLET_UI_CLICKED:"Wallet UI Clicked",WALLET_CONNECT_SCANNER_CLICKED:"Wallet Connect Scanner Clicked",WALLET_CHECKOUT_CLICKED:"Wallet Checkout Clicked",WALLET_SWAP_CLICKED:"Wallet Swap Clicked"},cU={REACT_HOOKS:"React Hooks",VUE_COMPOSABLES:"Vue Composables",NATIVE_SDK:"Native SDK"},uU={WEB_NO_MODAL:"Web NoModal",WEB_MODAL:"Web Modal"};var yd=class extends Xd{constructor(e){var t,i,n,s,o;super(e),De(this,"name",Ui.WALLET_CONNECT_V2),De(this,"connectorNamespace",Yd.MULTICHAIN),De(this,"currentChainNamespace",ke.OTHER),De(this,"type",Jd.EXTERNAL),De(this,"connectorOptions",void 0),De(this,"status",ct.NOT_READY),De(this,"connectorData",{uri:""}),De(this,"connector",null),De(this,"activeSession",null),De(this,"wcProvider",null),De(this,"analytics",void 0),this.connectorOptions=Z({},e);let{qrcodeModal:a,walletConnectInitOptions:c}=e?.connectorSettings||{};this.connectorOptions=Z(Z({},this.connectorOptions),{},{connectorSettings:(t=(i=this.connectorOptions)===null||i===void 0?void 0:i.connectorSettings)!==null&&t!==void 0?t:{},loginSettings:(n=(s=this.connectorOptions)===null||s===void 0?void 0:s.loginSettings)!==null&&n!==void 0?n:{}}),this.analytics=e.analytics,a&&(this.connectorOptions.connectorSettings.qrcodeModal=a),c&&(this.connectorOptions.connectorSettings.walletConnectInitOptions=Z(Z({},(o=this.connectorOptions.connectorSettings.walletConnectInitOptions)!==null&&o!==void 0?o:{}),c));let{loginSettings:u}=e;u&&(this.connectorOptions.loginSettings=Z(Z({},this.connectorOptions.loginSettings||{}),u))}get connected(){return!!this.activeSession}get provider(){return this.status!==ct.NOT_READY&&this.wcProvider?this.wcProvider:null}set provider(e){throw new Error("Not implemented")}async init(e){var t;let i=this.coreOptions.chains.find(c=>c.chainId===e.chainId);super.checkInitializationRequirements({chainConfig:i});let n=(t=this.connectorOptions.connectorSettings)===null||t===void 0||(t=t.walletConnectInitOptions)===null||t===void 0?void 0:t.projectId,s=this.coreOptions.chains.filter(c=>c.chainNamespace===ke.EIP155||c.chainNamespace===ke.SOLANA);if(s.length===0)throw Xt.invalidParams("No supported chains found");let o=await gf(s,n);(!this.connectorOptions.loginSettings||Object.keys(this.connectorOptions.loginSettings).length===0)&&(this.connectorOptions.loginSettings=o.loginSettings),this.connectorOptions.connectorSettings=(0,_v.default)(o.connectorSettings||{},this.connectorOptions.connectorSettings||{});let{connectorSettings:a}=this.connectorOptions;if(this.connector=await za.init(a?.walletConnectInitOptions),this.wcProvider=new xi({config:{chain:i,chains:this.coreOptions.chains},connector:this.connector}),this.emit(Qt.READY,Ui.WALLET_CONNECT_V2),this.status=ct.READY,Ie.debug("initializing wallet connect v2 connector"),e.autoConnect)if(await this.checkForPersistedSession(),this.connected){this.rehydrated=!0;try{await this.onConnectHandler({chain:i})}catch(c){Ie.error("wallet auto connect",c),this.emit(Qt.REHYDRATION_ERROR,c)}}else this.status=ct.NOT_READY,this.emit(Qt.CACHE_CLEAR)}async connect({chainId:e}){super.checkConnectionRequirements();let t=this.coreOptions.chains.find(c=>c.chainId===e);if(!t)throw It.connectionError("Chain config is not available");if(!this.connector)throw Xt.notReady("Wallet connector is not ready yet");let i=!this.connected&&!this.rehydrated,n=Date.now(),s={connector:this.name,connector_type:this.type,is_injected:this.isInjected,is_wallet_connect:!0,chain_id:Wd(t),chain_name:t?.displayName,chain_namespace:t?.chainNamespace};try{let c=()=>{if(i){var u,l,h;let{name:d,url:p,redirect:f}=((u=this.activeSession)===null||u===void 0||(u=u.peer)===null||u===void 0?void 0:u.metadata)||{},{native:g,universal:m,linkMode:w}=f||{};s=Z(Z({},s),{},{connector:d||this.name,wallet_url:p,redirect_native:g,redirect_universal:m,redirect_link_mode_enabled:w}),(l=this.analytics)===null||l===void 0||l.track(Bs.CONNECTION_STARTED,s),(h=this.analytics)===null||h===void 0||h.track(Bs.CONNECTION_COMPLETED,Z(Z({},s),{},{duration:Date.now()-n}))}};return this.connected?(await this.onConnectHandler({chain:t}),this.provider):(this.status!==ct.CONNECTING&&await this.createNewSession({chainConfig:t,trackCompletionEvents:c}),this.provider)}catch(c){if(Ie.error("Wallet connect v2 connector error while connecting",c),this.status=ct.READY,this.rehydrated=!0,this.emit(Qt.ERRORED,c),i){var o,a;(o=this.analytics)===null||o===void 0||o.track(Bs.CONNECTION_STARTED,s),(a=this.analytics)===null||a===void 0||a.track(Bs.CONNECTION_FAILED,Z(Z(Z({},s),Dd(c)),{},{duration:Date.now()-n}))}throw c instanceof Hd?c:It.connectionError(`Failed to login with wallet connect: ${c?.message||""}`,c)}}async switchChain(e,t=!1){if(super.checkSwitchChainRequirements(e,t),!this.wcProvider)throw Xt.notReady("Wallet Connect provider is not ready yet");try{await this.wcProvider.switchChain({chainId:e.chainId})}catch(i){throw Ie.error("error while switching chain",i),i}}async getUserInfo(){if(!this.connected)throw It.notConnectedError("Not connected with wallet, Please login/connect first");return{}}async disconnect(e={cleanup:!1,sessionRemovedByWallet:!1}){var t,i;let{cleanup:n}=e;if(!this.connector||!this.connected||!((t=this.activeSession)!==null&&t!==void 0&&t.topic))throw It.notConnectedError("Not connected with wallet");e.sessionRemovedByWallet||await this.connector.disconnect({topic:(i=this.activeSession)===null||i===void 0?void 0:i.topic,reason:he("USER_DISCONNECTED")}),this.rehydrated=!1,n?(this.connector=null,this.status=ct.NOT_READY,this.wcProvider=null):this.status=ct.READY,this.activeSession=null,this.emit(Qt.DISCONNECTED)}async getIdentityToken(){if(!this.provider||this.status!==ct.CONNECTED)throw It.notConnectedError();let{chainId:e}=this.provider,t=this.coreOptions.chains.find(s=>s.chainId===e);if(!t)throw It.connectionError("Chain config is not available");let{chainNamespace:i}=t,n=await this.provider.request({method:i===ke.EIP155?Tr.GET_ACCOUNTS:ki.GET_ACCOUNTS});if(n&&n.length>0){let s=Zd(n[0],this.name);if(s&&!Qd(s))return{idToken:s};let o={domain:window.location.origin,uri:window.location.href,address:n[0],chainId:parseInt(e,16),version:"1",nonce:Math.random().toString(36).slice(2),issuedAt:new Date().toISOString()},a=await Cd(o,i),c=await this._getSignedMessage(a,n,i),u=await Od(i,c,a,this.name,this.coreOptions.sessionTime,this.coreOptions.clientId,this.coreOptions.web3AuthNetwork);return ef(n[0],this.name,u),{idToken:u}}throw It.notConnectedError("Not connected with wallet, Please login/connect first")}async enableMFA(){throw new Error("Method Not implemented")}async manageMFA(){throw new Error("Method Not implemented")}cleanupPendingPairings(){if(!this.connector)throw Xt.notReady("Wallet connector is not ready yet");let e=this.connector.pairing.getAll({active:!1});Sr(e)&&e.forEach(t=>{this.connector&&this.connector.pairing.delete(t.topic,he("USER_DISCONNECTED"))})}async checkForPersistedSession(){if(!this.connector)throw Xt.notReady("Wallet connector is not ready yet");if(this.connector.session.length){let e=this.connector.session.keys.length-1;this.activeSession=this.connector.session.get(this.connector.session.keys[e])}return this.activeSession}async createNewSession({forceNewSession:e=!1,chainConfig:t,trackCompletionEvents:i}){try{var n,s;if(!this.connector)throw Xt.notReady("Wallet connector is not ready yet");if(!this.connectorOptions.loginSettings||Object.keys(this.connectorOptions.loginSettings).length===0)throw Xt.notReady("login settings are not set yet");if(this.status=ct.CONNECTING,this.emit(Qt.CONNECTING,{connector:Ui.WALLET_CONNECT_V2}),e&&(n=this.activeSession)!==null&&n!==void 0&&n.topic){var o;await this.connector.disconnect({topic:(o=this.activeSession)===null||o===void 0?void 0:o.topic,reason:he("USER_DISCONNECTED")})}let{uri:c,approval:u}=await this.connector.connect(this.connectorOptions.loginSettings),l=(s=this.connectorOptions)===null||s===void 0||(s=s.connectorSettings)===null||s===void 0?void 0:s.qrcodeModal;if(c)if(l)try{await l.openModal({uri:c}),Ie.debug("EVENT","QR Code Modal closed"),this.status=ct.READY,this.emit(Qt.READY,Ui.WALLET_CONNECT_V2)}catch(d){Ie.error("unable to open qr code modal",d)}else this.updateConnectorData({uri:c});Ie.info("awaiting session approval from wallet");let h=await u();this.activeSession=h,await this.onConnectHandler({chain:t,trackCompletionEvents:i}),l&&l.closeModal()}catch(c){var a;if((a=c.message)!==null&&a!==void 0&&a.toLowerCase().includes("proposal expired")){if(Ie.info("current connector status: ",this.status),this.status===ct.CONNECTING)return Ie.info("retrying to create new wallet connect session since proposal expired"),this.createNewSession({forceNewSession:!0,chainConfig:t});if(this.status===ct.READY){Ie.info("ignoring proposal expired error since some other connector is connected");return}}throw Ie.error("error while creating new wallet connect session",c),this.emit(Qt.ERRORED,c),c}}async onConnectHandler({chain:e,trackCompletionEvents:t}){var i;if(!this.connector||!this.wcProvider)throw Xt.notReady("Wallet connect connector is not ready yet");this.subscribeEvents(),(i=this.connectorOptions.connectorSettings)!==null&&i!==void 0&&i.qrcodeModal&&(this.wcProvider=new xi({config:{chain:e,chains:this.coreOptions.chains,skipLookupNetwork:!0},connector:this.connector})),await this.wcProvider.setupProvider(this.connector),this.cleanupPendingPairings(),this.status=ct.CONNECTED,t&&t(),this.emit(Qt.CONNECTED,{connector:Ui.WALLET_CONNECT_V2,reconnected:this.rehydrated,provider:this.provider})}subscribeEvents(){if(!this.connector)throw Xt.notReady("Wallet connector is not ready yet");this.connector.events.on("session_update",({topic:e,params:t})=>{if(!this.connector)return;let{namespaces:i}=t,n=this.connector.session.get(e),s=Z(Z({},n),{},{namespaces:i});this.activeSession=s}),this.connector.events.on("session_delete",()=>{this.disconnect({sessionRemovedByWallet:!0})})}async _getSignedMessage(e,t,i){return await this.provider.request({method:i===ke.EIP155?Tr.PERSONAL_SIGN:ki.SIGN_MESSAGE,params:i===ke.EIP155?[e,t[0]]:{data:e}})}},TU=r=>({coreOptions:e,projectConfig:t,analytics:i})=>{var n;let s=(r==null||(n=r.walletConnectInitOptions)===null||n===void 0?void 0:n.projectId)||t?.walletConnectProjectId,o=Z(Z({},r),{},{walletConnectInitOptions:Z(Z({},r?.walletConnectInitOptions),{},{projectId:s})});return new yd({connectorSettings:o,coreOptions:e,analytics:i})};export{xv as a,Bs as b,cU as c,uU as d,ff as e,pf as f,JO as g,Mv as h,qv as i,zv as j,jv as k,$v as l,Kv as m,Hv as n,Wv as o,gf as p,xi as q,TU as r};
