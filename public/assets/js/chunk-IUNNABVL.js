import{a as h}from"./chunk-GEDAPGUD.js";import{c as g,d as b,k as _}from"./chunk-PVBWCU6O.js";import{a as d,b as s,d as m,e as v,f as p}from"./chunk-U5CWZESK.js";var T=function(){var r,e,t=!1,i=new Promise(function(o,n){r=function(){for(var u=[],a=0;a<arguments.length;a++)u[a]=arguments[a];t=!0,o.apply(void 0,u)},e=function(){for(var u=[],a=0;a<arguments.length;a++)u[a]=arguments[a];t=!0,n.apply(void 0,u)}});return{resolve:r,reject:e,promise:i,isSettled:function(){return t}}};var x=(function(){function r(e){var t;this.callbacks={},this.warned=!1,this.maxListeners=(t=e?.maxListeners)!==null&&t!==void 0?t:10}return r.prototype.warnIfPossibleMemoryLeak=function(e){this.warned||this.maxListeners&&this.callbacks[e].length>this.maxListeners&&(this.warned=!0)},r.prototype.on=function(e,t){return this.callbacks[e]?(this.callbacks[e].push(t),this.warnIfPossibleMemoryLeak(e)):this.callbacks[e]=[t],this},r.prototype.once=function(e,t){var i=this,o=function(){for(var n=[],u=0;u<arguments.length;u++)n[u]=arguments[u];i.off(e,o),t.apply(i,n)};return this.on(e,o),this},r.prototype.off=function(e,t){var i,o=(i=this.callbacks[e])!==null&&i!==void 0?i:[],n=o.filter(function(u){return u!==t});return this.callbacks[e]=n,this},r.prototype.emit=function(e){for(var t=this,i,o=[],n=1;n<arguments.length;n++)o[n-1]=arguments[n];var u=(i=this.callbacks[e])!==null&&i!==void 0?i:[];return u.forEach(function(a){a.apply(t,o)}),this},r})();function O(r){var e=Math.random()+1,t=r.minTimeout,i=t===void 0?500:t,o=r.factor,n=o===void 0?2:o,u=r.attempt,a=r.maxTimeout,c=a===void 0?1/0:a;return Math.min(e*i*Math.pow(n,u),c)}var q="onRemoveFromFuture",y=(function(r){d(e,r);function e(t,i,o){var n=r.call(this)||this;return n.future=[],n.maxAttempts=t,n.queue=i,n.seen=o??{},n}return e.prototype.push=function(){for(var t=this,i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];var n=i.map(function(u){var a=t.updateAttempts(u);return a>t.maxAttempts||t.includes(u)?!1:(t.queue.push(u),!0)});return this.queue=this.queue.sort(function(u,a){return t.getAttempts(u)-t.getAttempts(a)}),n},e.prototype.pushWithBackoff=function(t,i){var o=this;if(i===void 0&&(i=0),i==0&&this.getAttempts(t)===0)return this.push(t)[0];var n=this.updateAttempts(t);if(n>this.maxAttempts||this.includes(t))return!1;var u=O({attempt:n-1});return i>0&&u<i&&(u=i),setTimeout(function(){o.queue.push(t),o.future=o.future.filter(function(a){return a.id!==t.id}),o.emit(q)},u),this.future.push(t),!0},e.prototype.getAttempts=function(t){var i;return(i=this.seen[t.id])!==null&&i!==void 0?i:0},e.prototype.updateAttempts=function(t){return this.seen[t.id]=this.getAttempts(t)+1,this.getAttempts(t)},e.prototype.includes=function(t){return this.queue.includes(t)||this.future.includes(t)||!!this.queue.find(function(i){return i.id===t.id})||!!this.future.find(function(i){return i.id===t.id})},e.prototype.pop=function(){return this.queue.shift()},Object.defineProperty(e.prototype,"length",{get:function(){return this.queue.length},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"todo",{get:function(){return this.queue.length+this.future.length},enumerable:!1,configurable:!0}),e})(x);function k(r){return m(this,void 0,void 0,function(){var e;return v(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,r()];case 1:return[2,t.sent()];case 2:return e=t.sent(),[2,Promise.reject(e)];case 3:return[2]}})})}function A(r,e){r.log("debug","plugin",{plugin:e.name});var t=new Date().getTime(),i=e[r.event.type];if(i===void 0)return Promise.resolve(r);var o=k(function(){return i.apply(e,[r])}).then(function(n){var u=new Date().getTime()-t;return n.stats.gauge("plugin_time",u,["plugin:".concat(e.name)]),n}).catch(function(n){if(n instanceof g&&n.type==="middleware_cancellation")throw n;return n instanceof g?(r.log("warn",n.type,{plugin:e.name,error:n}),n):(r.log("error","plugin Error",{plugin:e.name,error:n}),r.stats.increment("plugin_error",1,["plugin:".concat(e.name)]),n)});return o}function V(r,e){return A(r,e).then(function(t){if(t instanceof b)return t;r.log("debug","Context canceled"),r.stats.increment("context_canceled"),r.cancel(t)})}function S(){return h()?window.navigator.onLine:!0}function G(){return!S()}var f={getItem:function(){},setItem:function(){},removeItem:function(){}};try{f=h()&&window.localStorage?window.localStorage:f}catch{}function I(r){var e=f.getItem(r);return(e?JSON.parse(e):[]).map(function(t){return new _(t.event,t.id)})}function N(r,e){var t=I(r),i=p(p([],e,!0),t,!0),o=i.reduce(function(n,u){var a;return s(s({},n),(a={},a[u.id]=u,a))},{});f.setItem(r,JSON.stringify(Object.values(o)))}function P(r){var e=f.getItem(r);return e?JSON.parse(e):{}}function j(r,e){var t=P(r);f.setItem(r,JSON.stringify(s(s({},t),e)))}function E(r){f.removeItem(r)}var L=function(){return new Date().getTime()};function w(r,e,t){t===void 0&&(t=0);var i=50,o="persisted-queue:v1:".concat(r,":lock"),n=function(l){return new Date().getTime()>l},u=f.getItem(o),a=u?JSON.parse(u):null,c=a===null||n(a);if(c){f.setItem(o,JSON.stringify(L()+i)),e(),f.removeItem(o);return}!c&&t<3&&setTimeout(function(){w(r,e,t+1)},i)}var rt=(function(r){d(e,r);function e(t,i){var o=r.call(this,t,[])||this,n="persisted-queue:v1:".concat(i,":items"),u="persisted-queue:v1:".concat(i,":seen"),a=[],c={};return w(i,function(){try{a=I(n),c=P(u),E(n),E(u),o.queue=p(p([],a,!0),o.queue,!0),o.seen=s(s({},c),o.seen)}catch{}}),window.addEventListener("pagehide",function(){if(o.todo>0){var l=p(p([],o.queue,!0),o.future,!0);try{w(i,function(){N(n,l),j(u,o.seen)})}catch{}}}),o}return e})(y);var it=function(r,e){return m(void 0,void 0,void 0,function(){var t;return v(this,function(i){return t=function(o){return m(void 0,void 0,void 0,function(){var n;return v(this,function(u){switch(u.label){case 0:return r(o)?(n=t,[4,e()]):[3,2];case 1:return[2,n.apply(void 0,[u.sent()])];case 2:return[2]}})})},[2,t(void 0)]})})};function st(r,e){var t,i=Object.entries((t=e.integrations)!==null&&t!==void 0?t:{}).reduce(function(o,n){var u,a,c=n[0],l=n[1];return typeof l=="object"?s(s({},o),(u={},u[c]=l,u)):s(s({},o),(a={},a[c]={},a))},{});return Object.entries(r.integrations).reduce(function(o,n){var u,a=n[0],c=n[1];return s(s({},o),(u={},u[a]=s(s({},c),i[a]),u))},{})}function ft(r,e){var t=e.methodName,i=e.integrationName,o=e.type,n=e.didError,u=n===void 0?!1:n;r.stats.increment("analytics_js.integration.invoke".concat(u?".error":""),1,["method:".concat(t),"integration_name:".concat(i),"type:".concat(o)])}export{T as a,x as b,q as c,y as d,A as e,V as f,S as g,G as h,rt as i,it as j,st as k,ft as l};
